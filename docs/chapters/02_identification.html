<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Identification in Macroeconomics – Mastering Empirical Macroeconometrics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/03_local_projections.html" rel="next">
<link href="../chapters/01_panel_econometrics.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-f555ed0e695c0487cf72966c0b30f9ff.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-ec3f846469679b9e6f6b146d88a0bba5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/01_panel_econometrics.html">Phase 1: Foundations</a></li><li class="breadcrumb-item"><a href="../chapters/02_identification.html"><span class="chapter-title">Identification in Macroeconomics</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Mastering Empirical Macroeconometrics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/bijoyratanghosh/empirical-macro-curriculum" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Mastering Empirical Macroeconometrics</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 1: Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01_panel_econometrics.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Panel Data Econometrics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02_identification.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Identification in Macroeconomics</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 2: Dynamic Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03_local_projections.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Local Projections</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04_var_svar.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Vector Autoregressions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 3: Treatment Effects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05_staggered_did.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Staggered Difference-in-Differences</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06_synthetic_control.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Synthetic Control Methods</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 4: Bayesian Econometrics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07_bayesian_foundations.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Bayesian Foundations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08_bayesian_var.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Bayesian Vector Autoregressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09_bayesian_panel.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Bayesian Panel Methods</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 5: Structural Macro</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10_dsge_foundations.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">DSGE Foundations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11_dsge_estimation.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">DSGE Estimation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 6: Causal Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12_regularization.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Regularization for Macro</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13_causal_ml.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Causal Machine Learning</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-fundamental-problem" id="toc-the-fundamental-problem" class="nav-link active" data-scroll-target="#the-fundamental-problem">The Fundamental Problem</a>
  <ul class="collapse">
  <li><a href="#why-correlation-causation" id="toc-why-correlation-causation" class="nav-link" data-scroll-target="#why-correlation-causation">Why Correlation ≠ Causation</a>
  <ul class="collapse">
  <li><a href="#the-ideal-experiment" id="toc-the-ideal-experiment" class="nav-link" data-scroll-target="#the-ideal-experiment">The Ideal Experiment</a></li>
  <li><a href="#three-sources-of-bias" id="toc-three-sources-of-bias" class="nav-link" data-scroll-target="#three-sources-of-bias">Three Sources of Bias</a></li>
  <li><a href="#why-controlling-for-doesnt-solve-it" id="toc-why-controlling-for-doesnt-solve-it" class="nav-link" data-scroll-target="#why-controlling-for-doesnt-solve-it">Why “Controlling For” Doesn’t Solve It</a></li>
  </ul></li>
  <li><a href="#directed-acyclic-graphs-dags" id="toc-directed-acyclic-graphs-dags" class="nav-link" data-scroll-target="#directed-acyclic-graphs-dags">Directed Acyclic Graphs (DAGs)</a></li>
  <li><a href="#fixed-effects-as-partial-solution" id="toc-fixed-effects-as-partial-solution" class="nav-link" data-scroll-target="#fixed-effects-as-partial-solution">Fixed Effects as Partial Solution</a></li>
  </ul></li>
  <li><a href="#difference-in-differences" id="toc-difference-in-differences" class="nav-link" data-scroll-target="#difference-in-differences">Difference-in-Differences</a>
  <ul class="collapse">
  <li><a href="#the-classic-22-design" id="toc-the-classic-22-design" class="nav-link" data-scroll-target="#the-classic-22-design">The Classic 2×2 Design</a></li>
  <li><a href="#the-parallel-trends-assumption" id="toc-the-parallel-trends-assumption" class="nav-link" data-scroll-target="#the-parallel-trends-assumption">The Parallel Trends Assumption</a></li>
  <li><a href="#pre-trends-testing-and-its-limits" id="toc-pre-trends-testing-and-its-limits" class="nav-link" data-scroll-target="#pre-trends-testing-and-its-limits">Pre-Trends Testing and Its Limits</a>
  <ul class="collapse">
  <li><a href="#the-event-study-specification" id="toc-the-event-study-specification" class="nav-link" data-scroll-target="#the-event-study-specification">The Event Study Specification</a></li>
  <li><a href="#roth-2022-pre-trends-testing-has-low-power" id="toc-roth-2022-pre-trends-testing-has-low-power" class="nav-link" data-scroll-target="#roth-2022-pre-trends-testing-has-low-power">Roth (2022): Pre-Trends Testing Has Low Power</a></li>
  </ul></li>
  <li><a href="#natural-experiments-in-macro" id="toc-natural-experiments-in-macro" class="nav-link" data-scroll-target="#natural-experiments-in-macro">Natural Experiments in Macro</a></li>
  </ul></li>
  <li><a href="#instrumental-variables" id="toc-instrumental-variables" class="nav-link" data-scroll-target="#instrumental-variables">Instrumental Variables</a>
  <ul class="collapse">
  <li><a href="#the-logic-of-instruments" id="toc-the-logic-of-instruments" class="nav-link" data-scroll-target="#the-logic-of-instruments">The Logic of Instruments</a></li>
  <li><a href="#two-stage-least-squares" id="toc-two-stage-least-squares" class="nav-link" data-scroll-target="#two-stage-least-squares">Two-Stage Least Squares</a></li>
  <li><a href="#weak-instruments" id="toc-weak-instruments" class="nav-link" data-scroll-target="#weak-instruments">Weak Instruments</a></li>
  <li><a href="#shift-share-bartik-instruments" id="toc-shift-share-bartik-instruments" class="nav-link" data-scroll-target="#shift-share-bartik-instruments">Shift-Share (Bartik) Instruments</a></li>
  <li><a href="#gmm-for-dynamic-panels" id="toc-gmm-for-dynamic-panels" class="nav-link" data-scroll-target="#gmm-for-dynamic-panels">GMM for Dynamic Panels</a></li>
  </ul></li>
  <li><a href="#small-sample-inference" id="toc-small-sample-inference" class="nav-link" data-scroll-target="#small-sample-inference">Small-Sample Inference</a>
  <ul class="collapse">
  <li><a href="#the-small-cluster-problem" id="toc-the-small-cluster-problem" class="nav-link" data-scroll-target="#the-small-cluster-problem">The Small-Cluster Problem</a></li>
  <li><a href="#wild-cluster-bootstrap" id="toc-wild-cluster-bootstrap" class="nav-link" data-scroll-target="#wild-cluster-bootstrap">Wild Cluster Bootstrap</a></li>
  <li><a href="#when-to-use-what" id="toc-when-to-use-what" class="nav-link" data-scroll-target="#when-to-use-what">When to Use What</a></li>
  </ul></li>
  <li><a href="#putting-it-together" id="toc-putting-it-together" class="nav-link" data-scroll-target="#putting-it-together">Putting It Together</a>
  <ul class="collapse">
  <li><a href="#checklist-for-identification" id="toc-checklist-for-identification" class="nav-link" data-scroll-target="#checklist-for-identification">Checklist for Identification</a></li>
  <li><a href="#common-pitfalls" id="toc-common-pitfalls" class="nav-link" data-scroll-target="#common-pitfalls">Common Pitfalls</a></li>
  </ul></li>
  <li><a href="#frequently-asked-questions" id="toc-frequently-asked-questions" class="nav-link" data-scroll-target="#frequently-asked-questions">Frequently Asked Questions</a>
  <ul class="collapse">
  <li><a href="#how-do-i-know-if-parallel-trends-holds" id="toc-how-do-i-know-if-parallel-trends-holds" class="nav-link" data-scroll-target="#how-do-i-know-if-parallel-trends-holds">How do I know if parallel trends holds?</a></li>
  <li><a href="#when-should-i-use-iv-vs.-did" id="toc-when-should-i-use-iv-vs.-did" class="nav-link" data-scroll-target="#when-should-i-use-iv-vs.-did">When should I use IV vs.&nbsp;DiD?</a></li>
  <li><a href="#what-if-my-first-stage-f-is-below-10" id="toc-what-if-my-first-stage-f-is-below-10" class="nav-link" data-scroll-target="#what-if-my-first-stage-f-is-below-10">What if my first-stage F is below 10?</a></li>
  <li><a href="#how-many-clusters-do-i-need" id="toc-how-many-clusters-do-i-need" class="nav-link" data-scroll-target="#how-many-clusters-do-i-need">How many clusters do I need?</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/bijoyratanghosh/empirical-macro-curriculum/edit/main/chapters/02_identification.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/bijoyratanghosh/empirical-macro-curriculum/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/01_panel_econometrics.html">Phase 1: Foundations</a></li><li class="breadcrumb-item"><a href="../chapters/02_identification.html"><span class="chapter-title">Identification in Macroeconomics</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">Identification in Macroeconomics</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">From Correlation to Causation</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="the-fundamental-problem" class="level1 unnumbered">
<h1 class="unnumbered">The Fundamental Problem</h1>
<p>This section develops the core challenge of causal inference in macroeconomic settings: moving from observed correlations to credible causal estimates.</p>
<section id="why-correlation-causation" class="level2">
<h2 class="anchored" data-anchor-id="why-correlation-causation">Why Correlation ≠ Causation</h2>
<section id="the-ideal-experiment" class="level3">
<h3 class="anchored" data-anchor-id="the-ideal-experiment">The Ideal Experiment</h3>
<p>To measure the causal effect of a policy <span class="math inline">\(D\)</span> on an outcome <span class="math inline">\(Y\)</span>, we would ideally observe:</p>
<p><span class="math display">\[
\tau_i = Y_i(1) - Y_i(0)
\]</span></p>
<p>where <span class="math inline">\(Y_i(1)\)</span> is the outcome if unit <span class="math inline">\(i\)</span> receives treatment, and <span class="math inline">\(Y_i(0)\)</span> is the outcome if it doesn’t. The <strong>fundamental problem of causal inference</strong> is that we only observe one of these potential outcomes for each unit.</p>
<p>In macro settings, this is particularly severe: - We can’t randomly assign monetary policy across countries - We can’t rerun history with different fiscal rules - Countries that adopt different policies differ in many other ways</p>
</section>
<section id="three-sources-of-bias" class="level3">
<h3 class="anchored" data-anchor-id="three-sources-of-bias">Three Sources of Bias</h3>
<p>When we estimate <span class="math inline">\(\hat{\beta}\)</span> from a regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(X\)</span>, the estimate can be biased for the true causal effect <span class="math inline">\(\beta\)</span> due to:</p>
<p><strong>1. Simultaneity (Reverse Causality)</strong></p>
<p><span class="math display">\[
X \rightarrow Y \quad \text{AND} \quad Y \rightarrow X
\]</span></p>
<p>Example: Do high interest rates cause low inflation, or does low inflation allow central banks to keep rates high? The regression coefficient captures both directions.</p>
<p><strong>2. Selection (Confounding)</strong></p>
<p><span class="math display">\[
Z \rightarrow X \quad \text{AND} \quad Z \rightarrow Y
\]</span></p>
<p>Example: Countries with strong institutions (<span class="math inline">\(Z\)</span>) both adopt prudent debt management (<span class="math inline">\(X\)</span>) and have stable monetary policy (<span class="math inline">\(Y\)</span>). The correlation between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> reflects their common cause <span class="math inline">\(Z\)</span>.</p>
<p><strong>3. Omitted Variables</strong></p>
<p>A special case of confounding where the confounder <span class="math inline">\(Z\)</span> is unobserved:</p>
<p><span class="math display">\[
\hat{\beta}_{OLS} \xrightarrow{p} \beta + \underbrace{\gamma \cdot \frac{\text{Cov}(X, Z)}{\text{Var}(X)}}_{\text{omitted variable bias}}
\]</span></p>
<p>where <span class="math inline">\(\gamma\)</span> is the effect of <span class="math inline">\(Z\)</span> on <span class="math inline">\(Y\)</span>.</p>
</section>
<section id="why-controlling-for-doesnt-solve-it" class="level3">
<h3 class="anchored" data-anchor-id="why-controlling-for-doesnt-solve-it">Why “Controlling For” Doesn’t Solve It</h3>
<p>A common but flawed intuition: “Just add more controls to the regression.”</p>
<p><strong>Problem 1: Bad Controls</strong></p>
<p>Adding post-treatment variables can <em>introduce</em> bias. If <span class="math inline">\(M\)</span> is affected by treatment:</p>
<pre><code>D → M → Y    (M is a mediator)</code></pre>
<p>Controlling for <span class="math inline">\(M\)</span> blocks part of the causal effect of <span class="math inline">\(D\)</span> on <span class="math inline">\(Y\)</span>.</p>
<p><strong>Problem 2: Unobservables</strong></p>
<p>You can only control for what you observe. In macro: - Institutional quality is hard to measure - Political constraints are unobserved - Market expectations are latent</p>
<p><strong>Problem 3: Measurement Error</strong></p>
<p>Controls measured with error don’t fully absorb confounding:</p>
<p><span class="math display">\[
\tilde{Z} = Z + \nu \quad \Rightarrow \quad \text{bias persists even after controlling for } \tilde{Z}
\]</span></p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>The Credibility Revolution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Modern applied economics requires more than “throwing in controls.” It requires an <strong>identification strategy</strong>—a credible argument for why the remaining variation in <span class="math inline">\(X\)</span> is as good as randomly assigned conditional on the research design.</p>
</div>
</div>
</section>
</section>
<section id="directed-acyclic-graphs-dags" class="level2">
<h2 class="anchored" data-anchor-id="directed-acyclic-graphs-dags">Directed Acyclic Graphs (DAGs)</h2>
<p>DAGs provide a visual language for identification arguments.</p>
<p><strong>Confounding structure:</strong></p>
<pre><code>    Z
   / \
  ↓   ↓
  X → Y</code></pre>
<p>In this DAG, <span class="math inline">\(Z\)</span> is a <strong>confounder</strong>: it causes both <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. The path <span class="math inline">\(X \leftarrow Z \rightarrow Y\)</span> creates a spurious correlation between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> even if <span class="math inline">\(X\)</span> has no causal effect on <span class="math inline">\(Y\)</span>.</p>
<p><strong>Key DAG concepts:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 21%">
<col style="width: 32%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th>Term</th>
<th>Meaning</th>
<th>Implication</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Confounder</strong></td>
<td>Common cause of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span></td>
<td>Must control for it (or use design)</td>
</tr>
<tr class="even">
<td><strong>Mediator</strong></td>
<td>On causal path from <span class="math inline">\(X\)</span> to <span class="math inline">\(Y\)</span></td>
<td>Don’t control for it</td>
</tr>
<tr class="odd">
<td><strong>Collider</strong></td>
<td>Caused by both <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span></td>
<td>Don’t control for it</td>
</tr>
<tr class="even">
<td><strong>Backdoor path</strong></td>
<td>Non-causal path from <span class="math inline">\(X\)</span> to <span class="math inline">\(Y\)</span></td>
<td>Must block to identify causal effect</td>
</tr>
</tbody>
</table>
</section>
<section id="fixed-effects-as-partial-solution" class="level2">
<h2 class="anchored" data-anchor-id="fixed-effects-as-partial-solution">Fixed Effects as Partial Solution</h2>
<p>Panel fixed effects address one specific source of bias: <strong>time-invariant confounders</strong>.</p>
<p><span class="math display">\[
Y_{it} = \alpha_i + X_{it}'\beta + \varepsilon_{it}
\]</span></p>
<p>The country fixed effect <span class="math inline">\(\alpha_i\)</span> absorbs all factors that: - Differ across countries - Don’t change over time</p>
<p>This includes: geography, colonial history, legal origin, language, etc.</p>
<p><strong>What FE doesn’t solve:</strong> - Time-varying confounders - Reverse causality - Selection into treatment timing</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>The Identification Hierarchy
</div>
</div>
<div class="callout-body-container callout-body">
<p>From weakest to strongest causal claims:</p>
<ol type="1">
<li><strong>Cross-sectional correlation</strong>: Countries with high <span class="math inline">\(X\)</span> have high <span class="math inline">\(Y\)</span></li>
<li><strong>Panel FE</strong>: When a country’s <span class="math inline">\(X\)</span> rises, its <span class="math inline">\(Y\)</span> rises (within-country)</li>
<li><strong>DiD</strong>: Countries exposed to shock saw <span class="math inline">\(Y\)</span> change relative to unexposed (parallel trends)</li>
<li><strong>IV</strong>: Exogenous variation in <span class="math inline">\(X\)</span> (from instrument) causes <span class="math inline">\(Y\)</span> to change</li>
<li><strong>RCT</strong>: Random assignment of <span class="math inline">\(X\)</span> (rare in macro)</li>
</ol>
</div>
</div>
</section>
</section>
<section id="difference-in-differences" class="level1 unnumbered">
<h1 class="unnumbered">Difference-in-Differences</h1>
<p>DiD exploits variation from discrete policy changes or shocks to identify causal effects.</p>
<section id="the-classic-22-design" class="level2">
<h2 class="anchored" data-anchor-id="the-classic-22-design">The Classic 2×2 Design</h2>
<p>Consider a policy implemented in some countries (“treated”) at time <span class="math inline">\(T_0\)</span>, with other countries as controls.</p>
<p><strong>Setup:</strong> - <span class="math inline">\(D_i = 1\)</span> if country <span class="math inline">\(i\)</span> is treated, 0 otherwise - <span class="math inline">\(Post_t = 1\)</span> if <span class="math inline">\(t &gt; T_0\)</span>, 0 otherwise</p>
<p><strong>Regression:</strong> <span class="math display">\[
Y_{it} = \alpha + \beta_1 D_i + \beta_2 Post_t + \tau (D_i \times Post_t) + \varepsilon_{it}
\]</span></p>
<p><strong>The DiD estimator:</strong> <span class="math display">\[
\hat{\tau}_{DiD} = \underbrace{(\bar{Y}_{T,Post} - \bar{Y}_{T,Pre})}_{\text{Treated change}} - \underbrace{(\bar{Y}_{C,Post} - \bar{Y}_{C,Pre})}_{\text{Control change}}
\]</span></p>
<p>This “differences out” both: - Permanent differences between treated and control (first difference) - Common time trends (second difference)</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Simulate DiD data</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>T_periods <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>T0 <span class="ot">&lt;-</span> <span class="dv">5</span>  <span class="co"># Treatment at period 5</span></span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a>did_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="at">unit =</span> <span class="dv">1</span><span class="sc">:</span>N,</span>
<span id="cb3-8"><a href="#cb3-8"></a>  <span class="at">time =</span> <span class="dv">1</span><span class="sc">:</span>T_periods</span>
<span id="cb3-9"><a href="#cb3-9"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-11"><a href="#cb3-11"></a>    <span class="at">treated =</span> unit <span class="sc">&lt;=</span> N<span class="sc">/</span><span class="dv">2</span>,  <span class="co"># First half treated</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>    <span class="at">post =</span> time <span class="sc">&gt;</span> T0,</span>
<span id="cb3-13"><a href="#cb3-13"></a>    <span class="co"># Parallel trends in potential outcomes</span></span>
<span id="cb3-14"><a href="#cb3-14"></a>    <span class="at">Y0 =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> time <span class="sc">+</span> <span class="fu">ifelse</span>(treated, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb3-15"><a href="#cb3-15"></a>    <span class="co"># Treatment effect of 2 units</span></span>
<span id="cb3-16"><a href="#cb3-16"></a>    <span class="at">Y1 =</span> Y0 <span class="sc">+</span> <span class="dv">2</span>,</span>
<span id="cb3-17"><a href="#cb3-17"></a>    <span class="co"># Observed outcome</span></span>
<span id="cb3-18"><a href="#cb3-18"></a>    <span class="at">Y =</span> <span class="fu">ifelse</span>(treated <span class="sc">&amp;</span> post, Y1, Y0)</span>
<span id="cb3-19"><a href="#cb3-19"></a>  )</span>
<span id="cb3-20"><a href="#cb3-20"></a></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="co"># Plot</span></span>
<span id="cb3-22"><a href="#cb3-22"></a>did_summary <span class="ot">&lt;-</span> did_data <span class="sc">%&gt;%</span></span>
<span id="cb3-23"><a href="#cb3-23"></a>  <span class="fu">group_by</span>(treated, time) <span class="sc">%&gt;%</span></span>
<span id="cb3-24"><a href="#cb3-24"></a>  <span class="fu">summarise</span>(<span class="at">Y =</span> <span class="fu">mean</span>(Y), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb3-25"><a href="#cb3-25"></a></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="fu">ggplot</span>(did_summary, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> Y, <span class="at">color =</span> treated, <span class="at">linetype =</span> treated)) <span class="sc">+</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb3-28"><a href="#cb3-28"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> T0, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb3-29"><a href="#cb3-29"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> T0, <span class="at">xend =</span> T_periods,</span>
<span id="cb3-30"><a href="#cb3-30"></a>                   <span class="at">y =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.3</span><span class="sc">*</span>T0 <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.3</span><span class="sc">*</span>(T_periods <span class="sc">-</span> T0),</span>
<span id="cb3-31"><a href="#cb3-31"></a>                   <span class="at">yend =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.3</span><span class="sc">*</span>T_periods <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb3-32"><a href="#cb3-32"></a>               <span class="at">color =</span> <span class="st">"gray50"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb3-33"><a href="#cb3-33"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> T0 <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="dv">3</span>, <span class="at">label =</span> <span class="st">"Treatment"</span>, <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb3-34"><a href="#cb3-34"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> T_periods <span class="sc">-</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="fl">5.8</span>, <span class="at">label =</span> <span class="st">"Counterfactual"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb3-35"><a href="#cb3-35"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"#3498db"</span>, <span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"#e74c3c"</span>),</span>
<span id="cb3-36"><a href="#cb3-36"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Treated"</span>)) <span class="sc">+</span></span>
<span id="cb3-37"><a href="#cb3-37"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"solid"</span>, <span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"solid"</span>),</span>
<span id="cb3-38"><a href="#cb3-38"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Treated"</span>)) <span class="sc">+</span></span>
<span id="cb3-39"><a href="#cb3-39"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Difference-in-Differences Illustration"</span>,</span>
<span id="cb3-40"><a href="#cb3-40"></a>       <span class="at">subtitle =</span> <span class="st">"Treatment effect = gap between treated and counterfactual"</span>,</span>
<span id="cb3-41"><a href="#cb3-41"></a>       <span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Outcome"</span>, <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">linetype =</span> <span class="st">"Group"</span>) <span class="sc">+</span></span>
<span id="cb3-42"><a href="#cb3-42"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="02_identification_files/figure-html/did-simulation-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Difference-in-Differences: Parallel trends allow causal inference</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="the-parallel-trends-assumption" class="level2">
<h2 class="anchored" data-anchor-id="the-parallel-trends-assumption">The Parallel Trends Assumption</h2>
<p><strong>Assumption:</strong> In the absence of treatment, treated and control groups would have followed parallel paths.</p>
<p><span class="math display">\[
E[Y_{it}(0) | D_i = 1, t] - E[Y_{it}(0) | D_i = 0, t] = \delta \quad \forall t
\]</span></p>
<p>The difference in untreated potential outcomes is constant over time.</p>
<p><strong>What this requires:</strong> - No differential pre-trends - No anticipation effects - No differential shocks coinciding with treatment</p>
<p><strong>What this does NOT require:</strong> - Levels to be the same (that’s absorbed by <span class="math inline">\(\beta_1\)</span>) - Exact parallel paths (allows for noise)</p>
</section>
<section id="pre-trends-testing-and-its-limits" class="level2">
<h2 class="anchored" data-anchor-id="pre-trends-testing-and-its-limits">Pre-Trends Testing and Its Limits</h2>
<section id="the-event-study-specification" class="level3">
<h3 class="anchored" data-anchor-id="the-event-study-specification">The Event Study Specification</h3>
<p>To assess parallel trends, estimate:</p>
<p><span class="math display">\[
Y_{it} = \alpha_i + \delta_t + \sum_{k \neq -1} \beta_k \cdot \mathbf{1}[t - T_i^* = k] + \varepsilon_{it}
\]</span></p>
<p>where <span class="math inline">\(T_i^*\)</span> is the treatment time for unit <span class="math inline">\(i\)</span>, and <span class="math inline">\(k\)</span> indexes relative time.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Simulate event study with no pre-trends</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>es_data <span class="ot">&lt;-</span> did_data <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="at">rel_time =</span> time <span class="sc">-</span> T0,</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="at">rel_time_fct =</span> <span class="fu">factor</span>(rel_time)</span>
<span id="cb4-6"><a href="#cb4-6"></a>  )</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co"># Estimate event study</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>es_model <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y <span class="sc">~</span> <span class="fu">i</span>(rel_time_fct, treated, <span class="at">ref =</span> <span class="st">"-1"</span>) <span class="sc">|</span> unit <span class="sc">+</span> time,</span>
<span id="cb4-10"><a href="#cb4-10"></a>                   <span class="at">data =</span> es_data, <span class="at">vcov =</span> <span class="sc">~</span>unit)</span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co"># Extract coefficients</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>coef_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-14"><a href="#cb4-14"></a>  <span class="at">rel_time =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"rel_time_fct::(-?[0-9]+):treated"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>,</span>
<span id="cb4-15"><a href="#cb4-15"></a>                              <span class="fu">names</span>(<span class="fu">coef</span>(es_model)))),</span>
<span id="cb4-16"><a href="#cb4-16"></a>  <span class="at">estimate =</span> <span class="fu">coef</span>(es_model),</span>
<span id="cb4-17"><a href="#cb4-17"></a>  <span class="at">se =</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(es_model)))</span>
<span id="cb4-18"><a href="#cb4-18"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rel_time)) <span class="sc">%&gt;%</span></span>
<span id="cb4-20"><a href="#cb4-20"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-21"><a href="#cb4-21"></a>    <span class="at">lower =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb4-22"><a href="#cb4-22"></a>    <span class="at">upper =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb4-23"><a href="#cb4-23"></a>  )</span>
<span id="cb4-24"><a href="#cb4-24"></a></span>
<span id="cb4-25"><a href="#cb4-25"></a><span class="co"># Add reference period</span></span>
<span id="cb4-26"><a href="#cb4-26"></a>coef_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb4-27"><a href="#cb4-27"></a>  coef_df,</span>
<span id="cb4-28"><a href="#cb4-28"></a>  <span class="fu">data.frame</span>(<span class="at">rel_time =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">estimate =</span> <span class="dv">0</span>, <span class="at">se =</span> <span class="dv">0</span>, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="dv">0</span>)</span>
<span id="cb4-29"><a href="#cb4-29"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb4-30"><a href="#cb4-30"></a>  <span class="fu">arrange</span>(rel_time)</span>
<span id="cb4-31"><a href="#cb4-31"></a></span>
<span id="cb4-32"><a href="#cb4-32"></a><span class="fu">ggplot</span>(coef_df, <span class="fu">aes</span>(<span class="at">x =</span> rel_time, <span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb4-33"><a href="#cb4-33"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb4-34"><a href="#cb4-34"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb4-35"><a href="#cb4-35"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#3498db"</span>) <span class="sc">+</span></span>
<span id="cb4-36"><a href="#cb4-36"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#3498db"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-37"><a href="#cb4-37"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"#3498db"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb4-38"><a href="#cb4-38"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">y =</span> <span class="fl">0.5</span>, <span class="at">label =</span> <span class="st">"Pre-treatment</span><span class="sc">\n</span><span class="st">(should be ≈ 0)"</span>) <span class="sc">+</span></span>
<span id="cb4-39"><a href="#cb4-39"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">3</span>, <span class="at">y =</span> <span class="fl">2.5</span>, <span class="at">label =</span> <span class="st">"Post-treatment</span><span class="sc">\n</span><span class="st">(treatment effect)"</span>) <span class="sc">+</span></span>
<span id="cb4-40"><a href="#cb4-40"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Event Study Coefficients"</span>,</span>
<span id="cb4-41"><a href="#cb4-41"></a>       <span class="at">subtitle =</span> <span class="st">"Pre-treatment coefficients near zero support parallel trends"</span>,</span>
<span id="cb4-42"><a href="#cb4-42"></a>       <span class="at">x =</span> <span class="st">"Periods Relative to Treatment"</span>,</span>
<span id="cb4-43"><a href="#cb4-43"></a>       <span class="at">y =</span> <span class="st">"Coefficient (relative to t = -1)"</span>) <span class="sc">+</span></span>
<span id="cb4-44"><a href="#cb4-44"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="sc">-</span><span class="dv">4</span><span class="sc">:</span><span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="02_identification_files/figure-html/event-study-sim-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Event study: Testing for pre-trends</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="roth-2022-pre-trends-testing-has-low-power" class="level3">
<h3 class="anchored" data-anchor-id="roth-2022-pre-trends-testing-has-low-power">Roth (2022): Pre-Trends Testing Has Low Power</h3>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Key Insight from Roth (2022)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Passing a pre-trends test does NOT guarantee parallel trends hold. The test has low power against economically meaningful violations.</p>
</div>
</div>
<p><strong>The problem:</strong> - Pre-trends tests are underpowered for typical sample sizes - Researchers often “shop” for specifications that pass the test - Even small pre-trends that pass the test can generate large bias</p>
<p><strong>Quantifying the issue:</strong></p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Simulate: How often does pre-trend test miss a real violation?</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>simulate_pretrend_test <span class="ot">&lt;-</span> <span class="cf">function</span>(delta_trend, <span class="at">n_sim =</span> <span class="dv">500</span>) {</span>
<span id="cb5-3"><a href="#cb5-3"></a>  reject <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sim)</span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sim) {</span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="co"># Generate data with differential trend</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>    data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">unit =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, <span class="at">time =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>      <span class="fu">mutate</span>(</span>
<span id="cb5-9"><a href="#cb5-9"></a>        <span class="at">treated =</span> unit <span class="sc">&lt;=</span> <span class="dv">25</span>,</span>
<span id="cb5-10"><a href="#cb5-10"></a>        <span class="at">post =</span> time <span class="sc">&gt;</span> <span class="dv">5</span>,</span>
<span id="cb5-11"><a href="#cb5-11"></a>        <span class="co"># Add differential trend for treated</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>        <span class="at">trend_effect =</span> <span class="fu">ifelse</span>(treated, delta_trend <span class="sc">*</span> time, <span class="dv">0</span>),</span>
<span id="cb5-13"><a href="#cb5-13"></a>        <span class="at">Y =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> time <span class="sc">+</span> trend_effect <span class="sc">+</span></span>
<span id="cb5-14"><a href="#cb5-14"></a>            <span class="fu">ifelse</span>(treated, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15"></a>            <span class="fu">ifelse</span>(treated <span class="sc">&amp;</span> post, <span class="dv">2</span>, <span class="dv">0</span>) <span class="sc">+</span>  <span class="co"># True effect = 2</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>            <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb5-17"><a href="#cb5-17"></a>      )</span>
<span id="cb5-18"><a href="#cb5-18"></a></span>
<span id="cb5-19"><a href="#cb5-19"></a>    <span class="co"># Test pre-trends (joint F-test on pre-treatment dummies)</span></span>
<span id="cb5-20"><a href="#cb5-20"></a>    pre_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(data, time <span class="sc">&lt;=</span> <span class="dv">5</span>)</span>
<span id="cb5-21"><a href="#cb5-21"></a>    model <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y <span class="sc">~</span> <span class="fu">i</span>(time, treated, <span class="at">ref =</span> <span class="dv">5</span>) <span class="sc">|</span> unit <span class="sc">+</span> time,</span>
<span id="cb5-22"><a href="#cb5-22"></a>                   <span class="at">data =</span> pre_data, <span class="at">vcov =</span> <span class="sc">~</span>unit)</span>
<span id="cb5-23"><a href="#cb5-23"></a></span>
<span id="cb5-24"><a href="#cb5-24"></a>    <span class="co"># Joint test of pre-treatment coefficients</span></span>
<span id="cb5-25"><a href="#cb5-25"></a>    pre_coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(model)[<span class="fu">grep</span>(<span class="st">"time::"</span>, <span class="fu">names</span>(<span class="fu">coef</span>(model)))]</span>
<span id="cb5-26"><a href="#cb5-26"></a>    <span class="cf">if</span> (<span class="fu">length</span>(pre_coefs) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb5-27"><a href="#cb5-27"></a>      <span class="co"># Simplified: check if any coefficient is significant</span></span>
<span id="cb5-28"><a href="#cb5-28"></a>      reject[s] <span class="ot">&lt;-</span> <span class="fu">any</span>(<span class="fu">abs</span>(pre_coefs) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(model))[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pre_coefs)]) <span class="sc">&gt;</span> <span class="fl">1.96</span>)</span>
<span id="cb5-29"><a href="#cb5-29"></a>    }</span>
<span id="cb5-30"><a href="#cb5-30"></a>  }</span>
<span id="cb5-31"><a href="#cb5-31"></a></span>
<span id="cb5-32"><a href="#cb5-32"></a>  <span class="fu">mean</span>(reject)  <span class="co"># Power = rejection rate</span></span>
<span id="cb5-33"><a href="#cb5-33"></a>}</span>
<span id="cb5-34"><a href="#cb5-34"></a></span>
<span id="cb5-35"><a href="#cb5-35"></a><span class="co"># Power against different trend violations</span></span>
<span id="cb5-36"><a href="#cb5-36"></a>trend_violations <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.2</span>)</span>
<span id="cb5-37"><a href="#cb5-37"></a>power <span class="ot">&lt;-</span> <span class="fu">sapply</span>(trend_violations, simulate_pretrend_test, <span class="at">n_sim =</span> <span class="dv">200</span>)</span>
<span id="cb5-38"><a href="#cb5-38"></a></span>
<span id="cb5-39"><a href="#cb5-39"></a>power_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb5-40"><a href="#cb5-40"></a>  <span class="at">differential_trend =</span> trend_violations,</span>
<span id="cb5-41"><a href="#cb5-41"></a>  <span class="at">power =</span> power</span>
<span id="cb5-42"><a href="#cb5-42"></a>)</span>
<span id="cb5-43"><a href="#cb5-43"></a></span>
<span id="cb5-44"><a href="#cb5-44"></a><span class="fu">ggplot</span>(power_df, <span class="fu">aes</span>(<span class="at">x =</span> differential_trend, <span class="at">y =</span> power)) <span class="sc">+</span></span>
<span id="cb5-45"><a href="#cb5-45"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb5-46"><a href="#cb5-46"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb5-47"><a href="#cb5-47"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.05</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb5-48"><a href="#cb5-48"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.15</span>, <span class="at">y =</span> <span class="fl">0.1</span>, <span class="at">label =</span> <span class="st">"Nominal size (5%)"</span>) <span class="sc">+</span></span>
<span id="cb5-49"><a href="#cb5-49"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Power of Pre-Trends Test"</span>,</span>
<span id="cb5-50"><a href="#cb5-50"></a>       <span class="at">subtitle =</span> <span class="st">"Even substantial trend violations often go undetected"</span>,</span>
<span id="cb5-51"><a href="#cb5-51"></a>       <span class="at">x =</span> <span class="st">"Differential Pre-Trend (per period)"</span>,</span>
<span id="cb5-52"><a href="#cb5-52"></a>       <span class="at">y =</span> <span class="st">"Rejection Rate"</span>) <span class="sc">+</span></span>
<span id="cb5-53"><a href="#cb5-53"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="02_identification_files/figure-html/roth-power-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Recommendations:</strong> 1. Report pre-trends but don’t over-interpret passing 2. Use sensitivity analysis (HonestDiD package) 3. Focus on institutional knowledge of why parallel trends should hold</p>
</section>
</section>
<section id="natural-experiments-in-macro" class="level2">
<h2 class="anchored" data-anchor-id="natural-experiments-in-macro">Natural Experiments in Macro</h2>
<p>The most credible DiD designs exploit <strong>exogenous shocks</strong> that affect some units but not others.</p>
<p><strong>Examples of natural experiments:</strong> | Shock | Treatment | Control | Papers | |——-|———–|———|——–| | German reunification | East Germany | West Germany | Fuchs-Schündeln &amp; Schündeln | | Swiss franc appreciation | Swiss border regions | French border regions | Auer et al.&nbsp;| | Oil price shocks | Oil importers vs exporters | — | Kilian &amp; Lewis | | COVID-19 | High-exposure sectors | Low-exposure sectors | — |</p>
<p><strong>What makes a good natural experiment:</strong> 1. <strong>Exogenous timing</strong>: Shock not driven by outcome of interest 2. <strong>Clear treatment/control</strong>: Units can be cleanly classified 3. <strong>No spillovers</strong>: Control units unaffected by treatment (SUTVA) 4. <strong>Plausible parallel trends</strong>: Pre-shock trends similar</p>
</section>
</section>
<section id="instrumental-variables" class="level1 unnumbered">
<h1 class="unnumbered">Instrumental Variables</h1>
<p>IV exploits exogenous variation to isolate the causal effect of an endogenous regressor.</p>
<section id="the-logic-of-instruments" class="level2">
<h2 class="anchored" data-anchor-id="the-logic-of-instruments">The Logic of Instruments</h2>
<p>An instrument <span class="math inline">\(Z\)</span> satisfies:</p>
<p><strong>1. Relevance:</strong> <span class="math inline">\(Z\)</span> affects <span class="math inline">\(X\)</span> <span class="math display">\[
\text{Cov}(Z, X) \neq 0
\]</span></p>
<p><strong>2. Exclusion:</strong> <span class="math inline">\(Z\)</span> affects <span class="math inline">\(Y\)</span> only through <span class="math inline">\(X\)</span> <span class="math display">\[
\text{Cov}(Z, \varepsilon) = 0
\]</span></p>
<p>Graphically:</p>
<pre><code>Z → X → Y
Z ↛ Y (directly)</code></pre>
<p>The IV estimator: <span class="math display">\[
\hat{\beta}_{IV} = \frac{\text{Cov}(Z, Y)}{\text{Cov}(Z, X)} = \frac{\text{Reduced form}}{\text{First stage}}
\]</span></p>
</section>
<section id="two-stage-least-squares" class="level2">
<h2 class="anchored" data-anchor-id="two-stage-least-squares">Two-Stage Least Squares</h2>
<p><strong>First stage:</strong> Regress <span class="math inline">\(X\)</span> on <span class="math inline">\(Z\)</span> and controls <span class="math display">\[
X_{it} = \pi_0 + \pi_1 Z_{it} + W_{it}'\gamma + \nu_{it}
\]</span></p>
<p><strong>Second stage:</strong> Regress <span class="math inline">\(Y\)</span> on predicted <span class="math inline">\(\hat{X}\)</span> and controls <span class="math display">\[
Y_{it} = \beta_0 + \beta_1 \hat{X}_{it} + W_{it}'\delta + \varepsilon_{it}
\]</span></p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Simulate IV setting</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>N <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>true_beta <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co"># Instrument Z</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>Z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co"># Endogenous X (correlated with error)</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>U <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N)  <span class="co"># Unobserved confounder</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>X <span class="ot">&lt;-</span> <span class="fl">0.7</span> <span class="sc">*</span> Z <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> U <span class="sc">+</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="fl">0.3</span>)</span>
<span id="cb7-11"><a href="#cb7-11"></a></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co"># Outcome</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>Y <span class="ot">&lt;-</span> true_beta <span class="sc">*</span> X <span class="sc">+</span> <span class="fl">0.6</span> <span class="sc">*</span> U <span class="sc">+</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb7-14"><a href="#cb7-14"></a></span>
<span id="cb7-15"><a href="#cb7-15"></a>iv_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Y =</span> Y, <span class="at">X =</span> X, <span class="at">Z =</span> Z)</span>
<span id="cb7-16"><a href="#cb7-16"></a></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co"># OLS (biased)</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>ols_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X, <span class="at">data =</span> iv_data)</span>
<span id="cb7-19"><a href="#cb7-19"></a></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="co"># IV</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>iv_fit <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> X <span class="sc">~</span> Z, <span class="at">data =</span> iv_data)</span>
<span id="cb7-22"><a href="#cb7-22"></a></span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="fu">cat</span>(<span class="st">"True effect:"</span>, true_beta, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>True effect: 0.5 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">cat</span>(<span class="st">"OLS estimate:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(ols_fit)[<span class="st">"X"</span>], <span class="dv">3</span>), <span class="st">"(biased upward due to U)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimate: 0.895 (biased upward due to U)</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">cat</span>(<span class="st">"IV estimate:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(iv_fit)[<span class="st">"fit_X"</span>], <span class="dv">3</span>), <span class="st">"(consistent)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>IV estimate: 0.591 (consistent)</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">cat</span>(<span class="st">"First-stage F:"</span>, <span class="fu">round</span>(<span class="fu">fitstat</span>(iv_fit, <span class="st">"ivf"</span>)<span class="sc">$</span>ivf1<span class="sc">$</span>stat, <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>First-stage F: 448.3 </code></pre>
</div>
</div>
</section>
<section id="weak-instruments" class="level2">
<h2 class="anchored" data-anchor-id="weak-instruments">Weak Instruments</h2>
<p>If the first stage is weak (<span class="math inline">\(\pi_1 \approx 0\)</span>), IV estimates are: - Biased toward OLS - Have inflated standard errors - Unreliable inference</p>
<p><strong>Rule of thumb:</strong> First-stage F-statistic &gt; 10 (Stock &amp; Yogo)</p>
<p><strong>Diagnosis:</strong></p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Demonstrate weak IV bias</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>simulate_iv <span class="ot">&lt;-</span> <span class="cf">function</span>(first_stage_strength, <span class="at">n_sim =</span> <span class="dv">1000</span>) {</span>
<span id="cb15-3"><a href="#cb15-3"></a>  estimates <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sim)</span>
<span id="cb15-4"><a href="#cb15-4"></a></span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sim) {</span>
<span id="cb15-6"><a href="#cb15-6"></a>    Z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">200</span>)</span>
<span id="cb15-7"><a href="#cb15-7"></a>    U <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">200</span>)</span>
<span id="cb15-8"><a href="#cb15-8"></a>    X <span class="ot">&lt;-</span> first_stage_strength <span class="sc">*</span> Z <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> U <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb15-9"><a href="#cb15-9"></a>    Y <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> X <span class="sc">+</span> <span class="fl">0.6</span> <span class="sc">*</span> U <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb15-10"><a href="#cb15-10"></a></span>
<span id="cb15-11"><a href="#cb15-11"></a>    iv_fit <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> X <span class="sc">~</span> Z, <span class="at">data =</span> <span class="fu">data.frame</span>(Y, X, Z))</span>
<span id="cb15-12"><a href="#cb15-12"></a>    estimates[s] <span class="ot">&lt;-</span> <span class="fu">coef</span>(iv_fit)[<span class="st">"fit_X"</span>]</span>
<span id="cb15-13"><a href="#cb15-13"></a>  }</span>
<span id="cb15-14"><a href="#cb15-14"></a></span>
<span id="cb15-15"><a href="#cb15-15"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb15-16"><a href="#cb15-16"></a>    <span class="at">first_stage =</span> first_stage_strength,</span>
<span id="cb15-17"><a href="#cb15-17"></a>    <span class="at">mean_estimate =</span> <span class="fu">mean</span>(estimates),</span>
<span id="cb15-18"><a href="#cb15-18"></a>    <span class="at">sd_estimate =</span> <span class="fu">sd</span>(estimates)</span>
<span id="cb15-19"><a href="#cb15-19"></a>  )</span>
<span id="cb15-20"><a href="#cb15-20"></a>}</span>
<span id="cb15-21"><a href="#cb15-21"></a></span>
<span id="cb15-22"><a href="#cb15-22"></a>strengths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">1.0</span>)</span>
<span id="cb15-23"><a href="#cb15-23"></a>weak_iv_results <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(strengths, simulate_iv, <span class="at">n_sim =</span> <span class="dv">500</span>))</span>
<span id="cb15-24"><a href="#cb15-24"></a></span>
<span id="cb15-25"><a href="#cb15-25"></a><span class="fu">ggplot</span>(weak_iv_results, <span class="fu">aes</span>(<span class="at">x =</span> first_stage, <span class="at">y =</span> mean_estimate)) <span class="sc">+</span></span>
<span id="cb15-26"><a href="#cb15-26"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb15-27"><a href="#cb15-27"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"#9b59b6"</span>) <span class="sc">+</span></span>
<span id="cb15-28"><a href="#cb15-28"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"#9b59b6"</span>) <span class="sc">+</span></span>
<span id="cb15-29"><a href="#cb15-29"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean_estimate <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>sd_estimate,</span>
<span id="cb15-30"><a href="#cb15-30"></a>                    <span class="at">ymax =</span> mean_estimate <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>sd_estimate),</span>
<span id="cb15-31"><a href="#cb15-31"></a>                <span class="at">width =</span> <span class="fl">0.05</span>, <span class="at">color =</span> <span class="st">"#9b59b6"</span>) <span class="sc">+</span></span>
<span id="cb15-32"><a href="#cb15-32"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.8</span>, <span class="at">y =</span> <span class="fl">0.55</span>, <span class="at">label =</span> <span class="st">"True β = 0.5"</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb15-33"><a href="#cb15-33"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Weak IV Bias"</span>,</span>
<span id="cb15-34"><a href="#cb15-34"></a>       <span class="at">subtitle =</span> <span class="st">"Weak instruments bias IV toward OLS"</span>,</span>
<span id="cb15-35"><a href="#cb15-35"></a>       <span class="at">x =</span> <span class="st">"First-Stage Coefficient (instrument strength)"</span>,</span>
<span id="cb15-36"><a href="#cb15-36"></a>       <span class="at">y =</span> <span class="st">"Mean IV Estimate (across simulations)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="02_identification_files/figure-html/weak-iv-demo-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="shift-share-bartik-instruments" class="level2">
<h2 class="anchored" data-anchor-id="shift-share-bartik-instruments">Shift-Share (Bartik) Instruments</h2>
<p>A common IV strategy in macro uses <strong>shift-share</strong> designs:</p>
<p><span class="math display">\[
Z_{it} = \sum_k s_{ik,0} \cdot g_{kt}
\]</span></p>
<p>where: - <span class="math inline">\(s_{ik,0}\)</span> = pre-period <strong>share</strong> of sector <span class="math inline">\(k\)</span> in unit <span class="math inline">\(i\)</span> - <span class="math inline">\(g_{kt}\)</span> = national/global <strong>shock</strong> to sector <span class="math inline">\(k\)</span> at time <span class="math inline">\(t\)</span></p>
<p><strong>Example: China shock (Autor, Dorn, Hanson 2013)</strong> - <span class="math inline">\(s_{ik}\)</span> = share of industry <span class="math inline">\(k\)</span> in region <span class="math inline">\(i\)</span>’s employment - <span class="math inline">\(g_{kt}\)</span> = growth of Chinese imports in industry <span class="math inline">\(k\)</span></p>
<p><strong>Identification can come from:</strong> - Exogeneity of shares (Goldsmith-Pinkham, Sorkin &amp; Swift 2020) - Exogeneity of shocks (Borusyak, Hull &amp; Jaravel 2022)</p>
</section>
<section id="gmm-for-dynamic-panels" class="level2">
<h2 class="anchored" data-anchor-id="gmm-for-dynamic-panels">GMM for Dynamic Panels</h2>
<p>When the model includes lagged dependent variables:</p>
<p><span class="math display">\[
Y_{it} = \rho Y_{i,t-1} + X_{it}'\beta + \alpha_i + \varepsilon_{it}
\]</span></p>
<p>Standard FE is biased (<strong>Nickell bias</strong>): <span class="math inline">\(\text{plim}(\hat{\rho}_{FE}) = \rho - \frac{1+\rho}{T-1}\)</span></p>
<p><strong>Solutions:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 38%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Instruments</th>
<th>When to use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Anderson-Hsiao</td>
<td><span class="math inline">\(Y_{i,t-2}\)</span></td>
<td>Simple, conservative</td>
</tr>
<tr class="even">
<td>Arellano-Bond (diff-GMM)</td>
<td><span class="math inline">\(Y_{i,t-2}, Y_{i,t-3}, ...\)</span></td>
<td>Moderately persistent <span class="math inline">\(Y\)</span></td>
</tr>
<tr class="odd">
<td>Blundell-Bond (sys-GMM)</td>
<td>Add levels equations</td>
<td>Highly persistent <span class="math inline">\(Y\)</span></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>When Nickell Bias is Small
</div>
</div>
<div class="callout-body-container callout-body">
<p>With <span class="math inline">\(T = 84\)</span> quarters and <span class="math inline">\(\rho = 0.9\)</span>, the bias is approximately <span class="math inline">\(\frac{1.9}{83} \approx 2.3\%\)</span>. For long panels, FE may be acceptable.</p>
</div>
</div>
</section>
</section>
<section id="small-sample-inference" class="level1 unnumbered">
<h1 class="unnumbered">Small-Sample Inference</h1>
<p>Standard asymptotic inference fails with few clusters. This section covers robust alternatives.</p>
<section id="the-small-cluster-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-small-cluster-problem">The Small-Cluster Problem</h2>
<p>Cluster-robust standard errors assume <span class="math inline">\(G \to \infty\)</span> (number of clusters goes to infinity).</p>
<p>With <span class="math inline">\(G &lt; 50\)</span> clusters: - Standard errors are biased downward - t-statistics are inflated - Rejection rates exceed nominal size</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Simulate rejection rates with different cluster sizes</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>simulate_rejection <span class="ot">&lt;-</span> <span class="cf">function</span>(n_clusters, <span class="at">n_sim =</span> <span class="dv">1000</span>) {</span>
<span id="cb16-3"><a href="#cb16-3"></a>  rejections <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sim) {</span>
<span id="cb16-6"><a href="#cb16-6"></a>    <span class="co"># Generate clustered data with NO true effect</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>    cluster_effects <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_clusters, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb16-8"><a href="#cb16-8"></a></span>
<span id="cb16-9"><a href="#cb16-9"></a>    data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-10"><a href="#cb16-10"></a>      <span class="at">cluster =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_clusters, <span class="at">each =</span> <span class="dv">10</span>),</span>
<span id="cb16-11"><a href="#cb16-11"></a>      <span class="at">cluster_effect =</span> <span class="fu">rep</span>(cluster_effects, <span class="at">each =</span> <span class="dv">10</span>)</span>
<span id="cb16-12"><a href="#cb16-12"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb16-13"><a href="#cb16-13"></a>      <span class="fu">mutate</span>(</span>
<span id="cb16-14"><a href="#cb16-14"></a>        <span class="at">X =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>()) <span class="sc">+</span> cluster_effect <span class="sc">*</span> <span class="fl">0.3</span>,</span>
<span id="cb16-15"><a href="#cb16-15"></a>        <span class="at">Y =</span> cluster_effect <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>())  <span class="co"># No effect of X!</span></span>
<span id="cb16-16"><a href="#cb16-16"></a>      )</span>
<span id="cb16-17"><a href="#cb16-17"></a></span>
<span id="cb16-18"><a href="#cb16-18"></a>    <span class="co"># Test with clustered SEs</span></span>
<span id="cb16-19"><a href="#cb16-19"></a>    fit <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y <span class="sc">~</span> X <span class="sc">|</span> cluster, <span class="at">data =</span> data, <span class="at">vcov =</span> <span class="sc">~</span>cluster)</span>
<span id="cb16-20"><a href="#cb16-20"></a>    p_value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pt</span>(<span class="fu">abs</span>(<span class="fu">coef</span>(fit)[<span class="st">"X"</span>] <span class="sc">/</span> <span class="fu">se</span>(fit)[<span class="st">"X"</span>]), <span class="at">df =</span> n_clusters <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb16-21"><a href="#cb16-21"></a>    rejections <span class="ot">&lt;-</span> rejections <span class="sc">+</span> (p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb16-22"><a href="#cb16-22"></a>  }</span>
<span id="cb16-23"><a href="#cb16-23"></a></span>
<span id="cb16-24"><a href="#cb16-24"></a>  rejections <span class="sc">/</span> n_sim</span>
<span id="cb16-25"><a href="#cb16-25"></a>}</span>
<span id="cb16-26"><a href="#cb16-26"></a></span>
<span id="cb16-27"><a href="#cb16-27"></a>cluster_sizes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">100</span>)</span>
<span id="cb16-28"><a href="#cb16-28"></a>rejection_rates <span class="ot">&lt;-</span> <span class="fu">sapply</span>(cluster_sizes, simulate_rejection, <span class="at">n_sim =</span> <span class="dv">500</span>)</span>
<span id="cb16-29"><a href="#cb16-29"></a></span>
<span id="cb16-30"><a href="#cb16-30"></a>rej_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">clusters =</span> cluster_sizes, <span class="at">rejection =</span> rejection_rates)</span>
<span id="cb16-31"><a href="#cb16-31"></a></span>
<span id="cb16-32"><a href="#cb16-32"></a><span class="fu">ggplot</span>(rej_df, <span class="fu">aes</span>(<span class="at">x =</span> clusters, <span class="at">y =</span> rejection)) <span class="sc">+</span></span>
<span id="cb16-33"><a href="#cb16-33"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.05</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb16-34"><a href="#cb16-34"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb16-35"><a href="#cb16-35"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb16-36"><a href="#cb16-36"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">70</span>, <span class="at">y =</span> <span class="fl">0.06</span>, <span class="at">label =</span> <span class="st">"Nominal 5% size"</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb16-37"><a href="#cb16-37"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Over-Rejection with Few Clusters"</span>,</span>
<span id="cb16-38"><a href="#cb16-38"></a>       <span class="at">subtitle =</span> <span class="st">"Rejection rate under the null (should be 5%)"</span>,</span>
<span id="cb16-39"><a href="#cb16-39"></a>       <span class="at">x =</span> <span class="st">"Number of Clusters"</span>,</span>
<span id="cb16-40"><a href="#cb16-40"></a>       <span class="at">y =</span> <span class="st">"Rejection Rate"</span>) <span class="sc">+</span></span>
<span id="cb16-41"><a href="#cb16-41"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.15</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="02_identification_files/figure-html/cluster-problem-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Small clusters lead to over-rejection</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="wild-cluster-bootstrap" class="level2">
<h2 class="anchored" data-anchor-id="wild-cluster-bootstrap">Wild Cluster Bootstrap</h2>
<p>The <strong>wild cluster bootstrap</strong> (Cameron, Gelbach &amp; Miller 2008) provides valid inference with few clusters.</p>
<p><strong>Algorithm:</strong> 1. Estimate the model, get residuals <span class="math inline">\(\hat{\varepsilon}_{it}\)</span> 2. For <span class="math inline">\(b = 1, ..., B\)</span>: - Draw cluster-level weights <span class="math inline">\(w_g \in \{-1, +1\}\)</span> (Rademacher) - Construct bootstrap outcome: <span class="math inline">\(Y^*_{it} = \hat{Y}_{it} + w_{g(i)} \cdot \hat{\varepsilon}_{it}\)</span> - Re-estimate model, save t-statistic <span class="math inline">\(t^*_b\)</span> 3. Compare actual t-statistic to bootstrap distribution</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Demonstrate wild cluster bootstrap (manual implementation)</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co"># In practice, use fwildclusterboot::boottest()</span></span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co"># Generate data with few clusters</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>n_clusters <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>cluster_effects <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_clusters, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb17-7"><a href="#cb17-7"></a></span>
<span id="cb17-8"><a href="#cb17-8"></a>wcb_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-9"><a href="#cb17-9"></a>  <span class="at">cluster =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_clusters, <span class="at">each =</span> <span class="dv">15</span>),</span>
<span id="cb17-10"><a href="#cb17-10"></a>  <span class="at">cluster_effect =</span> <span class="fu">rep</span>(cluster_effects, <span class="at">each =</span> <span class="dv">15</span>)</span>
<span id="cb17-11"><a href="#cb17-11"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-13"><a href="#cb17-13"></a>    <span class="at">X =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>()) <span class="sc">+</span> cluster_effect <span class="sc">*</span> <span class="fl">0.3</span>,</span>
<span id="cb17-14"><a href="#cb17-14"></a>    <span class="at">Y =</span> <span class="fl">0.5</span> <span class="sc">*</span> X <span class="sc">+</span> cluster_effect <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="fl">0.8</span>)  <span class="co"># True effect = 0.5</span></span>
<span id="cb17-15"><a href="#cb17-15"></a>  )</span>
<span id="cb17-16"><a href="#cb17-16"></a></span>
<span id="cb17-17"><a href="#cb17-17"></a><span class="co"># Standard estimation</span></span>
<span id="cb17-18"><a href="#cb17-18"></a>model <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y <span class="sc">~</span> X <span class="sc">|</span> cluster, <span class="at">data =</span> wcb_data, <span class="at">vcov =</span> <span class="sc">~</span>cluster)</span>
<span id="cb17-19"><a href="#cb17-19"></a></span>
<span id="cb17-20"><a href="#cb17-20"></a><span class="fu">cat</span>(<span class="st">"=== Standard Cluster-Robust Inference ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>=== Standard Cluster-Robust Inference ===</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">cat</span>(<span class="st">"Estimate:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(model)[<span class="st">"X"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Estimate: 0.578 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">cat</span>(<span class="st">"Cluster SE:"</span>, <span class="fu">round</span>(<span class="fu">se</span>(model)[<span class="st">"X"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster SE: 0.046 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">cat</span>(<span class="st">"t-stat:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(model)[<span class="st">"X"</span>] <span class="sc">/</span> <span class="fu">se</span>(model)[<span class="st">"X"</span>], <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>t-stat: 12.47 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">cat</span>(<span class="st">"p-value (t-dist, df ="</span>, n_clusters <span class="sc">-</span> <span class="dv">1</span>, <span class="st">"):"</span>,</span>
<span id="cb25-2"><a href="#cb25-2"></a>    <span class="fu">round</span>(<span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="sc">-</span><span class="fu">abs</span>(<span class="fu">coef</span>(model)[<span class="st">"X"</span>] <span class="sc">/</span> <span class="fu">se</span>(model)[<span class="st">"X"</span>]), <span class="at">df =</span> n_clusters <span class="sc">-</span> <span class="dv">1</span>), <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>p-value (t-dist, df = 19 ): 0 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># Manual wild cluster bootstrap implementation</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>wild_cluster_bootstrap <span class="ot">&lt;-</span> <span class="cf">function</span>(model, data, cluster_var, <span class="at">B =</span> <span class="dv">999</span>) {</span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="co"># Get model components</span></span>
<span id="cb27-4"><a href="#cb27-4"></a>  y_fitted <span class="ot">&lt;-</span> <span class="fu">fitted</span>(model)</span>
<span id="cb27-5"><a href="#cb27-5"></a>  resid <span class="ot">&lt;-</span> <span class="fu">residuals</span>(model)</span>
<span id="cb27-6"><a href="#cb27-6"></a>  clusters <span class="ot">&lt;-</span> <span class="fu">unique</span>(data[[cluster_var]])</span>
<span id="cb27-7"><a href="#cb27-7"></a>  G <span class="ot">&lt;-</span> <span class="fu">length</span>(clusters)</span>
<span id="cb27-8"><a href="#cb27-8"></a></span>
<span id="cb27-9"><a href="#cb27-9"></a>  <span class="co"># Original t-statistic</span></span>
<span id="cb27-10"><a href="#cb27-10"></a>  t_orig <span class="ot">&lt;-</span> <span class="fu">coef</span>(model)[<span class="st">"X"</span>] <span class="sc">/</span> <span class="fu">se</span>(model)[<span class="st">"X"</span>]</span>
<span id="cb27-11"><a href="#cb27-11"></a></span>
<span id="cb27-12"><a href="#cb27-12"></a>  <span class="co"># Bootstrap</span></span>
<span id="cb27-13"><a href="#cb27-13"></a>  t_boot <span class="ot">&lt;-</span> <span class="fu">numeric</span>(B)</span>
<span id="cb27-14"><a href="#cb27-14"></a>  <span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb27-15"><a href="#cb27-15"></a>    <span class="co"># Rademacher weights (cluster-level)</span></span>
<span id="cb27-16"><a href="#cb27-16"></a>    weights <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), G, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-17"><a href="#cb27-17"></a>    <span class="fu">names</span>(weights) <span class="ot">&lt;-</span> clusters</span>
<span id="cb27-18"><a href="#cb27-18"></a></span>
<span id="cb27-19"><a href="#cb27-19"></a>    <span class="co"># Construct bootstrap outcome</span></span>
<span id="cb27-20"><a href="#cb27-20"></a>    data<span class="sc">$</span>Y_boot <span class="ot">&lt;-</span> y_fitted <span class="sc">+</span> weights[<span class="fu">as.character</span>(data[[cluster_var]])] <span class="sc">*</span> resid</span>
<span id="cb27-21"><a href="#cb27-21"></a></span>
<span id="cb27-22"><a href="#cb27-22"></a>    <span class="co"># Re-estimate under null (impose beta = 0)</span></span>
<span id="cb27-23"><a href="#cb27-23"></a>    model_boot <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y_boot <span class="sc">~</span> X <span class="sc">|</span> cluster, <span class="at">data =</span> data, <span class="at">vcov =</span> <span class="sc">~</span>cluster)</span>
<span id="cb27-24"><a href="#cb27-24"></a>    t_boot[b] <span class="ot">&lt;-</span> <span class="fu">coef</span>(model_boot)[<span class="st">"X"</span>] <span class="sc">/</span> <span class="fu">se</span>(model_boot)[<span class="st">"X"</span>]</span>
<span id="cb27-25"><a href="#cb27-25"></a>  }</span>
<span id="cb27-26"><a href="#cb27-26"></a></span>
<span id="cb27-27"><a href="#cb27-27"></a>  <span class="co"># Two-sided p-value</span></span>
<span id="cb27-28"><a href="#cb27-28"></a>  p_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(t_boot) <span class="sc">&gt;=</span> <span class="fu">abs</span>(t_orig))</span>
<span id="cb27-29"><a href="#cb27-29"></a></span>
<span id="cb27-30"><a href="#cb27-30"></a>  <span class="fu">list</span>(<span class="at">t_orig =</span> t_orig, <span class="at">t_boot =</span> t_boot, <span class="at">p_value =</span> p_value)</span>
<span id="cb27-31"><a href="#cb27-31"></a>}</span>
<span id="cb27-32"><a href="#cb27-32"></a></span>
<span id="cb27-33"><a href="#cb27-33"></a><span class="co"># Run bootstrap (reduced B for speed)</span></span>
<span id="cb27-34"><a href="#cb27-34"></a>boot_result <span class="ot">&lt;-</span> <span class="fu">wild_cluster_bootstrap</span>(model, wcb_data, <span class="st">"cluster"</span>, <span class="at">B =</span> <span class="dv">499</span>)</span>
<span id="cb27-35"><a href="#cb27-35"></a></span>
<span id="cb27-36"><a href="#cb27-36"></a><span class="fu">cat</span>(<span class="st">"=== Wild Cluster Bootstrap (Manual) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>=== Wild Cluster Bootstrap (Manual) ===</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">cat</span>(<span class="st">"Bootstrap p-value:"</span>, <span class="fu">round</span>(boot_result<span class="sc">$</span>p_value, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrap p-value: 0.5291 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu">cat</span>(<span class="st">"(In practice, use fwildclusterboot::boottest() for efficiency)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(In practice, use fwildclusterboot::boottest() for efficiency)</code></pre>
</div>
</div>
</section>
<section id="when-to-use-what" class="level2">
<h2 class="anchored" data-anchor-id="when-to-use-what">When to Use What</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 22%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Clusters</th>
<th>Method</th>
<th>R Implementation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>G &gt; 50</td>
<td>Standard cluster-robust SE</td>
<td><code>vcov = ~cluster</code></td>
</tr>
<tr class="even">
<td>30 &lt; G &lt; 50</td>
<td>t-distribution with G-1 df</td>
<td><code>vcov = ~cluster</code> + manual df adjustment</td>
</tr>
<tr class="odd">
<td>10 &lt; G &lt; 30</td>
<td>Wild cluster bootstrap</td>
<td><code>fwildclusterboot::boottest()</code></td>
</tr>
<tr class="even">
<td>G &lt; 10</td>
<td>Randomization inference</td>
<td>Permutation tests</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Webb Weights for Very Few Clusters
</div>
</div>
<div class="callout-body-container callout-body">
<p>With G &lt; 10, use Webb (6-point) weights instead of Rademacher:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">boottest</span>(model, <span class="at">param =</span> <span class="st">"X"</span>, <span class="at">clustid =</span> <span class="st">"cluster"</span>, <span class="at">type =</span> <span class="st">"webb"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</section>
</section>
<section id="putting-it-together" class="level1 unnumbered">
<h1 class="unnumbered">Putting It Together</h1>
<section id="checklist-for-identification" class="level2">
<h2 class="anchored" data-anchor-id="checklist-for-identification">Checklist for Identification</h2>
<p>Before claiming a causal effect, verify:</p>
<ol type="1">
<li><strong>What is the source of identifying variation?</strong>
<ul>
<li>Within-unit over time? (FE)</li>
<li>Across units hit by shock? (DiD)</li>
<li>Exogenous instrument? (IV)</li>
</ul></li>
<li><strong>What assumptions does this require?</strong>
<ul>
<li>Parallel trends? (DiD)</li>
<li>Exclusion restriction? (IV)</li>
<li>No anticipation? (Event study)</li>
</ul></li>
<li><strong>What are the threats?</strong>
<ul>
<li>Time-varying confounders?</li>
<li>Spillovers to control group?</li>
<li>Weak instruments?</li>
</ul></li>
<li><strong>What robustness checks support the design?</strong>
<ul>
<li>Pre-trends (with caveats about power)</li>
<li>Placebo tests</li>
<li>Alternative control groups</li>
<li>Sensitivity analysis</li>
</ul></li>
</ol>
</section>
<section id="common-pitfalls" class="level2">
<h2 class="anchored" data-anchor-id="common-pitfalls">Common Pitfalls</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 32%">
<col style="width: 32%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th>Pitfall</th>
<th>Problem</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Overinterpreting pre-trends</td>
<td>Low power against violations</td>
<td>Use HonestDiD, report sensitivity</td>
</tr>
<tr class="even">
<td>Post-treatment controls</td>
<td>Blocks causal path</td>
<td>Only control for pre-determined variables</td>
</tr>
<tr class="odd">
<td>Weak instruments</td>
<td>Bias toward OLS</td>
<td>Report first-stage F, use robust methods</td>
</tr>
<tr class="even">
<td>Few clusters</td>
<td>Over-rejection</td>
<td>Wild cluster bootstrap</td>
</tr>
<tr class="odd">
<td>Staggered treatment</td>
<td>TWFE bias</td>
<td>Callaway-Sant’Anna, Sun-Abraham</td>
</tr>
<tr class="even">
<td>Anticipation effects</td>
<td>Violates sharp treatment timing</td>
<td>Test for pre-treatment effects</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="frequently-asked-questions" class="level1 unnumbered">
<h1 class="unnumbered">Frequently Asked Questions</h1>
<section id="how-do-i-know-if-parallel-trends-holds" class="level2">
<h2 class="anchored" data-anchor-id="how-do-i-know-if-parallel-trends-holds">How do I know if parallel trends holds?</h2>
<p>You can’t prove it—it’s about <strong>counterfactuals</strong> we don’t observe. You can: - Show pre-trends are flat (but low power—Roth 2022) - Argue institutionally why the assumption is plausible - Run sensitivity analysis (HonestDiD) - Find a better control group</p>
</section>
<section id="when-should-i-use-iv-vs.-did" class="level2">
<h2 class="anchored" data-anchor-id="when-should-i-use-iv-vs.-did">When should I use IV vs.&nbsp;DiD?</h2>
<p><strong>Use DiD when:</strong> - You have a clear treatment/control distinction - Treatment timing is plausibly exogenous - Parallel trends is defensible</p>
<p><strong>Use IV when:</strong> - Treatment varies continuously (not just on/off) - You have a plausibly exogenous source of variation in treatment - Exclusion restriction is defensible</p>
</section>
<section id="what-if-my-first-stage-f-is-below-10" class="level2">
<h2 class="anchored" data-anchor-id="what-if-my-first-stage-f-is-below-10">What if my first-stage F is below 10?</h2>
<p>Options: 1. Find a stronger instrument 2. Use weak-IV robust methods (Anderson-Rubin, LIML) 3. Report reduced form instead (effect of Z on Y) 4. Interpret results as a lower bound (if bias direction is known)</p>
</section>
<section id="how-many-clusters-do-i-need" class="level2">
<h2 class="anchored" data-anchor-id="how-many-clusters-do-i-need">How many clusters do I need?</h2>
<ul>
<li>50+ clusters: Standard cluster-robust SEs are fine</li>
<li>30-50 clusters: Use t-distribution with G-1 df</li>
<li>10-30 clusters: Wild cluster bootstrap</li>
<li>&lt;10 clusters: Randomization inference, or aggregate to higher level</li>
</ul>
</section>
</section>
<section id="summary" class="level1 unnumbered">
<h1 class="unnumbered">Summary</h1>
<p>Key takeaways from this module:</p>
<ol type="1">
<li><p><strong>Correlation ≠ causation</strong> due to simultaneity, selection, and omitted variables</p></li>
<li><p><strong>Controlling for observables</strong> doesn’t solve endogeneity from unobservables</p></li>
<li><p><strong>DiD exploits discrete shocks</strong> but requires parallel trends—a <strong>strong, untestable assumption</strong></p></li>
<li><p><strong>Pre-trends tests have low power</strong>—passing doesn’t guarantee validity</p></li>
<li><p><strong>IV isolates exogenous variation</strong> but requires a valid instrument (relevant + excludable)</p></li>
<li><p><strong>Small clusters</strong> require wild cluster bootstrap for valid inference</p></li>
</ol>
<hr>
<p><em>Next: <a href="../chapters/03_local_projections.html">Module 3: Local Projections</a></em></p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/01_panel_econometrics.html" class="pagination-link" aria-label="Panel Data Econometrics">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Panel Data Econometrics</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/03_local_projections.html" class="pagination-link" aria-label="Local Projections">
        <span class="nav-page-text"><span class="chapter-title">Local Projections</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb34-1"><a href="#cb34-1"></a><span class="co">---</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="an">title:</span><span class="co"> "Identification in Macroeconomics"</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="an">subtitle:</span><span class="co"> "From Correlation to Causation"</span></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="co">---</span></span>
<span id="cb34-5"><a href="#cb34-5"></a></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="in">```{r}</span></span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="co">#| label: setup</span></span>
<span id="cb34-10"><a href="#cb34-10"></a><span class="co">#| include: false</span></span>
<span id="cb34-11"><a href="#cb34-11"></a></span>
<span id="cb34-12"><a href="#cb34-12"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb34-13"><a href="#cb34-13"></a>  <span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-14"><a href="#cb34-14"></a>  <span class="at">fig.width =</span> <span class="dv">10</span>, <span class="at">fig.height =</span> <span class="dv">6</span>, <span class="at">fig.align =</span> <span class="st">"center"</span></span>
<span id="cb34-15"><a href="#cb34-15"></a>)</span>
<span id="cb34-16"><a href="#cb34-16"></a></span>
<span id="cb34-17"><a href="#cb34-17"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb34-18"><a href="#cb34-18"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb34-19"><a href="#cb34-19"></a><span class="fu">library</span>(fixest)</span>
<span id="cb34-20"><a href="#cb34-20"></a><span class="fu">library</span>(MASS)</span>
<span id="cb34-21"><a href="#cb34-21"></a></span>
<span id="cb34-22"><a href="#cb34-22"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>))</span>
<span id="cb34-23"><a href="#cb34-23"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb34-24"><a href="#cb34-24"></a><span class="in">```</span></span>
<span id="cb34-25"><a href="#cb34-25"></a></span>
<span id="cb34-26"><a href="#cb34-26"></a><span class="fu"># The Fundamental Problem {.unnumbered}</span></span>
<span id="cb34-27"><a href="#cb34-27"></a></span>
<span id="cb34-28"><a href="#cb34-28"></a>This section develops the core challenge of causal inference in macroeconomic settings: moving from observed correlations to credible causal estimates.</span>
<span id="cb34-29"><a href="#cb34-29"></a></span>
<span id="cb34-30"><a href="#cb34-30"></a><span class="fu">## Why Correlation ≠ Causation</span></span>
<span id="cb34-31"><a href="#cb34-31"></a></span>
<span id="cb34-32"><a href="#cb34-32"></a><span class="fu">### The Ideal Experiment</span></span>
<span id="cb34-33"><a href="#cb34-33"></a></span>
<span id="cb34-34"><a href="#cb34-34"></a>To measure the causal effect of a policy $D$ on an outcome $Y$, we would ideally observe:</span>
<span id="cb34-35"><a href="#cb34-35"></a></span>
<span id="cb34-36"><a href="#cb34-36"></a>$$</span>
<span id="cb34-37"><a href="#cb34-37"></a>\tau_i = Y_i(1) - Y_i(0)</span>
<span id="cb34-38"><a href="#cb34-38"></a>$$</span>
<span id="cb34-39"><a href="#cb34-39"></a></span>
<span id="cb34-40"><a href="#cb34-40"></a>where $Y_i(1)$ is the outcome if unit $i$ receives treatment, and $Y_i(0)$ is the outcome if it doesn't. The **fundamental problem of causal inference** is that we only observe one of these potential outcomes for each unit.</span>
<span id="cb34-41"><a href="#cb34-41"></a></span>
<span id="cb34-42"><a href="#cb34-42"></a>In macro settings, this is particularly severe:</span>
<span id="cb34-43"><a href="#cb34-43"></a><span class="ss">- </span>We can't randomly assign monetary policy across countries</span>
<span id="cb34-44"><a href="#cb34-44"></a><span class="ss">- </span>We can't rerun history with different fiscal rules</span>
<span id="cb34-45"><a href="#cb34-45"></a><span class="ss">- </span>Countries that adopt different policies differ in many other ways</span>
<span id="cb34-46"><a href="#cb34-46"></a></span>
<span id="cb34-47"><a href="#cb34-47"></a><span class="fu">### Three Sources of Bias</span></span>
<span id="cb34-48"><a href="#cb34-48"></a></span>
<span id="cb34-49"><a href="#cb34-49"></a>When we estimate $\hat{\beta}$ from a regression of $Y$ on $X$, the estimate can be biased for the true causal effect $\beta$ due to:</span>
<span id="cb34-50"><a href="#cb34-50"></a></span>
<span id="cb34-51"><a href="#cb34-51"></a>**1. Simultaneity (Reverse Causality)**</span>
<span id="cb34-52"><a href="#cb34-52"></a></span>
<span id="cb34-53"><a href="#cb34-53"></a>$$</span>
<span id="cb34-54"><a href="#cb34-54"></a>X \rightarrow Y \quad \text{AND} \quad Y \rightarrow X</span>
<span id="cb34-55"><a href="#cb34-55"></a>$$</span>
<span id="cb34-56"><a href="#cb34-56"></a></span>
<span id="cb34-57"><a href="#cb34-57"></a>Example: Do high interest rates cause low inflation, or does low inflation allow central banks to keep rates high? The regression coefficient captures both directions.</span>
<span id="cb34-58"><a href="#cb34-58"></a></span>
<span id="cb34-59"><a href="#cb34-59"></a>**2. Selection (Confounding)**</span>
<span id="cb34-60"><a href="#cb34-60"></a></span>
<span id="cb34-61"><a href="#cb34-61"></a>$$</span>
<span id="cb34-62"><a href="#cb34-62"></a>Z \rightarrow X \quad \text{AND} \quad Z \rightarrow Y</span>
<span id="cb34-63"><a href="#cb34-63"></a>$$</span>
<span id="cb34-64"><a href="#cb34-64"></a></span>
<span id="cb34-65"><a href="#cb34-65"></a>Example: Countries with strong institutions ($Z$) both adopt prudent debt management ($X$) and have stable monetary policy ($Y$). The correlation between $X$ and $Y$ reflects their common cause $Z$.</span>
<span id="cb34-66"><a href="#cb34-66"></a></span>
<span id="cb34-67"><a href="#cb34-67"></a>**3. Omitted Variables**</span>
<span id="cb34-68"><a href="#cb34-68"></a></span>
<span id="cb34-69"><a href="#cb34-69"></a>A special case of confounding where the confounder $Z$ is unobserved:</span>
<span id="cb34-70"><a href="#cb34-70"></a></span>
<span id="cb34-71"><a href="#cb34-71"></a>$$</span>
<span id="cb34-72"><a href="#cb34-72"></a>\hat{\beta}_{OLS} \xrightarrow{p} \beta + \underbrace{\gamma \cdot \frac{\text{Cov}(X, Z)}{\text{Var}(X)}}_{\text{omitted variable bias}}</span>
<span id="cb34-73"><a href="#cb34-73"></a>$$</span>
<span id="cb34-74"><a href="#cb34-74"></a></span>
<span id="cb34-75"><a href="#cb34-75"></a>where $\gamma$ is the effect of $Z$ on $Y$.</span>
<span id="cb34-76"><a href="#cb34-76"></a></span>
<span id="cb34-77"><a href="#cb34-77"></a><span class="fu">### Why "Controlling For" Doesn't Solve It</span></span>
<span id="cb34-78"><a href="#cb34-78"></a></span>
<span id="cb34-79"><a href="#cb34-79"></a>A common but flawed intuition: "Just add more controls to the regression."</span>
<span id="cb34-80"><a href="#cb34-80"></a></span>
<span id="cb34-81"><a href="#cb34-81"></a>**Problem 1: Bad Controls**</span>
<span id="cb34-82"><a href="#cb34-82"></a></span>
<span id="cb34-83"><a href="#cb34-83"></a>Adding post-treatment variables can *introduce* bias. If $M$ is affected by treatment:</span>
<span id="cb34-84"><a href="#cb34-84"></a></span>
<span id="cb34-85"><a href="#cb34-85"></a><span class="in">```</span></span>
<span id="cb34-86"><a href="#cb34-86"></a><span class="in">D → M → Y    (M is a mediator)</span></span>
<span id="cb34-87"><a href="#cb34-87"></a><span class="in">```</span></span>
<span id="cb34-88"><a href="#cb34-88"></a></span>
<span id="cb34-89"><a href="#cb34-89"></a>Controlling for $M$ blocks part of the causal effect of $D$ on $Y$.</span>
<span id="cb34-90"><a href="#cb34-90"></a></span>
<span id="cb34-91"><a href="#cb34-91"></a>**Problem 2: Unobservables**</span>
<span id="cb34-92"><a href="#cb34-92"></a></span>
<span id="cb34-93"><a href="#cb34-93"></a>You can only control for what you observe. In macro:</span>
<span id="cb34-94"><a href="#cb34-94"></a><span class="ss">- </span>Institutional quality is hard to measure</span>
<span id="cb34-95"><a href="#cb34-95"></a><span class="ss">- </span>Political constraints are unobserved</span>
<span id="cb34-96"><a href="#cb34-96"></a><span class="ss">- </span>Market expectations are latent</span>
<span id="cb34-97"><a href="#cb34-97"></a></span>
<span id="cb34-98"><a href="#cb34-98"></a>**Problem 3: Measurement Error**</span>
<span id="cb34-99"><a href="#cb34-99"></a></span>
<span id="cb34-100"><a href="#cb34-100"></a>Controls measured with error don't fully absorb confounding:</span>
<span id="cb34-101"><a href="#cb34-101"></a></span>
<span id="cb34-102"><a href="#cb34-102"></a>$$</span>
<span id="cb34-103"><a href="#cb34-103"></a>\tilde{Z} = Z + \nu \quad \Rightarrow \quad \text{bias persists even after controlling for } \tilde{Z}</span>
<span id="cb34-104"><a href="#cb34-104"></a>$$</span>
<span id="cb34-105"><a href="#cb34-105"></a></span>
<span id="cb34-106"><a href="#cb34-106"></a>::: {.callout-warning}</span>
<span id="cb34-107"><a href="#cb34-107"></a><span class="fu">## The Credibility Revolution</span></span>
<span id="cb34-108"><a href="#cb34-108"></a>Modern applied economics requires more than "throwing in controls." It requires an **identification strategy**—a credible argument for why the remaining variation in $X$ is as good as randomly assigned conditional on the research design.</span>
<span id="cb34-109"><a href="#cb34-109"></a>:::</span>
<span id="cb34-110"><a href="#cb34-110"></a></span>
<span id="cb34-111"><a href="#cb34-111"></a><span class="fu">## Directed Acyclic Graphs (DAGs)</span></span>
<span id="cb34-112"><a href="#cb34-112"></a></span>
<span id="cb34-113"><a href="#cb34-113"></a>DAGs provide a visual language for identification arguments.</span>
<span id="cb34-114"><a href="#cb34-114"></a></span>
<span id="cb34-115"><a href="#cb34-115"></a>**Confounding structure:**</span>
<span id="cb34-116"><a href="#cb34-116"></a><span class="in">```</span></span>
<span id="cb34-117"><a href="#cb34-117"></a><span class="in">    Z</span></span>
<span id="cb34-118"><a href="#cb34-118"></a><span class="in">   / \</span></span>
<span id="cb34-119"><a href="#cb34-119"></a><span class="in">  ↓   ↓</span></span>
<span id="cb34-120"><a href="#cb34-120"></a><span class="in">  X → Y</span></span>
<span id="cb34-121"><a href="#cb34-121"></a><span class="in">```</span></span>
<span id="cb34-122"><a href="#cb34-122"></a></span>
<span id="cb34-123"><a href="#cb34-123"></a>In this DAG, $Z$ is a **confounder**: it causes both $X$ and $Y$. The path $X \leftarrow Z \rightarrow Y$ creates a spurious correlation between $X$ and $Y$ even if $X$ has no causal effect on $Y$.</span>
<span id="cb34-124"><a href="#cb34-124"></a></span>
<span id="cb34-125"><a href="#cb34-125"></a>**Key DAG concepts:**</span>
<span id="cb34-126"><a href="#cb34-126"></a></span>
<span id="cb34-127"><a href="#cb34-127"></a><span class="pp">|</span> Term <span class="pp">|</span> Meaning <span class="pp">|</span> Implication <span class="pp">|</span></span>
<span id="cb34-128"><a href="#cb34-128"></a><span class="pp">|------|---------|-------------|</span></span>
<span id="cb34-129"><a href="#cb34-129"></a><span class="pp">|</span> **Confounder** <span class="pp">|</span> Common cause of $X$ and $Y$ <span class="pp">|</span> Must control for it (or use design) <span class="pp">|</span></span>
<span id="cb34-130"><a href="#cb34-130"></a><span class="pp">|</span> **Mediator** <span class="pp">|</span> On causal path from $X$ to $Y$ <span class="pp">|</span> Don't control for it <span class="pp">|</span></span>
<span id="cb34-131"><a href="#cb34-131"></a><span class="pp">|</span> **Collider** <span class="pp">|</span> Caused by both $X$ and $Y$ <span class="pp">|</span> Don't control for it <span class="pp">|</span></span>
<span id="cb34-132"><a href="#cb34-132"></a><span class="pp">|</span> **Backdoor path** <span class="pp">|</span> Non-causal path from $X$ to $Y$ <span class="pp">|</span> Must block to identify causal effect <span class="pp">|</span></span>
<span id="cb34-133"><a href="#cb34-133"></a></span>
<span id="cb34-134"><a href="#cb34-134"></a><span class="fu">## Fixed Effects as Partial Solution</span></span>
<span id="cb34-135"><a href="#cb34-135"></a></span>
<span id="cb34-136"><a href="#cb34-136"></a>Panel fixed effects address one specific source of bias: **time-invariant confounders**.</span>
<span id="cb34-137"><a href="#cb34-137"></a></span>
<span id="cb34-138"><a href="#cb34-138"></a>$$</span>
<span id="cb34-139"><a href="#cb34-139"></a>Y_{it} = \alpha_i + X_{it}'\beta + \varepsilon_{it}</span>
<span id="cb34-140"><a href="#cb34-140"></a>$$</span>
<span id="cb34-141"><a href="#cb34-141"></a></span>
<span id="cb34-142"><a href="#cb34-142"></a>The country fixed effect $\alpha_i$ absorbs all factors that:</span>
<span id="cb34-143"><a href="#cb34-143"></a><span class="ss">- </span>Differ across countries</span>
<span id="cb34-144"><a href="#cb34-144"></a><span class="ss">- </span>Don't change over time</span>
<span id="cb34-145"><a href="#cb34-145"></a></span>
<span id="cb34-146"><a href="#cb34-146"></a>This includes: geography, colonial history, legal origin, language, etc.</span>
<span id="cb34-147"><a href="#cb34-147"></a></span>
<span id="cb34-148"><a href="#cb34-148"></a>**What FE doesn't solve:**</span>
<span id="cb34-149"><a href="#cb34-149"></a><span class="ss">- </span>Time-varying confounders</span>
<span id="cb34-150"><a href="#cb34-150"></a><span class="ss">- </span>Reverse causality</span>
<span id="cb34-151"><a href="#cb34-151"></a><span class="ss">- </span>Selection into treatment timing</span>
<span id="cb34-152"><a href="#cb34-152"></a></span>
<span id="cb34-153"><a href="#cb34-153"></a>::: {.callout-note}</span>
<span id="cb34-154"><a href="#cb34-154"></a><span class="fu">## The Identification Hierarchy</span></span>
<span id="cb34-155"><a href="#cb34-155"></a>From weakest to strongest causal claims:</span>
<span id="cb34-156"><a href="#cb34-156"></a></span>
<span id="cb34-157"><a href="#cb34-157"></a><span class="ss">1. </span>**Cross-sectional correlation**: Countries with high $X$ have high $Y$</span>
<span id="cb34-158"><a href="#cb34-158"></a><span class="ss">2. </span>**Panel FE**: When a country's $X$ rises, its $Y$ rises (within-country)</span>
<span id="cb34-159"><a href="#cb34-159"></a><span class="ss">3. </span>**DiD**: Countries exposed to shock saw $Y$ change relative to unexposed (parallel trends)</span>
<span id="cb34-160"><a href="#cb34-160"></a><span class="ss">4. </span>**IV**: Exogenous variation in $X$ (from instrument) causes $Y$ to change</span>
<span id="cb34-161"><a href="#cb34-161"></a><span class="ss">5. </span>**RCT**: Random assignment of $X$ (rare in macro)</span>
<span id="cb34-162"><a href="#cb34-162"></a>:::</span>
<span id="cb34-163"><a href="#cb34-163"></a></span>
<span id="cb34-164"><a href="#cb34-164"></a><span class="fu"># Difference-in-Differences {.unnumbered}</span></span>
<span id="cb34-165"><a href="#cb34-165"></a></span>
<span id="cb34-166"><a href="#cb34-166"></a>DiD exploits variation from discrete policy changes or shocks to identify causal effects.</span>
<span id="cb34-167"><a href="#cb34-167"></a></span>
<span id="cb34-168"><a href="#cb34-168"></a><span class="fu">## The Classic 2×2 Design</span></span>
<span id="cb34-169"><a href="#cb34-169"></a></span>
<span id="cb34-170"><a href="#cb34-170"></a>Consider a policy implemented in some countries ("treated") at time $T_0$, with other countries as controls.</span>
<span id="cb34-171"><a href="#cb34-171"></a></span>
<span id="cb34-172"><a href="#cb34-172"></a>**Setup:**</span>
<span id="cb34-173"><a href="#cb34-173"></a><span class="ss">- </span>$D_i = 1$ if country $i$ is treated, 0 otherwise</span>
<span id="cb34-174"><a href="#cb34-174"></a><span class="ss">- </span>$Post_t = 1$ if $t &gt; T_0$, 0 otherwise</span>
<span id="cb34-175"><a href="#cb34-175"></a></span>
<span id="cb34-176"><a href="#cb34-176"></a>**Regression:**</span>
<span id="cb34-177"><a href="#cb34-177"></a>$$</span>
<span id="cb34-178"><a href="#cb34-178"></a>Y_{it} = \alpha + \beta_1 D_i + \beta_2 Post_t + \tau (D_i \times Post_t) + \varepsilon_{it}</span>
<span id="cb34-179"><a href="#cb34-179"></a>$$</span>
<span id="cb34-180"><a href="#cb34-180"></a></span>
<span id="cb34-181"><a href="#cb34-181"></a>**The DiD estimator:**</span>
<span id="cb34-182"><a href="#cb34-182"></a>$$</span>
<span id="cb34-183"><a href="#cb34-183"></a>\hat{\tau}_{DiD} = \underbrace{(\bar{Y}_{T,Post} - \bar{Y}_{T,Pre})}_{\text{Treated change}} - \underbrace{(\bar{Y}_{C,Post} - \bar{Y}_{C,Pre})}_{\text{Control change}}</span>
<span id="cb34-184"><a href="#cb34-184"></a>$$</span>
<span id="cb34-185"><a href="#cb34-185"></a></span>
<span id="cb34-186"><a href="#cb34-186"></a>This "differences out" both:</span>
<span id="cb34-187"><a href="#cb34-187"></a><span class="ss">- </span>Permanent differences between treated and control (first difference)</span>
<span id="cb34-188"><a href="#cb34-188"></a><span class="ss">- </span>Common time trends (second difference)</span>
<span id="cb34-189"><a href="#cb34-189"></a></span>
<span id="cb34-192"><a href="#cb34-192"></a><span class="in">```{r}</span></span>
<span id="cb34-193"><a href="#cb34-193"></a><span class="co">#| label: did-simulation</span></span>
<span id="cb34-194"><a href="#cb34-194"></a><span class="co">#| fig-cap: "Difference-in-Differences: Parallel trends allow causal inference"</span></span>
<span id="cb34-195"><a href="#cb34-195"></a></span>
<span id="cb34-196"><a href="#cb34-196"></a><span class="co"># Simulate DiD data</span></span>
<span id="cb34-197"><a href="#cb34-197"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb34-198"><a href="#cb34-198"></a>T_periods <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb34-199"><a href="#cb34-199"></a>T0 <span class="ot">&lt;-</span> <span class="dv">5</span>  <span class="co"># Treatment at period 5</span></span>
<span id="cb34-200"><a href="#cb34-200"></a></span>
<span id="cb34-201"><a href="#cb34-201"></a>did_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb34-202"><a href="#cb34-202"></a>  <span class="at">unit =</span> <span class="dv">1</span><span class="sc">:</span>N,</span>
<span id="cb34-203"><a href="#cb34-203"></a>  <span class="at">time =</span> <span class="dv">1</span><span class="sc">:</span>T_periods</span>
<span id="cb34-204"><a href="#cb34-204"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb34-205"><a href="#cb34-205"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-206"><a href="#cb34-206"></a>    <span class="at">treated =</span> unit <span class="sc">&lt;=</span> N<span class="sc">/</span><span class="dv">2</span>,  <span class="co"># First half treated</span></span>
<span id="cb34-207"><a href="#cb34-207"></a>    <span class="at">post =</span> time <span class="sc">&gt;</span> T0,</span>
<span id="cb34-208"><a href="#cb34-208"></a>    <span class="co"># Parallel trends in potential outcomes</span></span>
<span id="cb34-209"><a href="#cb34-209"></a>    <span class="at">Y0 =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> time <span class="sc">+</span> <span class="fu">ifelse</span>(treated, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb34-210"><a href="#cb34-210"></a>    <span class="co"># Treatment effect of 2 units</span></span>
<span id="cb34-211"><a href="#cb34-211"></a>    <span class="at">Y1 =</span> Y0 <span class="sc">+</span> <span class="dv">2</span>,</span>
<span id="cb34-212"><a href="#cb34-212"></a>    <span class="co"># Observed outcome</span></span>
<span id="cb34-213"><a href="#cb34-213"></a>    <span class="at">Y =</span> <span class="fu">ifelse</span>(treated <span class="sc">&amp;</span> post, Y1, Y0)</span>
<span id="cb34-214"><a href="#cb34-214"></a>  )</span>
<span id="cb34-215"><a href="#cb34-215"></a></span>
<span id="cb34-216"><a href="#cb34-216"></a><span class="co"># Plot</span></span>
<span id="cb34-217"><a href="#cb34-217"></a>did_summary <span class="ot">&lt;-</span> did_data <span class="sc">%&gt;%</span></span>
<span id="cb34-218"><a href="#cb34-218"></a>  <span class="fu">group_by</span>(treated, time) <span class="sc">%&gt;%</span></span>
<span id="cb34-219"><a href="#cb34-219"></a>  <span class="fu">summarise</span>(<span class="at">Y =</span> <span class="fu">mean</span>(Y), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb34-220"><a href="#cb34-220"></a></span>
<span id="cb34-221"><a href="#cb34-221"></a><span class="fu">ggplot</span>(did_summary, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> Y, <span class="at">color =</span> treated, <span class="at">linetype =</span> treated)) <span class="sc">+</span></span>
<span id="cb34-222"><a href="#cb34-222"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb34-223"><a href="#cb34-223"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> T0, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb34-224"><a href="#cb34-224"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> T0, <span class="at">xend =</span> T_periods,</span>
<span id="cb34-225"><a href="#cb34-225"></a>                   <span class="at">y =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.3</span><span class="sc">*</span>T0 <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.3</span><span class="sc">*</span>(T_periods <span class="sc">-</span> T0),</span>
<span id="cb34-226"><a href="#cb34-226"></a>                   <span class="at">yend =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.3</span><span class="sc">*</span>T_periods <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb34-227"><a href="#cb34-227"></a>               <span class="at">color =</span> <span class="st">"gray50"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb34-228"><a href="#cb34-228"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> T0 <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="dv">3</span>, <span class="at">label =</span> <span class="st">"Treatment"</span>, <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb34-229"><a href="#cb34-229"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> T_periods <span class="sc">-</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="fl">5.8</span>, <span class="at">label =</span> <span class="st">"Counterfactual"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb34-230"><a href="#cb34-230"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"#3498db"</span>, <span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"#e74c3c"</span>),</span>
<span id="cb34-231"><a href="#cb34-231"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Treated"</span>)) <span class="sc">+</span></span>
<span id="cb34-232"><a href="#cb34-232"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"solid"</span>, <span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"solid"</span>),</span>
<span id="cb34-233"><a href="#cb34-233"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Treated"</span>)) <span class="sc">+</span></span>
<span id="cb34-234"><a href="#cb34-234"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Difference-in-Differences Illustration"</span>,</span>
<span id="cb34-235"><a href="#cb34-235"></a>       <span class="at">subtitle =</span> <span class="st">"Treatment effect = gap between treated and counterfactual"</span>,</span>
<span id="cb34-236"><a href="#cb34-236"></a>       <span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Outcome"</span>, <span class="at">color =</span> <span class="st">"Group"</span>, <span class="at">linetype =</span> <span class="st">"Group"</span>) <span class="sc">+</span></span>
<span id="cb34-237"><a href="#cb34-237"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb34-238"><a href="#cb34-238"></a><span class="in">```</span></span>
<span id="cb34-239"><a href="#cb34-239"></a></span>
<span id="cb34-240"><a href="#cb34-240"></a><span class="fu">## The Parallel Trends Assumption</span></span>
<span id="cb34-241"><a href="#cb34-241"></a></span>
<span id="cb34-242"><a href="#cb34-242"></a>**Assumption:** In the absence of treatment, treated and control groups would have followed parallel paths.</span>
<span id="cb34-243"><a href="#cb34-243"></a></span>
<span id="cb34-244"><a href="#cb34-244"></a>$$</span>
<span id="cb34-245"><a href="#cb34-245"></a>E<span class="co">[</span><span class="ot">Y_{it}(0) | D_i = 1, t</span><span class="co">]</span> - E<span class="co">[</span><span class="ot">Y_{it}(0) | D_i = 0, t</span><span class="co">]</span> = \delta \quad \forall t</span>
<span id="cb34-246"><a href="#cb34-246"></a>$$</span>
<span id="cb34-247"><a href="#cb34-247"></a></span>
<span id="cb34-248"><a href="#cb34-248"></a>The difference in untreated potential outcomes is constant over time.</span>
<span id="cb34-249"><a href="#cb34-249"></a></span>
<span id="cb34-250"><a href="#cb34-250"></a>**What this requires:**</span>
<span id="cb34-251"><a href="#cb34-251"></a><span class="ss">- </span>No differential pre-trends</span>
<span id="cb34-252"><a href="#cb34-252"></a><span class="ss">- </span>No anticipation effects</span>
<span id="cb34-253"><a href="#cb34-253"></a><span class="ss">- </span>No differential shocks coinciding with treatment</span>
<span id="cb34-254"><a href="#cb34-254"></a></span>
<span id="cb34-255"><a href="#cb34-255"></a>**What this does NOT require:**</span>
<span id="cb34-256"><a href="#cb34-256"></a><span class="ss">- </span>Levels to be the same (that's absorbed by $\beta_1$)</span>
<span id="cb34-257"><a href="#cb34-257"></a><span class="ss">- </span>Exact parallel paths (allows for noise)</span>
<span id="cb34-258"><a href="#cb34-258"></a></span>
<span id="cb34-259"><a href="#cb34-259"></a><span class="fu">## Pre-Trends Testing and Its Limits</span></span>
<span id="cb34-260"><a href="#cb34-260"></a></span>
<span id="cb34-261"><a href="#cb34-261"></a><span class="fu">### The Event Study Specification</span></span>
<span id="cb34-262"><a href="#cb34-262"></a></span>
<span id="cb34-263"><a href="#cb34-263"></a>To assess parallel trends, estimate:</span>
<span id="cb34-264"><a href="#cb34-264"></a></span>
<span id="cb34-265"><a href="#cb34-265"></a>$$</span>
<span id="cb34-266"><a href="#cb34-266"></a>Y_{it} = \alpha_i + \delta_t + \sum_{k \neq -1} \beta_k \cdot \mathbf{1}<span class="co">[</span><span class="ot">t - T_i^* = k</span><span class="co">]</span> + \varepsilon_{it}</span>
<span id="cb34-267"><a href="#cb34-267"></a>$$</span>
<span id="cb34-268"><a href="#cb34-268"></a></span>
<span id="cb34-269"><a href="#cb34-269"></a>where $T_i^*$ is the treatment time for unit $i$, and $k$ indexes relative time.</span>
<span id="cb34-270"><a href="#cb34-270"></a></span>
<span id="cb34-273"><a href="#cb34-273"></a><span class="in">```{r}</span></span>
<span id="cb34-274"><a href="#cb34-274"></a><span class="co">#| label: event-study-sim</span></span>
<span id="cb34-275"><a href="#cb34-275"></a><span class="co">#| fig-cap: "Event study: Testing for pre-trends"</span></span>
<span id="cb34-276"><a href="#cb34-276"></a></span>
<span id="cb34-277"><a href="#cb34-277"></a><span class="co"># Simulate event study with no pre-trends</span></span>
<span id="cb34-278"><a href="#cb34-278"></a>es_data <span class="ot">&lt;-</span> did_data <span class="sc">%&gt;%</span></span>
<span id="cb34-279"><a href="#cb34-279"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-280"><a href="#cb34-280"></a>    <span class="at">rel_time =</span> time <span class="sc">-</span> T0,</span>
<span id="cb34-281"><a href="#cb34-281"></a>    <span class="at">rel_time_fct =</span> <span class="fu">factor</span>(rel_time)</span>
<span id="cb34-282"><a href="#cb34-282"></a>  )</span>
<span id="cb34-283"><a href="#cb34-283"></a></span>
<span id="cb34-284"><a href="#cb34-284"></a><span class="co"># Estimate event study</span></span>
<span id="cb34-285"><a href="#cb34-285"></a>es_model <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y <span class="sc">~</span> <span class="fu">i</span>(rel_time_fct, treated, <span class="at">ref =</span> <span class="st">"-1"</span>) <span class="sc">|</span> unit <span class="sc">+</span> time,</span>
<span id="cb34-286"><a href="#cb34-286"></a>                   <span class="at">data =</span> es_data, <span class="at">vcov =</span> <span class="sc">~</span>unit)</span>
<span id="cb34-287"><a href="#cb34-287"></a></span>
<span id="cb34-288"><a href="#cb34-288"></a><span class="co"># Extract coefficients</span></span>
<span id="cb34-289"><a href="#cb34-289"></a>coef_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-290"><a href="#cb34-290"></a>  <span class="at">rel_time =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"rel_time_fct::(-?[0-9]+):treated"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>,</span>
<span id="cb34-291"><a href="#cb34-291"></a>                              <span class="fu">names</span>(<span class="fu">coef</span>(es_model)))),</span>
<span id="cb34-292"><a href="#cb34-292"></a>  <span class="at">estimate =</span> <span class="fu">coef</span>(es_model),</span>
<span id="cb34-293"><a href="#cb34-293"></a>  <span class="at">se =</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(es_model)))</span>
<span id="cb34-294"><a href="#cb34-294"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb34-295"><a href="#cb34-295"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(rel_time)) <span class="sc">%&gt;%</span></span>
<span id="cb34-296"><a href="#cb34-296"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-297"><a href="#cb34-297"></a>    <span class="at">lower =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb34-298"><a href="#cb34-298"></a>    <span class="at">upper =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb34-299"><a href="#cb34-299"></a>  )</span>
<span id="cb34-300"><a href="#cb34-300"></a></span>
<span id="cb34-301"><a href="#cb34-301"></a><span class="co"># Add reference period</span></span>
<span id="cb34-302"><a href="#cb34-302"></a>coef_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb34-303"><a href="#cb34-303"></a>  coef_df,</span>
<span id="cb34-304"><a href="#cb34-304"></a>  <span class="fu">data.frame</span>(<span class="at">rel_time =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">estimate =</span> <span class="dv">0</span>, <span class="at">se =</span> <span class="dv">0</span>, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="dv">0</span>)</span>
<span id="cb34-305"><a href="#cb34-305"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb34-306"><a href="#cb34-306"></a>  <span class="fu">arrange</span>(rel_time)</span>
<span id="cb34-307"><a href="#cb34-307"></a></span>
<span id="cb34-308"><a href="#cb34-308"></a><span class="fu">ggplot</span>(coef_df, <span class="fu">aes</span>(<span class="at">x =</span> rel_time, <span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb34-309"><a href="#cb34-309"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb34-310"><a href="#cb34-310"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb34-311"><a href="#cb34-311"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"#3498db"</span>) <span class="sc">+</span></span>
<span id="cb34-312"><a href="#cb34-312"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"#3498db"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb34-313"><a href="#cb34-313"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"#3498db"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb34-314"><a href="#cb34-314"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">y =</span> <span class="fl">0.5</span>, <span class="at">label =</span> <span class="st">"Pre-treatment</span><span class="sc">\n</span><span class="st">(should be ≈ 0)"</span>) <span class="sc">+</span></span>
<span id="cb34-315"><a href="#cb34-315"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">3</span>, <span class="at">y =</span> <span class="fl">2.5</span>, <span class="at">label =</span> <span class="st">"Post-treatment</span><span class="sc">\n</span><span class="st">(treatment effect)"</span>) <span class="sc">+</span></span>
<span id="cb34-316"><a href="#cb34-316"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Event Study Coefficients"</span>,</span>
<span id="cb34-317"><a href="#cb34-317"></a>       <span class="at">subtitle =</span> <span class="st">"Pre-treatment coefficients near zero support parallel trends"</span>,</span>
<span id="cb34-318"><a href="#cb34-318"></a>       <span class="at">x =</span> <span class="st">"Periods Relative to Treatment"</span>,</span>
<span id="cb34-319"><a href="#cb34-319"></a>       <span class="at">y =</span> <span class="st">"Coefficient (relative to t = -1)"</span>) <span class="sc">+</span></span>
<span id="cb34-320"><a href="#cb34-320"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="sc">-</span><span class="dv">4</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb34-321"><a href="#cb34-321"></a><span class="in">```</span></span>
<span id="cb34-322"><a href="#cb34-322"></a></span>
<span id="cb34-323"><a href="#cb34-323"></a><span class="fu">### Roth (2022): Pre-Trends Testing Has Low Power</span></span>
<span id="cb34-324"><a href="#cb34-324"></a></span>
<span id="cb34-325"><a href="#cb34-325"></a>::: {.callout-important}</span>
<span id="cb34-326"><a href="#cb34-326"></a><span class="fu">## Key Insight from Roth (2022)</span></span>
<span id="cb34-327"><a href="#cb34-327"></a>Passing a pre-trends test does NOT guarantee parallel trends hold. The test has low power against economically meaningful violations.</span>
<span id="cb34-328"><a href="#cb34-328"></a>:::</span>
<span id="cb34-329"><a href="#cb34-329"></a></span>
<span id="cb34-330"><a href="#cb34-330"></a>**The problem:**</span>
<span id="cb34-331"><a href="#cb34-331"></a><span class="ss">- </span>Pre-trends tests are underpowered for typical sample sizes</span>
<span id="cb34-332"><a href="#cb34-332"></a><span class="ss">- </span>Researchers often "shop" for specifications that pass the test</span>
<span id="cb34-333"><a href="#cb34-333"></a><span class="ss">- </span>Even small pre-trends that pass the test can generate large bias</span>
<span id="cb34-334"><a href="#cb34-334"></a></span>
<span id="cb34-335"><a href="#cb34-335"></a>**Quantifying the issue:**</span>
<span id="cb34-338"><a href="#cb34-338"></a><span class="in">```{r}</span></span>
<span id="cb34-339"><a href="#cb34-339"></a><span class="co">#| label: roth-power</span></span>
<span id="cb34-340"><a href="#cb34-340"></a></span>
<span id="cb34-341"><a href="#cb34-341"></a><span class="co"># Simulate: How often does pre-trend test miss a real violation?</span></span>
<span id="cb34-342"><a href="#cb34-342"></a>simulate_pretrend_test <span class="ot">&lt;-</span> <span class="cf">function</span>(delta_trend, <span class="at">n_sim =</span> <span class="dv">500</span>) {</span>
<span id="cb34-343"><a href="#cb34-343"></a>  reject <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sim)</span>
<span id="cb34-344"><a href="#cb34-344"></a></span>
<span id="cb34-345"><a href="#cb34-345"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sim) {</span>
<span id="cb34-346"><a href="#cb34-346"></a>    <span class="co"># Generate data with differential trend</span></span>
<span id="cb34-347"><a href="#cb34-347"></a>    data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">unit =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, <span class="at">time =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-348"><a href="#cb34-348"></a>      <span class="fu">mutate</span>(</span>
<span id="cb34-349"><a href="#cb34-349"></a>        <span class="at">treated =</span> unit <span class="sc">&lt;=</span> <span class="dv">25</span>,</span>
<span id="cb34-350"><a href="#cb34-350"></a>        <span class="at">post =</span> time <span class="sc">&gt;</span> <span class="dv">5</span>,</span>
<span id="cb34-351"><a href="#cb34-351"></a>        <span class="co"># Add differential trend for treated</span></span>
<span id="cb34-352"><a href="#cb34-352"></a>        <span class="at">trend_effect =</span> <span class="fu">ifelse</span>(treated, delta_trend <span class="sc">*</span> time, <span class="dv">0</span>),</span>
<span id="cb34-353"><a href="#cb34-353"></a>        <span class="at">Y =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> time <span class="sc">+</span> trend_effect <span class="sc">+</span></span>
<span id="cb34-354"><a href="#cb34-354"></a>            <span class="fu">ifelse</span>(treated, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb34-355"><a href="#cb34-355"></a>            <span class="fu">ifelse</span>(treated <span class="sc">&amp;</span> post, <span class="dv">2</span>, <span class="dv">0</span>) <span class="sc">+</span>  <span class="co"># True effect = 2</span></span>
<span id="cb34-356"><a href="#cb34-356"></a>            <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb34-357"><a href="#cb34-357"></a>      )</span>
<span id="cb34-358"><a href="#cb34-358"></a></span>
<span id="cb34-359"><a href="#cb34-359"></a>    <span class="co"># Test pre-trends (joint F-test on pre-treatment dummies)</span></span>
<span id="cb34-360"><a href="#cb34-360"></a>    pre_data <span class="ot">&lt;-</span> <span class="fu">filter</span>(data, time <span class="sc">&lt;=</span> <span class="dv">5</span>)</span>
<span id="cb34-361"><a href="#cb34-361"></a>    model <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y <span class="sc">~</span> <span class="fu">i</span>(time, treated, <span class="at">ref =</span> <span class="dv">5</span>) <span class="sc">|</span> unit <span class="sc">+</span> time,</span>
<span id="cb34-362"><a href="#cb34-362"></a>                   <span class="at">data =</span> pre_data, <span class="at">vcov =</span> <span class="sc">~</span>unit)</span>
<span id="cb34-363"><a href="#cb34-363"></a></span>
<span id="cb34-364"><a href="#cb34-364"></a>    <span class="co"># Joint test of pre-treatment coefficients</span></span>
<span id="cb34-365"><a href="#cb34-365"></a>    pre_coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(model)[<span class="fu">grep</span>(<span class="st">"time::"</span>, <span class="fu">names</span>(<span class="fu">coef</span>(model)))]</span>
<span id="cb34-366"><a href="#cb34-366"></a>    <span class="cf">if</span> (<span class="fu">length</span>(pre_coefs) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb34-367"><a href="#cb34-367"></a>      <span class="co"># Simplified: check if any coefficient is significant</span></span>
<span id="cb34-368"><a href="#cb34-368"></a>      reject[s] <span class="ot">&lt;-</span> <span class="fu">any</span>(<span class="fu">abs</span>(pre_coefs) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcov</span>(model))[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pre_coefs)]) <span class="sc">&gt;</span> <span class="fl">1.96</span>)</span>
<span id="cb34-369"><a href="#cb34-369"></a>    }</span>
<span id="cb34-370"><a href="#cb34-370"></a>  }</span>
<span id="cb34-371"><a href="#cb34-371"></a></span>
<span id="cb34-372"><a href="#cb34-372"></a>  <span class="fu">mean</span>(reject)  <span class="co"># Power = rejection rate</span></span>
<span id="cb34-373"><a href="#cb34-373"></a>}</span>
<span id="cb34-374"><a href="#cb34-374"></a></span>
<span id="cb34-375"><a href="#cb34-375"></a><span class="co"># Power against different trend violations</span></span>
<span id="cb34-376"><a href="#cb34-376"></a>trend_violations <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.2</span>)</span>
<span id="cb34-377"><a href="#cb34-377"></a>power <span class="ot">&lt;-</span> <span class="fu">sapply</span>(trend_violations, simulate_pretrend_test, <span class="at">n_sim =</span> <span class="dv">200</span>)</span>
<span id="cb34-378"><a href="#cb34-378"></a></span>
<span id="cb34-379"><a href="#cb34-379"></a>power_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-380"><a href="#cb34-380"></a>  <span class="at">differential_trend =</span> trend_violations,</span>
<span id="cb34-381"><a href="#cb34-381"></a>  <span class="at">power =</span> power</span>
<span id="cb34-382"><a href="#cb34-382"></a>)</span>
<span id="cb34-383"><a href="#cb34-383"></a></span>
<span id="cb34-384"><a href="#cb34-384"></a><span class="fu">ggplot</span>(power_df, <span class="fu">aes</span>(<span class="at">x =</span> differential_trend, <span class="at">y =</span> power)) <span class="sc">+</span></span>
<span id="cb34-385"><a href="#cb34-385"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb34-386"><a href="#cb34-386"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb34-387"><a href="#cb34-387"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.05</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb34-388"><a href="#cb34-388"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.15</span>, <span class="at">y =</span> <span class="fl">0.1</span>, <span class="at">label =</span> <span class="st">"Nominal size (5%)"</span>) <span class="sc">+</span></span>
<span id="cb34-389"><a href="#cb34-389"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Power of Pre-Trends Test"</span>,</span>
<span id="cb34-390"><a href="#cb34-390"></a>       <span class="at">subtitle =</span> <span class="st">"Even substantial trend violations often go undetected"</span>,</span>
<span id="cb34-391"><a href="#cb34-391"></a>       <span class="at">x =</span> <span class="st">"Differential Pre-Trend (per period)"</span>,</span>
<span id="cb34-392"><a href="#cb34-392"></a>       <span class="at">y =</span> <span class="st">"Rejection Rate"</span>) <span class="sc">+</span></span>
<span id="cb34-393"><a href="#cb34-393"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb34-394"><a href="#cb34-394"></a><span class="in">```</span></span>
<span id="cb34-395"><a href="#cb34-395"></a></span>
<span id="cb34-396"><a href="#cb34-396"></a>**Recommendations:**</span>
<span id="cb34-397"><a href="#cb34-397"></a><span class="ss">1. </span>Report pre-trends but don't over-interpret passing</span>
<span id="cb34-398"><a href="#cb34-398"></a><span class="ss">2. </span>Use sensitivity analysis (HonestDiD package)</span>
<span id="cb34-399"><a href="#cb34-399"></a><span class="ss">3. </span>Focus on institutional knowledge of why parallel trends should hold</span>
<span id="cb34-400"><a href="#cb34-400"></a></span>
<span id="cb34-401"><a href="#cb34-401"></a><span class="fu">## Natural Experiments in Macro</span></span>
<span id="cb34-402"><a href="#cb34-402"></a></span>
<span id="cb34-403"><a href="#cb34-403"></a>The most credible DiD designs exploit **exogenous shocks** that affect some units but not others.</span>
<span id="cb34-404"><a href="#cb34-404"></a></span>
<span id="cb34-405"><a href="#cb34-405"></a>**Examples of natural experiments:**</span>
<span id="cb34-406"><a href="#cb34-406"></a><span class="pp">|</span> Shock <span class="pp">|</span> Treatment <span class="pp">|</span> Control <span class="pp">|</span> Papers <span class="pp">|</span></span>
<span id="cb34-407"><a href="#cb34-407"></a><span class="pp">|-------|-----------|---------|--------|</span></span>
<span id="cb34-408"><a href="#cb34-408"></a><span class="pp">|</span> German reunification <span class="pp">|</span> East Germany <span class="pp">|</span> West Germany <span class="pp">|</span> Fuchs-Schündeln &amp; Schündeln <span class="pp">|</span></span>
<span id="cb34-409"><a href="#cb34-409"></a><span class="pp">|</span> Swiss franc appreciation <span class="pp">|</span> Swiss border regions <span class="pp">|</span> French border regions <span class="pp">|</span> Auer et al. <span class="pp">|</span></span>
<span id="cb34-410"><a href="#cb34-410"></a><span class="pp">|</span> Oil price shocks <span class="pp">|</span> Oil importers vs exporters <span class="pp">|</span> — <span class="pp">|</span> Kilian &amp; Lewis <span class="pp">|</span></span>
<span id="cb34-411"><a href="#cb34-411"></a><span class="pp">|</span> COVID-19 <span class="pp">|</span> High-exposure sectors <span class="pp">|</span> Low-exposure sectors <span class="pp">|</span> — <span class="pp">|</span></span>
<span id="cb34-412"><a href="#cb34-412"></a></span>
<span id="cb34-413"><a href="#cb34-413"></a>**What makes a good natural experiment:**</span>
<span id="cb34-414"><a href="#cb34-414"></a><span class="ss">1. </span>**Exogenous timing**: Shock not driven by outcome of interest</span>
<span id="cb34-415"><a href="#cb34-415"></a><span class="ss">2. </span>**Clear treatment/control**: Units can be cleanly classified</span>
<span id="cb34-416"><a href="#cb34-416"></a><span class="ss">3. </span>**No spillovers**: Control units unaffected by treatment (SUTVA)</span>
<span id="cb34-417"><a href="#cb34-417"></a><span class="ss">4. </span>**Plausible parallel trends**: Pre-shock trends similar</span>
<span id="cb34-418"><a href="#cb34-418"></a></span>
<span id="cb34-419"><a href="#cb34-419"></a><span class="fu"># Instrumental Variables {.unnumbered}</span></span>
<span id="cb34-420"><a href="#cb34-420"></a></span>
<span id="cb34-421"><a href="#cb34-421"></a>IV exploits exogenous variation to isolate the causal effect of an endogenous regressor.</span>
<span id="cb34-422"><a href="#cb34-422"></a></span>
<span id="cb34-423"><a href="#cb34-423"></a><span class="fu">## The Logic of Instruments</span></span>
<span id="cb34-424"><a href="#cb34-424"></a></span>
<span id="cb34-425"><a href="#cb34-425"></a>An instrument $Z$ satisfies:</span>
<span id="cb34-426"><a href="#cb34-426"></a></span>
<span id="cb34-427"><a href="#cb34-427"></a>**1. Relevance:** $Z$ affects $X$</span>
<span id="cb34-428"><a href="#cb34-428"></a>$$</span>
<span id="cb34-429"><a href="#cb34-429"></a>\text{Cov}(Z, X) \neq 0</span>
<span id="cb34-430"><a href="#cb34-430"></a>$$</span>
<span id="cb34-431"><a href="#cb34-431"></a></span>
<span id="cb34-432"><a href="#cb34-432"></a>**2. Exclusion:** $Z$ affects $Y$ only through $X$</span>
<span id="cb34-433"><a href="#cb34-433"></a>$$</span>
<span id="cb34-434"><a href="#cb34-434"></a>\text{Cov}(Z, \varepsilon) = 0</span>
<span id="cb34-435"><a href="#cb34-435"></a>$$</span>
<span id="cb34-436"><a href="#cb34-436"></a></span>
<span id="cb34-437"><a href="#cb34-437"></a>Graphically:</span>
<span id="cb34-438"><a href="#cb34-438"></a><span class="in">```</span></span>
<span id="cb34-439"><a href="#cb34-439"></a><span class="in">Z → X → Y</span></span>
<span id="cb34-440"><a href="#cb34-440"></a><span class="in">Z ↛ Y (directly)</span></span>
<span id="cb34-441"><a href="#cb34-441"></a><span class="in">```</span></span>
<span id="cb34-442"><a href="#cb34-442"></a></span>
<span id="cb34-443"><a href="#cb34-443"></a>The IV estimator:</span>
<span id="cb34-444"><a href="#cb34-444"></a>$$</span>
<span id="cb34-445"><a href="#cb34-445"></a>\hat{\beta}_{IV} = \frac{\text{Cov}(Z, Y)}{\text{Cov}(Z, X)} = \frac{\text{Reduced form}}{\text{First stage}}</span>
<span id="cb34-446"><a href="#cb34-446"></a>$$</span>
<span id="cb34-447"><a href="#cb34-447"></a></span>
<span id="cb34-448"><a href="#cb34-448"></a><span class="fu">## Two-Stage Least Squares</span></span>
<span id="cb34-449"><a href="#cb34-449"></a></span>
<span id="cb34-450"><a href="#cb34-450"></a>**First stage:** Regress $X$ on $Z$ and controls</span>
<span id="cb34-451"><a href="#cb34-451"></a>$$</span>
<span id="cb34-452"><a href="#cb34-452"></a>X_{it} = \pi_0 + \pi_1 Z_{it} + W_{it}'\gamma + \nu_{it}</span>
<span id="cb34-453"><a href="#cb34-453"></a>$$</span>
<span id="cb34-454"><a href="#cb34-454"></a></span>
<span id="cb34-455"><a href="#cb34-455"></a>**Second stage:** Regress $Y$ on predicted $\hat{X}$ and controls</span>
<span id="cb34-456"><a href="#cb34-456"></a>$$</span>
<span id="cb34-457"><a href="#cb34-457"></a>Y_{it} = \beta_0 + \beta_1 \hat{X}_{it} + W_{it}'\delta + \varepsilon_{it}</span>
<span id="cb34-458"><a href="#cb34-458"></a>$$</span>
<span id="cb34-459"><a href="#cb34-459"></a></span>
<span id="cb34-462"><a href="#cb34-462"></a><span class="in">```{r}</span></span>
<span id="cb34-463"><a href="#cb34-463"></a><span class="co">#| label: iv-simulation</span></span>
<span id="cb34-464"><a href="#cb34-464"></a><span class="co">#| fig-cap: "IV vs OLS: OLS is biased, IV recovers the true effect"</span></span>
<span id="cb34-465"><a href="#cb34-465"></a></span>
<span id="cb34-466"><a href="#cb34-466"></a><span class="co"># Simulate IV setting</span></span>
<span id="cb34-467"><a href="#cb34-467"></a>N <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb34-468"><a href="#cb34-468"></a>true_beta <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb34-469"><a href="#cb34-469"></a></span>
<span id="cb34-470"><a href="#cb34-470"></a><span class="co"># Instrument Z</span></span>
<span id="cb34-471"><a href="#cb34-471"></a>Z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb34-472"><a href="#cb34-472"></a></span>
<span id="cb34-473"><a href="#cb34-473"></a><span class="co"># Endogenous X (correlated with error)</span></span>
<span id="cb34-474"><a href="#cb34-474"></a>U <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N)  <span class="co"># Unobserved confounder</span></span>
<span id="cb34-475"><a href="#cb34-475"></a>X <span class="ot">&lt;-</span> <span class="fl">0.7</span> <span class="sc">*</span> Z <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> U <span class="sc">+</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="fl">0.3</span>)</span>
<span id="cb34-476"><a href="#cb34-476"></a></span>
<span id="cb34-477"><a href="#cb34-477"></a><span class="co"># Outcome</span></span>
<span id="cb34-478"><a href="#cb34-478"></a>Y <span class="ot">&lt;-</span> true_beta <span class="sc">*</span> X <span class="sc">+</span> <span class="fl">0.6</span> <span class="sc">*</span> U <span class="sc">+</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb34-479"><a href="#cb34-479"></a></span>
<span id="cb34-480"><a href="#cb34-480"></a>iv_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Y =</span> Y, <span class="at">X =</span> X, <span class="at">Z =</span> Z)</span>
<span id="cb34-481"><a href="#cb34-481"></a></span>
<span id="cb34-482"><a href="#cb34-482"></a><span class="co"># OLS (biased)</span></span>
<span id="cb34-483"><a href="#cb34-483"></a>ols_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X, <span class="at">data =</span> iv_data)</span>
<span id="cb34-484"><a href="#cb34-484"></a></span>
<span id="cb34-485"><a href="#cb34-485"></a><span class="co"># IV</span></span>
<span id="cb34-486"><a href="#cb34-486"></a>iv_fit <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> X <span class="sc">~</span> Z, <span class="at">data =</span> iv_data)</span>
<span id="cb34-487"><a href="#cb34-487"></a></span>
<span id="cb34-488"><a href="#cb34-488"></a><span class="fu">cat</span>(<span class="st">"True effect:"</span>, true_beta, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-489"><a href="#cb34-489"></a><span class="fu">cat</span>(<span class="st">"OLS estimate:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(ols_fit)[<span class="st">"X"</span>], <span class="dv">3</span>), <span class="st">"(biased upward due to U)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-490"><a href="#cb34-490"></a><span class="fu">cat</span>(<span class="st">"IV estimate:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(iv_fit)[<span class="st">"fit_X"</span>], <span class="dv">3</span>), <span class="st">"(consistent)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-491"><a href="#cb34-491"></a><span class="fu">cat</span>(<span class="st">"First-stage F:"</span>, <span class="fu">round</span>(<span class="fu">fitstat</span>(iv_fit, <span class="st">"ivf"</span>)<span class="sc">$</span>ivf1<span class="sc">$</span>stat, <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-492"><a href="#cb34-492"></a><span class="in">```</span></span>
<span id="cb34-493"><a href="#cb34-493"></a></span>
<span id="cb34-494"><a href="#cb34-494"></a><span class="fu">## Weak Instruments</span></span>
<span id="cb34-495"><a href="#cb34-495"></a></span>
<span id="cb34-496"><a href="#cb34-496"></a>If the first stage is weak ($\pi_1 \approx 0$), IV estimates are:</span>
<span id="cb34-497"><a href="#cb34-497"></a><span class="ss">- </span>Biased toward OLS</span>
<span id="cb34-498"><a href="#cb34-498"></a><span class="ss">- </span>Have inflated standard errors</span>
<span id="cb34-499"><a href="#cb34-499"></a><span class="ss">- </span>Unreliable inference</span>
<span id="cb34-500"><a href="#cb34-500"></a></span>
<span id="cb34-501"><a href="#cb34-501"></a>**Rule of thumb:** First-stage F-statistic &gt; 10 (Stock &amp; Yogo)</span>
<span id="cb34-502"><a href="#cb34-502"></a></span>
<span id="cb34-503"><a href="#cb34-503"></a>**Diagnosis:**</span>
<span id="cb34-506"><a href="#cb34-506"></a><span class="in">```{r}</span></span>
<span id="cb34-507"><a href="#cb34-507"></a><span class="co">#| label: weak-iv-demo</span></span>
<span id="cb34-508"><a href="#cb34-508"></a></span>
<span id="cb34-509"><a href="#cb34-509"></a><span class="co"># Demonstrate weak IV bias</span></span>
<span id="cb34-510"><a href="#cb34-510"></a>simulate_iv <span class="ot">&lt;-</span> <span class="cf">function</span>(first_stage_strength, <span class="at">n_sim =</span> <span class="dv">1000</span>) {</span>
<span id="cb34-511"><a href="#cb34-511"></a>  estimates <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sim)</span>
<span id="cb34-512"><a href="#cb34-512"></a></span>
<span id="cb34-513"><a href="#cb34-513"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sim) {</span>
<span id="cb34-514"><a href="#cb34-514"></a>    Z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">200</span>)</span>
<span id="cb34-515"><a href="#cb34-515"></a>    U <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">200</span>)</span>
<span id="cb34-516"><a href="#cb34-516"></a>    X <span class="ot">&lt;-</span> first_stage_strength <span class="sc">*</span> Z <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> U <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb34-517"><a href="#cb34-517"></a>    Y <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> X <span class="sc">+</span> <span class="fl">0.6</span> <span class="sc">*</span> U <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb34-518"><a href="#cb34-518"></a></span>
<span id="cb34-519"><a href="#cb34-519"></a>    iv_fit <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> X <span class="sc">~</span> Z, <span class="at">data =</span> <span class="fu">data.frame</span>(Y, X, Z))</span>
<span id="cb34-520"><a href="#cb34-520"></a>    estimates[s] <span class="ot">&lt;-</span> <span class="fu">coef</span>(iv_fit)[<span class="st">"fit_X"</span>]</span>
<span id="cb34-521"><a href="#cb34-521"></a>  }</span>
<span id="cb34-522"><a href="#cb34-522"></a></span>
<span id="cb34-523"><a href="#cb34-523"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb34-524"><a href="#cb34-524"></a>    <span class="at">first_stage =</span> first_stage_strength,</span>
<span id="cb34-525"><a href="#cb34-525"></a>    <span class="at">mean_estimate =</span> <span class="fu">mean</span>(estimates),</span>
<span id="cb34-526"><a href="#cb34-526"></a>    <span class="at">sd_estimate =</span> <span class="fu">sd</span>(estimates)</span>
<span id="cb34-527"><a href="#cb34-527"></a>  )</span>
<span id="cb34-528"><a href="#cb34-528"></a>}</span>
<span id="cb34-529"><a href="#cb34-529"></a></span>
<span id="cb34-530"><a href="#cb34-530"></a>strengths <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">1.0</span>)</span>
<span id="cb34-531"><a href="#cb34-531"></a>weak_iv_results <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(strengths, simulate_iv, <span class="at">n_sim =</span> <span class="dv">500</span>))</span>
<span id="cb34-532"><a href="#cb34-532"></a></span>
<span id="cb34-533"><a href="#cb34-533"></a><span class="fu">ggplot</span>(weak_iv_results, <span class="fu">aes</span>(<span class="at">x =</span> first_stage, <span class="at">y =</span> mean_estimate)) <span class="sc">+</span></span>
<span id="cb34-534"><a href="#cb34-534"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb34-535"><a href="#cb34-535"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"#9b59b6"</span>) <span class="sc">+</span></span>
<span id="cb34-536"><a href="#cb34-536"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"#9b59b6"</span>) <span class="sc">+</span></span>
<span id="cb34-537"><a href="#cb34-537"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean_estimate <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>sd_estimate,</span>
<span id="cb34-538"><a href="#cb34-538"></a>                    <span class="at">ymax =</span> mean_estimate <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>sd_estimate),</span>
<span id="cb34-539"><a href="#cb34-539"></a>                <span class="at">width =</span> <span class="fl">0.05</span>, <span class="at">color =</span> <span class="st">"#9b59b6"</span>) <span class="sc">+</span></span>
<span id="cb34-540"><a href="#cb34-540"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">0.8</span>, <span class="at">y =</span> <span class="fl">0.55</span>, <span class="at">label =</span> <span class="st">"True β = 0.5"</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb34-541"><a href="#cb34-541"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Weak IV Bias"</span>,</span>
<span id="cb34-542"><a href="#cb34-542"></a>       <span class="at">subtitle =</span> <span class="st">"Weak instruments bias IV toward OLS"</span>,</span>
<span id="cb34-543"><a href="#cb34-543"></a>       <span class="at">x =</span> <span class="st">"First-Stage Coefficient (instrument strength)"</span>,</span>
<span id="cb34-544"><a href="#cb34-544"></a>       <span class="at">y =</span> <span class="st">"Mean IV Estimate (across simulations)"</span>)</span>
<span id="cb34-545"><a href="#cb34-545"></a><span class="in">```</span></span>
<span id="cb34-546"><a href="#cb34-546"></a></span>
<span id="cb34-547"><a href="#cb34-547"></a><span class="fu">## Shift-Share (Bartik) Instruments</span></span>
<span id="cb34-548"><a href="#cb34-548"></a></span>
<span id="cb34-549"><a href="#cb34-549"></a>A common IV strategy in macro uses **shift-share** designs:</span>
<span id="cb34-550"><a href="#cb34-550"></a></span>
<span id="cb34-551"><a href="#cb34-551"></a>$$</span>
<span id="cb34-552"><a href="#cb34-552"></a>Z_{it} = \sum_k s_{ik,0} \cdot g_{kt}</span>
<span id="cb34-553"><a href="#cb34-553"></a>$$</span>
<span id="cb34-554"><a href="#cb34-554"></a></span>
<span id="cb34-555"><a href="#cb34-555"></a>where:</span>
<span id="cb34-556"><a href="#cb34-556"></a><span class="ss">- </span>$s_{ik,0}$ = pre-period **share** of sector $k$ in unit $i$</span>
<span id="cb34-557"><a href="#cb34-557"></a><span class="ss">- </span>$g_{kt}$ = national/global **shock** to sector $k$ at time $t$</span>
<span id="cb34-558"><a href="#cb34-558"></a></span>
<span id="cb34-559"><a href="#cb34-559"></a>**Example: China shock (Autor, Dorn, Hanson 2013)**</span>
<span id="cb34-560"><a href="#cb34-560"></a><span class="ss">- </span>$s_{ik}$ = share of industry $k$ in region $i$'s employment</span>
<span id="cb34-561"><a href="#cb34-561"></a><span class="ss">- </span>$g_{kt}$ = growth of Chinese imports in industry $k$</span>
<span id="cb34-562"><a href="#cb34-562"></a></span>
<span id="cb34-563"><a href="#cb34-563"></a>**Identification can come from:**</span>
<span id="cb34-564"><a href="#cb34-564"></a><span class="ss">- </span>Exogeneity of shares (Goldsmith-Pinkham, Sorkin &amp; Swift 2020)</span>
<span id="cb34-565"><a href="#cb34-565"></a><span class="ss">- </span>Exogeneity of shocks (Borusyak, Hull &amp; Jaravel 2022)</span>
<span id="cb34-566"><a href="#cb34-566"></a></span>
<span id="cb34-567"><a href="#cb34-567"></a><span class="fu">## GMM for Dynamic Panels</span></span>
<span id="cb34-568"><a href="#cb34-568"></a></span>
<span id="cb34-569"><a href="#cb34-569"></a>When the model includes lagged dependent variables:</span>
<span id="cb34-570"><a href="#cb34-570"></a></span>
<span id="cb34-571"><a href="#cb34-571"></a>$$</span>
<span id="cb34-572"><a href="#cb34-572"></a>Y_{it} = \rho Y_{i,t-1} + X_{it}'\beta + \alpha_i + \varepsilon_{it}</span>
<span id="cb34-573"><a href="#cb34-573"></a>$$</span>
<span id="cb34-574"><a href="#cb34-574"></a></span>
<span id="cb34-575"><a href="#cb34-575"></a>Standard FE is biased (**Nickell bias**): $\text{plim}(\hat{\rho}_{FE}) = \rho - \frac{1+\rho}{T-1}$</span>
<span id="cb34-576"><a href="#cb34-576"></a></span>
<span id="cb34-577"><a href="#cb34-577"></a>**Solutions:**</span>
<span id="cb34-578"><a href="#cb34-578"></a></span>
<span id="cb34-579"><a href="#cb34-579"></a><span class="pp">|</span> Method <span class="pp">|</span> Instruments <span class="pp">|</span> When to use <span class="pp">|</span></span>
<span id="cb34-580"><a href="#cb34-580"></a><span class="pp">|--------|-------------|-------------|</span></span>
<span id="cb34-581"><a href="#cb34-581"></a><span class="pp">|</span> Anderson-Hsiao <span class="pp">|</span> $Y_{i,t-2}$ <span class="pp">|</span> Simple, conservative <span class="pp">|</span></span>
<span id="cb34-582"><a href="#cb34-582"></a><span class="pp">|</span> Arellano-Bond (diff-GMM) <span class="pp">|</span> $Y_{i,t-2}, Y_{i,t-3}, ...$ <span class="pp">|</span> Moderately persistent $Y$ <span class="pp">|</span></span>
<span id="cb34-583"><a href="#cb34-583"></a><span class="pp">|</span> Blundell-Bond (sys-GMM) <span class="pp">|</span> Add levels equations <span class="pp">|</span> Highly persistent $Y$ <span class="pp">|</span></span>
<span id="cb34-584"><a href="#cb34-584"></a></span>
<span id="cb34-585"><a href="#cb34-585"></a>::: {.callout-tip}</span>
<span id="cb34-586"><a href="#cb34-586"></a><span class="fu">## When Nickell Bias is Small</span></span>
<span id="cb34-587"><a href="#cb34-587"></a>With $T = 84$ quarters and $\rho = 0.9$, the bias is approximately $\frac{1.9}{83} \approx 2.3\%$. For long panels, FE may be acceptable.</span>
<span id="cb34-588"><a href="#cb34-588"></a>:::</span>
<span id="cb34-589"><a href="#cb34-589"></a></span>
<span id="cb34-590"><a href="#cb34-590"></a><span class="fu"># Small-Sample Inference {.unnumbered}</span></span>
<span id="cb34-591"><a href="#cb34-591"></a></span>
<span id="cb34-592"><a href="#cb34-592"></a>Standard asymptotic inference fails with few clusters. This section covers robust alternatives.</span>
<span id="cb34-593"><a href="#cb34-593"></a></span>
<span id="cb34-594"><a href="#cb34-594"></a><span class="fu">## The Small-Cluster Problem</span></span>
<span id="cb34-595"><a href="#cb34-595"></a></span>
<span id="cb34-596"><a href="#cb34-596"></a>Cluster-robust standard errors assume $G \to \infty$ (number of clusters goes to infinity).</span>
<span id="cb34-597"><a href="#cb34-597"></a></span>
<span id="cb34-598"><a href="#cb34-598"></a>With $G &lt; 50$ clusters:</span>
<span id="cb34-599"><a href="#cb34-599"></a><span class="ss">- </span>Standard errors are biased downward</span>
<span id="cb34-600"><a href="#cb34-600"></a><span class="ss">- </span>t-statistics are inflated</span>
<span id="cb34-601"><a href="#cb34-601"></a><span class="ss">- </span>Rejection rates exceed nominal size</span>
<span id="cb34-602"><a href="#cb34-602"></a></span>
<span id="cb34-605"><a href="#cb34-605"></a><span class="in">```{r}</span></span>
<span id="cb34-606"><a href="#cb34-606"></a><span class="co">#| label: cluster-problem</span></span>
<span id="cb34-607"><a href="#cb34-607"></a><span class="co">#| fig-cap: "Small clusters lead to over-rejection"</span></span>
<span id="cb34-608"><a href="#cb34-608"></a></span>
<span id="cb34-609"><a href="#cb34-609"></a><span class="co"># Simulate rejection rates with different cluster sizes</span></span>
<span id="cb34-610"><a href="#cb34-610"></a>simulate_rejection <span class="ot">&lt;-</span> <span class="cf">function</span>(n_clusters, <span class="at">n_sim =</span> <span class="dv">1000</span>) {</span>
<span id="cb34-611"><a href="#cb34-611"></a>  rejections <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-612"><a href="#cb34-612"></a></span>
<span id="cb34-613"><a href="#cb34-613"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sim) {</span>
<span id="cb34-614"><a href="#cb34-614"></a>    <span class="co"># Generate clustered data with NO true effect</span></span>
<span id="cb34-615"><a href="#cb34-615"></a>    cluster_effects <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_clusters, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb34-616"><a href="#cb34-616"></a></span>
<span id="cb34-617"><a href="#cb34-617"></a>    data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-618"><a href="#cb34-618"></a>      <span class="at">cluster =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_clusters, <span class="at">each =</span> <span class="dv">10</span>),</span>
<span id="cb34-619"><a href="#cb34-619"></a>      <span class="at">cluster_effect =</span> <span class="fu">rep</span>(cluster_effects, <span class="at">each =</span> <span class="dv">10</span>)</span>
<span id="cb34-620"><a href="#cb34-620"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-621"><a href="#cb34-621"></a>      <span class="fu">mutate</span>(</span>
<span id="cb34-622"><a href="#cb34-622"></a>        <span class="at">X =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>()) <span class="sc">+</span> cluster_effect <span class="sc">*</span> <span class="fl">0.3</span>,</span>
<span id="cb34-623"><a href="#cb34-623"></a>        <span class="at">Y =</span> cluster_effect <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>())  <span class="co"># No effect of X!</span></span>
<span id="cb34-624"><a href="#cb34-624"></a>      )</span>
<span id="cb34-625"><a href="#cb34-625"></a></span>
<span id="cb34-626"><a href="#cb34-626"></a>    <span class="co"># Test with clustered SEs</span></span>
<span id="cb34-627"><a href="#cb34-627"></a>    fit <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y <span class="sc">~</span> X <span class="sc">|</span> cluster, <span class="at">data =</span> data, <span class="at">vcov =</span> <span class="sc">~</span>cluster)</span>
<span id="cb34-628"><a href="#cb34-628"></a>    p_value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pt</span>(<span class="fu">abs</span>(<span class="fu">coef</span>(fit)[<span class="st">"X"</span>] <span class="sc">/</span> <span class="fu">se</span>(fit)[<span class="st">"X"</span>]), <span class="at">df =</span> n_clusters <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb34-629"><a href="#cb34-629"></a>    rejections <span class="ot">&lt;-</span> rejections <span class="sc">+</span> (p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb34-630"><a href="#cb34-630"></a>  }</span>
<span id="cb34-631"><a href="#cb34-631"></a></span>
<span id="cb34-632"><a href="#cb34-632"></a>  rejections <span class="sc">/</span> n_sim</span>
<span id="cb34-633"><a href="#cb34-633"></a>}</span>
<span id="cb34-634"><a href="#cb34-634"></a></span>
<span id="cb34-635"><a href="#cb34-635"></a>cluster_sizes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">100</span>)</span>
<span id="cb34-636"><a href="#cb34-636"></a>rejection_rates <span class="ot">&lt;-</span> <span class="fu">sapply</span>(cluster_sizes, simulate_rejection, <span class="at">n_sim =</span> <span class="dv">500</span>)</span>
<span id="cb34-637"><a href="#cb34-637"></a></span>
<span id="cb34-638"><a href="#cb34-638"></a>rej_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">clusters =</span> cluster_sizes, <span class="at">rejection =</span> rejection_rates)</span>
<span id="cb34-639"><a href="#cb34-639"></a></span>
<span id="cb34-640"><a href="#cb34-640"></a><span class="fu">ggplot</span>(rej_df, <span class="fu">aes</span>(<span class="at">x =</span> clusters, <span class="at">y =</span> rejection)) <span class="sc">+</span></span>
<span id="cb34-641"><a href="#cb34-641"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.05</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb34-642"><a href="#cb34-642"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb34-643"><a href="#cb34-643"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb34-644"><a href="#cb34-644"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">70</span>, <span class="at">y =</span> <span class="fl">0.06</span>, <span class="at">label =</span> <span class="st">"Nominal 5% size"</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb34-645"><a href="#cb34-645"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Over-Rejection with Few Clusters"</span>,</span>
<span id="cb34-646"><a href="#cb34-646"></a>       <span class="at">subtitle =</span> <span class="st">"Rejection rate under the null (should be 5%)"</span>,</span>
<span id="cb34-647"><a href="#cb34-647"></a>       <span class="at">x =</span> <span class="st">"Number of Clusters"</span>,</span>
<span id="cb34-648"><a href="#cb34-648"></a>       <span class="at">y =</span> <span class="st">"Rejection Rate"</span>) <span class="sc">+</span></span>
<span id="cb34-649"><a href="#cb34-649"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.15</span>))</span>
<span id="cb34-650"><a href="#cb34-650"></a><span class="in">```</span></span>
<span id="cb34-651"><a href="#cb34-651"></a></span>
<span id="cb34-652"><a href="#cb34-652"></a><span class="fu">## Wild Cluster Bootstrap</span></span>
<span id="cb34-653"><a href="#cb34-653"></a></span>
<span id="cb34-654"><a href="#cb34-654"></a>The **wild cluster bootstrap** (Cameron, Gelbach &amp; Miller 2008) provides valid inference with few clusters.</span>
<span id="cb34-655"><a href="#cb34-655"></a></span>
<span id="cb34-656"><a href="#cb34-656"></a>**Algorithm:**</span>
<span id="cb34-657"><a href="#cb34-657"></a><span class="ss">1. </span>Estimate the model, get residuals $\hat{\varepsilon}_{it}$</span>
<span id="cb34-658"><a href="#cb34-658"></a><span class="ss">2. </span>For $b = 1, ..., B$:</span>
<span id="cb34-659"><a href="#cb34-659"></a><span class="ss">   - </span>Draw cluster-level weights $w_g \in <span class="sc">\{</span>-1, +1<span class="sc">\}</span>$ (Rademacher)</span>
<span id="cb34-660"><a href="#cb34-660"></a><span class="ss">   - </span>Construct bootstrap outcome: $Y^*_{it} = \hat{Y}_{it} + w_{g(i)} \cdot \hat{\varepsilon}_{it}$</span>
<span id="cb34-661"><a href="#cb34-661"></a><span class="ss">   - </span>Re-estimate model, save t-statistic $t^*_b$</span>
<span id="cb34-662"><a href="#cb34-662"></a><span class="ss">3. </span>Compare actual t-statistic to bootstrap distribution</span>
<span id="cb34-663"><a href="#cb34-663"></a></span>
<span id="cb34-666"><a href="#cb34-666"></a><span class="in">```{r}</span></span>
<span id="cb34-667"><a href="#cb34-667"></a><span class="co">#| label: wcb-demo</span></span>
<span id="cb34-668"><a href="#cb34-668"></a><span class="co">#| fig-cap: "Wild cluster bootstrap provides valid inference"</span></span>
<span id="cb34-669"><a href="#cb34-669"></a></span>
<span id="cb34-670"><a href="#cb34-670"></a><span class="co"># Demonstrate wild cluster bootstrap (manual implementation)</span></span>
<span id="cb34-671"><a href="#cb34-671"></a><span class="co"># In practice, use fwildclusterboot::boottest()</span></span>
<span id="cb34-672"><a href="#cb34-672"></a></span>
<span id="cb34-673"><a href="#cb34-673"></a><span class="co"># Generate data with few clusters</span></span>
<span id="cb34-674"><a href="#cb34-674"></a>n_clusters <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb34-675"><a href="#cb34-675"></a>cluster_effects <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_clusters, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb34-676"><a href="#cb34-676"></a></span>
<span id="cb34-677"><a href="#cb34-677"></a>wcb_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-678"><a href="#cb34-678"></a>  <span class="at">cluster =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_clusters, <span class="at">each =</span> <span class="dv">15</span>),</span>
<span id="cb34-679"><a href="#cb34-679"></a>  <span class="at">cluster_effect =</span> <span class="fu">rep</span>(cluster_effects, <span class="at">each =</span> <span class="dv">15</span>)</span>
<span id="cb34-680"><a href="#cb34-680"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb34-681"><a href="#cb34-681"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-682"><a href="#cb34-682"></a>    <span class="at">X =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>()) <span class="sc">+</span> cluster_effect <span class="sc">*</span> <span class="fl">0.3</span>,</span>
<span id="cb34-683"><a href="#cb34-683"></a>    <span class="at">Y =</span> <span class="fl">0.5</span> <span class="sc">*</span> X <span class="sc">+</span> cluster_effect <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="fl">0.8</span>)  <span class="co"># True effect = 0.5</span></span>
<span id="cb34-684"><a href="#cb34-684"></a>  )</span>
<span id="cb34-685"><a href="#cb34-685"></a></span>
<span id="cb34-686"><a href="#cb34-686"></a><span class="co"># Standard estimation</span></span>
<span id="cb34-687"><a href="#cb34-687"></a>model <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y <span class="sc">~</span> X <span class="sc">|</span> cluster, <span class="at">data =</span> wcb_data, <span class="at">vcov =</span> <span class="sc">~</span>cluster)</span>
<span id="cb34-688"><a href="#cb34-688"></a></span>
<span id="cb34-689"><a href="#cb34-689"></a><span class="fu">cat</span>(<span class="st">"=== Standard Cluster-Robust Inference ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-690"><a href="#cb34-690"></a><span class="fu">cat</span>(<span class="st">"Estimate:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(model)[<span class="st">"X"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-691"><a href="#cb34-691"></a><span class="fu">cat</span>(<span class="st">"Cluster SE:"</span>, <span class="fu">round</span>(<span class="fu">se</span>(model)[<span class="st">"X"</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-692"><a href="#cb34-692"></a><span class="fu">cat</span>(<span class="st">"t-stat:"</span>, <span class="fu">round</span>(<span class="fu">coef</span>(model)[<span class="st">"X"</span>] <span class="sc">/</span> <span class="fu">se</span>(model)[<span class="st">"X"</span>], <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-693"><a href="#cb34-693"></a><span class="fu">cat</span>(<span class="st">"p-value (t-dist, df ="</span>, n_clusters <span class="sc">-</span> <span class="dv">1</span>, <span class="st">"):"</span>,</span>
<span id="cb34-694"><a href="#cb34-694"></a>    <span class="fu">round</span>(<span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="sc">-</span><span class="fu">abs</span>(<span class="fu">coef</span>(model)[<span class="st">"X"</span>] <span class="sc">/</span> <span class="fu">se</span>(model)[<span class="st">"X"</span>]), <span class="at">df =</span> n_clusters <span class="sc">-</span> <span class="dv">1</span>), <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb34-695"><a href="#cb34-695"></a></span>
<span id="cb34-696"><a href="#cb34-696"></a><span class="co"># Manual wild cluster bootstrap implementation</span></span>
<span id="cb34-697"><a href="#cb34-697"></a>wild_cluster_bootstrap <span class="ot">&lt;-</span> <span class="cf">function</span>(model, data, cluster_var, <span class="at">B =</span> <span class="dv">999</span>) {</span>
<span id="cb34-698"><a href="#cb34-698"></a>  <span class="co"># Get model components</span></span>
<span id="cb34-699"><a href="#cb34-699"></a>  y_fitted <span class="ot">&lt;-</span> <span class="fu">fitted</span>(model)</span>
<span id="cb34-700"><a href="#cb34-700"></a>  resid <span class="ot">&lt;-</span> <span class="fu">residuals</span>(model)</span>
<span id="cb34-701"><a href="#cb34-701"></a>  clusters <span class="ot">&lt;-</span> <span class="fu">unique</span>(data[[cluster_var]])</span>
<span id="cb34-702"><a href="#cb34-702"></a>  G <span class="ot">&lt;-</span> <span class="fu">length</span>(clusters)</span>
<span id="cb34-703"><a href="#cb34-703"></a></span>
<span id="cb34-704"><a href="#cb34-704"></a>  <span class="co"># Original t-statistic</span></span>
<span id="cb34-705"><a href="#cb34-705"></a>  t_orig <span class="ot">&lt;-</span> <span class="fu">coef</span>(model)[<span class="st">"X"</span>] <span class="sc">/</span> <span class="fu">se</span>(model)[<span class="st">"X"</span>]</span>
<span id="cb34-706"><a href="#cb34-706"></a></span>
<span id="cb34-707"><a href="#cb34-707"></a>  <span class="co"># Bootstrap</span></span>
<span id="cb34-708"><a href="#cb34-708"></a>  t_boot <span class="ot">&lt;-</span> <span class="fu">numeric</span>(B)</span>
<span id="cb34-709"><a href="#cb34-709"></a>  <span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb34-710"><a href="#cb34-710"></a>    <span class="co"># Rademacher weights (cluster-level)</span></span>
<span id="cb34-711"><a href="#cb34-711"></a>    weights <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), G, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-712"><a href="#cb34-712"></a>    <span class="fu">names</span>(weights) <span class="ot">&lt;-</span> clusters</span>
<span id="cb34-713"><a href="#cb34-713"></a></span>
<span id="cb34-714"><a href="#cb34-714"></a>    <span class="co"># Construct bootstrap outcome</span></span>
<span id="cb34-715"><a href="#cb34-715"></a>    data<span class="sc">$</span>Y_boot <span class="ot">&lt;-</span> y_fitted <span class="sc">+</span> weights[<span class="fu">as.character</span>(data[[cluster_var]])] <span class="sc">*</span> resid</span>
<span id="cb34-716"><a href="#cb34-716"></a></span>
<span id="cb34-717"><a href="#cb34-717"></a>    <span class="co"># Re-estimate under null (impose beta = 0)</span></span>
<span id="cb34-718"><a href="#cb34-718"></a>    model_boot <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y_boot <span class="sc">~</span> X <span class="sc">|</span> cluster, <span class="at">data =</span> data, <span class="at">vcov =</span> <span class="sc">~</span>cluster)</span>
<span id="cb34-719"><a href="#cb34-719"></a>    t_boot[b] <span class="ot">&lt;-</span> <span class="fu">coef</span>(model_boot)[<span class="st">"X"</span>] <span class="sc">/</span> <span class="fu">se</span>(model_boot)[<span class="st">"X"</span>]</span>
<span id="cb34-720"><a href="#cb34-720"></a>  }</span>
<span id="cb34-721"><a href="#cb34-721"></a></span>
<span id="cb34-722"><a href="#cb34-722"></a>  <span class="co"># Two-sided p-value</span></span>
<span id="cb34-723"><a href="#cb34-723"></a>  p_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(t_boot) <span class="sc">&gt;=</span> <span class="fu">abs</span>(t_orig))</span>
<span id="cb34-724"><a href="#cb34-724"></a></span>
<span id="cb34-725"><a href="#cb34-725"></a>  <span class="fu">list</span>(<span class="at">t_orig =</span> t_orig, <span class="at">t_boot =</span> t_boot, <span class="at">p_value =</span> p_value)</span>
<span id="cb34-726"><a href="#cb34-726"></a>}</span>
<span id="cb34-727"><a href="#cb34-727"></a></span>
<span id="cb34-728"><a href="#cb34-728"></a><span class="co"># Run bootstrap (reduced B for speed)</span></span>
<span id="cb34-729"><a href="#cb34-729"></a>boot_result <span class="ot">&lt;-</span> <span class="fu">wild_cluster_bootstrap</span>(model, wcb_data, <span class="st">"cluster"</span>, <span class="at">B =</span> <span class="dv">499</span>)</span>
<span id="cb34-730"><a href="#cb34-730"></a></span>
<span id="cb34-731"><a href="#cb34-731"></a><span class="fu">cat</span>(<span class="st">"=== Wild Cluster Bootstrap (Manual) ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-732"><a href="#cb34-732"></a><span class="fu">cat</span>(<span class="st">"Bootstrap p-value:"</span>, <span class="fu">round</span>(boot_result<span class="sc">$</span>p_value, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-733"><a href="#cb34-733"></a><span class="fu">cat</span>(<span class="st">"(In practice, use fwildclusterboot::boottest() for efficiency)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-734"><a href="#cb34-734"></a><span class="in">```</span></span>
<span id="cb34-735"><a href="#cb34-735"></a></span>
<span id="cb34-736"><a href="#cb34-736"></a><span class="fu">## When to Use What</span></span>
<span id="cb34-737"><a href="#cb34-737"></a></span>
<span id="cb34-738"><a href="#cb34-738"></a><span class="pp">|</span> Clusters <span class="pp">|</span> Method <span class="pp">|</span> R Implementation <span class="pp">|</span></span>
<span id="cb34-739"><a href="#cb34-739"></a><span class="pp">|----------|--------|------------------|</span></span>
<span id="cb34-740"><a href="#cb34-740"></a><span class="pp">|</span> G &gt; 50 <span class="pp">|</span> Standard cluster-robust SE <span class="pp">|</span> <span class="in">`vcov = ~cluster`</span> <span class="pp">|</span></span>
<span id="cb34-741"><a href="#cb34-741"></a><span class="pp">|</span> 30 &lt; G &lt; 50 <span class="pp">|</span> t-distribution with G-1 df <span class="pp">|</span> <span class="in">`vcov = ~cluster`</span> + manual df adjustment <span class="pp">|</span></span>
<span id="cb34-742"><a href="#cb34-742"></a><span class="pp">|</span> 10 &lt; G &lt; 30 <span class="pp">|</span> Wild cluster bootstrap <span class="pp">|</span> <span class="in">`fwildclusterboot::boottest()`</span> <span class="pp">|</span></span>
<span id="cb34-743"><a href="#cb34-743"></a><span class="pp">|</span> G &lt; 10 <span class="pp">|</span> Randomization inference <span class="pp">|</span> Permutation tests <span class="pp">|</span></span>
<span id="cb34-744"><a href="#cb34-744"></a></span>
<span id="cb34-745"><a href="#cb34-745"></a>::: {.callout-tip}</span>
<span id="cb34-746"><a href="#cb34-746"></a><span class="fu">## Webb Weights for Very Few Clusters</span></span>
<span id="cb34-747"><a href="#cb34-747"></a>With G &lt; 10, use Webb (6-point) weights instead of Rademacher:</span>
<span id="cb34-748"><a href="#cb34-748"></a><span class="in">```r</span></span>
<span id="cb34-749"><a href="#cb34-749"></a><span class="fu">boottest</span>(model, <span class="at">param =</span> <span class="st">"X"</span>, <span class="at">clustid =</span> <span class="st">"cluster"</span>, <span class="at">type =</span> <span class="st">"webb"</span>)</span>
<span id="cb34-750"><a href="#cb34-750"></a><span class="in">```</span></span>
<span id="cb34-751"><a href="#cb34-751"></a>:::</span>
<span id="cb34-752"><a href="#cb34-752"></a></span>
<span id="cb34-753"><a href="#cb34-753"></a><span class="fu"># Putting It Together {.unnumbered}</span></span>
<span id="cb34-754"><a href="#cb34-754"></a></span>
<span id="cb34-755"><a href="#cb34-755"></a><span class="fu">## Checklist for Identification</span></span>
<span id="cb34-756"><a href="#cb34-756"></a></span>
<span id="cb34-757"><a href="#cb34-757"></a>Before claiming a causal effect, verify:</span>
<span id="cb34-758"><a href="#cb34-758"></a></span>
<span id="cb34-759"><a href="#cb34-759"></a><span class="ss">1. </span>**What is the source of identifying variation?**</span>
<span id="cb34-760"><a href="#cb34-760"></a><span class="ss">   - </span>Within-unit over time? (FE)</span>
<span id="cb34-761"><a href="#cb34-761"></a><span class="ss">   - </span>Across units hit by shock? (DiD)</span>
<span id="cb34-762"><a href="#cb34-762"></a><span class="ss">   - </span>Exogenous instrument? (IV)</span>
<span id="cb34-763"><a href="#cb34-763"></a></span>
<span id="cb34-764"><a href="#cb34-764"></a><span class="ss">2. </span>**What assumptions does this require?**</span>
<span id="cb34-765"><a href="#cb34-765"></a><span class="ss">   - </span>Parallel trends? (DiD)</span>
<span id="cb34-766"><a href="#cb34-766"></a><span class="ss">   - </span>Exclusion restriction? (IV)</span>
<span id="cb34-767"><a href="#cb34-767"></a><span class="ss">   - </span>No anticipation? (Event study)</span>
<span id="cb34-768"><a href="#cb34-768"></a></span>
<span id="cb34-769"><a href="#cb34-769"></a><span class="ss">3. </span>**What are the threats?**</span>
<span id="cb34-770"><a href="#cb34-770"></a><span class="ss">   - </span>Time-varying confounders?</span>
<span id="cb34-771"><a href="#cb34-771"></a><span class="ss">   - </span>Spillovers to control group?</span>
<span id="cb34-772"><a href="#cb34-772"></a><span class="ss">   - </span>Weak instruments?</span>
<span id="cb34-773"><a href="#cb34-773"></a></span>
<span id="cb34-774"><a href="#cb34-774"></a><span class="ss">4. </span>**What robustness checks support the design?**</span>
<span id="cb34-775"><a href="#cb34-775"></a><span class="ss">   - </span>Pre-trends (with caveats about power)</span>
<span id="cb34-776"><a href="#cb34-776"></a><span class="ss">   - </span>Placebo tests</span>
<span id="cb34-777"><a href="#cb34-777"></a><span class="ss">   - </span>Alternative control groups</span>
<span id="cb34-778"><a href="#cb34-778"></a><span class="ss">   - </span>Sensitivity analysis</span>
<span id="cb34-779"><a href="#cb34-779"></a></span>
<span id="cb34-780"><a href="#cb34-780"></a><span class="fu">## Common Pitfalls</span></span>
<span id="cb34-781"><a href="#cb34-781"></a></span>
<span id="cb34-782"><a href="#cb34-782"></a><span class="pp">|</span> Pitfall <span class="pp">|</span> Problem <span class="pp">|</span> Solution <span class="pp">|</span></span>
<span id="cb34-783"><a href="#cb34-783"></a><span class="pp">|---------|---------|----------|</span></span>
<span id="cb34-784"><a href="#cb34-784"></a><span class="pp">|</span> Overinterpreting pre-trends <span class="pp">|</span> Low power against violations <span class="pp">|</span> Use HonestDiD, report sensitivity <span class="pp">|</span></span>
<span id="cb34-785"><a href="#cb34-785"></a><span class="pp">|</span> Post-treatment controls <span class="pp">|</span> Blocks causal path <span class="pp">|</span> Only control for pre-determined variables <span class="pp">|</span></span>
<span id="cb34-786"><a href="#cb34-786"></a><span class="pp">|</span> Weak instruments <span class="pp">|</span> Bias toward OLS <span class="pp">|</span> Report first-stage F, use robust methods <span class="pp">|</span></span>
<span id="cb34-787"><a href="#cb34-787"></a><span class="pp">|</span> Few clusters <span class="pp">|</span> Over-rejection <span class="pp">|</span> Wild cluster bootstrap <span class="pp">|</span></span>
<span id="cb34-788"><a href="#cb34-788"></a><span class="pp">|</span> Staggered treatment <span class="pp">|</span> TWFE bias <span class="pp">|</span> Callaway-Sant'Anna, Sun-Abraham <span class="pp">|</span></span>
<span id="cb34-789"><a href="#cb34-789"></a><span class="pp">|</span> Anticipation effects <span class="pp">|</span> Violates sharp treatment timing <span class="pp">|</span> Test for pre-treatment effects <span class="pp">|</span></span>
<span id="cb34-790"><a href="#cb34-790"></a></span>
<span id="cb34-791"><a href="#cb34-791"></a><span class="fu"># Frequently Asked Questions {.unnumbered}</span></span>
<span id="cb34-792"><a href="#cb34-792"></a></span>
<span id="cb34-793"><a href="#cb34-793"></a><span class="fu">## How do I know if parallel trends holds?</span></span>
<span id="cb34-794"><a href="#cb34-794"></a></span>
<span id="cb34-795"><a href="#cb34-795"></a>You can't prove it—it's about **counterfactuals** we don't observe. You can:</span>
<span id="cb34-796"><a href="#cb34-796"></a><span class="ss">- </span>Show pre-trends are flat (but low power—Roth 2022)</span>
<span id="cb34-797"><a href="#cb34-797"></a><span class="ss">- </span>Argue institutionally why the assumption is plausible</span>
<span id="cb34-798"><a href="#cb34-798"></a><span class="ss">- </span>Run sensitivity analysis (HonestDiD)</span>
<span id="cb34-799"><a href="#cb34-799"></a><span class="ss">- </span>Find a better control group</span>
<span id="cb34-800"><a href="#cb34-800"></a></span>
<span id="cb34-801"><a href="#cb34-801"></a><span class="fu">## When should I use IV vs. DiD?</span></span>
<span id="cb34-802"><a href="#cb34-802"></a></span>
<span id="cb34-803"><a href="#cb34-803"></a>**Use DiD when:**</span>
<span id="cb34-804"><a href="#cb34-804"></a><span class="ss">- </span>You have a clear treatment/control distinction</span>
<span id="cb34-805"><a href="#cb34-805"></a><span class="ss">- </span>Treatment timing is plausibly exogenous</span>
<span id="cb34-806"><a href="#cb34-806"></a><span class="ss">- </span>Parallel trends is defensible</span>
<span id="cb34-807"><a href="#cb34-807"></a></span>
<span id="cb34-808"><a href="#cb34-808"></a>**Use IV when:**</span>
<span id="cb34-809"><a href="#cb34-809"></a><span class="ss">- </span>Treatment varies continuously (not just on/off)</span>
<span id="cb34-810"><a href="#cb34-810"></a><span class="ss">- </span>You have a plausibly exogenous source of variation in treatment</span>
<span id="cb34-811"><a href="#cb34-811"></a><span class="ss">- </span>Exclusion restriction is defensible</span>
<span id="cb34-812"><a href="#cb34-812"></a></span>
<span id="cb34-813"><a href="#cb34-813"></a><span class="fu">## What if my first-stage F is below 10?</span></span>
<span id="cb34-814"><a href="#cb34-814"></a></span>
<span id="cb34-815"><a href="#cb34-815"></a>Options:</span>
<span id="cb34-816"><a href="#cb34-816"></a><span class="ss">1. </span>Find a stronger instrument</span>
<span id="cb34-817"><a href="#cb34-817"></a><span class="ss">2. </span>Use weak-IV robust methods (Anderson-Rubin, LIML)</span>
<span id="cb34-818"><a href="#cb34-818"></a><span class="ss">3. </span>Report reduced form instead (effect of Z on Y)</span>
<span id="cb34-819"><a href="#cb34-819"></a><span class="ss">4. </span>Interpret results as a lower bound (if bias direction is known)</span>
<span id="cb34-820"><a href="#cb34-820"></a></span>
<span id="cb34-821"><a href="#cb34-821"></a><span class="fu">## How many clusters do I need?</span></span>
<span id="cb34-822"><a href="#cb34-822"></a></span>
<span id="cb34-823"><a href="#cb34-823"></a><span class="ss">- </span>50+ clusters: Standard cluster-robust SEs are fine</span>
<span id="cb34-824"><a href="#cb34-824"></a><span class="ss">- </span>30-50 clusters: Use t-distribution with G-1 df</span>
<span id="cb34-825"><a href="#cb34-825"></a><span class="ss">- </span>10-30 clusters: Wild cluster bootstrap</span>
<span id="cb34-826"><a href="#cb34-826"></a><span class="ss">- </span>&lt;10 clusters: Randomization inference, or aggregate to higher level</span>
<span id="cb34-827"><a href="#cb34-827"></a></span>
<span id="cb34-828"><a href="#cb34-828"></a><span class="fu"># Summary {.unnumbered}</span></span>
<span id="cb34-829"><a href="#cb34-829"></a></span>
<span id="cb34-830"><a href="#cb34-830"></a>Key takeaways from this module:</span>
<span id="cb34-831"><a href="#cb34-831"></a></span>
<span id="cb34-832"><a href="#cb34-832"></a><span class="ss">1. </span>**Correlation ≠ causation** due to simultaneity, selection, and omitted variables</span>
<span id="cb34-833"><a href="#cb34-833"></a></span>
<span id="cb34-834"><a href="#cb34-834"></a><span class="ss">2. </span>**Controlling for observables** doesn't solve endogeneity from unobservables</span>
<span id="cb34-835"><a href="#cb34-835"></a></span>
<span id="cb34-836"><a href="#cb34-836"></a><span class="ss">3. </span>**DiD exploits discrete shocks** but requires parallel trends—a **strong, untestable assumption**</span>
<span id="cb34-837"><a href="#cb34-837"></a></span>
<span id="cb34-838"><a href="#cb34-838"></a><span class="ss">4. </span>**Pre-trends tests have low power**—passing doesn't guarantee validity</span>
<span id="cb34-839"><a href="#cb34-839"></a></span>
<span id="cb34-840"><a href="#cb34-840"></a><span class="ss">5. </span>**IV isolates exogenous variation** but requires a valid instrument (relevant + excludable)</span>
<span id="cb34-841"><a href="#cb34-841"></a></span>
<span id="cb34-842"><a href="#cb34-842"></a><span class="ss">6. </span>**Small clusters** require wild cluster bootstrap for valid inference</span>
<span id="cb34-843"><a href="#cb34-843"></a></span>
<span id="cb34-844"><a href="#cb34-844"></a>---</span>
<span id="cb34-845"><a href="#cb34-845"></a></span>
<span id="cb34-846"><a href="#cb34-846"></a>*Next: [Module 3: Local Projections](03_local_projections.qmd)*</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Mastering Empirical Macroeconometrics by Bijoy Ratan Ghosh</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/bijoyratanghosh/empirical-macro-curriculum/edit/main/chapters/02_identification.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/bijoyratanghosh/empirical-macro-curriculum/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>