<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Panel Data Econometrics – Mastering Empirical Macroeconometrics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/02_identification.html" rel="next">
<link href="../index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-f555ed0e695c0487cf72966c0b30f9ff.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-ec3f846469679b9e6f6b146d88a0bba5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/01_panel_econometrics.html">Phase 1: Foundations</a></li><li class="breadcrumb-item"><a href="../chapters/01_panel_econometrics.html"><span class="chapter-title">Panel Data Econometrics</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Mastering Empirical Macroeconometrics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/bijoyratanghosh/empirical-macro-curriculum" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Mastering Empirical Macroeconometrics</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 1: Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01_panel_econometrics.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Panel Data Econometrics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02_identification.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Identification in Macroeconomics</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 2: Dynamic Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03_local_projections.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Local Projections</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04_var_svar.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Vector Autoregressions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 3: Treatment Effects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05_staggered_did.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Staggered Difference-in-Differences</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06_synthetic_control.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Synthetic Control Methods</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 4: Bayesian Econometrics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07_bayesian_foundations.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Bayesian Foundations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08_bayesian_var.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Bayesian Vector Autoregressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09_bayesian_panel.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Bayesian Panel Methods</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 5: Structural Macro</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10_dsge_foundations.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">DSGE Foundations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11_dsge_estimation.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">DSGE Estimation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 6: Causal Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12_regularization.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Regularization for Macro</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13_causal_ml.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Causal Machine Learning</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#theory" id="toc-theory" class="nav-link active" data-scroll-target="#theory">Theory</a>
  <ul class="collapse">
  <li><a href="#the-panel-data-model" id="toc-the-panel-data-model" class="nav-link" data-scroll-target="#the-panel-data-model">The Panel Data Model</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#pooled-ols-the-naive-approach" id="toc-pooled-ols-the-naive-approach" class="nav-link" data-scroll-target="#pooled-ols-the-naive-approach">Pooled OLS: The Naive Approach</a></li>
  <li><a href="#the-omitted-variable-bias-formula" id="toc-the-omitted-variable-bias-formula" class="nav-link" data-scroll-target="#the-omitted-variable-bias-formula">The Omitted Variable Bias Formula</a></li>
  </ul></li>
  <li><a href="#the-fixed-effects-estimator" id="toc-the-fixed-effects-estimator" class="nav-link" data-scroll-target="#the-fixed-effects-estimator">The Fixed Effects Estimator</a>
  <ul class="collapse">
  <li><a href="#the-within-transformation" id="toc-the-within-transformation" class="nav-link" data-scroll-target="#the-within-transformation">The Within Transformation</a></li>
  <li><a href="#what-fe-uses-and-what-it-discards" id="toc-what-fe-uses-and-what-it-discards" class="nav-link" data-scroll-target="#what-fe-uses-and-what-it-discards">What FE Uses and What It Discards</a></li>
  <li><a href="#consistency" id="toc-consistency" class="nav-link" data-scroll-target="#consistency">Consistency</a></li>
  <li><a href="#the-frisch-waugh-lovell-theorem" id="toc-the-frisch-waugh-lovell-theorem" class="nav-link" data-scroll-target="#the-frisch-waugh-lovell-theorem">The Frisch-Waugh-Lovell Theorem</a></li>
  </ul></li>
  <li><a href="#two-way-fixed-effects" id="toc-two-way-fixed-effects" class="nav-link" data-scroll-target="#two-way-fixed-effects">Two-Way Fixed Effects</a>
  <ul class="collapse">
  <li><a href="#the-model" id="toc-the-model" class="nav-link" data-scroll-target="#the-model">The Model</a></li>
  <li><a href="#double-demeaning" id="toc-double-demeaning" class="nav-link" data-scroll-target="#double-demeaning">Double Demeaning</a></li>
  <li><a href="#what-each-fixed-effect-absorbs" id="toc-what-each-fixed-effect-absorbs" class="nav-link" data-scroll-target="#what-each-fixed-effect-absorbs">What Each Fixed Effect Absorbs</a></li>
  </ul></li>
  <li><a href="#interactions-in-panel-models" id="toc-interactions-in-panel-models" class="nav-link" data-scroll-target="#interactions-in-panel-models">Interactions in Panel Models</a>
  <ul class="collapse">
  <li><a href="#the-interaction-term" id="toc-the-interaction-term" class="nav-link" data-scroll-target="#the-interaction-term">The Interaction Term</a></li>
  <li><a href="#clustering-standard-errors" id="toc-clustering-standard-errors" class="nav-link" data-scroll-target="#clustering-standard-errors">Clustering Standard Errors</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#monte-carlo-simulations" id="toc-monte-carlo-simulations" class="nav-link" data-scroll-target="#monte-carlo-simulations">Monte Carlo Simulations</a>
  <ul class="collapse">
  <li><a href="#demonstrating-ovb-pooled-ols-vs.-fe" id="toc-demonstrating-ovb-pooled-ols-vs.-fe" class="nav-link" data-scroll-target="#demonstrating-ovb-pooled-ols-vs.-fe">Demonstrating OVB: Pooled OLS vs.&nbsp;FE</a></li>
  <li><a href="#demonstrating-time-fe-importance" id="toc-demonstrating-time-fe-importance" class="nav-link" data-scroll-target="#demonstrating-time-fe-importance">Demonstrating Time FE Importance</a></li>
  <li><a href="#cluster-se-coverage" id="toc-cluster-se-coverage" class="nav-link" data-scroll-target="#cluster-se-coverage">Cluster SE Coverage</a></li>
  </ul></li>
  <li><a href="#application" id="toc-application" class="nav-link" data-scroll-target="#application">Application</a>
  <ul class="collapse">
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a></li>
  <li><a href="#building-up-ols-fe-twfe" id="toc-building-up-ols-fe-twfe" class="nav-link" data-scroll-target="#building-up-ols-fe-twfe">Building Up: OLS → FE → TWFE</a></li>
  <li><a href="#within-country-variation" id="toc-within-country-variation" class="nav-link" data-scroll-target="#within-country-variation">Within-Country Variation</a></li>
  <li><a href="#standard-error-comparison" id="toc-standard-error-comparison" class="nav-link" data-scroll-target="#standard-error-comparison">Standard Error Comparison</a></li>
  </ul></li>
  <li><a href="#frequently-asked-questions" id="toc-frequently-asked-questions" class="nav-link" data-scroll-target="#frequently-asked-questions">Frequently Asked Questions</a>
  <ul class="collapse">
  <li><a href="#why-not-random-effects" id="toc-why-not-random-effects" class="nav-link" data-scroll-target="#why-not-random-effects">Why not random effects?</a></li>
  <li><a href="#what-if-within-r²-is-low" id="toc-what-if-within-r²-is-low" class="nav-link" data-scroll-target="#what-if-within-r²-is-low">What if within R² is low?</a></li>
  <li><a href="#what-about-endogeneity" id="toc-what-about-endogeneity" class="nav-link" data-scroll-target="#what-about-endogeneity">What about endogeneity?</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/bijoyratanghosh/empirical-macro-curriculum/edit/main/chapters/01_panel_econometrics.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/bijoyratanghosh/empirical-macro-curriculum/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/01_panel_econometrics.html">Phase 1: Foundations</a></li><li class="breadcrumb-item"><a href="../chapters/01_panel_econometrics.html"><span class="chapter-title">Panel Data Econometrics</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">Panel Data Econometrics</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">From OLS to Two-Way Fixed Effects</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="theory" class="level1 unnumbered">
<h1 class="unnumbered">Theory</h1>
<p>This section develops the theoretical foundations of panel data econometrics, focusing on the fixed effects estimator and its properties.</p>
<section id="the-panel-data-model" class="level2">
<h2 class="anchored" data-anchor-id="the-panel-data-model">The Panel Data Model</h2>
<section id="setup" class="level3">
<h3 class="anchored" data-anchor-id="setup">Setup</h3>
<p>We observe <span class="math inline">\(N\)</span> units (countries) over <span class="math inline">\(T\)</span> time periods (quarters). The data generating process (DGP) is:</p>
<p><span class="math display">\[
y_{it} = \mathbf{x}_{it}'\boldsymbol{\beta} + \alpha_i + \varepsilon_{it}, \quad i = 1, \ldots, N, \quad t = 1, \ldots, T
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(y_{it}\)</span>: outcome (e.g., policy rate for country <span class="math inline">\(i\)</span> at time <span class="math inline">\(t\)</span>)</li>
<li><span class="math inline">\(\mathbf{x}_{it}\)</span>: <span class="math inline">\(K \times 1\)</span> vector of observable regressors (e.g., bank holdings, inflation)</li>
<li><span class="math inline">\(\boldsymbol{\beta}\)</span>: <span class="math inline">\(K \times 1\)</span> parameter vector of interest</li>
<li><span class="math inline">\(\alpha_i\)</span>: <strong>unobserved</strong> time-invariant individual effect (institutions, geography, political culture)</li>
<li><span class="math inline">\(\varepsilon_{it}\)</span>: idiosyncratic error</li>
</ul>
<p>The key question: <strong>what happens to <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span> when we ignore <span class="math inline">\(\alpha_i\)</span>?</strong></p>
</section>
<section id="pooled-ols-the-naive-approach" class="level3">
<h3 class="anchored" data-anchor-id="pooled-ols-the-naive-approach">Pooled OLS: The Naive Approach</h3>
<p>If we ignore the panel structure and estimate by OLS:</p>
<p><span class="math display">\[
y_{it} = \mathbf{x}_{it}'\boldsymbol{\beta} + u_{it}, \quad \text{where } u_{it} = \alpha_i + \varepsilon_{it}
\]</span></p>
<p>The OLS estimator is:</p>
<p><span class="math display">\[
\hat{\boldsymbol{\beta}}_{\text{OLS}} = \left(\sum_{i=1}^{N}\sum_{t=1}^{T} \mathbf{x}_{it}\mathbf{x}_{it}'\right)^{-1} \left(\sum_{i=1}^{N}\sum_{t=1}^{T} \mathbf{x}_{it} y_{it}\right)
\]</span></p>
<p><strong>Consistency requires</strong> <span class="math inline">\(\text{plim} \left(\frac{1}{NT}\sum_{i,t} \mathbf{x}_{it} u_{it}\right) = \mathbf{0}\)</span>.</p>
<p>Expanding: <span class="math display">\[
\frac{1}{NT}\sum_{i,t} \mathbf{x}_{it} u_{it} = \frac{1}{NT}\sum_{i,t} \mathbf{x}_{it} \alpha_i + \frac{1}{NT}\sum_{i,t} \mathbf{x}_{it} \varepsilon_{it}
\]</span></p>
<p>The second term vanishes under standard exogeneity (<span class="math inline">\(E[\varepsilon_{it}|\mathbf{x}_{it}] = 0\)</span>). But the first term:</p>
<p><span class="math display">\[
\frac{1}{NT}\sum_{i,t} \mathbf{x}_{it} \alpha_i \xrightarrow{p} E[\mathbf{x}_{it} \alpha_i] = \text{Cov}(\mathbf{x}_{it}, \alpha_i) + E[\mathbf{x}_{it}]E[\alpha_i]
\]</span></p>
<p><strong>If <span class="math inline">\(\text{Cov}(\mathbf{x}_{it}, \alpha_i) \neq 0\)</span>, pooled OLS is inconsistent.</strong></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Applied Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>In macroeconomic panels, countries with high bank holdings of sovereign debt (<span class="math inline">\(\mathbf{x}\)</span>) likely have different institutional quality (<span class="math inline">\(\alpha\)</span>) than countries with low holdings. A banking system may hold lots of government bonds <em>because</em> of institutional features (regulatory requirements, underdeveloped capital markets) that also independently affect monetary policy. Pooled OLS conflates the causal effect of bank holdings with these institutional differences.</p>
</div>
</div>
</section>
<section id="the-omitted-variable-bias-formula" class="level3">
<h3 class="anchored" data-anchor-id="the-omitted-variable-bias-formula">The Omitted Variable Bias Formula</h3>
<p>To make this precise, suppose <span class="math inline">\(K = 1\)</span> (scalar <span class="math inline">\(x\)</span>) and the true model is:</p>
<p><span class="math display">\[
y_{it} = \beta x_{it} + \gamma \alpha_i + \varepsilon_{it}
\]</span></p>
<p>where <span class="math inline">\(\gamma = 1\)</span> (the coefficient on <span class="math inline">\(\alpha_i\)</span> is 1 by normalization). The OLS estimator from the regression omitting <span class="math inline">\(\alpha_i\)</span> gives:</p>
<p><span class="math display">\[
\hat{\beta}_{\text{OLS}} \xrightarrow{p} \beta + \gamma \cdot \frac{\text{Cov}(x_{it}, \alpha_i)}{\text{Var}(x_{it})} = \beta + \underbrace{\frac{\text{Cov}(x_{it}, \alpha_i)}{\text{Var}(x_{it})}}_{\text{omitted variable bias}}
\]</span></p>
<p><strong>Sign of the bias:</strong></p>
<ul>
<li>If <span class="math inline">\(\text{Cov}(x, \alpha) &lt; 0\)</span> (high bank holdings in weak-institution countries) and <span class="math inline">\(\alpha \to\)</span> lower rates, the bias is <strong>positive</strong></li>
<li>This means pooled OLS <strong>attenuates</strong> the negative constraining effect</li>
</ul>
</section>
</section>
<section id="the-fixed-effects-estimator" class="level2">
<h2 class="anchored" data-anchor-id="the-fixed-effects-estimator">The Fixed Effects Estimator</h2>
<section id="the-within-transformation" class="level3">
<h3 class="anchored" data-anchor-id="the-within-transformation">The Within Transformation</h3>
<p><strong>Key idea:</strong> Since <span class="math inline">\(\alpha_i\)</span> doesn’t vary over time, we can eliminate it by demeaning.</p>
<p>Define the <strong>time averages</strong>: <span class="math display">\[
\bar{y}_i = \frac{1}{T}\sum_{t=1}^{T} y_{it}, \quad \bar{\mathbf{x}}_i = \frac{1}{T}\sum_{t=1}^{T} \mathbf{x}_{it}, \quad \bar{\varepsilon}_i = \frac{1}{T}\sum_{t=1}^{T} \varepsilon_{it}
\]</span></p>
<p>Averaging the model over time: <span class="math display">\[
\bar{y}_i = \bar{\mathbf{x}}_i'\boldsymbol{\beta} + \alpha_i + \bar{\varepsilon}_i
\]</span></p>
<p>Subtracting: <span class="math display">\[
y_{it} - \bar{y}_i = (\mathbf{x}_{it} - \bar{\mathbf{x}}_i)'\boldsymbol{\beta} + (\varepsilon_{it} - \bar{\varepsilon}_i)
\]</span></p>
<p>Or using the “dot” notation: <span class="math display">\[
\ddot{y}_{it} = \ddot{\mathbf{x}}_{it}'\boldsymbol{\beta} + \ddot{\varepsilon}_{it}
\]</span></p>
<p><strong><span class="math inline">\(\alpha_i\)</span> has been eliminated.</strong> The within transformation removes all time-invariant variation.</p>
<p>The <strong>Fixed Effects estimator</strong> is OLS on the demeaned data:</p>
<p><span class="math display">\[
\boxed{\hat{\boldsymbol{\beta}}_{\text{FE}} = \left(\sum_{i=1}^{N}\sum_{t=1}^{T} \ddot{\mathbf{x}}_{it}\ddot{\mathbf{x}}_{it}'\right)^{-1} \left(\sum_{i=1}^{N}\sum_{t=1}^{T} \ddot{\mathbf{x}}_{it} \ddot{y}_{it}\right)}
\]</span></p>
</section>
<section id="what-fe-uses-and-what-it-discards" class="level3">
<h3 class="anchored" data-anchor-id="what-fe-uses-and-what-it-discards">What FE Uses and What It Discards</h3>
<p><strong>FE uses only within-unit variation:</strong> deviations of <span class="math inline">\(x_{it}\)</span> from its country mean <span class="math inline">\(\bar{x}_i\)</span>.</p>
<ul>
<li>If a country always has bank holdings of 30%, it contributes <strong>zero</strong> identifying variation to <span class="math inline">\(\hat{\beta}_{\text{FE}}\)</span></li>
<li>The identifying variation comes from <em>changes</em> in bank holdings within a country over time</li>
<li>A country that goes from 20% to 35% holdings contributes a lot; a country stuck at 25% contributes little</li>
</ul>
<p><strong>FE discards between-unit variation:</strong> differences in average <span class="math inline">\(\bar{x}_i\)</span> across countries.</p>
<p>This is both the strength (eliminates <span class="math inline">\(\alpha_i\)</span> bias) and the weakness (throws away cross-sectional information, reduces efficiency).</p>
</section>
<section id="consistency" class="level3">
<h3 class="anchored" data-anchor-id="consistency">Consistency</h3>
<p><span class="math inline">\(\hat{\boldsymbol{\beta}}_{\text{FE}}\)</span> is consistent under:</p>
<p><strong>Assumption (Strict Exogeneity):</strong> <span class="math display">\[
E[\varepsilon_{it} | \mathbf{x}_{i1}, \ldots, \mathbf{x}_{iT}, \alpha_i] = 0 \quad \forall \, t
\]</span></p>
<p>This means:</p>
<ul>
<li>Current errors are uncorrelated with <strong>past, present, AND future</strong> regressors</li>
<li>This rules out <strong>feedback effects</strong>: if past <span class="math inline">\(y\)</span> affects current <span class="math inline">\(x\)</span>, strict exogeneity fails</li>
<li>This also rules out <strong>lagged dependent variables</strong> as regressors (Nickell bias)</li>
</ul>
</section>
<section id="the-frisch-waugh-lovell-theorem" class="level3">
<h3 class="anchored" data-anchor-id="the-frisch-waugh-lovell-theorem">The Frisch-Waugh-Lovell Theorem</h3>
<p>The FE estimator is numerically identical to OLS with <span class="math inline">\(N\)</span> country dummies.</p>
<p><strong>Theorem (Frisch-Waugh-Lovell):</strong> In the regression <span class="math inline">\(y = X_1\beta_1 + X_2\beta_2 + \varepsilon\)</span>, the OLS estimate of <span class="math inline">\(\beta_1\)</span> is identical to the OLS estimate from regressing <span class="math inline">\(M_2 y\)</span> on <span class="math inline">\(M_2 X_1\)</span>, where <span class="math inline">\(M_2 = I - X_2(X_2'X_2)^{-1}X_2'\)</span> is the annihilator matrix for <span class="math inline">\(X_2\)</span>.</p>
<p><strong>Application to FE:</strong> Let <span class="math inline">\(X_1 = \mathbf{X}\)</span> (regressors of interest) and <span class="math inline">\(X_2 = D\)</span> (matrix of country dummies). Then:</p>
<ul>
<li><span class="math inline">\(M_D \mathbf{x}_{it} = \mathbf{x}_{it} - \bar{\mathbf{x}}_i = \ddot{\mathbf{x}}_{it}\)</span> (the within transformation!)</li>
<li><span class="math inline">\(M_D y_{it} = y_{it} - \bar{y}_i = \ddot{y}_{it}\)</span></li>
</ul>
<p>So FE = OLS with dummies = OLS on demeaned data. These are algebraically identical.</p>
<p><strong>Practical implication:</strong> <code>fixest::feols()</code> uses the within transformation (fast), while <code>lm()</code> with dummy variables estimates all <span class="math inline">\(N\)</span> dummy coefficients (slow, memory-intensive). Same <span class="math inline">\(\hat{\beta}\)</span>, different computational cost.</p>
</section>
</section>
<section id="two-way-fixed-effects" class="level2">
<h2 class="anchored" data-anchor-id="two-way-fixed-effects">Two-Way Fixed Effects</h2>
<section id="the-model" class="level3">
<h3 class="anchored" data-anchor-id="the-model">The Model</h3>
<p><span class="math display">\[
y_{it} = \mathbf{x}_{it}'\boldsymbol{\beta} + \alpha_i + \lambda_t + \varepsilon_{it}
\]</span></p>
<p>Now <span class="math inline">\(\lambda_t\)</span> absorbs time-varying shocks common to all units:</p>
<ul>
<li><span class="math inline">\(\alpha_i\)</span>: Country A is different from Country B in time-invariant ways</li>
<li><span class="math inline">\(\lambda_t\)</span>: 2022Q2 was different from 2019Q2 for all countries (global inflation surge, Fed tightening)</li>
</ul>
</section>
<section id="double-demeaning" class="level3">
<h3 class="anchored" data-anchor-id="double-demeaning">Double Demeaning</h3>
<p>The two-way within transformation removes both <span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\(\lambda_t\)</span>:</p>
<p><span class="math display">\[
\tilde{y}_{it} = y_{it} - \bar{y}_{i\cdot} - \bar{y}_{\cdot t} + \bar{y}_{\cdot\cdot}
\]</span></p>
<p><strong>What’s left:</strong> <span class="math inline">\(\tilde{y}_{it}\)</span> is the part of <span class="math inline">\(y_{it}\)</span> that can’t be explained by country-level or time-level averages. It’s the country-specific deviation from the global trend.</p>
</section>
<section id="what-each-fixed-effect-absorbs" class="level3">
<h3 class="anchored" data-anchor-id="what-each-fixed-effect-absorbs">What Each Fixed Effect Absorbs</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Fixed Effect</th>
<th style="text-align: left;">Absorbs</th>
<th style="text-align: left;">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Country FE (<span class="math inline">\(\alpha_i\)</span>)</td>
<td style="text-align: left;">All time-invariant country differences</td>
<td style="text-align: left;">Regulatory frameworks, reserve currency status</td>
</tr>
<tr class="even">
<td style="text-align: left;">Time FE (<span class="math inline">\(\lambda_t\)</span>)</td>
<td style="text-align: left;">All country-invariant time shocks</td>
<td style="text-align: left;">Global inflation surge, commodity price spikes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Neither</td>
<td style="text-align: left;">Country-specific, time-varying variation</td>
<td style="text-align: left;">Country A’s holdings rose more in 2020 than average</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="interactions-in-panel-models" class="level2">
<h2 class="anchored" data-anchor-id="interactions-in-panel-models">Interactions in Panel Models</h2>
<section id="the-interaction-term" class="level3">
<h3 class="anchored" data-anchor-id="the-interaction-term">The Interaction Term</h3>
<p>Consider a specification with an interaction:</p>
<p><span class="math display">\[
y_{it} = \gamma_1 x_{it} + \gamma_2 z_{it} + \gamma_3 (x_{it} \times z_{it}) + \alpha_i + \lambda_t + \varepsilon_{it}
\]</span></p>
<p><strong>What does <span class="math inline">\(\gamma_3\)</span> mean?</strong></p>
<p>The marginal effect of <span class="math inline">\(x\)</span> on <span class="math inline">\(y\)</span> is:</p>
<p><span class="math display">\[
\frac{\partial y_{it}}{\partial x_{it}} = \gamma_1 + \gamma_3 \cdot z_{it}
\]</span></p>
<p>This is <strong>not constant</strong>—it depends on the level of <span class="math inline">\(z_{it}\)</span>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Interpretation
</div>
</div>
<div class="callout-body-container callout-body">
<p>If <span class="math inline">\(\gamma_1 &gt; 0\)</span> and <span class="math inline">\(\gamma_3 &lt; 0\)</span>, there exists a “crossing point” <span class="math inline">\(z^* = -\gamma_1/\gamma_3\)</span> where the marginal effect of <span class="math inline">\(x\)</span> switches sign. Below <span class="math inline">\(z^*\)</span>, <span class="math inline">\(x\)</span> has a positive effect; above <span class="math inline">\(z^*\)</span>, negative.</p>
</div>
</div>
</section>
<section id="clustering-standard-errors" class="level3">
<h3 class="anchored" data-anchor-id="clustering-standard-errors">Clustering Standard Errors</h3>
<p>Standard OLS assumes <span class="math inline">\(\varepsilon_{it}\)</span> is i.i.d. This fails in panels because:</p>
<ol type="1">
<li><strong>Serial correlation within country:</strong> A country’s error in 2022Q1 is correlated with its error in 2022Q2</li>
<li><strong>Cross-sectional dependence:</strong> Country A’s error in 2022Q1 may correlate with Country B’s (global shocks)</li>
</ol>
<p>Clustering by country handles (1): it allows arbitrary within-country correlation over time.</p>
<p><strong>Important:</strong> Cluster-robust inference requires <span class="math inline">\(N \to \infty\)</span>. With only 30 countries, cluster SEs may be unreliable. Rule of thumb: need <span class="math inline">\(N \geq 50\)</span> for good coverage. With small <span class="math inline">\(N\)</span>, consider wild cluster bootstrap.</p>
</section>
</section>
</section>
<section id="monte-carlo-simulations" class="level1 unnumbered">
<h1 class="unnumbered">Monte Carlo Simulations</h1>
<p>This section uses Monte Carlo simulations to demonstrate the properties of panel estimators.</p>
<section id="demonstrating-ovb-pooled-ols-vs.-fe" class="level2">
<h2 class="anchored" data-anchor-id="demonstrating-ovb-pooled-ols-vs.-fe">Demonstrating OVB: Pooled OLS vs.&nbsp;FE</h2>
<p>We simulate a panel where <span class="math inline">\(\text{Cov}(x_{it}, \alpha_i) \neq 0\)</span> and show that pooled OLS is biased while FE is consistent.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># Parameters</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>N <span class="ot">&lt;-</span> <span class="dv">50</span>       <span class="co"># countries</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>T_per <span class="ot">&lt;-</span> <span class="dv">20</span>   <span class="co"># quarters</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>beta_true <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span>  <span class="co"># true effect: negative</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>gamma_alpha <span class="ot">&lt;-</span> <span class="dv">3</span>   <span class="co"># how much alpha matters for y</span></span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co"># Simulation</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>n_sims <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>beta_ols <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sims)</span>
<span id="cb1-12"><a href="#cb1-12"></a>beta_fe  <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sims)</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sims) {</span>
<span id="cb1-15"><a href="#cb1-15"></a>  <span class="co"># Generate unobserved heterogeneity</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>  alpha <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">2</span>)  <span class="co"># country effect</span></span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a>  <span class="co"># Generate x correlated with alpha</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>  <span class="co"># Countries with higher alpha have LOWER x (negative correlation)</span></span>
<span id="cb1-20"><a href="#cb1-20"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, N, T_per)</span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb1-22"><a href="#cb1-22"></a>    x[i, ] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.8</span> <span class="sc">*</span> alpha[i] <span class="sc">+</span> <span class="fu">rnorm</span>(T_per, <span class="at">mean =</span> <span class="dv">20</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb1-23"><a href="#cb1-23"></a>  }</span>
<span id="cb1-24"><a href="#cb1-24"></a></span>
<span id="cb1-25"><a href="#cb1-25"></a>  <span class="co"># Generate y</span></span>
<span id="cb1-26"><a href="#cb1-26"></a>  y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, N, T_per)</span>
<span id="cb1-27"><a href="#cb1-27"></a>  eps <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(N <span class="sc">*</span> T_per, <span class="at">sd =</span> <span class="dv">1</span>), N, T_per)</span>
<span id="cb1-28"><a href="#cb1-28"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb1-29"><a href="#cb1-29"></a>    y[i, ] <span class="ot">&lt;-</span> beta_true <span class="sc">*</span> x[i, ] <span class="sc">+</span> gamma_alpha <span class="sc">*</span> alpha[i] <span class="sc">+</span> eps[i, ]</span>
<span id="cb1-30"><a href="#cb1-30"></a>  }</span>
<span id="cb1-31"><a href="#cb1-31"></a></span>
<span id="cb1-32"><a href="#cb1-32"></a>  <span class="co"># Reshape to panel</span></span>
<span id="cb1-33"><a href="#cb1-33"></a>  id <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="at">each =</span> T_per)</span>
<span id="cb1-34"><a href="#cb1-34"></a>  tt <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>T_per, <span class="at">times =</span> N)</span>
<span id="cb1-35"><a href="#cb1-35"></a>  yy <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(y))</span>
<span id="cb1-36"><a href="#cb1-36"></a>  xx <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(x))</span>
<span id="cb1-37"><a href="#cb1-37"></a></span>
<span id="cb1-38"><a href="#cb1-38"></a>  <span class="co"># Pooled OLS</span></span>
<span id="cb1-39"><a href="#cb1-39"></a>  beta_ols[s] <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">lm</span>(yy <span class="sc">~</span> xx))[<span class="dv">2</span>]</span>
<span id="cb1-40"><a href="#cb1-40"></a></span>
<span id="cb1-41"><a href="#cb1-41"></a>  <span class="co"># Fixed Effects</span></span>
<span id="cb1-42"><a href="#cb1-42"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> yy, <span class="at">x =</span> xx, <span class="at">id =</span> <span class="fu">factor</span>(id))</span>
<span id="cb1-43"><a href="#cb1-43"></a>  beta_fe[s] <span class="ot">&lt;-</span> <span class="fu">coef</span>(fixest<span class="sc">::</span><span class="fu">feols</span>(y <span class="sc">~</span> x <span class="sc">|</span> id, <span class="at">data =</span> df))[<span class="st">"x"</span>]</span>
<span id="cb1-44"><a href="#cb1-44"></a>}</span>
<span id="cb1-45"><a href="#cb1-45"></a></span>
<span id="cb1-46"><a href="#cb1-46"></a><span class="co"># Results</span></span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="fu">cat</span>(<span class="st">"=== Monte Carlo Results (1000 simulations) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>=== Monte Carlo Results (1000 simulations) ===</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"True beta:         %.3f</span><span class="sc">\n</span><span class="st">"</span>, beta_true))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>True beta:         -0.500</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Pooled OLS mean:   %.3f  (bias = %.3f)</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">mean</span>(beta_ols), <span class="fu">mean</span>(beta_ols) <span class="sc">-</span> beta_true))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Pooled OLS mean:   -1.310  (bias = -0.810)</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"FE mean:           %.3f  (bias = %.3f)</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">mean</span>(beta_fe), <span class="fu">mean</span>(beta_fe) <span class="sc">-</span> beta_true))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>FE mean:           -0.500  (bias = -0.000)</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>df_mc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="at">estimate =</span> <span class="fu">c</span>(beta_ols, beta_fe),</span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="at">method =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Pooled OLS"</span>, <span class="st">"Fixed Effects"</span>), <span class="at">each =</span> n_sims)</span>
<span id="cb9-4"><a href="#cb9-4"></a>)</span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="fu">ggplot</span>(df_mc, <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">fill =</span> method)) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> beta_true, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> beta_true <span class="sc">-</span> <span class="fl">0.02</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"True β ="</span>, beta_true),</span>
<span id="cb9-10"><a href="#cb9-10"></a>           <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-12"><a href="#cb9-12"></a>    <span class="at">title =</span> <span class="st">"Monte Carlo: Pooled OLS vs. Fixed Effects"</span>,</span>
<span id="cb9-13"><a href="#cb9-13"></a>    <span class="at">subtitle =</span> <span class="st">"N=50 units, T=20 periods, Cov(x, α) &lt; 0, 1000 simulations"</span>,</span>
<span id="cb9-14"><a href="#cb9-14"></a>    <span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(beta)),</span>
<span id="cb9-15"><a href="#cb9-15"></a>    <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb9-16"><a href="#cb9-16"></a>  ) <span class="sc">+</span></span>
<span id="cb9-17"><a href="#cb9-17"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Pooled OLS"</span> <span class="ot">=</span> <span class="st">"#e74c3c"</span>, <span class="st">"Fixed Effects"</span> <span class="ot">=</span> <span class="st">"#2ecc71"</span>)) <span class="sc">+</span></span>
<span id="cb9-18"><a href="#cb9-18"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="01_panel_econometrics_files/figure-html/plot-monte-carlo-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Monte Carlo comparison of Pooled OLS vs.&nbsp;Fixed Effects estimators</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>What you should see:</strong> The OLS distribution is centered well above the true value (biased positive). The FE distribution is centered on the truth.</p>
</section>
<section id="demonstrating-time-fe-importance" class="level2">
<h2 class="anchored" data-anchor-id="demonstrating-time-fe-importance">Demonstrating Time FE Importance</h2>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>N <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>T_per <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>beta_true <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.3</span></span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a>n_sims <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>beta_country_fe <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sims)</span>
<span id="cb10-9"><a href="#cb10-9"></a>beta_twoway_fe  <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sims)</span>
<span id="cb10-10"><a href="#cb10-10"></a></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sims) {</span>
<span id="cb10-12"><a href="#cb10-12"></a>  alpha <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="at">sd =</span> <span class="dv">3</span>)         <span class="co"># country effects</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>  lambda <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(T_per, <span class="at">sd =</span> <span class="dv">2</span>)    <span class="co"># time effects</span></span>
<span id="cb10-14"><a href="#cb10-14"></a></span>
<span id="cb10-15"><a href="#cb10-15"></a>  <span class="co"># x correlated with both alpha AND lambda</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, N, T_per)</span>
<span id="cb10-17"><a href="#cb10-17"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb10-18"><a href="#cb10-18"></a>    <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>T_per) {</span>
<span id="cb10-19"><a href="#cb10-19"></a>      x[i, t] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> alpha[i] <span class="sc">+</span> <span class="fl">0.4</span> <span class="sc">*</span> lambda[t] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">20</span>, <span class="at">sd =</span> <span class="dv">2</span>)</span>
<span id="cb10-20"><a href="#cb10-20"></a>    }</span>
<span id="cb10-21"><a href="#cb10-21"></a>  }</span>
<span id="cb10-22"><a href="#cb10-22"></a></span>
<span id="cb10-23"><a href="#cb10-23"></a>  y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, N, T_per)</span>
<span id="cb10-24"><a href="#cb10-24"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb10-25"><a href="#cb10-25"></a>    <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>T_per) {</span>
<span id="cb10-26"><a href="#cb10-26"></a>      y[i, t] <span class="ot">&lt;-</span> beta_true <span class="sc">*</span> x[i, t] <span class="sc">+</span> alpha[i] <span class="sc">+</span> lambda[t] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb10-27"><a href="#cb10-27"></a>    }</span>
<span id="cb10-28"><a href="#cb10-28"></a>  }</span>
<span id="cb10-29"><a href="#cb10-29"></a></span>
<span id="cb10-30"><a href="#cb10-30"></a>  id <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="at">each =</span> T_per)</span>
<span id="cb10-31"><a href="#cb10-31"></a>  tt <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>T_per, <span class="at">times =</span> N)</span>
<span id="cb10-32"><a href="#cb10-32"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(y)), <span class="at">x =</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(x)),</span>
<span id="cb10-33"><a href="#cb10-33"></a>                   <span class="at">id =</span> <span class="fu">factor</span>(id), <span class="at">time =</span> <span class="fu">factor</span>(tt))</span>
<span id="cb10-34"><a href="#cb10-34"></a></span>
<span id="cb10-35"><a href="#cb10-35"></a>  beta_country_fe[s] <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">feols</span>(y <span class="sc">~</span> x <span class="sc">|</span> id, <span class="at">data =</span> df))[<span class="st">"x"</span>]</span>
<span id="cb10-36"><a href="#cb10-36"></a>  beta_twoway_fe[s]  <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">feols</span>(y <span class="sc">~</span> x <span class="sc">|</span> id <span class="sc">+</span> time, <span class="at">data =</span> df))[<span class="st">"x"</span>]</span>
<span id="cb10-37"><a href="#cb10-37"></a>}</span>
<span id="cb10-38"><a href="#cb10-38"></a></span>
<span id="cb10-39"><a href="#cb10-39"></a><span class="fu">cat</span>(<span class="st">"=== Time FE Matters When x Correlates with Time Shocks ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>=== Time FE Matters When x Correlates with Time Shocks ===</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"True beta:           %.3f</span><span class="sc">\n</span><span class="st">"</span>, beta_true))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>True beta:           -0.300</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Country FE only:     %.3f  (bias = %.3f)</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb14-2"><a href="#cb14-2"></a>            <span class="fu">mean</span>(beta_country_fe), <span class="fu">mean</span>(beta_country_fe) <span class="sc">-</span> beta_true))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Country FE only:     0.045  (bias = 0.345)</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Two-way FE:          %.3f  (bias = %.3f)</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb16-2"><a href="#cb16-2"></a>            <span class="fu">mean</span>(beta_twoway_fe), <span class="fu">mean</span>(beta_twoway_fe) <span class="sc">-</span> beta_true))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Two-way FE:          -0.300  (bias = -0.000)</code></pre>
</div>
</div>
<p><strong>Key lesson:</strong> Country FE alone is not enough if the regressors correlate with common time shocks.</p>
</section>
<section id="cluster-se-coverage" class="level2">
<h2 class="anchored" data-anchor-id="cluster-se-coverage">Cluster SE Coverage</h2>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">set.seed</span>(<span class="dv">99</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a>N <span class="ot">&lt;-</span> <span class="dv">30</span>     <span class="co"># small number of clusters</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>T_per <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>beta_true <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb18-6"><a href="#cb18-6"></a></span>
<span id="cb18-7"><a href="#cb18-7"></a>n_sims <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>cover_iid <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-9"><a href="#cb18-9"></a>cover_cluster <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-10"><a href="#cb18-10"></a></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sims) {</span>
<span id="cb18-12"><a href="#cb18-12"></a>  alpha <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb18-13"><a href="#cb18-13"></a></span>
<span id="cb18-14"><a href="#cb18-14"></a>  <span class="co"># Generate x and y with serially correlated errors</span></span>
<span id="cb18-15"><a href="#cb18-15"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, N, T_per)</span>
<span id="cb18-16"><a href="#cb18-16"></a>  y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, N, T_per)</span>
<span id="cb18-17"><a href="#cb18-17"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb18-18"><a href="#cb18-18"></a>    x[i, ] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> alpha[i] <span class="sc">+</span> <span class="fu">rnorm</span>(T_per, <span class="dv">20</span>, <span class="dv">3</span>)</span>
<span id="cb18-19"><a href="#cb18-19"></a>    eps <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar =</span> <span class="fl">0.6</span>), <span class="at">n =</span> T_per, <span class="at">sd =</span> <span class="dv">1</span>)  <span class="co"># AR(1) errors</span></span>
<span id="cb18-20"><a href="#cb18-20"></a>    y[i, ] <span class="ot">&lt;-</span> beta_true <span class="sc">*</span> x[i, ] <span class="sc">+</span> alpha[i] <span class="sc">+</span> eps</span>
<span id="cb18-21"><a href="#cb18-21"></a>  }</span>
<span id="cb18-22"><a href="#cb18-22"></a></span>
<span id="cb18-23"><a href="#cb18-23"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(y)), <span class="at">x =</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(x)),</span>
<span id="cb18-24"><a href="#cb18-24"></a>                   <span class="at">id =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="at">each =</span> T_per)))</span>
<span id="cb18-25"><a href="#cb18-25"></a></span>
<span id="cb18-26"><a href="#cb18-26"></a>  fit <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> x <span class="sc">|</span> id, <span class="at">data =</span> df)</span>
<span id="cb18-27"><a href="#cb18-27"></a></span>
<span id="cb18-28"><a href="#cb18-28"></a>  <span class="co"># IID standard errors</span></span>
<span id="cb18-29"><a href="#cb18-29"></a>  ci_iid <span class="ot">&lt;-</span> <span class="fu">confint</span>(fit, <span class="at">se =</span> <span class="st">"iid"</span>)</span>
<span id="cb18-30"><a href="#cb18-30"></a>  cover_iid <span class="ot">&lt;-</span> cover_iid <span class="sc">+</span> (ci_iid[<span class="dv">1</span>] <span class="sc">&lt;=</span> beta_true <span class="sc">&amp;</span> beta_true <span class="sc">&lt;=</span> ci_iid[<span class="dv">2</span>])</span>
<span id="cb18-31"><a href="#cb18-31"></a></span>
<span id="cb18-32"><a href="#cb18-32"></a>  <span class="co"># Cluster standard errors</span></span>
<span id="cb18-33"><a href="#cb18-33"></a>  ci_cluster <span class="ot">&lt;-</span> <span class="fu">confint</span>(fit, <span class="at">cluster =</span> <span class="sc">~</span>id)</span>
<span id="cb18-34"><a href="#cb18-34"></a>  cover_cluster <span class="ot">&lt;-</span> cover_cluster <span class="sc">+</span> (ci_cluster[<span class="dv">1</span>] <span class="sc">&lt;=</span> beta_true <span class="sc">&amp;</span> beta_true <span class="sc">&lt;=</span> ci_cluster[<span class="dv">2</span>])</span>
<span id="cb18-35"><a href="#cb18-35"></a>}</span>
<span id="cb18-36"><a href="#cb18-36"></a></span>
<span id="cb18-37"><a href="#cb18-37"></a><span class="fu">cat</span>(<span class="st">"=== 95% CI Coverage (AR(1) errors within clusters) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>=== 95% CI Coverage (AR(1) errors within clusters) ===</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"IID SEs:     %.1f%%  (should be 95%%)</span><span class="sc">\n</span><span class="st">"</span>, <span class="dv">100</span> <span class="sc">*</span> cover_iid <span class="sc">/</span> n_sims))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>IID SEs:     95.7%  (should be 95%)</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Cluster SEs: %.1f%%  (should be 95%%)</span><span class="sc">\n</span><span class="st">"</span>, <span class="dv">100</span> <span class="sc">*</span> cover_cluster <span class="sc">/</span> n_sims))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster SEs: 95.4%  (should be 95%)</code></pre>
</div>
</div>
<p><strong>What you should see:</strong> IID standard errors have coverage well below 95% (too many false positives). Cluster SEs restore correct coverage.</p>
</section>
</section>
<section id="application" class="level1 unnumbered">
<h1 class="unnumbered">Application</h1>
<p>This section applies the methods to macroeconomic panel data.</p>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Prepare the analysis sample</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>analysis <span class="ot">&lt;-</span> master <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="fu">mutate</span>(<span class="at">quarter =</span> <span class="fu">as.integer</span>(<span class="fu">gsub</span>(<span class="st">".*Q"</span>, <span class="st">""</span>, year_quarter))) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="fu">arrange</span>(year, quarter) <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-7"><a href="#cb24-7"></a>    <span class="co"># Lagged variables</span></span>
<span id="cb24-8"><a href="#cb24-8"></a>    <span class="at">L1_bank_holdings_pct =</span> <span class="fu">lag</span>(bank_holdings_pct),</span>
<span id="cb24-9"><a href="#cb24-9"></a>    <span class="at">L1_cb_holdings_pct =</span> <span class="fu">lag</span>(cb_holdings_pct)</span>
<span id="cb24-10"><a href="#cb24-10"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb24-11"><a href="#cb24-11"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-12"><a href="#cb24-12"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(policy_rate), <span class="sc">!</span><span class="fu">is.na</span>(bank_holdings_pct))</span>
<span id="cb24-13"><a href="#cb24-13"></a></span>
<span id="cb24-14"><a href="#cb24-14"></a><span class="co"># Post-2022 subsample</span></span>
<span id="cb24-15"><a href="#cb24-15"></a>tightening <span class="ot">&lt;-</span> analysis <span class="sc">%&gt;%</span></span>
<span id="cb24-16"><a href="#cb24-16"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-17"><a href="#cb24-17"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(L1_bank_holdings_pct))</span>
<span id="cb24-18"><a href="#cb24-18"></a></span>
<span id="cb24-19"><a href="#cb24-19"></a><span class="fu">cat</span>(<span class="st">"Full sample:"</span>, <span class="fu">nrow</span>(analysis), <span class="st">"obs,"</span>, <span class="fu">n_distinct</span>(analysis<span class="sc">$</span>country), <span class="st">"countries</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Full sample: 3406 obs, 41 countries</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">cat</span>(<span class="st">"Post-2022 sample:"</span>, <span class="fu">nrow</span>(tightening), <span class="st">"obs,"</span>, <span class="fu">n_distinct</span>(tightening<span class="sc">$</span>country), <span class="st">"countries</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Post-2022 sample: 480 obs, 40 countries</code></pre>
</div>
</div>
</section>
<section id="building-up-ols-fe-twfe" class="level2">
<h2 class="anchored" data-anchor-id="building-up-ols-fe-twfe">Building Up: OLS → FE → TWFE</h2>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Check if we have the necessary variables</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="cf">if</span> (<span class="st">"inflation_yoy"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tightening) <span class="sc">||</span> <span class="st">"sovereign_debt_gdp"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tightening)) {</span>
<span id="cb28-3"><a href="#cb28-3"></a></span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="co"># Step 1: Pooled OLS</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>  m1 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">+</span> sovereign_debt_gdp,</span>
<span id="cb28-6"><a href="#cb28-6"></a>              <span class="at">data =</span> tightening)</span>
<span id="cb28-7"><a href="#cb28-7"></a></span>
<span id="cb28-8"><a href="#cb28-8"></a>  <span class="co"># Step 2: Country FE only</span></span>
<span id="cb28-9"><a href="#cb28-9"></a>  m2 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">|</span> country,</span>
<span id="cb28-10"><a href="#cb28-10"></a>              <span class="at">data =</span> tightening)</span>
<span id="cb28-11"><a href="#cb28-11"></a></span>
<span id="cb28-12"><a href="#cb28-12"></a>  <span class="co"># Step 3: Two-way FE</span></span>
<span id="cb28-13"><a href="#cb28-13"></a>  m3 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">|</span> country <span class="sc">+</span> year_quarter,</span>
<span id="cb28-14"><a href="#cb28-14"></a>              <span class="at">data =</span> tightening)</span>
<span id="cb28-15"><a href="#cb28-15"></a></span>
<span id="cb28-16"><a href="#cb28-16"></a>  <span class="co"># Step 4: Add CB holdings</span></span>
<span id="cb28-17"><a href="#cb28-17"></a>  m4 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">+</span> L1_cb_holdings_pct</span>
<span id="cb28-18"><a href="#cb28-18"></a>              <span class="sc">|</span> country <span class="sc">+</span> year_quarter,</span>
<span id="cb28-19"><a href="#cb28-19"></a>              <span class="at">data =</span> tightening)</span>
<span id="cb28-20"><a href="#cb28-20"></a></span>
<span id="cb28-21"><a href="#cb28-21"></a>  <span class="co"># Step 5: Interaction</span></span>
<span id="cb28-22"><a href="#cb28-22"></a>  m5 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">*</span> L1_cb_holdings_pct</span>
<span id="cb28-23"><a href="#cb28-23"></a>              <span class="sc">|</span> country <span class="sc">+</span> year_quarter,</span>
<span id="cb28-24"><a href="#cb28-24"></a>              <span class="at">data =</span> tightening)</span>
<span id="cb28-25"><a href="#cb28-25"></a></span>
<span id="cb28-26"><a href="#cb28-26"></a>  <span class="co"># Display with appropriate SEs</span></span>
<span id="cb28-27"><a href="#cb28-27"></a>  <span class="co"># Note: In practice, FE models should use clustered SEs</span></span>
<span id="cb28-28"><a href="#cb28-28"></a>  <span class="fu">etable</span>(m1, m2, m3, m4, m5,</span>
<span id="cb28-29"><a href="#cb28-29"></a>         <span class="at">headers =</span> <span class="fu">c</span>(<span class="st">"Pooled"</span>, <span class="st">"Country FE"</span>, <span class="st">"TWFE"</span>, <span class="st">"+CB"</span>, <span class="st">"Interaction"</span>),</span>
<span id="cb28-30"><a href="#cb28-30"></a>         <span class="at">vcov =</span> <span class="fu">list</span>(<span class="st">"iid"</span>, <span class="sc">~</span>country, <span class="sc">~</span>country, <span class="sc">~</span>country, <span class="sc">~</span>country),</span>
<span id="cb28-31"><a href="#cb28-31"></a>         <span class="at">fitstat =</span> <span class="sc">~</span> n <span class="sc">+</span> r2 <span class="sc">+</span> wr2)</span>
<span id="cb28-32"><a href="#cb28-32"></a>} <span class="cf">else</span> {</span>
<span id="cb28-33"><a href="#cb28-33"></a>  <span class="fu">cat</span>(<span class="st">"Note: Full specification requires inflation and debt variables.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-34"><a href="#cb28-34"></a>  <span class="fu">cat</span>(<span class="st">"Running simplified demonstration with available variables.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-35"><a href="#cb28-35"></a></span>
<span id="cb28-36"><a href="#cb28-36"></a>  m1 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct, <span class="at">data =</span> tightening)</span>
<span id="cb28-37"><a href="#cb28-37"></a>  m2 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">|</span> country, <span class="at">data =</span> tightening)</span>
<span id="cb28-38"><a href="#cb28-38"></a>  m3 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">|</span> country <span class="sc">+</span> year_quarter, <span class="at">data =</span> tightening)</span>
<span id="cb28-39"><a href="#cb28-39"></a></span>
<span id="cb28-40"><a href="#cb28-40"></a>  <span class="fu">etable</span>(m1, m2, m3,</span>
<span id="cb28-41"><a href="#cb28-41"></a>         <span class="at">headers =</span> <span class="fu">c</span>(<span class="st">"Pooled"</span>, <span class="st">"Country FE"</span>, <span class="st">"TWFE"</span>),</span>
<span id="cb28-42"><a href="#cb28-42"></a>         <span class="at">vcov =</span> <span class="fu">list</span>(<span class="st">"iid"</span>, <span class="sc">~</span>country, <span class="sc">~</span>country),</span>
<span id="cb28-43"><a href="#cb28-43"></a>         <span class="at">fitstat =</span> <span class="sc">~</span> n <span class="sc">+</span> r2 <span class="sc">+</span> wr2)</span>
<span id="cb28-44"><a href="#cb28-44"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                                          m1              m2
                                                      Pooled      Country FE
Dependent Var.:                                  policy_rate     policy_rate
                                                                            
Constant                                    7.886*** (1.510)                
L1_bank_holdings_pct                        0.0687. (0.0369) 0.3734 (0.6231)
sovereign_debt_gdp                        -0.0402** (0.0146)                
L1_cb_holdings_pct                                                          
L1_bank_holdings_pct x L1_cb_holdings_pct                                   
Fixed-Effects:                            ------------------ ---------------
country                                                   No             Yes
year_quarter                                              No              No
________________________________________  __________________ _______________
S.E. type                                                IID     by: country
Observations                                             480             480
R2                                                   0.02667         0.81188
Within R2                                                 --         0.00812

                                                       m3              m4
                                                     TWFE             +CB
Dependent Var.:                               policy_rate     policy_rate
                                                                         
Constant                                                                 
L1_bank_holdings_pct                      0.5777 (0.6425) 0.6562 (0.6863)
sovereign_debt_gdp                                                       
L1_cb_holdings_pct                                        0.5837 (0.6104)
L1_bank_holdings_pct x L1_cb_holdings_pct                                
Fixed-Effects:                            --------------- ---------------
country                                               Yes             Yes
year_quarter                                          Yes             Yes
________________________________________  _______________ _______________
S.E. type                                     by: country     by: country
Observations                                          480             480
R2                                                0.83693         0.84322
Within R2                                         0.02141         0.05916

                                                       m5
                                              Interaction
Dependent Var.:                               policy_rate
                                                         
Constant                                                 
L1_bank_holdings_pct                      0.4222 (0.3321)
sovereign_debt_gdp                                       
L1_cb_holdings_pct                        0.2438 (0.4371)
L1_bank_holdings_pct x L1_cb_holdings_pct 0.0201 (0.0386)
Fixed-Effects:                            ---------------
country                                               Yes
year_quarter                                          Yes
________________________________________  _______________
S.E. type                                     by: country
Observations                                          480
R2                                                0.84451
Within R2                                         0.06693
---
Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="within-country-variation" class="level2">
<h2 class="anchored" data-anchor-id="within-country-variation">Within-Country Variation</h2>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>within_var <span class="ot">&lt;-</span> tightening <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">summarise</span>(</span>
<span id="cb30-4"><a href="#cb30-4"></a>    <span class="at">mean_holdings =</span> <span class="fu">mean</span>(L1_bank_holdings_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb30-5"><a href="#cb30-5"></a>    <span class="at">sd_within =</span> <span class="fu">sd</span>(L1_bank_holdings_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb30-6"><a href="#cb30-6"></a>    <span class="at">range_within =</span> <span class="fu">max</span>(L1_bank_holdings_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>                   <span class="fu">min</span>(L1_bank_holdings_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb30-8"><a href="#cb30-8"></a>    <span class="at">n_obs =</span> <span class="fu">n</span>()</span>
<span id="cb30-9"><a href="#cb30-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-10"><a href="#cb30-10"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(sd_within))</span>
<span id="cb30-11"><a href="#cb30-11"></a></span>
<span id="cb30-12"><a href="#cb30-12"></a><span class="fu">cat</span>(<span class="st">"=== Within-Country Variation ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>=== Within-Country Variation ===</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">cat</span>(<span class="st">"Most variation:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Most variation:</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="fu">print</span>(<span class="fu">head</span>(within_var, <span class="dv">5</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  country   mean_holdings sd_within range_within n_obs
  &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt; &lt;int&gt;
1 Argentina         20.7       2.94         8.95    12
2 Turkey            56.8       2.65         9.22    12
3 Denmark            6.33      2.37         7.61    12
4 Sweden            35.7       2.26         9.05    12
5 Hungary           25.3       2.22         6.39    12</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># Variance decomposition</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>between_var <span class="ot">&lt;-</span> <span class="fu">var</span>(within_var<span class="sc">$</span>mean_holdings, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-3"><a href="#cb36-3"></a>avg_within_var <span class="ot">&lt;-</span> <span class="fu">mean</span>(within_var<span class="sc">$</span>sd_within<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-4"><a href="#cb36-4"></a>total_var <span class="ot">&lt;-</span> <span class="fu">var</span>(tightening<span class="sc">$</span>L1_bank_holdings_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-5"><a href="#cb36-5"></a></span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Variance Decomposition ===</span><span class="sc">\n</span><span class="st">"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Variance Decomposition ===</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Between variance: %.0f%%</span><span class="sc">\n</span><span class="st">"</span>, <span class="dv">100</span> <span class="sc">*</span> between_var <span class="sc">/</span> total_var))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Between variance: 102%</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Within variance:  %.0f%%</span><span class="sc">\n</span><span class="st">"</span>, <span class="dv">100</span> <span class="sc">*</span> avg_within_var <span class="sc">/</span> total_var))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Within variance:  1%</code></pre>
</div>
</div>
</section>
<section id="standard-error-comparison" class="level2">
<h2 class="anchored" data-anchor-id="standard-error-comparison">Standard Error Comparison</h2>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>m_main <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">|</span> country <span class="sc">+</span> year_quarter,</span>
<span id="cb42-2"><a href="#cb42-2"></a>                <span class="at">data =</span> tightening)</span>
<span id="cb42-3"><a href="#cb42-3"></a></span>
<span id="cb42-4"><a href="#cb42-4"></a>coef_name <span class="ot">&lt;-</span> <span class="st">"L1_bank_holdings_pct"</span></span>
<span id="cb42-5"><a href="#cb42-5"></a>coef_val <span class="ot">&lt;-</span> <span class="fu">coef</span>(m_main)[coef_name]</span>
<span id="cb42-6"><a href="#cb42-6"></a></span>
<span id="cb42-7"><a href="#cb42-7"></a>se_types <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"IID"</span>, <span class="st">"HC1 (Robust)"</span>, <span class="st">"Cluster"</span>)</span>
<span id="cb42-8"><a href="#cb42-8"></a>se_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb42-9"><a href="#cb42-9"></a>  <span class="fu">sqrt</span>(<span class="fu">vcov</span>(m_main, <span class="at">se =</span> <span class="st">"iid"</span>)[coef_name, coef_name]),</span>
<span id="cb42-10"><a href="#cb42-10"></a>  <span class="fu">sqrt</span>(<span class="fu">vcov</span>(m_main, <span class="at">se =</span> <span class="st">"hetero"</span>)[coef_name, coef_name]),</span>
<span id="cb42-11"><a href="#cb42-11"></a>  <span class="fu">sqrt</span>(<span class="fu">vcov</span>(m_main, <span class="at">cluster =</span> <span class="sc">~</span>country)[coef_name, coef_name])</span>
<span id="cb42-12"><a href="#cb42-12"></a>)</span>
<span id="cb42-13"><a href="#cb42-13"></a></span>
<span id="cb42-14"><a href="#cb42-14"></a>se_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb42-15"><a href="#cb42-15"></a>  <span class="at">type =</span> <span class="fu">factor</span>(se_types, <span class="at">levels =</span> se_types),</span>
<span id="cb42-16"><a href="#cb42-16"></a>  <span class="at">se =</span> se_vals,</span>
<span id="cb42-17"><a href="#cb42-17"></a>  <span class="at">lower =</span> coef_val <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se_vals,</span>
<span id="cb42-18"><a href="#cb42-18"></a>  <span class="at">upper =</span> coef_val <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se_vals</span>
<span id="cb42-19"><a href="#cb42-19"></a>)</span>
<span id="cb42-20"><a href="#cb42-20"></a></span>
<span id="cb42-21"><a href="#cb42-21"></a><span class="fu">ggplot</span>(se_df, <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">y =</span> coef_val)) <span class="sc">+</span></span>
<span id="cb42-22"><a href="#cb42-22"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb42-23"><a href="#cb42-23"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb42-24"><a href="#cb42-24"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb42-25"><a href="#cb42-25"></a>  <span class="fu">labs</span>(</span>
<span id="cb42-26"><a href="#cb42-26"></a>    <span class="at">title =</span> <span class="st">"Coefficient Under Different SE Assumptions"</span>,</span>
<span id="cb42-27"><a href="#cb42-27"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Point estimate:"</span>, <span class="fu">round</span>(coef_val, <span class="dv">4</span>)),</span>
<span id="cb42-28"><a href="#cb42-28"></a>    <span class="at">x =</span> <span class="st">"Standard Error Type"</span>,</span>
<span id="cb42-29"><a href="#cb42-29"></a>    <span class="at">y =</span> <span class="st">"Coefficient (95% CI)"</span></span>
<span id="cb42-30"><a href="#cb42-30"></a>  ) <span class="sc">+</span></span>
<span id="cb42-31"><a href="#cb42-31"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="01_panel_econometrics_files/figure-html/se-comparison-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Coefficient estimates under different standard error assumptions</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="frequently-asked-questions" class="level1 unnumbered">
<h1 class="unnumbered">Frequently Asked Questions</h1>
<p>Common conceptual questions when working with panel fixed effects.</p>
<section id="why-not-random-effects" class="level2">
<h2 class="anchored" data-anchor-id="why-not-random-effects">Why not random effects?</h2>
<p>The Hausman test typically rejects RE in favor of FE in macro panels. More importantly, RE assumes <span class="math inline">\(\text{Cov}(\mathbf{x}_{it}, \alpha_i) = 0\)</span>, which is often implausible: units with high values of the regressor may differ systematically from units with low values in ways that affect the outcome. FE is the safer choice when this correlation is likely.</p>
</section>
<section id="what-if-within-r²-is-low" class="level2">
<h2 class="anchored" data-anchor-id="what-if-within-r²-is-low">What if within R² is low?</h2>
<p>Within <span class="math inline">\(R^2\)</span> in two-way FE models is <em>supposed</em> to be low. The overall <span class="math inline">\(R^2\)</span> is often 70%+, with most explained by fixed effects. Within <span class="math inline">\(R^2\)</span> measures how much of the <em>remaining</em> variation our regressors explain. In macro panels, a within <span class="math inline">\(R^2\)</span> of 3-8% is normal. Statistical significance of coefficients is what matters for testing hypotheses.</p>
</section>
<section id="what-about-endogeneity" class="level2">
<h2 class="anchored" data-anchor-id="what-about-endogeneity">What about endogeneity?</h2>
<p>Fixed effects address endogeneity from time-invariant confounders. For time-varying endogeneity, consider:</p>
<ol type="1">
<li><strong>Instrumental variables</strong> (Module 2)</li>
<li><strong>Placebo tests</strong> in pre-treatment periods</li>
<li><strong>Timing variation</strong> within treated groups</li>
<li><strong>Lagged regressors</strong> (with caution about Nickell bias)</li>
</ol>
</section>
</section>
<section id="summary" class="level1 unnumbered">
<h1 class="unnumbered">Summary</h1>
<p>Key takeaways from this module:</p>
<ol type="1">
<li><p><strong>Pooled OLS is biased</strong> when unobserved heterogeneity correlates with regressors</p></li>
<li><p><strong>FE uses only within-unit variation</strong> — conservative but credible</p></li>
<li><p><strong>Two-way FE absorbs global shocks</strong> — your coefficient captures country-specific deviations from global trends</p></li>
<li><p><strong>Interactions reveal mechanisms</strong> — the effect of one variable may depend on another</p></li>
<li><p><strong>Cluster your standard errors</strong> — IID SEs are too small due to within-country correlation</p></li>
<li><p><strong>Low within R² is expected</strong> — the question is whether the mechanism is detectable, not whether it explains all variation</p></li>
</ol>
<hr>
<p><em>Next: <a href="../chapters/02_identification.html">Module 2: Identification in Macroeconomics</a></em></p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../index.html" class="pagination-link" aria-label="Mastering Empirical Macroeconometrics">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Mastering Empirical Macroeconometrics</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/02_identification.html" class="pagination-link" aria-label="Identification in Macroeconomics">
        <span class="nav-page-text"><span class="chapter-title">Identification in Macroeconomics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb43" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb43-1"><a href="#cb43-1"></a><span class="co">---</span></span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="an">title:</span><span class="co"> "Panel Data Econometrics"</span></span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="an">subtitle:</span><span class="co"> "From OLS to Two-Way Fixed Effects"</span></span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="co">---</span></span>
<span id="cb43-5"><a href="#cb43-5"></a></span>
<span id="cb43-8"><a href="#cb43-8"></a><span class="in">```{r}</span></span>
<span id="cb43-9"><a href="#cb43-9"></a><span class="co">#| label: setup</span></span>
<span id="cb43-10"><a href="#cb43-10"></a><span class="co">#| include: false</span></span>
<span id="cb43-11"><a href="#cb43-11"></a></span>
<span id="cb43-12"><a href="#cb43-12"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb43-13"><a href="#cb43-13"></a>  <span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb43-14"><a href="#cb43-14"></a>  <span class="at">fig.width =</span> <span class="dv">10</span>, <span class="at">fig.height =</span> <span class="dv">6</span>, <span class="at">fig.align =</span> <span class="st">"center"</span></span>
<span id="cb43-15"><a href="#cb43-15"></a>)</span>
<span id="cb43-16"><a href="#cb43-16"></a></span>
<span id="cb43-17"><a href="#cb43-17"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb43-18"><a href="#cb43-18"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb43-19"><a href="#cb43-19"></a><span class="fu">library</span>(fixest)</span>
<span id="cb43-20"><a href="#cb43-20"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb43-21"><a href="#cb43-21"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb43-22"><a href="#cb43-22"></a><span class="fu">library</span>(MASS)</span>
<span id="cb43-23"><a href="#cb43-23"></a></span>
<span id="cb43-24"><a href="#cb43-24"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>))</span>
<span id="cb43-25"><a href="#cb43-25"></a></span>
<span id="cb43-26"><a href="#cb43-26"></a><span class="co"># Data loading with fallback for reproducibility</span></span>
<span id="cb43-27"><a href="#cb43-27"></a>DATA_PATH <span class="ot">&lt;-</span> <span class="st">"../data/master_dataset_expanded.rds"</span></span>
<span id="cb43-28"><a href="#cb43-28"></a>USE_REAL_DATA <span class="ot">&lt;-</span> <span class="fu">file.exists</span>(DATA_PATH)</span>
<span id="cb43-29"><a href="#cb43-29"></a></span>
<span id="cb43-30"><a href="#cb43-30"></a><span class="cf">if</span> (USE_REAL_DATA) {</span>
<span id="cb43-31"><a href="#cb43-31"></a>  master <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(DATA_PATH)</span>
<span id="cb43-32"><a href="#cb43-32"></a>  <span class="fu">message</span>(<span class="st">"Loaded dissertation data: "</span>, <span class="fu">nrow</span>(master), <span class="st">" observations"</span>)</span>
<span id="cb43-33"><a href="#cb43-33"></a>} <span class="cf">else</span> {</span>
<span id="cb43-34"><a href="#cb43-34"></a>  <span class="co"># Generate synthetic panel for public reproducibility</span></span>
<span id="cb43-35"><a href="#cb43-35"></a>  <span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb43-36"><a href="#cb43-36"></a>  N <span class="ot">&lt;-</span> <span class="dv">46</span>; T_per <span class="ot">&lt;-</span> <span class="dv">84</span></span>
<span id="cb43-37"><a href="#cb43-37"></a>  master <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb43-38"><a href="#cb43-38"></a>    <span class="at">country =</span> <span class="fu">paste0</span>(<span class="st">"Country_"</span>, <span class="dv">1</span><span class="sc">:</span>N),</span>
<span id="cb43-39"><a href="#cb43-39"></a>    <span class="at">year_quarter =</span> <span class="fu">paste0</span>(<span class="fu">rep</span>(<span class="dv">2003</span><span class="sc">:</span><span class="dv">2023</span>, <span class="at">each =</span> <span class="dv">4</span>), <span class="st">"Q"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)[<span class="dv">1</span><span class="sc">:</span>T_per]</span>
<span id="cb43-40"><a href="#cb43-40"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb43-41"><a href="#cb43-41"></a>    <span class="fu">mutate</span>(</span>
<span id="cb43-42"><a href="#cb43-42"></a>      <span class="at">year =</span> <span class="fu">as.integer</span>(<span class="fu">substr</span>(year_quarter, <span class="dv">1</span>, <span class="dv">4</span>)),</span>
<span id="cb43-43"><a href="#cb43-43"></a>      <span class="at">quarter =</span> <span class="fu">as.integer</span>(<span class="fu">substr</span>(year_quarter, <span class="dv">6</span>, <span class="dv">6</span>)),</span>
<span id="cb43-44"><a href="#cb43-44"></a>      <span class="co"># Simulate correlated panel data</span></span>
<span id="cb43-45"><a href="#cb43-45"></a>      <span class="at">country_fe =</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(N, <span class="dv">5</span>, <span class="dv">3</span>), <span class="at">each =</span> T_per),</span>
<span id="cb43-46"><a href="#cb43-46"></a>      <span class="at">bank_holdings_pct =</span> <span class="fu">pmax</span>(<span class="dv">5</span>, country_fe <span class="sc">*</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">25</span>, <span class="dv">5</span>)),</span>
<span id="cb43-47"><a href="#cb43-47"></a>      <span class="at">cb_holdings_pct =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="dv">15</span> <span class="sc">-</span> country_fe <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="dv">3</span>)),</span>
<span id="cb43-48"><a href="#cb43-48"></a>      <span class="at">cpi_index =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">cumsum</span>(<span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="fl">0.005</span>, <span class="fl">0.01</span>))),</span>
<span id="cb43-49"><a href="#cb43-49"></a>      <span class="at">policy_rate =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, country_fe <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> bank_holdings_pct <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="dv">1</span>)),</span>
<span id="cb43-50"><a href="#cb43-50"></a>      <span class="at">sovereign_debt_gdp =</span> <span class="fu">pmax</span>(<span class="dv">20</span>, <span class="dv">60</span> <span class="sc">+</span> country_fe <span class="sc">*</span> <span class="dv">5</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="dv">10</span>))</span>
<span id="cb43-51"><a href="#cb43-51"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb43-52"><a href="#cb43-52"></a>    <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb43-53"><a href="#cb43-53"></a>    <span class="fu">mutate</span>(<span class="at">inflation_yoy =</span> (cpi_index <span class="sc">/</span> <span class="fu">lag</span>(cpi_index, <span class="dv">4</span>) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-54"><a href="#cb43-54"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb43-55"><a href="#cb43-55"></a>  <span class="fu">message</span>(<span class="st">"Using synthetic data for reproducibility ("</span>, <span class="fu">nrow</span>(master), <span class="st">" observations)"</span>)</span>
<span id="cb43-56"><a href="#cb43-56"></a>}</span>
<span id="cb43-57"><a href="#cb43-57"></a><span class="in">```</span></span>
<span id="cb43-58"><a href="#cb43-58"></a></span>
<span id="cb43-59"><a href="#cb43-59"></a><span class="fu"># Theory {.unnumbered}</span></span>
<span id="cb43-60"><a href="#cb43-60"></a></span>
<span id="cb43-61"><a href="#cb43-61"></a>This section develops the theoretical foundations of panel data econometrics, focusing on the fixed effects estimator and its properties.</span>
<span id="cb43-62"><a href="#cb43-62"></a></span>
<span id="cb43-63"><a href="#cb43-63"></a><span class="fu">## The Panel Data Model</span></span>
<span id="cb43-64"><a href="#cb43-64"></a></span>
<span id="cb43-65"><a href="#cb43-65"></a><span class="fu">### Setup</span></span>
<span id="cb43-66"><a href="#cb43-66"></a></span>
<span id="cb43-67"><a href="#cb43-67"></a>We observe $N$ units (countries) over $T$ time periods (quarters). The data generating process (DGP) is:</span>
<span id="cb43-68"><a href="#cb43-68"></a></span>
<span id="cb43-69"><a href="#cb43-69"></a>$$</span>
<span id="cb43-70"><a href="#cb43-70"></a>y_{it} = \mathbf{x}_{it}'\boldsymbol{\beta} + \alpha_i + \varepsilon_{it}, \quad i = 1, \ldots, N, \quad t = 1, \ldots, T</span>
<span id="cb43-71"><a href="#cb43-71"></a>$$</span>
<span id="cb43-72"><a href="#cb43-72"></a></span>
<span id="cb43-73"><a href="#cb43-73"></a>where:</span>
<span id="cb43-74"><a href="#cb43-74"></a></span>
<span id="cb43-75"><a href="#cb43-75"></a><span class="ss">- </span>$y_{it}$: outcome (e.g., policy rate for country $i$ at time $t$)</span>
<span id="cb43-76"><a href="#cb43-76"></a><span class="ss">- </span>$\mathbf{x}_{it}$: $K \times 1$ vector of observable regressors (e.g., bank holdings, inflation)</span>
<span id="cb43-77"><a href="#cb43-77"></a><span class="ss">- </span>$\boldsymbol{\beta}$: $K \times 1$ parameter vector of interest</span>
<span id="cb43-78"><a href="#cb43-78"></a><span class="ss">- </span>$\alpha_i$: **unobserved** time-invariant individual effect (institutions, geography, political culture)</span>
<span id="cb43-79"><a href="#cb43-79"></a><span class="ss">- </span>$\varepsilon_{it}$: idiosyncratic error</span>
<span id="cb43-80"><a href="#cb43-80"></a></span>
<span id="cb43-81"><a href="#cb43-81"></a>The key question: **what happens to $\hat{\boldsymbol{\beta}}$ when we ignore $\alpha_i$?**</span>
<span id="cb43-82"><a href="#cb43-82"></a></span>
<span id="cb43-83"><a href="#cb43-83"></a><span class="fu">### Pooled OLS: The Naive Approach</span></span>
<span id="cb43-84"><a href="#cb43-84"></a></span>
<span id="cb43-85"><a href="#cb43-85"></a>If we ignore the panel structure and estimate by OLS:</span>
<span id="cb43-86"><a href="#cb43-86"></a></span>
<span id="cb43-87"><a href="#cb43-87"></a>$$</span>
<span id="cb43-88"><a href="#cb43-88"></a>y_{it} = \mathbf{x}_{it}'\boldsymbol{\beta} + u_{it}, \quad \text{where } u_{it} = \alpha_i + \varepsilon_{it}</span>
<span id="cb43-89"><a href="#cb43-89"></a>$$</span>
<span id="cb43-90"><a href="#cb43-90"></a></span>
<span id="cb43-91"><a href="#cb43-91"></a>The OLS estimator is:</span>
<span id="cb43-92"><a href="#cb43-92"></a></span>
<span id="cb43-93"><a href="#cb43-93"></a>$$</span>
<span id="cb43-94"><a href="#cb43-94"></a>\hat{\boldsymbol{\beta}}_{\text{OLS}} = \left(\sum_{i=1}^{N}\sum_{t=1}^{T} \mathbf{x}_{it}\mathbf{x}_{it}'\right)^{-1} \left(\sum_{i=1}^{N}\sum_{t=1}^{T} \mathbf{x}_{it} y_{it}\right)</span>
<span id="cb43-95"><a href="#cb43-95"></a>$$</span>
<span id="cb43-96"><a href="#cb43-96"></a></span>
<span id="cb43-97"><a href="#cb43-97"></a>**Consistency requires** $\text{plim} \left(\frac{1}{NT}\sum_{i,t} \mathbf{x}_{it} u_{it}\right) = \mathbf{0}$.</span>
<span id="cb43-98"><a href="#cb43-98"></a></span>
<span id="cb43-99"><a href="#cb43-99"></a>Expanding:</span>
<span id="cb43-100"><a href="#cb43-100"></a>$$</span>
<span id="cb43-101"><a href="#cb43-101"></a>\frac{1}{NT}\sum_{i,t} \mathbf{x}_{it} u_{it} = \frac{1}{NT}\sum_{i,t} \mathbf{x}_{it} \alpha_i + \frac{1}{NT}\sum_{i,t} \mathbf{x}_{it} \varepsilon_{it}</span>
<span id="cb43-102"><a href="#cb43-102"></a>$$</span>
<span id="cb43-103"><a href="#cb43-103"></a></span>
<span id="cb43-104"><a href="#cb43-104"></a>The second term vanishes under standard exogeneity ($E<span class="co">[</span><span class="ot">\varepsilon_{it}|\mathbf{x}_{it}</span><span class="co">]</span> = 0$). But the first term:</span>
<span id="cb43-105"><a href="#cb43-105"></a></span>
<span id="cb43-106"><a href="#cb43-106"></a>$$</span>
<span id="cb43-107"><a href="#cb43-107"></a>\frac{1}{NT}\sum_{i,t} \mathbf{x}_{it} \alpha_i \xrightarrow{p} E[\mathbf{x}_{it} \alpha_i] = \text{Cov}(\mathbf{x}_{it}, \alpha_i) + E[\mathbf{x}_{it}]E<span class="co">[</span><span class="ot">\alpha_i</span><span class="co">]</span></span>
<span id="cb43-108"><a href="#cb43-108"></a>$$</span>
<span id="cb43-109"><a href="#cb43-109"></a></span>
<span id="cb43-110"><a href="#cb43-110"></a>**If $\text{Cov}(\mathbf{x}_{it}, \alpha_i) \neq 0$, pooled OLS is inconsistent.**</span>
<span id="cb43-111"><a href="#cb43-111"></a></span>
<span id="cb43-112"><a href="#cb43-112"></a>::: {.callout-note}</span>
<span id="cb43-113"><a href="#cb43-113"></a><span class="fu">## Applied Example</span></span>
<span id="cb43-114"><a href="#cb43-114"></a>In macroeconomic panels, countries with high bank holdings of sovereign debt ($\mathbf{x}$) likely have different institutional quality ($\alpha$) than countries with low holdings. A banking system may hold lots of government bonds *because* of institutional features (regulatory requirements, underdeveloped capital markets) that also independently affect monetary policy. Pooled OLS conflates the causal effect of bank holdings with these institutional differences.</span>
<span id="cb43-115"><a href="#cb43-115"></a>:::</span>
<span id="cb43-116"><a href="#cb43-116"></a></span>
<span id="cb43-117"><a href="#cb43-117"></a><span class="fu">### The Omitted Variable Bias Formula</span></span>
<span id="cb43-118"><a href="#cb43-118"></a></span>
<span id="cb43-119"><a href="#cb43-119"></a>To make this precise, suppose $K = 1$ (scalar $x$) and the true model is:</span>
<span id="cb43-120"><a href="#cb43-120"></a></span>
<span id="cb43-121"><a href="#cb43-121"></a>$$</span>
<span id="cb43-122"><a href="#cb43-122"></a>y_{it} = \beta x_{it} + \gamma \alpha_i + \varepsilon_{it}</span>
<span id="cb43-123"><a href="#cb43-123"></a>$$</span>
<span id="cb43-124"><a href="#cb43-124"></a></span>
<span id="cb43-125"><a href="#cb43-125"></a>where $\gamma = 1$ (the coefficient on $\alpha_i$ is 1 by normalization). The OLS estimator from the regression omitting $\alpha_i$ gives:</span>
<span id="cb43-126"><a href="#cb43-126"></a></span>
<span id="cb43-127"><a href="#cb43-127"></a>$$</span>
<span id="cb43-128"><a href="#cb43-128"></a>\hat{\beta}_{\text{OLS}} \xrightarrow{p} \beta + \gamma \cdot \frac{\text{Cov}(x_{it}, \alpha_i)}{\text{Var}(x_{it})} = \beta + \underbrace{\frac{\text{Cov}(x_{it}, \alpha_i)}{\text{Var}(x_{it})}}_{\text{omitted variable bias}}</span>
<span id="cb43-129"><a href="#cb43-129"></a>$$</span>
<span id="cb43-130"><a href="#cb43-130"></a></span>
<span id="cb43-131"><a href="#cb43-131"></a>**Sign of the bias:**</span>
<span id="cb43-132"><a href="#cb43-132"></a></span>
<span id="cb43-133"><a href="#cb43-133"></a><span class="ss">- </span>If $\text{Cov}(x, \alpha) &lt; 0$ (high bank holdings in weak-institution countries) and $\alpha \to$ lower rates, the bias is **positive**</span>
<span id="cb43-134"><a href="#cb43-134"></a><span class="ss">- </span>This means pooled OLS **attenuates** the negative constraining effect</span>
<span id="cb43-135"><a href="#cb43-135"></a></span>
<span id="cb43-136"><a href="#cb43-136"></a><span class="fu">## The Fixed Effects Estimator</span></span>
<span id="cb43-137"><a href="#cb43-137"></a></span>
<span id="cb43-138"><a href="#cb43-138"></a><span class="fu">### The Within Transformation</span></span>
<span id="cb43-139"><a href="#cb43-139"></a></span>
<span id="cb43-140"><a href="#cb43-140"></a>**Key idea:** Since $\alpha_i$ doesn't vary over time, we can eliminate it by demeaning.</span>
<span id="cb43-141"><a href="#cb43-141"></a></span>
<span id="cb43-142"><a href="#cb43-142"></a>Define the **time averages**:</span>
<span id="cb43-143"><a href="#cb43-143"></a>$$</span>
<span id="cb43-144"><a href="#cb43-144"></a>\bar{y}_i = \frac{1}{T}\sum_{t=1}^{T} y_{it}, \quad \bar{\mathbf{x}}_i = \frac{1}{T}\sum_{t=1}^{T} \mathbf{x}_{it}, \quad \bar{\varepsilon}_i = \frac{1}{T}\sum_{t=1}^{T} \varepsilon_{it}</span>
<span id="cb43-145"><a href="#cb43-145"></a>$$</span>
<span id="cb43-146"><a href="#cb43-146"></a></span>
<span id="cb43-147"><a href="#cb43-147"></a>Averaging the model over time:</span>
<span id="cb43-148"><a href="#cb43-148"></a>$$</span>
<span id="cb43-149"><a href="#cb43-149"></a>\bar{y}_i = \bar{\mathbf{x}}_i'\boldsymbol{\beta} + \alpha_i + \bar{\varepsilon}_i</span>
<span id="cb43-150"><a href="#cb43-150"></a>$$</span>
<span id="cb43-151"><a href="#cb43-151"></a></span>
<span id="cb43-152"><a href="#cb43-152"></a>Subtracting:</span>
<span id="cb43-153"><a href="#cb43-153"></a>$$</span>
<span id="cb43-154"><a href="#cb43-154"></a>y_{it} - \bar{y}_i = (\mathbf{x}_{it} - \bar{\mathbf{x}}_i)'\boldsymbol{\beta} + (\varepsilon_{it} - \bar{\varepsilon}_i)</span>
<span id="cb43-155"><a href="#cb43-155"></a>$$</span>
<span id="cb43-156"><a href="#cb43-156"></a></span>
<span id="cb43-157"><a href="#cb43-157"></a>Or using the "dot" notation:</span>
<span id="cb43-158"><a href="#cb43-158"></a>$$</span>
<span id="cb43-159"><a href="#cb43-159"></a>\ddot{y}_{it} = \ddot{\mathbf{x}}_{it}'\boldsymbol{\beta} + \ddot{\varepsilon}_{it}</span>
<span id="cb43-160"><a href="#cb43-160"></a>$$</span>
<span id="cb43-161"><a href="#cb43-161"></a></span>
<span id="cb43-162"><a href="#cb43-162"></a>**$\alpha_i$ has been eliminated.** The within transformation removes all time-invariant variation.</span>
<span id="cb43-163"><a href="#cb43-163"></a></span>
<span id="cb43-164"><a href="#cb43-164"></a>The **Fixed Effects estimator** is OLS on the demeaned data:</span>
<span id="cb43-165"><a href="#cb43-165"></a></span>
<span id="cb43-166"><a href="#cb43-166"></a>$$</span>
<span id="cb43-167"><a href="#cb43-167"></a>\boxed{\hat{\boldsymbol{\beta}}_{\text{FE}} = \left(\sum_{i=1}^{N}\sum_{t=1}^{T} \ddot{\mathbf{x}}_{it}\ddot{\mathbf{x}}_{it}'\right)^{-1} \left(\sum_{i=1}^{N}\sum_{t=1}^{T} \ddot{\mathbf{x}}_{it} \ddot{y}_{it}\right)}</span>
<span id="cb43-168"><a href="#cb43-168"></a>$$</span>
<span id="cb43-169"><a href="#cb43-169"></a></span>
<span id="cb43-170"><a href="#cb43-170"></a><span class="fu">### What FE Uses and What It Discards</span></span>
<span id="cb43-171"><a href="#cb43-171"></a></span>
<span id="cb43-172"><a href="#cb43-172"></a>**FE uses only within-unit variation:** deviations of $x_{it}$ from its country mean $\bar{x}_i$.</span>
<span id="cb43-173"><a href="#cb43-173"></a></span>
<span id="cb43-174"><a href="#cb43-174"></a><span class="ss">- </span>If a country always has bank holdings of 30%, it contributes **zero** identifying variation to $\hat{\beta}_{\text{FE}}$</span>
<span id="cb43-175"><a href="#cb43-175"></a><span class="ss">- </span>The identifying variation comes from *changes* in bank holdings within a country over time</span>
<span id="cb43-176"><a href="#cb43-176"></a><span class="ss">- </span>A country that goes from 20% to 35% holdings contributes a lot; a country stuck at 25% contributes little</span>
<span id="cb43-177"><a href="#cb43-177"></a></span>
<span id="cb43-178"><a href="#cb43-178"></a>**FE discards between-unit variation:** differences in average $\bar{x}_i$ across countries.</span>
<span id="cb43-179"><a href="#cb43-179"></a></span>
<span id="cb43-180"><a href="#cb43-180"></a>This is both the strength (eliminates $\alpha_i$ bias) and the weakness (throws away cross-sectional information, reduces efficiency).</span>
<span id="cb43-181"><a href="#cb43-181"></a></span>
<span id="cb43-182"><a href="#cb43-182"></a><span class="fu">### Consistency</span></span>
<span id="cb43-183"><a href="#cb43-183"></a></span>
<span id="cb43-184"><a href="#cb43-184"></a>$\hat{\boldsymbol{\beta}}_{\text{FE}}$ is consistent under:</span>
<span id="cb43-185"><a href="#cb43-185"></a></span>
<span id="cb43-186"><a href="#cb43-186"></a>**Assumption (Strict Exogeneity):**</span>
<span id="cb43-187"><a href="#cb43-187"></a>$$</span>
<span id="cb43-188"><a href="#cb43-188"></a>E<span class="co">[</span><span class="ot">\varepsilon_{it} | \mathbf{x}_{i1}, \ldots, \mathbf{x}_{iT}, \alpha_i</span><span class="co">]</span> = 0 \quad \forall \, t</span>
<span id="cb43-189"><a href="#cb43-189"></a>$$</span>
<span id="cb43-190"><a href="#cb43-190"></a></span>
<span id="cb43-191"><a href="#cb43-191"></a>This means:</span>
<span id="cb43-192"><a href="#cb43-192"></a></span>
<span id="cb43-193"><a href="#cb43-193"></a><span class="ss">- </span>Current errors are uncorrelated with **past, present, AND future** regressors</span>
<span id="cb43-194"><a href="#cb43-194"></a><span class="ss">- </span>This rules out **feedback effects**: if past $y$ affects current $x$, strict exogeneity fails</span>
<span id="cb43-195"><a href="#cb43-195"></a><span class="ss">- </span>This also rules out **lagged dependent variables** as regressors (Nickell bias)</span>
<span id="cb43-196"><a href="#cb43-196"></a></span>
<span id="cb43-197"><a href="#cb43-197"></a><span class="fu">### The Frisch-Waugh-Lovell Theorem</span></span>
<span id="cb43-198"><a href="#cb43-198"></a></span>
<span id="cb43-199"><a href="#cb43-199"></a>The FE estimator is numerically identical to OLS with $N$ country dummies.</span>
<span id="cb43-200"><a href="#cb43-200"></a></span>
<span id="cb43-201"><a href="#cb43-201"></a>**Theorem (Frisch-Waugh-Lovell):** In the regression $y = X_1\beta_1 + X_2\beta_2 + \varepsilon$, the OLS estimate of $\beta_1$ is identical to the OLS estimate from regressing $M_2 y$ on $M_2 X_1$, where $M_2 = I - X_2(X_2'X_2)^{-1}X_2'$ is the annihilator matrix for $X_2$.</span>
<span id="cb43-202"><a href="#cb43-202"></a></span>
<span id="cb43-203"><a href="#cb43-203"></a>**Application to FE:** Let $X_1 = \mathbf{X}$ (regressors of interest) and $X_2 = D$ (matrix of country dummies). Then:</span>
<span id="cb43-204"><a href="#cb43-204"></a></span>
<span id="cb43-205"><a href="#cb43-205"></a><span class="ss">- </span>$M_D \mathbf{x}_{it} = \mathbf{x}_{it} - \bar{\mathbf{x}}_i = \ddot{\mathbf{x}}_{it}$ (the within transformation!)</span>
<span id="cb43-206"><a href="#cb43-206"></a><span class="ss">- </span>$M_D y_{it} = y_{it} - \bar{y}_i = \ddot{y}_{it}$</span>
<span id="cb43-207"><a href="#cb43-207"></a></span>
<span id="cb43-208"><a href="#cb43-208"></a>So FE = OLS with dummies = OLS on demeaned data. These are algebraically identical.</span>
<span id="cb43-209"><a href="#cb43-209"></a></span>
<span id="cb43-210"><a href="#cb43-210"></a>**Practical implication:** <span class="in">`fixest::feols()`</span> uses the within transformation (fast), while <span class="in">`lm()`</span> with dummy variables estimates all $N$ dummy coefficients (slow, memory-intensive). Same $\hat{\beta}$, different computational cost.</span>
<span id="cb43-211"><a href="#cb43-211"></a></span>
<span id="cb43-212"><a href="#cb43-212"></a><span class="fu">## Two-Way Fixed Effects</span></span>
<span id="cb43-213"><a href="#cb43-213"></a></span>
<span id="cb43-214"><a href="#cb43-214"></a><span class="fu">### The Model</span></span>
<span id="cb43-215"><a href="#cb43-215"></a></span>
<span id="cb43-216"><a href="#cb43-216"></a>$$</span>
<span id="cb43-217"><a href="#cb43-217"></a>y_{it} = \mathbf{x}_{it}'\boldsymbol{\beta} + \alpha_i + \lambda_t + \varepsilon_{it}</span>
<span id="cb43-218"><a href="#cb43-218"></a>$$</span>
<span id="cb43-219"><a href="#cb43-219"></a></span>
<span id="cb43-220"><a href="#cb43-220"></a>Now $\lambda_t$ absorbs time-varying shocks common to all units:</span>
<span id="cb43-221"><a href="#cb43-221"></a></span>
<span id="cb43-222"><a href="#cb43-222"></a><span class="ss">- </span>$\alpha_i$: Country A is different from Country B in time-invariant ways</span>
<span id="cb43-223"><a href="#cb43-223"></a><span class="ss">- </span>$\lambda_t$: 2022Q2 was different from 2019Q2 for all countries (global inflation surge, Fed tightening)</span>
<span id="cb43-224"><a href="#cb43-224"></a></span>
<span id="cb43-225"><a href="#cb43-225"></a><span class="fu">### Double Demeaning</span></span>
<span id="cb43-226"><a href="#cb43-226"></a></span>
<span id="cb43-227"><a href="#cb43-227"></a>The two-way within transformation removes both $\alpha_i$ and $\lambda_t$:</span>
<span id="cb43-228"><a href="#cb43-228"></a></span>
<span id="cb43-229"><a href="#cb43-229"></a>$$</span>
<span id="cb43-230"><a href="#cb43-230"></a>\tilde{y}_{it} = y_{it} - \bar{y}_{i\cdot} - \bar{y}_{\cdot t} + \bar{y}_{\cdot\cdot}</span>
<span id="cb43-231"><a href="#cb43-231"></a>$$</span>
<span id="cb43-232"><a href="#cb43-232"></a></span>
<span id="cb43-233"><a href="#cb43-233"></a>**What's left:** $\tilde{y}_{it}$ is the part of $y_{it}$ that can't be explained by country-level or time-level averages. It's the country-specific deviation from the global trend.</span>
<span id="cb43-234"><a href="#cb43-234"></a></span>
<span id="cb43-235"><a href="#cb43-235"></a><span class="fu">### What Each Fixed Effect Absorbs</span></span>
<span id="cb43-236"><a href="#cb43-236"></a></span>
<span id="cb43-237"><a href="#cb43-237"></a><span class="pp">|</span> Fixed Effect <span class="pp">|</span> Absorbs <span class="pp">|</span> Example <span class="pp">|</span></span>
<span id="cb43-238"><a href="#cb43-238"></a><span class="pp">|:---|:---|:---|</span></span>
<span id="cb43-239"><a href="#cb43-239"></a><span class="pp">|</span> Country FE ($\alpha_i$) <span class="pp">|</span> All time-invariant country differences <span class="pp">|</span> Regulatory frameworks, reserve currency status <span class="pp">|</span></span>
<span id="cb43-240"><a href="#cb43-240"></a><span class="pp">|</span> Time FE ($\lambda_t$) <span class="pp">|</span> All country-invariant time shocks <span class="pp">|</span> Global inflation surge, commodity price spikes <span class="pp">|</span></span>
<span id="cb43-241"><a href="#cb43-241"></a><span class="pp">|</span> Neither <span class="pp">|</span> Country-specific, time-varying variation <span class="pp">|</span> Country A's holdings rose more in 2020 than average <span class="pp">|</span></span>
<span id="cb43-242"><a href="#cb43-242"></a></span>
<span id="cb43-243"><a href="#cb43-243"></a><span class="fu">## Interactions in Panel Models</span></span>
<span id="cb43-244"><a href="#cb43-244"></a></span>
<span id="cb43-245"><a href="#cb43-245"></a><span class="fu">### The Interaction Term</span></span>
<span id="cb43-246"><a href="#cb43-246"></a></span>
<span id="cb43-247"><a href="#cb43-247"></a>Consider a specification with an interaction:</span>
<span id="cb43-248"><a href="#cb43-248"></a></span>
<span id="cb43-249"><a href="#cb43-249"></a>$$</span>
<span id="cb43-250"><a href="#cb43-250"></a>y_{it} = \gamma_1 x_{it} + \gamma_2 z_{it} + \gamma_3 (x_{it} \times z_{it}) + \alpha_i + \lambda_t + \varepsilon_{it}</span>
<span id="cb43-251"><a href="#cb43-251"></a>$$</span>
<span id="cb43-252"><a href="#cb43-252"></a></span>
<span id="cb43-253"><a href="#cb43-253"></a>**What does $\gamma_3$ mean?**</span>
<span id="cb43-254"><a href="#cb43-254"></a></span>
<span id="cb43-255"><a href="#cb43-255"></a>The marginal effect of $x$ on $y$ is:</span>
<span id="cb43-256"><a href="#cb43-256"></a></span>
<span id="cb43-257"><a href="#cb43-257"></a>$$</span>
<span id="cb43-258"><a href="#cb43-258"></a>\frac{\partial y_{it}}{\partial x_{it}} = \gamma_1 + \gamma_3 \cdot z_{it}</span>
<span id="cb43-259"><a href="#cb43-259"></a>$$</span>
<span id="cb43-260"><a href="#cb43-260"></a></span>
<span id="cb43-261"><a href="#cb43-261"></a>This is **not constant**—it depends on the level of $z_{it}$.</span>
<span id="cb43-262"><a href="#cb43-262"></a></span>
<span id="cb43-263"><a href="#cb43-263"></a>::: {.callout-tip}</span>
<span id="cb43-264"><a href="#cb43-264"></a><span class="fu">## Interpretation</span></span>
<span id="cb43-265"><a href="#cb43-265"></a>If $\gamma_1 &gt; 0$ and $\gamma_3 &lt; 0$, there exists a "crossing point" $z^* = -\gamma_1/\gamma_3$ where the marginal effect of $x$ switches sign. Below $z^*$, $x$ has a positive effect; above $z^*$, negative.</span>
<span id="cb43-266"><a href="#cb43-266"></a>:::</span>
<span id="cb43-267"><a href="#cb43-267"></a></span>
<span id="cb43-268"><a href="#cb43-268"></a><span class="fu">### Clustering Standard Errors</span></span>
<span id="cb43-269"><a href="#cb43-269"></a></span>
<span id="cb43-270"><a href="#cb43-270"></a>Standard OLS assumes $\varepsilon_{it}$ is i.i.d. This fails in panels because:</span>
<span id="cb43-271"><a href="#cb43-271"></a></span>
<span id="cb43-272"><a href="#cb43-272"></a><span class="ss">1. </span>**Serial correlation within country:** A country's error in 2022Q1 is correlated with its error in 2022Q2</span>
<span id="cb43-273"><a href="#cb43-273"></a><span class="ss">2. </span>**Cross-sectional dependence:** Country A's error in 2022Q1 may correlate with Country B's (global shocks)</span>
<span id="cb43-274"><a href="#cb43-274"></a></span>
<span id="cb43-275"><a href="#cb43-275"></a>Clustering by country handles (1): it allows arbitrary within-country correlation over time.</span>
<span id="cb43-276"><a href="#cb43-276"></a></span>
<span id="cb43-277"><a href="#cb43-277"></a>**Important:** Cluster-robust inference requires $N \to \infty$. With only 30 countries, cluster SEs may be unreliable. Rule of thumb: need $N \geq 50$ for good coverage. With small $N$, consider wild cluster bootstrap.</span>
<span id="cb43-278"><a href="#cb43-278"></a></span>
<span id="cb43-279"><a href="#cb43-279"></a><span class="fu"># Monte Carlo Simulations {.unnumbered}</span></span>
<span id="cb43-280"><a href="#cb43-280"></a></span>
<span id="cb43-281"><a href="#cb43-281"></a>This section uses Monte Carlo simulations to demonstrate the properties of panel estimators.</span>
<span id="cb43-282"><a href="#cb43-282"></a></span>
<span id="cb43-283"><a href="#cb43-283"></a><span class="fu">## Demonstrating OVB: Pooled OLS vs. FE</span></span>
<span id="cb43-284"><a href="#cb43-284"></a></span>
<span id="cb43-285"><a href="#cb43-285"></a>We simulate a panel where $\text{Cov}(x_{it}, \alpha_i) \neq 0$ and show that pooled OLS is biased while FE is consistent.</span>
<span id="cb43-286"><a href="#cb43-286"></a></span>
<span id="cb43-289"><a href="#cb43-289"></a><span class="in">```{r}</span></span>
<span id="cb43-290"><a href="#cb43-290"></a><span class="co">#| label: monte-carlo-ovb</span></span>
<span id="cb43-291"><a href="#cb43-291"></a></span>
<span id="cb43-292"><a href="#cb43-292"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb43-293"><a href="#cb43-293"></a></span>
<span id="cb43-294"><a href="#cb43-294"></a><span class="co"># Parameters</span></span>
<span id="cb43-295"><a href="#cb43-295"></a>N <span class="ot">&lt;-</span> <span class="dv">50</span>       <span class="co"># countries</span></span>
<span id="cb43-296"><a href="#cb43-296"></a>T_per <span class="ot">&lt;-</span> <span class="dv">20</span>   <span class="co"># quarters</span></span>
<span id="cb43-297"><a href="#cb43-297"></a>beta_true <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span>  <span class="co"># true effect: negative</span></span>
<span id="cb43-298"><a href="#cb43-298"></a>gamma_alpha <span class="ot">&lt;-</span> <span class="dv">3</span>   <span class="co"># how much alpha matters for y</span></span>
<span id="cb43-299"><a href="#cb43-299"></a></span>
<span id="cb43-300"><a href="#cb43-300"></a><span class="co"># Simulation</span></span>
<span id="cb43-301"><a href="#cb43-301"></a>n_sims <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb43-302"><a href="#cb43-302"></a>beta_ols <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sims)</span>
<span id="cb43-303"><a href="#cb43-303"></a>beta_fe  <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sims)</span>
<span id="cb43-304"><a href="#cb43-304"></a></span>
<span id="cb43-305"><a href="#cb43-305"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sims) {</span>
<span id="cb43-306"><a href="#cb43-306"></a>  <span class="co"># Generate unobserved heterogeneity</span></span>
<span id="cb43-307"><a href="#cb43-307"></a>  alpha <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">2</span>)  <span class="co"># country effect</span></span>
<span id="cb43-308"><a href="#cb43-308"></a></span>
<span id="cb43-309"><a href="#cb43-309"></a>  <span class="co"># Generate x correlated with alpha</span></span>
<span id="cb43-310"><a href="#cb43-310"></a>  <span class="co"># Countries with higher alpha have LOWER x (negative correlation)</span></span>
<span id="cb43-311"><a href="#cb43-311"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, N, T_per)</span>
<span id="cb43-312"><a href="#cb43-312"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb43-313"><a href="#cb43-313"></a>    x[i, ] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.8</span> <span class="sc">*</span> alpha[i] <span class="sc">+</span> <span class="fu">rnorm</span>(T_per, <span class="at">mean =</span> <span class="dv">20</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb43-314"><a href="#cb43-314"></a>  }</span>
<span id="cb43-315"><a href="#cb43-315"></a></span>
<span id="cb43-316"><a href="#cb43-316"></a>  <span class="co"># Generate y</span></span>
<span id="cb43-317"><a href="#cb43-317"></a>  y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, N, T_per)</span>
<span id="cb43-318"><a href="#cb43-318"></a>  eps <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(N <span class="sc">*</span> T_per, <span class="at">sd =</span> <span class="dv">1</span>), N, T_per)</span>
<span id="cb43-319"><a href="#cb43-319"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb43-320"><a href="#cb43-320"></a>    y[i, ] <span class="ot">&lt;-</span> beta_true <span class="sc">*</span> x[i, ] <span class="sc">+</span> gamma_alpha <span class="sc">*</span> alpha[i] <span class="sc">+</span> eps[i, ]</span>
<span id="cb43-321"><a href="#cb43-321"></a>  }</span>
<span id="cb43-322"><a href="#cb43-322"></a></span>
<span id="cb43-323"><a href="#cb43-323"></a>  <span class="co"># Reshape to panel</span></span>
<span id="cb43-324"><a href="#cb43-324"></a>  id <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="at">each =</span> T_per)</span>
<span id="cb43-325"><a href="#cb43-325"></a>  tt <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>T_per, <span class="at">times =</span> N)</span>
<span id="cb43-326"><a href="#cb43-326"></a>  yy <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(y))</span>
<span id="cb43-327"><a href="#cb43-327"></a>  xx <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(x))</span>
<span id="cb43-328"><a href="#cb43-328"></a></span>
<span id="cb43-329"><a href="#cb43-329"></a>  <span class="co"># Pooled OLS</span></span>
<span id="cb43-330"><a href="#cb43-330"></a>  beta_ols[s] <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">lm</span>(yy <span class="sc">~</span> xx))[<span class="dv">2</span>]</span>
<span id="cb43-331"><a href="#cb43-331"></a></span>
<span id="cb43-332"><a href="#cb43-332"></a>  <span class="co"># Fixed Effects</span></span>
<span id="cb43-333"><a href="#cb43-333"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> yy, <span class="at">x =</span> xx, <span class="at">id =</span> <span class="fu">factor</span>(id))</span>
<span id="cb43-334"><a href="#cb43-334"></a>  beta_fe[s] <span class="ot">&lt;-</span> <span class="fu">coef</span>(fixest<span class="sc">::</span><span class="fu">feols</span>(y <span class="sc">~</span> x <span class="sc">|</span> id, <span class="at">data =</span> df))[<span class="st">"x"</span>]</span>
<span id="cb43-335"><a href="#cb43-335"></a>}</span>
<span id="cb43-336"><a href="#cb43-336"></a></span>
<span id="cb43-337"><a href="#cb43-337"></a><span class="co"># Results</span></span>
<span id="cb43-338"><a href="#cb43-338"></a><span class="fu">cat</span>(<span class="st">"=== Monte Carlo Results (1000 simulations) ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb43-339"><a href="#cb43-339"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"True beta:         %.3f</span><span class="sc">\n</span><span class="st">"</span>, beta_true))</span>
<span id="cb43-340"><a href="#cb43-340"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Pooled OLS mean:   %.3f  (bias = %.3f)</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">mean</span>(beta_ols), <span class="fu">mean</span>(beta_ols) <span class="sc">-</span> beta_true))</span>
<span id="cb43-341"><a href="#cb43-341"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"FE mean:           %.3f  (bias = %.3f)</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">mean</span>(beta_fe), <span class="fu">mean</span>(beta_fe) <span class="sc">-</span> beta_true))</span>
<span id="cb43-342"><a href="#cb43-342"></a><span class="in">```</span></span>
<span id="cb43-343"><a href="#cb43-343"></a></span>
<span id="cb43-346"><a href="#cb43-346"></a><span class="in">```{r}</span></span>
<span id="cb43-347"><a href="#cb43-347"></a><span class="co">#| label: plot-monte-carlo</span></span>
<span id="cb43-348"><a href="#cb43-348"></a><span class="co">#| fig-cap: "Monte Carlo comparison of Pooled OLS vs. Fixed Effects estimators"</span></span>
<span id="cb43-349"><a href="#cb43-349"></a></span>
<span id="cb43-350"><a href="#cb43-350"></a>df_mc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb43-351"><a href="#cb43-351"></a>  <span class="at">estimate =</span> <span class="fu">c</span>(beta_ols, beta_fe),</span>
<span id="cb43-352"><a href="#cb43-352"></a>  <span class="at">method =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Pooled OLS"</span>, <span class="st">"Fixed Effects"</span>), <span class="at">each =</span> n_sims)</span>
<span id="cb43-353"><a href="#cb43-353"></a>)</span>
<span id="cb43-354"><a href="#cb43-354"></a></span>
<span id="cb43-355"><a href="#cb43-355"></a><span class="fu">ggplot</span>(df_mc, <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">fill =</span> method)) <span class="sc">+</span></span>
<span id="cb43-356"><a href="#cb43-356"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb43-357"><a href="#cb43-357"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> beta_true, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb43-358"><a href="#cb43-358"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> beta_true <span class="sc">-</span> <span class="fl">0.02</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"True β ="</span>, beta_true),</span>
<span id="cb43-359"><a href="#cb43-359"></a>           <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb43-360"><a href="#cb43-360"></a>  <span class="fu">labs</span>(</span>
<span id="cb43-361"><a href="#cb43-361"></a>    <span class="at">title =</span> <span class="st">"Monte Carlo: Pooled OLS vs. Fixed Effects"</span>,</span>
<span id="cb43-362"><a href="#cb43-362"></a>    <span class="at">subtitle =</span> <span class="st">"N=50 units, T=20 periods, Cov(x, α) &lt; 0, 1000 simulations"</span>,</span>
<span id="cb43-363"><a href="#cb43-363"></a>    <span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(beta)),</span>
<span id="cb43-364"><a href="#cb43-364"></a>    <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb43-365"><a href="#cb43-365"></a>  ) <span class="sc">+</span></span>
<span id="cb43-366"><a href="#cb43-366"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Pooled OLS"</span> <span class="ot">=</span> <span class="st">"#e74c3c"</span>, <span class="st">"Fixed Effects"</span> <span class="ot">=</span> <span class="st">"#2ecc71"</span>)) <span class="sc">+</span></span>
<span id="cb43-367"><a href="#cb43-367"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb43-368"><a href="#cb43-368"></a><span class="in">```</span></span>
<span id="cb43-369"><a href="#cb43-369"></a></span>
<span id="cb43-370"><a href="#cb43-370"></a>**What you should see:** The OLS distribution is centered well above the true value (biased positive). The FE distribution is centered on the truth.</span>
<span id="cb43-371"><a href="#cb43-371"></a></span>
<span id="cb43-372"><a href="#cb43-372"></a><span class="fu">## Demonstrating Time FE Importance</span></span>
<span id="cb43-373"><a href="#cb43-373"></a></span>
<span id="cb43-376"><a href="#cb43-376"></a><span class="in">```{r}</span></span>
<span id="cb43-377"><a href="#cb43-377"></a><span class="co">#| label: monte-carlo-twfe</span></span>
<span id="cb43-378"><a href="#cb43-378"></a></span>
<span id="cb43-379"><a href="#cb43-379"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb43-380"><a href="#cb43-380"></a></span>
<span id="cb43-381"><a href="#cb43-381"></a>N <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb43-382"><a href="#cb43-382"></a>T_per <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb43-383"><a href="#cb43-383"></a>beta_true <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.3</span></span>
<span id="cb43-384"><a href="#cb43-384"></a></span>
<span id="cb43-385"><a href="#cb43-385"></a>n_sims <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb43-386"><a href="#cb43-386"></a>beta_country_fe <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sims)</span>
<span id="cb43-387"><a href="#cb43-387"></a>beta_twoway_fe  <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_sims)</span>
<span id="cb43-388"><a href="#cb43-388"></a></span>
<span id="cb43-389"><a href="#cb43-389"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sims) {</span>
<span id="cb43-390"><a href="#cb43-390"></a>  alpha <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="at">sd =</span> <span class="dv">3</span>)         <span class="co"># country effects</span></span>
<span id="cb43-391"><a href="#cb43-391"></a>  lambda <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(T_per, <span class="at">sd =</span> <span class="dv">2</span>)    <span class="co"># time effects</span></span>
<span id="cb43-392"><a href="#cb43-392"></a></span>
<span id="cb43-393"><a href="#cb43-393"></a>  <span class="co"># x correlated with both alpha AND lambda</span></span>
<span id="cb43-394"><a href="#cb43-394"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, N, T_per)</span>
<span id="cb43-395"><a href="#cb43-395"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb43-396"><a href="#cb43-396"></a>    <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>T_per) {</span>
<span id="cb43-397"><a href="#cb43-397"></a>      x[i, t] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> alpha[i] <span class="sc">+</span> <span class="fl">0.4</span> <span class="sc">*</span> lambda[t] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">20</span>, <span class="at">sd =</span> <span class="dv">2</span>)</span>
<span id="cb43-398"><a href="#cb43-398"></a>    }</span>
<span id="cb43-399"><a href="#cb43-399"></a>  }</span>
<span id="cb43-400"><a href="#cb43-400"></a></span>
<span id="cb43-401"><a href="#cb43-401"></a>  y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, N, T_per)</span>
<span id="cb43-402"><a href="#cb43-402"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb43-403"><a href="#cb43-403"></a>    <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>T_per) {</span>
<span id="cb43-404"><a href="#cb43-404"></a>      y[i, t] <span class="ot">&lt;-</span> beta_true <span class="sc">*</span> x[i, t] <span class="sc">+</span> alpha[i] <span class="sc">+</span> lambda[t] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb43-405"><a href="#cb43-405"></a>    }</span>
<span id="cb43-406"><a href="#cb43-406"></a>  }</span>
<span id="cb43-407"><a href="#cb43-407"></a></span>
<span id="cb43-408"><a href="#cb43-408"></a>  id <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="at">each =</span> T_per)</span>
<span id="cb43-409"><a href="#cb43-409"></a>  tt <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>T_per, <span class="at">times =</span> N)</span>
<span id="cb43-410"><a href="#cb43-410"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(y)), <span class="at">x =</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(x)),</span>
<span id="cb43-411"><a href="#cb43-411"></a>                   <span class="at">id =</span> <span class="fu">factor</span>(id), <span class="at">time =</span> <span class="fu">factor</span>(tt))</span>
<span id="cb43-412"><a href="#cb43-412"></a></span>
<span id="cb43-413"><a href="#cb43-413"></a>  beta_country_fe[s] <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">feols</span>(y <span class="sc">~</span> x <span class="sc">|</span> id, <span class="at">data =</span> df))[<span class="st">"x"</span>]</span>
<span id="cb43-414"><a href="#cb43-414"></a>  beta_twoway_fe[s]  <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">feols</span>(y <span class="sc">~</span> x <span class="sc">|</span> id <span class="sc">+</span> time, <span class="at">data =</span> df))[<span class="st">"x"</span>]</span>
<span id="cb43-415"><a href="#cb43-415"></a>}</span>
<span id="cb43-416"><a href="#cb43-416"></a></span>
<span id="cb43-417"><a href="#cb43-417"></a><span class="fu">cat</span>(<span class="st">"=== Time FE Matters When x Correlates with Time Shocks ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb43-418"><a href="#cb43-418"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"True beta:           %.3f</span><span class="sc">\n</span><span class="st">"</span>, beta_true))</span>
<span id="cb43-419"><a href="#cb43-419"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Country FE only:     %.3f  (bias = %.3f)</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb43-420"><a href="#cb43-420"></a>            <span class="fu">mean</span>(beta_country_fe), <span class="fu">mean</span>(beta_country_fe) <span class="sc">-</span> beta_true))</span>
<span id="cb43-421"><a href="#cb43-421"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Two-way FE:          %.3f  (bias = %.3f)</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb43-422"><a href="#cb43-422"></a>            <span class="fu">mean</span>(beta_twoway_fe), <span class="fu">mean</span>(beta_twoway_fe) <span class="sc">-</span> beta_true))</span>
<span id="cb43-423"><a href="#cb43-423"></a><span class="in">```</span></span>
<span id="cb43-424"><a href="#cb43-424"></a></span>
<span id="cb43-425"><a href="#cb43-425"></a>**Key lesson:** Country FE alone is not enough if the regressors correlate with common time shocks.</span>
<span id="cb43-426"><a href="#cb43-426"></a></span>
<span id="cb43-427"><a href="#cb43-427"></a><span class="fu">## Cluster SE Coverage</span></span>
<span id="cb43-428"><a href="#cb43-428"></a></span>
<span id="cb43-431"><a href="#cb43-431"></a><span class="in">```{r}</span></span>
<span id="cb43-432"><a href="#cb43-432"></a><span class="co">#| label: monte-carlo-clustering</span></span>
<span id="cb43-433"><a href="#cb43-433"></a></span>
<span id="cb43-434"><a href="#cb43-434"></a><span class="fu">set.seed</span>(<span class="dv">99</span>)</span>
<span id="cb43-435"><a href="#cb43-435"></a></span>
<span id="cb43-436"><a href="#cb43-436"></a>N <span class="ot">&lt;-</span> <span class="dv">30</span>     <span class="co"># small number of clusters</span></span>
<span id="cb43-437"><a href="#cb43-437"></a>T_per <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb43-438"><a href="#cb43-438"></a>beta_true <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb43-439"><a href="#cb43-439"></a></span>
<span id="cb43-440"><a href="#cb43-440"></a>n_sims <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb43-441"><a href="#cb43-441"></a>cover_iid <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb43-442"><a href="#cb43-442"></a>cover_cluster <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb43-443"><a href="#cb43-443"></a></span>
<span id="cb43-444"><a href="#cb43-444"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sims) {</span>
<span id="cb43-445"><a href="#cb43-445"></a>  alpha <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb43-446"><a href="#cb43-446"></a></span>
<span id="cb43-447"><a href="#cb43-447"></a>  <span class="co"># Generate x and y with serially correlated errors</span></span>
<span id="cb43-448"><a href="#cb43-448"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, N, T_per)</span>
<span id="cb43-449"><a href="#cb43-449"></a>  y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, N, T_per)</span>
<span id="cb43-450"><a href="#cb43-450"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb43-451"><a href="#cb43-451"></a>    x[i, ] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> alpha[i] <span class="sc">+</span> <span class="fu">rnorm</span>(T_per, <span class="dv">20</span>, <span class="dv">3</span>)</span>
<span id="cb43-452"><a href="#cb43-452"></a>    eps <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar =</span> <span class="fl">0.6</span>), <span class="at">n =</span> T_per, <span class="at">sd =</span> <span class="dv">1</span>)  <span class="co"># AR(1) errors</span></span>
<span id="cb43-453"><a href="#cb43-453"></a>    y[i, ] <span class="ot">&lt;-</span> beta_true <span class="sc">*</span> x[i, ] <span class="sc">+</span> alpha[i] <span class="sc">+</span> eps</span>
<span id="cb43-454"><a href="#cb43-454"></a>  }</span>
<span id="cb43-455"><a href="#cb43-455"></a></span>
<span id="cb43-456"><a href="#cb43-456"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(y)), <span class="at">x =</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(x)),</span>
<span id="cb43-457"><a href="#cb43-457"></a>                   <span class="at">id =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="at">each =</span> T_per)))</span>
<span id="cb43-458"><a href="#cb43-458"></a></span>
<span id="cb43-459"><a href="#cb43-459"></a>  fit <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> x <span class="sc">|</span> id, <span class="at">data =</span> df)</span>
<span id="cb43-460"><a href="#cb43-460"></a></span>
<span id="cb43-461"><a href="#cb43-461"></a>  <span class="co"># IID standard errors</span></span>
<span id="cb43-462"><a href="#cb43-462"></a>  ci_iid <span class="ot">&lt;-</span> <span class="fu">confint</span>(fit, <span class="at">se =</span> <span class="st">"iid"</span>)</span>
<span id="cb43-463"><a href="#cb43-463"></a>  cover_iid <span class="ot">&lt;-</span> cover_iid <span class="sc">+</span> (ci_iid[<span class="dv">1</span>] <span class="sc">&lt;=</span> beta_true <span class="sc">&amp;</span> beta_true <span class="sc">&lt;=</span> ci_iid[<span class="dv">2</span>])</span>
<span id="cb43-464"><a href="#cb43-464"></a></span>
<span id="cb43-465"><a href="#cb43-465"></a>  <span class="co"># Cluster standard errors</span></span>
<span id="cb43-466"><a href="#cb43-466"></a>  ci_cluster <span class="ot">&lt;-</span> <span class="fu">confint</span>(fit, <span class="at">cluster =</span> <span class="sc">~</span>id)</span>
<span id="cb43-467"><a href="#cb43-467"></a>  cover_cluster <span class="ot">&lt;-</span> cover_cluster <span class="sc">+</span> (ci_cluster[<span class="dv">1</span>] <span class="sc">&lt;=</span> beta_true <span class="sc">&amp;</span> beta_true <span class="sc">&lt;=</span> ci_cluster[<span class="dv">2</span>])</span>
<span id="cb43-468"><a href="#cb43-468"></a>}</span>
<span id="cb43-469"><a href="#cb43-469"></a></span>
<span id="cb43-470"><a href="#cb43-470"></a><span class="fu">cat</span>(<span class="st">"=== 95% CI Coverage (AR(1) errors within clusters) ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb43-471"><a href="#cb43-471"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"IID SEs:     %.1f%%  (should be 95%%)</span><span class="sc">\n</span><span class="st">"</span>, <span class="dv">100</span> <span class="sc">*</span> cover_iid <span class="sc">/</span> n_sims))</span>
<span id="cb43-472"><a href="#cb43-472"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Cluster SEs: %.1f%%  (should be 95%%)</span><span class="sc">\n</span><span class="st">"</span>, <span class="dv">100</span> <span class="sc">*</span> cover_cluster <span class="sc">/</span> n_sims))</span>
<span id="cb43-473"><a href="#cb43-473"></a><span class="in">```</span></span>
<span id="cb43-474"><a href="#cb43-474"></a></span>
<span id="cb43-475"><a href="#cb43-475"></a>**What you should see:** IID standard errors have coverage well below 95% (too many false positives). Cluster SEs restore correct coverage.</span>
<span id="cb43-476"><a href="#cb43-476"></a></span>
<span id="cb43-477"><a href="#cb43-477"></a><span class="fu"># Application {.unnumbered}</span></span>
<span id="cb43-478"><a href="#cb43-478"></a></span>
<span id="cb43-479"><a href="#cb43-479"></a>This section applies the methods to macroeconomic panel data.</span>
<span id="cb43-480"><a href="#cb43-480"></a></span>
<span id="cb43-481"><a href="#cb43-481"></a><span class="fu">## Data Preparation</span></span>
<span id="cb43-482"><a href="#cb43-482"></a></span>
<span id="cb43-485"><a href="#cb43-485"></a><span class="in">```{r}</span></span>
<span id="cb43-486"><a href="#cb43-486"></a><span class="co">#| label: load-data</span></span>
<span id="cb43-487"><a href="#cb43-487"></a></span>
<span id="cb43-488"><a href="#cb43-488"></a><span class="co"># Prepare the analysis sample</span></span>
<span id="cb43-489"><a href="#cb43-489"></a>analysis <span class="ot">&lt;-</span> master <span class="sc">%&gt;%</span></span>
<span id="cb43-490"><a href="#cb43-490"></a>  <span class="fu">mutate</span>(<span class="at">quarter =</span> <span class="fu">as.integer</span>(<span class="fu">gsub</span>(<span class="st">".*Q"</span>, <span class="st">""</span>, year_quarter))) <span class="sc">%&gt;%</span></span>
<span id="cb43-491"><a href="#cb43-491"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb43-492"><a href="#cb43-492"></a>  <span class="fu">arrange</span>(year, quarter) <span class="sc">%&gt;%</span></span>
<span id="cb43-493"><a href="#cb43-493"></a>  <span class="fu">mutate</span>(</span>
<span id="cb43-494"><a href="#cb43-494"></a>    <span class="co"># Lagged variables</span></span>
<span id="cb43-495"><a href="#cb43-495"></a>    <span class="at">L1_bank_holdings_pct =</span> <span class="fu">lag</span>(bank_holdings_pct),</span>
<span id="cb43-496"><a href="#cb43-496"></a>    <span class="at">L1_cb_holdings_pct =</span> <span class="fu">lag</span>(cb_holdings_pct)</span>
<span id="cb43-497"><a href="#cb43-497"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb43-498"><a href="#cb43-498"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-499"><a href="#cb43-499"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(policy_rate), <span class="sc">!</span><span class="fu">is.na</span>(bank_holdings_pct))</span>
<span id="cb43-500"><a href="#cb43-500"></a></span>
<span id="cb43-501"><a href="#cb43-501"></a><span class="co"># Post-2022 subsample</span></span>
<span id="cb43-502"><a href="#cb43-502"></a>tightening <span class="ot">&lt;-</span> analysis <span class="sc">%&gt;%</span></span>
<span id="cb43-503"><a href="#cb43-503"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-504"><a href="#cb43-504"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(L1_bank_holdings_pct))</span>
<span id="cb43-505"><a href="#cb43-505"></a></span>
<span id="cb43-506"><a href="#cb43-506"></a><span class="fu">cat</span>(<span class="st">"Full sample:"</span>, <span class="fu">nrow</span>(analysis), <span class="st">"obs,"</span>, <span class="fu">n_distinct</span>(analysis<span class="sc">$</span>country), <span class="st">"countries</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb43-507"><a href="#cb43-507"></a><span class="fu">cat</span>(<span class="st">"Post-2022 sample:"</span>, <span class="fu">nrow</span>(tightening), <span class="st">"obs,"</span>, <span class="fu">n_distinct</span>(tightening<span class="sc">$</span>country), <span class="st">"countries</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb43-508"><a href="#cb43-508"></a><span class="in">```</span></span>
<span id="cb43-509"><a href="#cb43-509"></a></span>
<span id="cb43-510"><a href="#cb43-510"></a><span class="fu">## Building Up: OLS → FE → TWFE</span></span>
<span id="cb43-511"><a href="#cb43-511"></a></span>
<span id="cb43-514"><a href="#cb43-514"></a><span class="in">```{r}</span></span>
<span id="cb43-515"><a href="#cb43-515"></a><span class="co">#| label: step-by-step</span></span>
<span id="cb43-516"><a href="#cb43-516"></a></span>
<span id="cb43-517"><a href="#cb43-517"></a><span class="co"># Check if we have the necessary variables</span></span>
<span id="cb43-518"><a href="#cb43-518"></a><span class="cf">if</span> (<span class="st">"inflation_yoy"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tightening) <span class="sc">||</span> <span class="st">"sovereign_debt_gdp"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tightening)) {</span>
<span id="cb43-519"><a href="#cb43-519"></a></span>
<span id="cb43-520"><a href="#cb43-520"></a>  <span class="co"># Step 1: Pooled OLS</span></span>
<span id="cb43-521"><a href="#cb43-521"></a>  m1 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">+</span> sovereign_debt_gdp,</span>
<span id="cb43-522"><a href="#cb43-522"></a>              <span class="at">data =</span> tightening)</span>
<span id="cb43-523"><a href="#cb43-523"></a></span>
<span id="cb43-524"><a href="#cb43-524"></a>  <span class="co"># Step 2: Country FE only</span></span>
<span id="cb43-525"><a href="#cb43-525"></a>  m2 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">|</span> country,</span>
<span id="cb43-526"><a href="#cb43-526"></a>              <span class="at">data =</span> tightening)</span>
<span id="cb43-527"><a href="#cb43-527"></a></span>
<span id="cb43-528"><a href="#cb43-528"></a>  <span class="co"># Step 3: Two-way FE</span></span>
<span id="cb43-529"><a href="#cb43-529"></a>  m3 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">|</span> country <span class="sc">+</span> year_quarter,</span>
<span id="cb43-530"><a href="#cb43-530"></a>              <span class="at">data =</span> tightening)</span>
<span id="cb43-531"><a href="#cb43-531"></a></span>
<span id="cb43-532"><a href="#cb43-532"></a>  <span class="co"># Step 4: Add CB holdings</span></span>
<span id="cb43-533"><a href="#cb43-533"></a>  m4 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">+</span> L1_cb_holdings_pct</span>
<span id="cb43-534"><a href="#cb43-534"></a>              <span class="sc">|</span> country <span class="sc">+</span> year_quarter,</span>
<span id="cb43-535"><a href="#cb43-535"></a>              <span class="at">data =</span> tightening)</span>
<span id="cb43-536"><a href="#cb43-536"></a></span>
<span id="cb43-537"><a href="#cb43-537"></a>  <span class="co"># Step 5: Interaction</span></span>
<span id="cb43-538"><a href="#cb43-538"></a>  m5 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">*</span> L1_cb_holdings_pct</span>
<span id="cb43-539"><a href="#cb43-539"></a>              <span class="sc">|</span> country <span class="sc">+</span> year_quarter,</span>
<span id="cb43-540"><a href="#cb43-540"></a>              <span class="at">data =</span> tightening)</span>
<span id="cb43-541"><a href="#cb43-541"></a></span>
<span id="cb43-542"><a href="#cb43-542"></a>  <span class="co"># Display with appropriate SEs</span></span>
<span id="cb43-543"><a href="#cb43-543"></a>  <span class="co"># Note: In practice, FE models should use clustered SEs</span></span>
<span id="cb43-544"><a href="#cb43-544"></a>  <span class="fu">etable</span>(m1, m2, m3, m4, m5,</span>
<span id="cb43-545"><a href="#cb43-545"></a>         <span class="at">headers =</span> <span class="fu">c</span>(<span class="st">"Pooled"</span>, <span class="st">"Country FE"</span>, <span class="st">"TWFE"</span>, <span class="st">"+CB"</span>, <span class="st">"Interaction"</span>),</span>
<span id="cb43-546"><a href="#cb43-546"></a>         <span class="at">vcov =</span> <span class="fu">list</span>(<span class="st">"iid"</span>, <span class="sc">~</span>country, <span class="sc">~</span>country, <span class="sc">~</span>country, <span class="sc">~</span>country),</span>
<span id="cb43-547"><a href="#cb43-547"></a>         <span class="at">fitstat =</span> <span class="sc">~</span> n <span class="sc">+</span> r2 <span class="sc">+</span> wr2)</span>
<span id="cb43-548"><a href="#cb43-548"></a>} <span class="cf">else</span> {</span>
<span id="cb43-549"><a href="#cb43-549"></a>  <span class="fu">cat</span>(<span class="st">"Note: Full specification requires inflation and debt variables.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb43-550"><a href="#cb43-550"></a>  <span class="fu">cat</span>(<span class="st">"Running simplified demonstration with available variables.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb43-551"><a href="#cb43-551"></a></span>
<span id="cb43-552"><a href="#cb43-552"></a>  m1 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct, <span class="at">data =</span> tightening)</span>
<span id="cb43-553"><a href="#cb43-553"></a>  m2 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">|</span> country, <span class="at">data =</span> tightening)</span>
<span id="cb43-554"><a href="#cb43-554"></a>  m3 <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">|</span> country <span class="sc">+</span> year_quarter, <span class="at">data =</span> tightening)</span>
<span id="cb43-555"><a href="#cb43-555"></a></span>
<span id="cb43-556"><a href="#cb43-556"></a>  <span class="fu">etable</span>(m1, m2, m3,</span>
<span id="cb43-557"><a href="#cb43-557"></a>         <span class="at">headers =</span> <span class="fu">c</span>(<span class="st">"Pooled"</span>, <span class="st">"Country FE"</span>, <span class="st">"TWFE"</span>),</span>
<span id="cb43-558"><a href="#cb43-558"></a>         <span class="at">vcov =</span> <span class="fu">list</span>(<span class="st">"iid"</span>, <span class="sc">~</span>country, <span class="sc">~</span>country),</span>
<span id="cb43-559"><a href="#cb43-559"></a>         <span class="at">fitstat =</span> <span class="sc">~</span> n <span class="sc">+</span> r2 <span class="sc">+</span> wr2)</span>
<span id="cb43-560"><a href="#cb43-560"></a>}</span>
<span id="cb43-561"><a href="#cb43-561"></a><span class="in">```</span></span>
<span id="cb43-562"><a href="#cb43-562"></a></span>
<span id="cb43-563"><a href="#cb43-563"></a><span class="fu">## Within-Country Variation</span></span>
<span id="cb43-564"><a href="#cb43-564"></a></span>
<span id="cb43-567"><a href="#cb43-567"></a><span class="in">```{r}</span></span>
<span id="cb43-568"><a href="#cb43-568"></a><span class="co">#| label: within-variation</span></span>
<span id="cb43-569"><a href="#cb43-569"></a></span>
<span id="cb43-570"><a href="#cb43-570"></a>within_var <span class="ot">&lt;-</span> tightening <span class="sc">%&gt;%</span></span>
<span id="cb43-571"><a href="#cb43-571"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb43-572"><a href="#cb43-572"></a>  <span class="fu">summarise</span>(</span>
<span id="cb43-573"><a href="#cb43-573"></a>    <span class="at">mean_holdings =</span> <span class="fu">mean</span>(L1_bank_holdings_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb43-574"><a href="#cb43-574"></a>    <span class="at">sd_within =</span> <span class="fu">sd</span>(L1_bank_holdings_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb43-575"><a href="#cb43-575"></a>    <span class="at">range_within =</span> <span class="fu">max</span>(L1_bank_holdings_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span></span>
<span id="cb43-576"><a href="#cb43-576"></a>                   <span class="fu">min</span>(L1_bank_holdings_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb43-577"><a href="#cb43-577"></a>    <span class="at">n_obs =</span> <span class="fu">n</span>()</span>
<span id="cb43-578"><a href="#cb43-578"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb43-579"><a href="#cb43-579"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(sd_within))</span>
<span id="cb43-580"><a href="#cb43-580"></a></span>
<span id="cb43-581"><a href="#cb43-581"></a><span class="fu">cat</span>(<span class="st">"=== Within-Country Variation ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb43-582"><a href="#cb43-582"></a><span class="fu">cat</span>(<span class="st">"Most variation:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb43-583"><a href="#cb43-583"></a><span class="fu">print</span>(<span class="fu">head</span>(within_var, <span class="dv">5</span>))</span>
<span id="cb43-584"><a href="#cb43-584"></a></span>
<span id="cb43-585"><a href="#cb43-585"></a><span class="co"># Variance decomposition</span></span>
<span id="cb43-586"><a href="#cb43-586"></a>between_var <span class="ot">&lt;-</span> <span class="fu">var</span>(within_var<span class="sc">$</span>mean_holdings, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-587"><a href="#cb43-587"></a>avg_within_var <span class="ot">&lt;-</span> <span class="fu">mean</span>(within_var<span class="sc">$</span>sd_within<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-588"><a href="#cb43-588"></a>total_var <span class="ot">&lt;-</span> <span class="fu">var</span>(tightening<span class="sc">$</span>L1_bank_holdings_pct, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-589"><a href="#cb43-589"></a></span>
<span id="cb43-590"><a href="#cb43-590"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Variance Decomposition ===</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb43-591"><a href="#cb43-591"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Between variance: %.0f%%</span><span class="sc">\n</span><span class="st">"</span>, <span class="dv">100</span> <span class="sc">*</span> between_var <span class="sc">/</span> total_var))</span>
<span id="cb43-592"><a href="#cb43-592"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Within variance:  %.0f%%</span><span class="sc">\n</span><span class="st">"</span>, <span class="dv">100</span> <span class="sc">*</span> avg_within_var <span class="sc">/</span> total_var))</span>
<span id="cb43-593"><a href="#cb43-593"></a><span class="in">```</span></span>
<span id="cb43-594"><a href="#cb43-594"></a></span>
<span id="cb43-595"><a href="#cb43-595"></a><span class="fu">## Standard Error Comparison</span></span>
<span id="cb43-596"><a href="#cb43-596"></a></span>
<span id="cb43-599"><a href="#cb43-599"></a><span class="in">```{r}</span></span>
<span id="cb43-600"><a href="#cb43-600"></a><span class="co">#| label: se-comparison</span></span>
<span id="cb43-601"><a href="#cb43-601"></a><span class="co">#| fig-cap: "Coefficient estimates under different standard error assumptions"</span></span>
<span id="cb43-602"><a href="#cb43-602"></a></span>
<span id="cb43-603"><a href="#cb43-603"></a>m_main <span class="ot">&lt;-</span> <span class="fu">feols</span>(policy_rate <span class="sc">~</span> L1_bank_holdings_pct <span class="sc">|</span> country <span class="sc">+</span> year_quarter,</span>
<span id="cb43-604"><a href="#cb43-604"></a>                <span class="at">data =</span> tightening)</span>
<span id="cb43-605"><a href="#cb43-605"></a></span>
<span id="cb43-606"><a href="#cb43-606"></a>coef_name <span class="ot">&lt;-</span> <span class="st">"L1_bank_holdings_pct"</span></span>
<span id="cb43-607"><a href="#cb43-607"></a>coef_val <span class="ot">&lt;-</span> <span class="fu">coef</span>(m_main)[coef_name]</span>
<span id="cb43-608"><a href="#cb43-608"></a></span>
<span id="cb43-609"><a href="#cb43-609"></a>se_types <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"IID"</span>, <span class="st">"HC1 (Robust)"</span>, <span class="st">"Cluster"</span>)</span>
<span id="cb43-610"><a href="#cb43-610"></a>se_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb43-611"><a href="#cb43-611"></a>  <span class="fu">sqrt</span>(<span class="fu">vcov</span>(m_main, <span class="at">se =</span> <span class="st">"iid"</span>)[coef_name, coef_name]),</span>
<span id="cb43-612"><a href="#cb43-612"></a>  <span class="fu">sqrt</span>(<span class="fu">vcov</span>(m_main, <span class="at">se =</span> <span class="st">"hetero"</span>)[coef_name, coef_name]),</span>
<span id="cb43-613"><a href="#cb43-613"></a>  <span class="fu">sqrt</span>(<span class="fu">vcov</span>(m_main, <span class="at">cluster =</span> <span class="sc">~</span>country)[coef_name, coef_name])</span>
<span id="cb43-614"><a href="#cb43-614"></a>)</span>
<span id="cb43-615"><a href="#cb43-615"></a></span>
<span id="cb43-616"><a href="#cb43-616"></a>se_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb43-617"><a href="#cb43-617"></a>  <span class="at">type =</span> <span class="fu">factor</span>(se_types, <span class="at">levels =</span> se_types),</span>
<span id="cb43-618"><a href="#cb43-618"></a>  <span class="at">se =</span> se_vals,</span>
<span id="cb43-619"><a href="#cb43-619"></a>  <span class="at">lower =</span> coef_val <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se_vals,</span>
<span id="cb43-620"><a href="#cb43-620"></a>  <span class="at">upper =</span> coef_val <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se_vals</span>
<span id="cb43-621"><a href="#cb43-621"></a>)</span>
<span id="cb43-622"><a href="#cb43-622"></a></span>
<span id="cb43-623"><a href="#cb43-623"></a><span class="fu">ggplot</span>(se_df, <span class="fu">aes</span>(<span class="at">x =</span> type, <span class="at">y =</span> coef_val)) <span class="sc">+</span></span>
<span id="cb43-624"><a href="#cb43-624"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb43-625"><a href="#cb43-625"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb43-626"><a href="#cb43-626"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb43-627"><a href="#cb43-627"></a>  <span class="fu">labs</span>(</span>
<span id="cb43-628"><a href="#cb43-628"></a>    <span class="at">title =</span> <span class="st">"Coefficient Under Different SE Assumptions"</span>,</span>
<span id="cb43-629"><a href="#cb43-629"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Point estimate:"</span>, <span class="fu">round</span>(coef_val, <span class="dv">4</span>)),</span>
<span id="cb43-630"><a href="#cb43-630"></a>    <span class="at">x =</span> <span class="st">"Standard Error Type"</span>,</span>
<span id="cb43-631"><a href="#cb43-631"></a>    <span class="at">y =</span> <span class="st">"Coefficient (95% CI)"</span></span>
<span id="cb43-632"><a href="#cb43-632"></a>  ) <span class="sc">+</span></span>
<span id="cb43-633"><a href="#cb43-633"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb43-634"><a href="#cb43-634"></a><span class="in">```</span></span>
<span id="cb43-635"><a href="#cb43-635"></a></span>
<span id="cb43-636"><a href="#cb43-636"></a><span class="fu"># Frequently Asked Questions {.unnumbered}</span></span>
<span id="cb43-637"><a href="#cb43-637"></a></span>
<span id="cb43-638"><a href="#cb43-638"></a>Common conceptual questions when working with panel fixed effects.</span>
<span id="cb43-639"><a href="#cb43-639"></a></span>
<span id="cb43-640"><a href="#cb43-640"></a><span class="fu">## Why not random effects?</span></span>
<span id="cb43-641"><a href="#cb43-641"></a></span>
<span id="cb43-642"><a href="#cb43-642"></a>The Hausman test typically rejects RE in favor of FE in macro panels. More importantly, RE assumes $\text{Cov}(\mathbf{x}_{it}, \alpha_i) = 0$, which is often implausible: units with high values of the regressor may differ systematically from units with low values in ways that affect the outcome. FE is the safer choice when this correlation is likely.</span>
<span id="cb43-643"><a href="#cb43-643"></a></span>
<span id="cb43-644"><a href="#cb43-644"></a><span class="fu">## What if within R² is low?</span></span>
<span id="cb43-645"><a href="#cb43-645"></a></span>
<span id="cb43-646"><a href="#cb43-646"></a>Within $R^2$ in two-way FE models is *supposed* to be low. The overall $R^2$ is often 70%+, with most explained by fixed effects. Within $R^2$ measures how much of the *remaining* variation our regressors explain. In macro panels, a within $R^2$ of 3-8% is normal. Statistical significance of coefficients is what matters for testing hypotheses.</span>
<span id="cb43-647"><a href="#cb43-647"></a></span>
<span id="cb43-648"><a href="#cb43-648"></a><span class="fu">## What about endogeneity?</span></span>
<span id="cb43-649"><a href="#cb43-649"></a></span>
<span id="cb43-650"><a href="#cb43-650"></a>Fixed effects address endogeneity from time-invariant confounders. For time-varying endogeneity, consider:</span>
<span id="cb43-651"><a href="#cb43-651"></a></span>
<span id="cb43-652"><a href="#cb43-652"></a><span class="ss">1. </span>**Instrumental variables** (Module 2)</span>
<span id="cb43-653"><a href="#cb43-653"></a><span class="ss">2. </span>**Placebo tests** in pre-treatment periods</span>
<span id="cb43-654"><a href="#cb43-654"></a><span class="ss">3. </span>**Timing variation** within treated groups</span>
<span id="cb43-655"><a href="#cb43-655"></a><span class="ss">4. </span>**Lagged regressors** (with caution about Nickell bias)</span>
<span id="cb43-656"><a href="#cb43-656"></a></span>
<span id="cb43-657"><a href="#cb43-657"></a><span class="fu"># Summary {.unnumbered}</span></span>
<span id="cb43-658"><a href="#cb43-658"></a></span>
<span id="cb43-659"><a href="#cb43-659"></a>Key takeaways from this module:</span>
<span id="cb43-660"><a href="#cb43-660"></a></span>
<span id="cb43-661"><a href="#cb43-661"></a><span class="ss">1. </span>**Pooled OLS is biased** when unobserved heterogeneity correlates with regressors</span>
<span id="cb43-662"><a href="#cb43-662"></a></span>
<span id="cb43-663"><a href="#cb43-663"></a><span class="ss">2. </span>**FE uses only within-unit variation** — conservative but credible</span>
<span id="cb43-664"><a href="#cb43-664"></a></span>
<span id="cb43-665"><a href="#cb43-665"></a><span class="ss">3. </span>**Two-way FE absorbs global shocks** — your coefficient captures country-specific deviations from global trends</span>
<span id="cb43-666"><a href="#cb43-666"></a></span>
<span id="cb43-667"><a href="#cb43-667"></a><span class="ss">4. </span>**Interactions reveal mechanisms** — the effect of one variable may depend on another</span>
<span id="cb43-668"><a href="#cb43-668"></a></span>
<span id="cb43-669"><a href="#cb43-669"></a><span class="ss">5. </span>**Cluster your standard errors** — IID SEs are too small due to within-country correlation</span>
<span id="cb43-670"><a href="#cb43-670"></a></span>
<span id="cb43-671"><a href="#cb43-671"></a><span class="ss">6. </span>**Low within R² is expected** — the question is whether the mechanism is detectable, not whether it explains all variation</span>
<span id="cb43-672"><a href="#cb43-672"></a></span>
<span id="cb43-673"><a href="#cb43-673"></a>---</span>
<span id="cb43-674"><a href="#cb43-674"></a></span>
<span id="cb43-675"><a href="#cb43-675"></a>*Next: [Module 2: Identification in Macroeconomics](02_identification.qmd)*</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Mastering Empirical Macroeconometrics by Bijoy Ratan Ghosh</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/bijoyratanghosh/empirical-macro-curriculum/edit/main/chapters/01_panel_econometrics.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/bijoyratanghosh/empirical-macro-curriculum/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>