<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Bayesian Vector Autoregressions – Mastering Empirical Macroeconometrics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/09_bayesian_panel.html" rel="next">
<link href="../chapters/07_bayesian_foundations.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-f555ed0e695c0487cf72966c0b30f9ff.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-ec3f846469679b9e6f6b146d88a0bba5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/07_bayesian_foundations.html">Phase 4: Bayesian Econometrics</a></li><li class="breadcrumb-item"><a href="../chapters/08_bayesian_var.html"><span class="chapter-title">Bayesian Vector Autoregressions</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Mastering Empirical Macroeconometrics</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/bijoyratanghosh/empirical-macro-curriculum" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Mastering Empirical Macroeconometrics</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 1: Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01_panel_econometrics.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Panel Data Econometrics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02_identification.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Identification in Macroeconomics</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 2: Dynamic Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03_local_projections.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Local Projections</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04_var_svar.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Vector Autoregressions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 3: Treatment Effects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05_staggered_did.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Staggered Difference-in-Differences</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06_synthetic_control.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Synthetic Control Methods</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 4: Bayesian Econometrics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07_bayesian_foundations.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Bayesian Foundations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08_bayesian_var.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Bayesian Vector Autoregressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09_bayesian_panel.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Bayesian Panel Methods</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 5: Structural Macro</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10_dsge_foundations.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">DSGE Foundations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11_dsge_estimation.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">DSGE Estimation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Phase 6: Causal Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12_regularization.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Regularization for Macro</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13_causal_ml.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Causal Machine Learning</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#why-bayesian-vars" id="toc-why-bayesian-vars" class="nav-link active" data-scroll-target="#why-bayesian-vars">Why Bayesian VARs?</a>
  <ul class="collapse">
  <li><a href="#the-curse-of-dimensionality" id="toc-the-curse-of-dimensionality" class="nav-link" data-scroll-target="#the-curse-of-dimensionality">The Curse of Dimensionality</a></li>
  <li><a href="#the-ols-problem" id="toc-the-ols-problem" class="nav-link" data-scroll-target="#the-ols-problem">The OLS Problem</a></li>
  <li><a href="#the-bayesian-solution-shrinkage" id="toc-the-bayesian-solution-shrinkage" class="nav-link" data-scroll-target="#the-bayesian-solution-shrinkage">The Bayesian Solution: Shrinkage</a></li>
  </ul></li>
  <li><a href="#the-minnesota-prior" id="toc-the-minnesota-prior" class="nav-link" data-scroll-target="#the-minnesota-prior">The Minnesota Prior</a>
  <ul class="collapse">
  <li><a href="#litterman-1986-and-doan-litterman-sims-1984" id="toc-litterman-1986-and-doan-litterman-sims-1984" class="nav-link" data-scroll-target="#litterman-1986-and-doan-litterman-sims-1984">Litterman (1986) and Doan-Litterman-Sims (1984)</a>
  <ul class="collapse">
  <li><a href="#prior-mean" id="toc-prior-mean" class="nav-link" data-scroll-target="#prior-mean">Prior Mean</a></li>
  <li><a href="#prior-variance-the-shrinkage-structure" id="toc-prior-variance-the-shrinkage-structure" class="nav-link" data-scroll-target="#prior-variance-the-shrinkage-structure">Prior Variance (The Shrinkage Structure)</a></li>
  <li><a href="#hyperparameter-interpretation" id="toc-hyperparameter-interpretation" class="nav-link" data-scroll-target="#hyperparameter-interpretation">Hyperparameter Interpretation</a></li>
  </ul></li>
  <li><a href="#the-normal-inverse-wishart-prior" id="toc-the-normal-inverse-wishart-prior" class="nav-link" data-scroll-target="#the-normal-inverse-wishart-prior">The Normal-Inverse-Wishart Prior</a></li>
  </ul></li>
  <li><a href="#glp-data-driven-hyperparameters" id="toc-glp-data-driven-hyperparameters" class="nav-link" data-scroll-target="#glp-data-driven-hyperparameters">GLP: Data-Driven Hyperparameters</a>
  <ul class="collapse">
  <li><a href="#giannone-lenza-primiceri-2015" id="toc-giannone-lenza-primiceri-2015" class="nav-link" data-scroll-target="#giannone-lenza-primiceri-2015">Giannone, Lenza &amp; Primiceri (2015)</a>
  <ul class="collapse">
  <li><a href="#the-algorithm" id="toc-the-algorithm" class="nav-link" data-scroll-target="#the-algorithm">The Algorithm</a></li>
  <li><a href="#why-this-matters" id="toc-why-this-matters" class="nav-link" data-scroll-target="#why-this-matters">Why This Matters</a></li>
  </ul></li>
  <li><a href="#additional-priors-sum-of-coefficients-and-no-cointegration" id="toc-additional-priors-sum-of-coefficients-and-no-cointegration" class="nav-link" data-scroll-target="#additional-priors-sum-of-coefficients-and-no-cointegration">Additional Priors: Sum-of-Coefficients and No-Cointegration</a>
  <ul class="collapse">
  <li><a href="#sum-of-coefficients-doan-litterman-sims" id="toc-sum-of-coefficients-doan-litterman-sims" class="nav-link" data-scroll-target="#sum-of-coefficients-doan-litterman-sims">Sum-of-Coefficients (Doan-Litterman-Sims)</a></li>
  <li><a href="#no-cointegration-sims-zha" id="toc-no-cointegration-sims-zha" class="nav-link" data-scroll-target="#no-cointegration-sims-zha">No-Cointegration (Sims-Zha)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#gibbs-sampling-for-bvar" id="toc-gibbs-sampling-for-bvar" class="nav-link" data-scroll-target="#gibbs-sampling-for-bvar">Gibbs Sampling for BVAR</a>
  <ul class="collapse">
  <li><a href="#the-gibbs-sampler" id="toc-the-gibbs-sampler" class="nav-link" data-scroll-target="#the-gibbs-sampler">The Gibbs Sampler</a></li>
  </ul></li>
  <li><a href="#structural-identification-in-bvar" id="toc-structural-identification-in-bvar" class="nav-link" data-scroll-target="#structural-identification-in-bvar">Structural Identification in BVAR</a>
  <ul class="collapse">
  <li><a href="#cholesky-identification" id="toc-cholesky-identification" class="nav-link" data-scroll-target="#cholesky-identification">Cholesky Identification</a></li>
  <li><a href="#sign-restrictions-in-bvar" id="toc-sign-restrictions-in-bvar" class="nav-link" data-scroll-target="#sign-restrictions-in-bvar">Sign Restrictions in BVAR</a></li>
  </ul></li>
  <li><a href="#irfs-and-fevds-from-posterior" id="toc-irfs-and-fevds-from-posterior" class="nav-link" data-scroll-target="#irfs-and-fevds-from-posterior">IRFs and FEVDs from Posterior</a>
  <ul class="collapse">
  <li><a href="#computing-posterior-irfs" id="toc-computing-posterior-irfs" class="nav-link" data-scroll-target="#computing-posterior-irfs">Computing Posterior IRFs</a></li>
  <li><a href="#forecast-error-variance-decomposition" id="toc-forecast-error-variance-decomposition" class="nav-link" data-scroll-target="#forecast-error-variance-decomposition">Forecast Error Variance Decomposition</a></li>
  </ul></li>
  <li><a href="#implementation-in-r" id="toc-implementation-in-r" class="nav-link" data-scroll-target="#implementation-in-r">Implementation in R</a>
  <ul class="collapse">
  <li><a href="#using-the-bvar-package" id="toc-using-the-bvar-package" class="nav-link" data-scroll-target="#using-the-bvar-package">Using the <code>BVAR</code> Package</a></li>
  <li><a href="#using-the-bvartools-package" id="toc-using-the-bvartools-package" class="nav-link" data-scroll-target="#using-the-bvartools-package">Using the <code>bvartools</code> Package</a></li>
  <li><a href="#manual-implementation" id="toc-manual-implementation" class="nav-link" data-scroll-target="#manual-implementation">Manual Implementation</a></li>
  </ul></li>
  <li><a href="#implementation-in-python" id="toc-implementation-in-python" class="nav-link" data-scroll-target="#implementation-in-python">Implementation in Python</a>
  <ul class="collapse">
  <li><a href="#using-numpyscipy-manual" id="toc-using-numpyscipy-manual" class="nav-link" data-scroll-target="#using-numpyscipy-manual">Using NumPy/SciPy (Manual)</a></li>
  <li><a href="#using-pymc-probabilistic-programming" id="toc-using-pymc-probabilistic-programming" class="nav-link" data-scroll-target="#using-pymc-probabilistic-programming">Using PyMC (Probabilistic Programming)</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a>
  <ul class="collapse">
  <li><a href="#key-references" id="toc-key-references" class="nav-link" data-scroll-target="#key-references">Key References</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/bijoyratanghosh/empirical-macro-curriculum/edit/main/chapters/08_bayesian_var.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/bijoyratanghosh/empirical-macro-curriculum/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/07_bayesian_foundations.html">Phase 4: Bayesian Econometrics</a></li><li class="breadcrumb-item"><a href="../chapters/08_bayesian_var.html"><span class="chapter-title">Bayesian Vector Autoregressions</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">Bayesian Vector Autoregressions</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Shrinkage, Minnesota Priors, and Posterior Inference</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="why-bayesian-vars" class="level1 unnumbered">
<h1 class="unnumbered">Why Bayesian VARs?</h1>
<p>Vector Autoregressions are powerful tools for macroeconomic analysis, but they suffer from a fundamental problem: <strong>too many parameters, too little data</strong>.</p>
<section id="the-curse-of-dimensionality" class="level2">
<h2 class="anchored" data-anchor-id="the-curse-of-dimensionality">The Curse of Dimensionality</h2>
<p>A VAR(p) with K variables has: <span class="math display">\[
\text{Parameters} = K^2 p + K = K(Kp + 1)
\]</span></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Variables (K)</th>
<th>Lags (p)</th>
<th>Parameters</th>
<th>Typical Macro Sample (T=200)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>4</td>
<td>39</td>
<td>OK</td>
</tr>
<tr class="even">
<td>5</td>
<td>4</td>
<td>105</td>
<td>Marginal</td>
</tr>
<tr class="odd">
<td>7</td>
<td>4</td>
<td>203</td>
<td>Problematic</td>
</tr>
<tr class="even">
<td>10</td>
<td>4</td>
<td>410</td>
<td>Unreliable</td>
</tr>
</tbody>
</table>
<p>With quarterly data since 1960, you have ~250 observations. A 7-variable VAR(4) estimates 203 parameters—almost one parameter per observation!</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>param_count <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">K =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">p =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="fu">mutate</span>(<span class="at">params =</span> K <span class="sc">*</span> (K <span class="sc">*</span> p <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">ggplot</span>(param_count, <span class="fu">aes</span>(<span class="at">x =</span> K, <span class="at">y =</span> params, <span class="at">color =</span> <span class="fu">factor</span>(p))) <span class="sc">+</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">11</span>, <span class="at">y =</span> <span class="dv">110</span>, <span class="at">label =</span> <span class="st">"T = 100"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">11</span>, <span class="at">y =</span> <span class="dv">210</span>, <span class="at">label =</span> <span class="st">"T = 200"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"VAR Parameters Explode with System Size"</span>,</span>
<span id="cb1-12"><a href="#cb1-12"></a>       <span class="at">subtitle =</span> <span class="st">"Dashed lines show typical macro sample sizes"</span>,</span>
<span id="cb1-13"><a href="#cb1-13"></a>       <span class="at">x =</span> <span class="st">"Number of Variables (K)"</span>, <span class="at">y =</span> <span class="st">"Number of Parameters"</span>,</span>
<span id="cb1-14"><a href="#cb1-14"></a>       <span class="at">color =</span> <span class="st">"Lags (p)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="08_bayesian_var_files/figure-html/param-explosion-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>The curse of dimensionality in VARs</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="the-ols-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-ols-problem">The OLS Problem</h2>
<p>With many parameters and few observations: - <strong>Overfitting</strong>: In-sample fit is excellent, out-of-sample forecasts are poor - <strong>Imprecision</strong>: Huge standard errors, wide confidence intervals - <strong>Instability</strong>: Small changes in data lead to large changes in estimates</p>
</section>
<section id="the-bayesian-solution-shrinkage" class="level2">
<h2 class="anchored" data-anchor-id="the-bayesian-solution-shrinkage">The Bayesian Solution: Shrinkage</h2>
<p><strong>Key insight</strong>: We have prior beliefs about macroeconomic dynamics. Use them!</p>
<p>Reasonable priors for macro VARs: 1. Variables are <strong>persistent</strong> (close to random walks) 2. <strong>Own lags</strong> matter more than other variables’ lags 3. <strong>Recent lags</strong> matter more than distant lags 4. <strong>Cross-variable effects</strong> are typically small</p>
<p>Bayesian estimation <strong>shrinks</strong> estimates toward these beliefs, reducing variance at the cost of some bias. With many parameters, this variance-bias tradeoff strongly favors shrinkage.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Demonstrate shrinkage benefit</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a>n_sim <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>true_beta <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>n_obs <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co"># OLS estimates (high variance)</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>ols_estimates <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_sim, {</span>
<span id="cb2-9"><a href="#cb2-9"></a>  x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_obs)</span>
<span id="cb2-10"><a href="#cb2-10"></a>  y <span class="ot">&lt;-</span> true_beta <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n_obs, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb2-11"><a href="#cb2-11"></a>  <span class="fu">coef</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb2-12"><a href="#cb2-12"></a>})</span>
<span id="cb2-13"><a href="#cb2-13"></a></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co"># Bayesian estimates with shrinkage prior toward 0</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co"># Prior: beta ~ N(0, 0.5^2)</span></span>
<span id="cb2-16"><a href="#cb2-16"></a>prior_var <span class="ot">&lt;-</span> <span class="fl">0.5</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb2-17"><a href="#cb2-17"></a>bayes_estimates <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_sim, {</span>
<span id="cb2-18"><a href="#cb2-18"></a>  x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_obs)</span>
<span id="cb2-19"><a href="#cb2-19"></a>  y <span class="ot">&lt;-</span> true_beta <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n_obs, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb2-20"><a href="#cb2-20"></a></span>
<span id="cb2-21"><a href="#cb2-21"></a>  <span class="co"># Posterior with known sigma = 2</span></span>
<span id="cb2-22"><a href="#cb2-22"></a>  sigma2 <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb2-23"><a href="#cb2-23"></a>  post_var <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span><span class="sc">/</span>prior_var <span class="sc">+</span> <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>sigma2)</span>
<span id="cb2-24"><a href="#cb2-24"></a>  post_mean <span class="ot">&lt;-</span> post_var <span class="sc">*</span> (<span class="fu">sum</span>(x<span class="sc">*</span>y)<span class="sc">/</span>sigma2)</span>
<span id="cb2-25"><a href="#cb2-25"></a>  post_mean</span>
<span id="cb2-26"><a href="#cb2-26"></a>})</span>
<span id="cb2-27"><a href="#cb2-27"></a></span>
<span id="cb2-28"><a href="#cb2-28"></a>estimates_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2-29"><a href="#cb2-29"></a>  <span class="at">estimate =</span> <span class="fu">c</span>(ols_estimates, bayes_estimates),</span>
<span id="cb2-30"><a href="#cb2-30"></a>  <span class="at">method =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"OLS (no shrinkage)"</span>, <span class="st">"Bayesian (shrinkage)"</span>), <span class="at">each =</span> n_sim)</span>
<span id="cb2-31"><a href="#cb2-31"></a>)</span>
<span id="cb2-32"><a href="#cb2-32"></a></span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="fu">ggplot</span>(estimates_df, <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">fill =</span> method)) <span class="sc">+</span></span>
<span id="cb2-34"><a href="#cb2-34"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb2-35"><a href="#cb2-35"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> true_beta, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-36"><a href="#cb2-36"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> true_beta <span class="sc">+</span> <span class="fl">0.1</span>, <span class="at">y =</span> <span class="fl">1.5</span>,</span>
<span id="cb2-37"><a href="#cb2-37"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"True β = "</span>, true_beta), <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb2-38"><a href="#cb2-38"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"OLS (no shrinkage)"</span> <span class="ot">=</span> <span class="st">"#e74c3c"</span>,</span>
<span id="cb2-39"><a href="#cb2-39"></a>                                <span class="st">"Bayesian (shrinkage)"</span> <span class="ot">=</span> <span class="st">"#3498db"</span>)) <span class="sc">+</span></span>
<span id="cb2-40"><a href="#cb2-40"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shrinkage Reduces Estimation Variance"</span>,</span>
<span id="cb2-41"><a href="#cb2-41"></a>       <span class="at">subtitle =</span> <span class="st">"Bayesian estimates cluster closer to truth despite small bias"</span>,</span>
<span id="cb2-42"><a href="#cb2-42"></a>       <span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(beta)), <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb2-43"><a href="#cb2-43"></a>       <span class="at">fill =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb2-44"><a href="#cb2-44"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="08_bayesian_var_files/figure-html/shrinkage-intuition-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Shrinkage reduces variance at the cost of small bias</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="the-minnesota-prior" class="level1 unnumbered">
<h1 class="unnumbered">The Minnesota Prior</h1>
<section id="litterman-1986-and-doan-litterman-sims-1984" class="level2">
<h2 class="anchored" data-anchor-id="litterman-1986-and-doan-litterman-sims-1984">Litterman (1986) and Doan-Litterman-Sims (1984)</h2>
<p>The <strong>Minnesota prior</strong> is the workhorse prior for macroeconomic BVARs. It encodes the belief that macro variables behave approximately like random walks.</p>
<section id="prior-mean" class="level3">
<h3 class="anchored" data-anchor-id="prior-mean">Prior Mean</h3>
<p>For variables in <strong>levels</strong> (GDP, prices, etc.):</p>
<p><span class="math display">\[
E[A_1] = I_K, \quad E[A_j] = 0 \text{ for } j &gt; 1
\]</span></p>
<p>Each variable’s first own lag coefficient is centered at 1 (random walk), all other coefficients at 0.</p>
<p>For <strong>stationary</strong> variables (growth rates, spreads):</p>
<p><span class="math display">\[
E[A_j] = 0 \text{ for all } j
\]</span></p>
</section>
<section id="prior-variance-the-shrinkage-structure" class="level3">
<h3 class="anchored" data-anchor-id="prior-variance-the-shrinkage-structure">Prior Variance (The Shrinkage Structure)</h3>
<p>The key innovation is the <strong>structured prior variance</strong>:</p>
<p><strong>Own lag <span class="math inline">\(l\)</span> of variable <span class="math inline">\(i\)</span></strong>: <span class="math display">\[
\text{Var}(a_{ii,l}) = \left(\frac{\lambda_1}{l^d}\right)^2
\]</span></p>
<p><strong>Cross lag <span class="math inline">\(l\)</span> of variable <span class="math inline">\(j\)</span> on equation <span class="math inline">\(i\)</span></strong>: <span class="math display">\[
\text{Var}(a_{ij,l}) = \left(\frac{\lambda_1 \cdot \lambda_2 \cdot \sigma_i}{l^d \cdot \sigma_j}\right)^2
\]</span></p>
<p><strong>Constant term</strong>: <span class="math display">\[
\text{Var}(c_i) = (\lambda_1 \cdot \lambda_3)^2
\]</span></p>
<p>where: - <span class="math inline">\(\sigma_i\)</span> = residual std from univariate AR(p) of variable <span class="math inline">\(i\)</span> - <span class="math inline">\(\lambda_1\)</span> = <strong>overall tightness</strong> (controls shrinkage strength) - <span class="math inline">\(\lambda_2\)</span> = <strong>cross-variable shrinkage</strong> (typically &lt; 1) - <span class="math inline">\(\lambda_3\)</span> = <strong>constant tightness</strong> (typically large, ~100) - <span class="math inline">\(d\)</span> = <strong>lag decay</strong> (typically 1 or 2)</p>
</section>
<section id="hyperparameter-interpretation" class="level3">
<h3 class="anchored" data-anchor-id="hyperparameter-interpretation">Hyperparameter Interpretation</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Typical Range</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\lambda_1\)</span></td>
<td>0.1 - 0.5</td>
<td>Smaller → more shrinkage toward prior</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\lambda_2\)</span></td>
<td>0.3 - 0.5</td>
<td>Smaller → own lags dominate cross effects</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\lambda_3\)</span></td>
<td>100</td>
<td>Large → loose prior on constant</td>
</tr>
<tr class="even">
<td><span class="math inline">\(d\)</span></td>
<td>1 or 2</td>
<td>Larger → faster decay for distant lags</td>
</tr>
</tbody>
</table>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Illustrate Minnesota prior variance structure</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>K <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>p <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>lambda1 <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>lambda2 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>d <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co"># Prior variance for different coefficient types</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>lags <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>p</span>
<span id="cb3-10"><a href="#cb3-10"></a>own_var <span class="ot">&lt;-</span> (lambda1 <span class="sc">/</span> lags<span class="sc">^</span>d)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>cross_var <span class="ot">&lt;-</span> (lambda1 <span class="sc">*</span> lambda2 <span class="sc">/</span> lags<span class="sc">^</span>d)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a>var_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-14"><a href="#cb3-14"></a>  <span class="at">lag =</span> <span class="fu">rep</span>(lags, <span class="dv">2</span>),</span>
<span id="cb3-15"><a href="#cb3-15"></a>  <span class="at">variance =</span> <span class="fu">c</span>(own_var, cross_var),</span>
<span id="cb3-16"><a href="#cb3-16"></a>  <span class="at">type =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Own lag"</span>, <span class="st">"Cross lag"</span>), <span class="at">each =</span> p)</span>
<span id="cb3-17"><a href="#cb3-17"></a>)</span>
<span id="cb3-18"><a href="#cb3-18"></a></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="fu">ggplot</span>(var_df, <span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> <span class="fu">sqrt</span>(variance), <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Own lag"</span> <span class="ot">=</span> <span class="st">"#3498db"</span>, <span class="st">"Cross lag"</span> <span class="ot">=</span> <span class="st">"#e74c3c"</span>)) <span class="sc">+</span></span>
<span id="cb3-23"><a href="#cb3-23"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Minnesota Prior: Standard Deviation by Lag"</span>,</span>
<span id="cb3-24"><a href="#cb3-24"></a>       <span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(lambda[<span class="dv">1</span>], <span class="st">" = 0.2, "</span>, lambda[<span class="dv">2</span>], <span class="st">" = 0.5, d = 1"</span>)),</span>
<span id="cb3-25"><a href="#cb3-25"></a>       <span class="at">x =</span> <span class="st">"Lag"</span>, <span class="at">y =</span> <span class="st">"Prior Standard Deviation"</span>,</span>
<span id="cb3-26"><a href="#cb3-26"></a>       <span class="at">color =</span> <span class="st">"Coefficient Type"</span>) <span class="sc">+</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="08_bayesian_var_files/figure-html/minnesota-variance-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Minnesota prior variance structure</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="the-normal-inverse-wishart-prior" class="level2">
<h2 class="anchored" data-anchor-id="the-normal-inverse-wishart-prior">The Normal-Inverse-Wishart Prior</h2>
<p>The Minnesota prior is typically implemented as a <strong>Normal-Inverse-Wishart (NIW)</strong> prior:</p>
<p><span class="math display">\[
\begin{aligned}
\text{vec}(B) | \Sigma &amp;\sim N(\text{vec}(B_0), \Sigma \otimes V_0) \\
\Sigma &amp;\sim \text{Inverse-Wishart}(S_0, \nu_0)
\end{aligned}
\]</span></p>
<p>This is <strong>conjugate</strong>: the posterior has the same form with updated parameters.</p>
<p><strong>Posterior</strong>: <span class="math display">\[
\begin{aligned}
V_{\text{post}} &amp;= (V_0^{-1} + X'X)^{-1} \\
B_{\text{post}} &amp;= V_{\text{post}}(V_0^{-1} B_0 + X'Y) \\
\nu_{\text{post}} &amp;= \nu_0 + T \\
S_{\text{post}} &amp;= S_0 + (Y - XB_{\text{post}})'(Y - XB_{\text{post}}) + (B_{\text{post}} - B_0)'V_0^{-1}(B_{\text{post}} - B_0)
\end{aligned}
\]</span></p>
</section>
</section>
<section id="glp-data-driven-hyperparameters" class="level1 unnumbered">
<h1 class="unnumbered">GLP: Data-Driven Hyperparameters</h1>
<section id="giannone-lenza-primiceri-2015" class="level2">
<h2 class="anchored" data-anchor-id="giannone-lenza-primiceri-2015">Giannone, Lenza &amp; Primiceri (2015)</h2>
<p>How do we choose <span class="math inline">\(\lambda_1, \lambda_2\)</span>? The traditional approach: researcher judgment or cross-validation.</p>
<p><strong>GLP innovation</strong>: Choose hyperparameters by <strong>maximizing the marginal likelihood</strong>:</p>
<p><span class="math display">\[
p(Y | \lambda) = \int p(Y | B, \Sigma) \cdot p(B, \Sigma | \lambda) \, dB \, d\Sigma
\]</span></p>
<p>For the NIW prior, this integral has a <strong>closed-form solution</strong>!</p>
<section id="the-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="the-algorithm">The Algorithm</h3>
<ol type="1">
<li>Define a grid over <span class="math inline">\(\lambda = (\lambda_1, \lambda_2, \ldots)\)</span></li>
<li>For each <span class="math inline">\(\lambda\)</span>, compute <span class="math inline">\(p(Y | \lambda)\)</span> analytically</li>
<li>Choose <span class="math inline">\(\lambda^* = \arg\max_\lambda p(Y | \lambda)\)</span></li>
<li>Estimate BVAR with optimal hyperparameters</li>
</ol>
</section>
<section id="why-this-matters" class="level3">
<h3 class="anchored" data-anchor-id="why-this-matters">Why This Matters</h3>
<ul>
<li><strong>Data-driven</strong>: No arbitrary hyperparameter choices</li>
<li><strong>Automatic</strong>: Adapts to different datasets</li>
<li><strong>Forecast accuracy</strong>: GLP BVARs consistently outperform OLS VARs</li>
</ul>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Illustrate marginal likelihood as function of lambda</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># (Simulated for illustration)</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>lambda_grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">50</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co"># Simulated marginal likelihood (realistic shape)</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb4-7"><a href="#cb4-7"></a>ml_values <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">50</span> <span class="sc">-</span> <span class="dv">20</span><span class="sc">*</span>(lambda_grid <span class="sc">-</span> <span class="fl">0.25</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb4-8"><a href="#cb4-8"></a></span>
<span id="cb4-9"><a href="#cb4-9"></a>ml_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lambda =</span> lambda_grid, <span class="at">log_ml =</span> ml_values)</span>
<span id="cb4-10"><a href="#cb4-10"></a>optimal_lambda <span class="ot">&lt;-</span> lambda_grid[<span class="fu">which.max</span>(ml_values)]</span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="fu">ggplot</span>(ml_df, <span class="fu">aes</span>(<span class="at">x =</span> lambda, <span class="at">y =</span> log_ml)) <span class="sc">+</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"#3498db"</span>) <span class="sc">+</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> optimal_lambda, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb4-15"><a href="#cb4-15"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> optimal_lambda, <span class="at">y =</span> <span class="fu">max</span>(ml_values),</span>
<span id="cb4-16"><a href="#cb4-16"></a>           <span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> optimal_lambda <span class="sc">+</span> <span class="fl">0.05</span>, <span class="at">y =</span> <span class="fu">max</span>(ml_values) <span class="sc">-</span> <span class="dv">5</span>,</span>
<span id="cb4-18"><a href="#cb4-18"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"λ* = "</span>, <span class="fu">round</span>(optimal_lambda, <span class="dv">2</span>)), <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb4-19"><a href="#cb4-19"></a>           <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb4-20"><a href="#cb4-20"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"GLP: Marginal Likelihood Optimization"</span>,</span>
<span id="cb4-21"><a href="#cb4-21"></a>       <span class="at">subtitle =</span> <span class="st">"Optimal shrinkage is data-determined"</span>,</span>
<span id="cb4-22"><a href="#cb4-22"></a>       <span class="at">x =</span> <span class="fu">expression</span>(lambda[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"(Overall Tightness)"</span>),</span>
<span id="cb4-23"><a href="#cb4-23"></a>       <span class="at">y =</span> <span class="st">"Log Marginal Likelihood"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="08_bayesian_var_files/figure-html/glp-illustration-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>GLP marginal likelihood optimization</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="additional-priors-sum-of-coefficients-and-no-cointegration" class="level2">
<h2 class="anchored" data-anchor-id="additional-priors-sum-of-coefficients-and-no-cointegration">Additional Priors: Sum-of-Coefficients and No-Cointegration</h2>
<p>GLP (2015) also optimizes over additional priors that improve forecasting:</p>
<section id="sum-of-coefficients-doan-litterman-sims" class="level3">
<h3 class="anchored" data-anchor-id="sum-of-coefficients-doan-litterman-sims">Sum-of-Coefficients (Doan-Litterman-Sims)</h3>
<p>Belief: If all variables equal their sample means, the forecast should also be the mean.</p>
<p>Implemented by adding dummy observations. Controlled by hyperparameter <span class="math inline">\(\mu\)</span>.</p>
</section>
<section id="no-cointegration-sims-zha" class="level3">
<h3 class="anchored" data-anchor-id="no-cointegration-sims-zha">No-Cointegration (Sims-Zha)</h3>
<p>Belief: Variables have unit roots but are not cointegrated.</p>
<p>Also implemented via dummy observations. Controlled by hyperparameter <span class="math inline">\(\delta\)</span>.</p>
<p><strong>GLP jointly optimizes</strong> <span class="math inline">\((\lambda_1, \lambda_2, \mu, \delta)\)</span> via marginal likelihood.</p>
</section>
</section>
</section>
<section id="gibbs-sampling-for-bvar" class="level1 unnumbered">
<h1 class="unnumbered">Gibbs Sampling for BVAR</h1>
<p>While the NIW prior allows analytical posteriors, we often use <strong>Gibbs sampling</strong> to: - Easily compute posterior quantities (IRFs, FEVDs) - Extend to non-conjugate priors - Handle structural identification</p>
<section id="the-gibbs-sampler" class="level2">
<h2 class="anchored" data-anchor-id="the-gibbs-sampler">The Gibbs Sampler</h2>
<p><strong>Block 1</strong>: Draw <span class="math inline">\(B | \Sigma, Y\)</span> <span class="math display">\[
\text{vec}(B) | \Sigma, Y \sim N(\text{vec}(B_{\text{post}}), \Sigma \otimes V_{\text{post}})
\]</span></p>
<p><strong>Block 2</strong>: Draw <span class="math inline">\(\Sigma | B, Y\)</span> <span class="math display">\[
\Sigma | B, Y \sim \text{Inverse-Wishart}(S_{\text{post}}, \nu_{\text{post}})
\]</span></p>
<p>Iterate for <span class="math inline">\(G\)</span> draws, discarding the first <span class="math inline">\(B_{\text{burn}}\)</span> as burn-in.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Simplified BVAR Gibbs sampler demonstration</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># Generate synthetic VAR(1) data</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>T_obs <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>K <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb5-5"><a href="#cb5-5"></a></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co"># True parameters</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>A_true <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>, <span class="fl">0.7</span>), K, K)</span>
<span id="cb5-8"><a href="#cb5-8"></a>Sigma_true <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="dv">1</span>), K, K)</span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co"># Generate data</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>Y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, T_obs, K)</span>
<span id="cb5-12"><a href="#cb5-12"></a>Y[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(K)</span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>T_obs) {</span>
<span id="cb5-14"><a href="#cb5-14"></a>  Y[t, ] <span class="ot">&lt;-</span> Y[t<span class="dv">-1</span>, ] <span class="sc">%*%</span> <span class="fu">t</span>(A_true) <span class="sc">+</span> <span class="fu">rmvnorm</span>(<span class="dv">1</span>, <span class="at">sigma =</span> Sigma_true)</span>
<span id="cb5-15"><a href="#cb5-15"></a>}</span>
<span id="cb5-16"><a href="#cb5-16"></a></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="co"># Build matrices</span></span>
<span id="cb5-18"><a href="#cb5-18"></a>y <span class="ot">&lt;-</span> Y[<span class="dv">2</span><span class="sc">:</span>T_obs, ]</span>
<span id="cb5-19"><a href="#cb5-19"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, Y[<span class="dv">1</span><span class="sc">:</span>(T_obs<span class="dv">-1</span>), ])</span>
<span id="cb5-20"><a href="#cb5-20"></a>T_eff <span class="ot">&lt;-</span> <span class="fu">nrow</span>(y)</span>
<span id="cb5-21"><a href="#cb5-21"></a>M <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb5-22"><a href="#cb5-22"></a></span>
<span id="cb5-23"><a href="#cb5-23"></a><span class="co"># Minnesota-style prior</span></span>
<span id="cb5-24"><a href="#cb5-24"></a>B0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, M, K)</span>
<span id="cb5-25"><a href="#cb5-25"></a>B0[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, ] <span class="ot">&lt;-</span> <span class="fu">diag</span>(K) <span class="sc">*</span> <span class="fl">0.9</span>  <span class="co"># Prior: close to random walk</span></span>
<span id="cb5-26"><a href="#cb5-26"></a></span>
<span id="cb5-27"><a href="#cb5-27"></a><span class="co"># Prior precision (diagonal, tight) - must be (M*K) x (M*K) for vec(B)</span></span>
<span id="cb5-28"><a href="#cb5-28"></a>lambda1 <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb5-29"><a href="#cb5-29"></a><span class="co"># Build prior variance for each coefficient in vec(B)</span></span>
<span id="cb5-30"><a href="#cb5-30"></a><span class="co"># Structure: [const_eq1, y1_eq1, y2_eq1, const_eq2, y1_eq2, y2_eq2]</span></span>
<span id="cb5-31"><a href="#cb5-31"></a>v0_diag <span class="ot">&lt;-</span> <span class="fu">numeric</span>(M <span class="sc">*</span> K)</span>
<span id="cb5-32"><a href="#cb5-32"></a><span class="cf">for</span> (eq <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K) {</span>
<span id="cb5-33"><a href="#cb5-33"></a>  idx_const <span class="ot">&lt;-</span> (eq <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> M <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb5-34"><a href="#cb5-34"></a>  v0_diag[idx_const] <span class="ot">&lt;-</span> <span class="dv">100</span>  <span class="co"># Loose prior on constant</span></span>
<span id="cb5-35"><a href="#cb5-35"></a>  <span class="cf">for</span> (var <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K) {</span>
<span id="cb5-36"><a href="#cb5-36"></a>    idx_var <span class="ot">&lt;-</span> (eq <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> M <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> var</span>
<span id="cb5-37"><a href="#cb5-37"></a>    v0_diag[idx_var] <span class="ot">&lt;-</span> lambda1<span class="sc">^</span><span class="dv">2</span>  <span class="co"># Tight prior on AR coefficients</span></span>
<span id="cb5-38"><a href="#cb5-38"></a>  }</span>
<span id="cb5-39"><a href="#cb5-39"></a>}</span>
<span id="cb5-40"><a href="#cb5-40"></a>V0_inv <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span> <span class="sc">/</span> v0_diag)</span>
<span id="cb5-41"><a href="#cb5-41"></a></span>
<span id="cb5-42"><a href="#cb5-42"></a><span class="co"># Prior for Sigma</span></span>
<span id="cb5-43"><a href="#cb5-43"></a>nu0 <span class="ot">&lt;-</span> K <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb5-44"><a href="#cb5-44"></a>S0 <span class="ot">&lt;-</span> <span class="fu">diag</span>(K)</span>
<span id="cb5-45"><a href="#cb5-45"></a></span>
<span id="cb5-46"><a href="#cb5-46"></a><span class="co"># Gibbs sampler</span></span>
<span id="cb5-47"><a href="#cb5-47"></a>n_draw <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb5-48"><a href="#cb5-48"></a>n_burn <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb5-49"><a href="#cb5-49"></a>B_draws <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(M, K, n_draw))</span>
<span id="cb5-50"><a href="#cb5-50"></a>Sigma_draws <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(K, K, n_draw))</span>
<span id="cb5-51"><a href="#cb5-51"></a></span>
<span id="cb5-52"><a href="#cb5-52"></a><span class="co"># Initialize</span></span>
<span id="cb5-53"><a href="#cb5-53"></a>B_curr <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">crossprod</span>(X)) <span class="sc">%*%</span> <span class="fu">crossprod</span>(X, y)</span>
<span id="cb5-54"><a href="#cb5-54"></a>Sigma_curr <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(y <span class="sc">-</span> X <span class="sc">%*%</span> B_curr) <span class="sc">/</span> T_eff</span>
<span id="cb5-55"><a href="#cb5-55"></a></span>
<span id="cb5-56"><a href="#cb5-56"></a><span class="cf">for</span> (g <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n_draw <span class="sc">+</span> n_burn)) {</span>
<span id="cb5-57"><a href="#cb5-57"></a>  <span class="co"># Draw B | Sigma using vectorized form</span></span>
<span id="cb5-58"><a href="#cb5-58"></a>  <span class="co"># vec(B) | Sigma ~ N(b_post, V_post) where V_post = (V0_inv + Sigma^{-1} ⊗ X'X)^{-1}</span></span>
<span id="cb5-59"><a href="#cb5-59"></a>  Sigma_inv <span class="ot">&lt;-</span> <span class="fu">solve</span>(Sigma_curr)</span>
<span id="cb5-60"><a href="#cb5-60"></a>  V_post_inv <span class="ot">&lt;-</span> V0_inv <span class="sc">+</span> <span class="fu">kronecker</span>(Sigma_inv, <span class="fu">crossprod</span>(X))</span>
<span id="cb5-61"><a href="#cb5-61"></a>  V_post <span class="ot">&lt;-</span> <span class="fu">solve</span>(V_post_inv)</span>
<span id="cb5-62"><a href="#cb5-62"></a>  b_post <span class="ot">&lt;-</span> V_post <span class="sc">%*%</span> (V0_inv <span class="sc">%*%</span> <span class="fu">as.vector</span>(B0) <span class="sc">+</span></span>
<span id="cb5-63"><a href="#cb5-63"></a>                         <span class="fu">kronecker</span>(Sigma_inv, <span class="fu">t</span>(X)) <span class="sc">%*%</span> <span class="fu">as.vector</span>(y))</span>
<span id="cb5-64"><a href="#cb5-64"></a>  B_curr <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rmvnorm</span>(<span class="dv">1</span>, b_post, V_post), M, K)</span>
<span id="cb5-65"><a href="#cb5-65"></a></span>
<span id="cb5-66"><a href="#cb5-66"></a>  <span class="co"># Draw Sigma | B</span></span>
<span id="cb5-67"><a href="#cb5-67"></a>  U <span class="ot">&lt;-</span> y <span class="sc">-</span> X <span class="sc">%*%</span> B_curr</span>
<span id="cb5-68"><a href="#cb5-68"></a>  S_post <span class="ot">&lt;-</span> S0 <span class="sc">+</span> <span class="fu">crossprod</span>(U)</span>
<span id="cb5-69"><a href="#cb5-69"></a>  Sigma_curr <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">rWishart</span>(<span class="dv">1</span>, nu0 <span class="sc">+</span> T_eff, <span class="fu">solve</span>(S_post))[,,<span class="dv">1</span>])</span>
<span id="cb5-70"><a href="#cb5-70"></a></span>
<span id="cb5-71"><a href="#cb5-71"></a>  <span class="co"># Store</span></span>
<span id="cb5-72"><a href="#cb5-72"></a>  <span class="cf">if</span> (g <span class="sc">&gt;</span> n_burn) {</span>
<span id="cb5-73"><a href="#cb5-73"></a>    B_draws[,,g <span class="sc">-</span> n_burn] <span class="ot">&lt;-</span> B_curr</span>
<span id="cb5-74"><a href="#cb5-74"></a>    Sigma_draws[,,g <span class="sc">-</span> n_burn] <span class="ot">&lt;-</span> Sigma_curr</span>
<span id="cb5-75"><a href="#cb5-75"></a>  }</span>
<span id="cb5-76"><a href="#cb5-76"></a>}</span>
<span id="cb5-77"><a href="#cb5-77"></a></span>
<span id="cb5-78"><a href="#cb5-78"></a><span class="co"># Trace plot for A[1,1]</span></span>
<span id="cb5-79"><a href="#cb5-79"></a>trace_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb5-80"><a href="#cb5-80"></a>  <span class="at">iteration =</span> <span class="dv">1</span><span class="sc">:</span>n_draw,</span>
<span id="cb5-81"><a href="#cb5-81"></a>  <span class="at">value =</span> B_draws[<span class="dv">2</span>, <span class="dv">1</span>, ]  <span class="co"># A[1,1] coefficient</span></span>
<span id="cb5-82"><a href="#cb5-82"></a>)</span>
<span id="cb5-83"><a href="#cb5-83"></a></span>
<span id="cb5-84"><a href="#cb5-84"></a><span class="fu">ggplot</span>(trace_df, <span class="fu">aes</span>(<span class="at">x =</span> iteration, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb5-85"><a href="#cb5-85"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"#3498db"</span>) <span class="sc">+</span></span>
<span id="cb5-86"><a href="#cb5-86"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> A_true[<span class="dv">1</span>,<span class="dv">1</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb5-87"><a href="#cb5-87"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(trace_df<span class="sc">$</span>value), <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">color =</span> <span class="st">"#2ecc71"</span>) <span class="sc">+</span></span>
<span id="cb5-88"><a href="#cb5-88"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> n_draw <span class="sc">*</span> <span class="fl">0.8</span>, <span class="at">y =</span> A_true[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">0.05</span>,</span>
<span id="cb5-89"><a href="#cb5-89"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"True = "</span>, A_true[<span class="dv">1</span>,<span class="dv">1</span>]), <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb5-90"><a href="#cb5-90"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gibbs Sampler: Trace Plot for VAR Coefficient"</span>,</span>
<span id="cb5-91"><a href="#cb5-91"></a>       <span class="at">subtitle =</span> <span class="st">"Green = posterior mean, Red = true value"</span>,</span>
<span id="cb5-92"><a href="#cb5-92"></a>       <span class="at">x =</span> <span class="st">"Iteration (post burn-in)"</span>, <span class="at">y =</span> <span class="fu">expression</span>(A[<span class="dv">11</span>]))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="08_bayesian_var_files/figure-html/gibbs-bvar-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Gibbs sampler trace plots for BVAR coefficient</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="structural-identification-in-bvar" class="level1 unnumbered">
<h1 class="unnumbered">Structural Identification in BVAR</h1>
<p>Bayesian VARs estimate <strong>reduced-form</strong> parameters <span class="math inline">\((B, \Sigma)\)</span>. For structural analysis, we need to identify structural shocks.</p>
<section id="cholesky-identification" class="level2">
<h2 class="anchored" data-anchor-id="cholesky-identification">Cholesky Identification</h2>
<p>The simplest approach: impose a recursive structure.</p>
<p><span class="math display">\[
\Sigma = PP', \quad P = \text{chol}(\Sigma, \text{lower})
\]</span></p>
<p>For each posterior draw <span class="math inline">\(\Sigma^{(g)}\)</span>, compute <span class="math inline">\(P^{(g)} = \text{chol}(\Sigma^{(g)})\)</span>.</p>
<p>The ordering matters: variable ordered first is not affected contemporaneously by others.</p>
</section>
<section id="sign-restrictions-in-bvar" class="level2">
<h2 class="anchored" data-anchor-id="sign-restrictions-in-bvar">Sign Restrictions in BVAR</h2>
<p>Bayesian framework naturally handles set-identification:</p>
<ol type="1">
<li>For each posterior draw <span class="math inline">\((B^{(g)}, \Sigma^{(g)})\)</span>:
<ol type="a">
<li>Compute <span class="math inline">\(P^{(g)} = \text{chol}(\Sigma^{(g)})\)</span></li>
<li>Draw orthogonal rotation <span class="math inline">\(Q\)</span> uniformly</li>
<li>Candidate impact: <span class="math inline">\(\tilde{P}^{(g)} = P^{(g)} Q\)</span></li>
<li>Check sign restrictions on IRFs</li>
<li>If satisfied: keep. Otherwise: redraw <span class="math inline">\(Q\)</span></li>
</ol></li>
<li>Report distribution across accepted draws</li>
</ol>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Sign restriction: monetary tightening</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co"># - Raises interest rate (positive)</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co"># - Lowers output (negative)</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># - Lowers inflation (negative)</span></span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a>restrictions <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="at">Variable =</span> <span class="fu">c</span>(<span class="st">"Interest Rate"</span>, <span class="st">"Output"</span>, <span class="st">"Inflation"</span>),</span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="at">Sign =</span> <span class="fu">c</span>(<span class="st">"+"</span>, <span class="st">"-"</span>, <span class="st">"-"</span>),</span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="at">Interpretation =</span> <span class="fu">c</span>(<span class="st">"Policy instrument"</span>, <span class="st">"Demand falls"</span>, <span class="st">"Prices fall"</span>)</span>
<span id="cb6-10"><a href="#cb6-10"></a>)</span>
<span id="cb6-11"><a href="#cb6-11"></a></span>
<span id="cb6-12"><a href="#cb6-12"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(restrictions,</span>
<span id="cb6-13"><a href="#cb6-13"></a>             <span class="at">caption =</span> <span class="st">"Example Sign Restrictions for Monetary Policy Shock"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Example Sign Restrictions for Monetary Policy Shock</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Sign</th>
<th style="text-align: left;">Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Interest Rate</td>
<td style="text-align: left;">+</td>
<td style="text-align: left;">Policy instrument</td>
</tr>
<tr class="even">
<td style="text-align: left;">Output</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Demand falls</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Inflation</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Prices fall</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="irfs-and-fevds-from-posterior" class="level1 unnumbered">
<h1 class="unnumbered">IRFs and FEVDs from Posterior</h1>
<section id="computing-posterior-irfs" class="level2">
<h2 class="anchored" data-anchor-id="computing-posterior-irfs">Computing Posterior IRFs</h2>
<p>For each posterior draw <span class="math inline">\((B^{(g)}, \Sigma^{(g)})\)</span>:</p>
<ol type="1">
<li>Extract coefficient matrices <span class="math inline">\(A_1^{(g)}, \ldots, A_p^{(g)}\)</span> from <span class="math inline">\(B^{(g)}\)</span></li>
<li>Compute structural impact <span class="math inline">\(P^{(g)}\)</span> (Cholesky or sign-restricted)</li>
<li>Compute IRF at each horizon using MA representation: <span class="math display">\[
\Phi_h = \sum_{j=1}^{\min(h,p)} \Phi_{h-j} A_j, \quad \Phi_0 = I
\]</span></li>
<li>Structural IRF: <span class="math inline">\(\text{IRF}_h = \Phi_h P\)</span></li>
</ol>
<p>Report <strong>posterior median</strong> and <strong>credible bands</strong> (68%, 95%).</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Compute IRFs from Gibbs draws</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>H <span class="ot">&lt;-</span> <span class="dv">20</span>  <span class="co"># horizons</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>K <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>n_draws_use <span class="ot">&lt;-</span> <span class="dv">500</span>  <span class="co"># use subset for speed</span></span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a>IRF_draws <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(K, K, H<span class="sc">+</span><span class="dv">1</span>, n_draws_use))</span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="cf">for</span> (g <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_draws_use) {</span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="co"># Extract A matrix (coefficients on lagged Y)</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>  A1 <span class="ot">&lt;-</span> <span class="fu">t</span>(B_draws[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, , g])</span>
<span id="cb7-11"><a href="#cb7-11"></a></span>
<span id="cb7-12"><a href="#cb7-12"></a>  <span class="co"># Cholesky impact</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>  P <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">chol</span>(Sigma_draws[,,g]))</span>
<span id="cb7-14"><a href="#cb7-14"></a></span>
<span id="cb7-15"><a href="#cb7-15"></a>  <span class="co"># Compute IRFs</span></span>
<span id="cb7-16"><a href="#cb7-16"></a>  Phi <span class="ot">&lt;-</span> <span class="fu">diag</span>(K)</span>
<span id="cb7-17"><a href="#cb7-17"></a>  IRF_draws[,,<span class="dv">1</span>,g] <span class="ot">&lt;-</span> P</span>
<span id="cb7-18"><a href="#cb7-18"></a></span>
<span id="cb7-19"><a href="#cb7-19"></a>  <span class="cf">for</span> (h <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>H) {</span>
<span id="cb7-20"><a href="#cb7-20"></a>    Phi <span class="ot">&lt;-</span> Phi <span class="sc">%*%</span> A1</span>
<span id="cb7-21"><a href="#cb7-21"></a>    IRF_draws[,,h<span class="sc">+</span><span class="dv">1</span>,g] <span class="ot">&lt;-</span> Phi <span class="sc">%*%</span> P</span>
<span id="cb7-22"><a href="#cb7-22"></a>  }</span>
<span id="cb7-23"><a href="#cb7-23"></a>}</span>
<span id="cb7-24"><a href="#cb7-24"></a></span>
<span id="cb7-25"><a href="#cb7-25"></a><span class="co"># Extract IRF of variable 1 to shock 1</span></span>
<span id="cb7-26"><a href="#cb7-26"></a>irf_11 <span class="ot">&lt;-</span> IRF_draws[<span class="dv">1</span>, <span class="dv">1</span>, , ]</span>
<span id="cb7-27"><a href="#cb7-27"></a></span>
<span id="cb7-28"><a href="#cb7-28"></a><span class="co"># Posterior summaries</span></span>
<span id="cb7-29"><a href="#cb7-29"></a>irf_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(irf_11, <span class="dv">1</span>, median)</span>
<span id="cb7-30"><a href="#cb7-30"></a>irf_lower <span class="ot">&lt;-</span> <span class="fu">apply</span>(irf_11, <span class="dv">1</span>, quantile, <span class="fl">0.16</span>)</span>
<span id="cb7-31"><a href="#cb7-31"></a>irf_upper <span class="ot">&lt;-</span> <span class="fu">apply</span>(irf_11, <span class="dv">1</span>, quantile, <span class="fl">0.84</span>)</span>
<span id="cb7-32"><a href="#cb7-32"></a>irf_lower95 <span class="ot">&lt;-</span> <span class="fu">apply</span>(irf_11, <span class="dv">1</span>, quantile, <span class="fl">0.025</span>)</span>
<span id="cb7-33"><a href="#cb7-33"></a>irf_upper95 <span class="ot">&lt;-</span> <span class="fu">apply</span>(irf_11, <span class="dv">1</span>, quantile, <span class="fl">0.975</span>)</span>
<span id="cb7-34"><a href="#cb7-34"></a></span>
<span id="cb7-35"><a href="#cb7-35"></a>irf_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb7-36"><a href="#cb7-36"></a>  <span class="at">horizon =</span> <span class="dv">0</span><span class="sc">:</span>H,</span>
<span id="cb7-37"><a href="#cb7-37"></a>  <span class="at">median =</span> irf_median,</span>
<span id="cb7-38"><a href="#cb7-38"></a>  <span class="at">lower68 =</span> irf_lower,</span>
<span id="cb7-39"><a href="#cb7-39"></a>  <span class="at">upper68 =</span> irf_upper,</span>
<span id="cb7-40"><a href="#cb7-40"></a>  <span class="at">lower95 =</span> irf_lower95,</span>
<span id="cb7-41"><a href="#cb7-41"></a>  <span class="at">upper95 =</span> irf_upper95</span>
<span id="cb7-42"><a href="#cb7-42"></a>)</span>
<span id="cb7-43"><a href="#cb7-43"></a></span>
<span id="cb7-44"><a href="#cb7-44"></a><span class="fu">ggplot</span>(irf_df, <span class="fu">aes</span>(<span class="at">x =</span> horizon)) <span class="sc">+</span></span>
<span id="cb7-45"><a href="#cb7-45"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower95, <span class="at">ymax =</span> upper95), <span class="at">fill =</span> <span class="st">"#3498db"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb7-46"><a href="#cb7-46"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower68, <span class="at">ymax =</span> upper68), <span class="at">fill =</span> <span class="st">"#3498db"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb7-47"><a href="#cb7-47"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> median), <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"#2c3e50"</span>) <span class="sc">+</span></span>
<span id="cb7-48"><a href="#cb7-48"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb7-49"><a href="#cb7-49"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Bayesian VAR: Impulse Response Function"</span>,</span>
<span id="cb7-50"><a href="#cb7-50"></a>       <span class="at">subtitle =</span> <span class="st">"Posterior median with 68% and 95% credible bands"</span>,</span>
<span id="cb7-51"><a href="#cb7-51"></a>       <span class="at">x =</span> <span class="st">"Horizon"</span>, <span class="at">y =</span> <span class="st">"Response of Y1 to Shock 1"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="08_bayesian_var_files/figure-html/posterior-irfs-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Impulse responses with posterior credible bands</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="forecast-error-variance-decomposition" class="level2">
<h2 class="anchored" data-anchor-id="forecast-error-variance-decomposition">Forecast Error Variance Decomposition</h2>
<p>FEVD at horizon <span class="math inline">\(h\)</span>: <span class="math display">\[
\text{FEVD}_{i,j}(h) = \frac{\sum_{s=0}^{h} (\text{IRF}_{i,j,s})^2}{\sum_{s=0}^{h} \sum_{k=1}^{K} (\text{IRF}_{i,k,s})^2}
\]</span></p>
<p>Compute for each posterior draw, report median and bands.</p>
</section>
</section>
<section id="implementation-in-r" class="level1 unnumbered">
<h1 class="unnumbered">Implementation in R</h1>
<section id="using-the-bvar-package" class="level2">
<h2 class="anchored" data-anchor-id="using-the-bvar-package">Using the <code>BVAR</code> Package</h2>
<p>The <code>BVAR</code> package implements Minnesota priors with GLP-style optimization.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">library</span>(BVAR)</span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co"># Prepare data (T × K matrix)</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>data_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(macro_data[, <span class="fu">c</span>(<span class="st">"gdp_growth"</span>, <span class="st">"inflation"</span>, <span class="st">"interest_rate"</span>)])</span>
<span id="cb8-5"><a href="#cb8-5"></a></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co"># Minnesota prior with GLP optimization</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>mn_prior <span class="ot">&lt;-</span> <span class="fu">bv_minnesota</span>(</span>
<span id="cb8-8"><a href="#cb8-8"></a>  <span class="at">lambda =</span> <span class="fu">bv_lambda</span>(<span class="at">mode =</span> <span class="fl">0.2</span>, <span class="at">sd =</span> <span class="fl">0.4</span>, <span class="at">min =</span> <span class="fl">0.0001</span>, <span class="at">max =</span> <span class="dv">5</span>),</span>
<span id="cb8-9"><a href="#cb8-9"></a>  <span class="at">alpha =</span> <span class="fu">bv_alpha</span>(<span class="at">mode =</span> <span class="dv">2</span>),   <span class="co"># lag decay</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>  <span class="at">var =</span> <span class="fl">1e07</span>                     <span class="co"># constant variance</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>)</span>
<span id="cb8-12"><a href="#cb8-12"></a></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co"># Estimate BVAR</span></span>
<span id="cb8-14"><a href="#cb8-14"></a>bvar_model <span class="ot">&lt;-</span> <span class="fu">bvar</span>(</span>
<span id="cb8-15"><a href="#cb8-15"></a>  <span class="at">data =</span> data_mat,</span>
<span id="cb8-16"><a href="#cb8-16"></a>  <span class="at">lags =</span> <span class="dv">4</span>,</span>
<span id="cb8-17"><a href="#cb8-17"></a>  <span class="at">n_draw =</span> <span class="dv">20000</span>,</span>
<span id="cb8-18"><a href="#cb8-18"></a>  <span class="at">n_burn =</span> <span class="dv">5000</span>,</span>
<span id="cb8-19"><a href="#cb8-19"></a>  <span class="at">priors =</span> mn_prior,</span>
<span id="cb8-20"><a href="#cb8-20"></a>  <span class="at">mh =</span> <span class="fu">bv_mh</span>(<span class="at">scale_hess =</span> <span class="fl">0.01</span>, <span class="at">adjust_acc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-21"><a href="#cb8-21"></a>)</span>
<span id="cb8-22"><a href="#cb8-22"></a></span>
<span id="cb8-23"><a href="#cb8-23"></a><span class="co"># Diagnostics</span></span>
<span id="cb8-24"><a href="#cb8-24"></a><span class="fu">summary</span>(bvar_model)</span>
<span id="cb8-25"><a href="#cb8-25"></a><span class="fu">plot</span>(bvar_model)  <span class="co"># trace plots</span></span>
<span id="cb8-26"><a href="#cb8-26"></a></span>
<span id="cb8-27"><a href="#cb8-27"></a><span class="co"># IRFs (Cholesky identification)</span></span>
<span id="cb8-28"><a href="#cb8-28"></a>irf_results <span class="ot">&lt;-</span> <span class="fu">irf</span>(bvar_model, <span class="at">horizon =</span> <span class="dv">20</span>, <span class="at">identification =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-29"><a href="#cb8-29"></a><span class="fu">plot</span>(irf_results)</span>
<span id="cb8-30"><a href="#cb8-30"></a></span>
<span id="cb8-31"><a href="#cb8-31"></a><span class="co"># FEVD</span></span>
<span id="cb8-32"><a href="#cb8-32"></a>fevd_results <span class="ot">&lt;-</span> <span class="fu">fevd</span>(bvar_model, <span class="at">horizon =</span> <span class="dv">20</span>)</span>
<span id="cb8-33"><a href="#cb8-33"></a><span class="fu">plot</span>(fevd_results)</span>
<span id="cb8-34"><a href="#cb8-34"></a></span>
<span id="cb8-35"><a href="#cb8-35"></a><span class="co"># Forecasting</span></span>
<span id="cb8-36"><a href="#cb8-36"></a>forecasts <span class="ot">&lt;-</span> <span class="fu">predict</span>(bvar_model, <span class="at">horizon =</span> <span class="dv">8</span>)</span>
<span id="cb8-37"><a href="#cb8-37"></a><span class="fu">plot</span>(forecasts)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="using-the-bvartools-package" class="level2">
<h2 class="anchored" data-anchor-id="using-the-bvartools-package">Using the <code>bvartools</code> Package</h2>
<p>More flexible, allows custom prior specification.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">library</span>(bvartools)</span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co"># Generate VAR data matrices</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>bvar_data <span class="ot">&lt;-</span> <span class="fu">gen_var</span>(data_ts, <span class="at">p =</span> <span class="dv">4</span>, <span class="at">deterministic =</span> <span class="st">"const"</span>)</span>
<span id="cb9-5"><a href="#cb9-5"></a>y <span class="ot">&lt;-</span> <span class="fu">t</span>(bvar_data<span class="sc">$</span>data<span class="sc">$</span>Y)</span>
<span id="cb9-6"><a href="#cb9-6"></a>x <span class="ot">&lt;-</span> <span class="fu">t</span>(bvar_data<span class="sc">$</span>data<span class="sc">$</span>Z)</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co"># Set up Minnesota prior manually</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>K <span class="ot">&lt;-</span> <span class="fu">ncol</span>(data_mat)</span>
<span id="cb9-10"><a href="#cb9-10"></a>M <span class="ot">&lt;-</span> K <span class="sc">*</span> <span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-11"><a href="#cb9-11"></a></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co"># Prior mean: random walk on first lag</span></span>
<span id="cb9-13"><a href="#cb9-13"></a>a_mu_prior <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, M, K)</span>
<span id="cb9-14"><a href="#cb9-14"></a>a_mu_prior[<span class="dv">2</span><span class="sc">:</span>(K<span class="sc">+</span><span class="dv">1</span>), ] <span class="ot">&lt;-</span> <span class="fu">diag</span>(K)</span>
<span id="cb9-15"><a href="#cb9-15"></a></span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="co"># Prior precision (Minnesota structure)</span></span>
<span id="cb9-17"><a href="#cb9-17"></a>a_v_i_prior <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>, M <span class="sc">*</span> K) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb9-18"><a href="#cb9-18"></a></span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="co"># Prior for Sigma</span></span>
<span id="cb9-20"><a href="#cb9-20"></a>u_sigma_df_prior <span class="ot">&lt;-</span> K <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb9-21"><a href="#cb9-21"></a>u_sigma_scale_prior <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>, K)</span>
<span id="cb9-22"><a href="#cb9-22"></a></span>
<span id="cb9-23"><a href="#cb9-23"></a><span class="co"># Estimate</span></span>
<span id="cb9-24"><a href="#cb9-24"></a>bvar_est <span class="ot">&lt;-</span> <span class="fu">bvar</span>(</span>
<span id="cb9-25"><a href="#cb9-25"></a>  <span class="at">y =</span> y, <span class="at">x =</span> x,</span>
<span id="cb9-26"><a href="#cb9-26"></a>  <span class="at">A =</span> <span class="fu">list</span>(<span class="at">mu =</span> a_mu_prior, <span class="at">V_i =</span> a_v_i_prior),</span>
<span id="cb9-27"><a href="#cb9-27"></a>  <span class="at">Sigma =</span> <span class="fu">list</span>(<span class="at">df =</span> u_sigma_df_prior, <span class="at">scale =</span> u_sigma_scale_prior),</span>
<span id="cb9-28"><a href="#cb9-28"></a>  <span class="at">iterations =</span> <span class="dv">20000</span>, <span class="at">burnin =</span> <span class="dv">5000</span></span>
<span id="cb9-29"><a href="#cb9-29"></a>)</span>
<span id="cb9-30"><a href="#cb9-30"></a></span>
<span id="cb9-31"><a href="#cb9-31"></a><span class="co"># IRFs</span></span>
<span id="cb9-32"><a href="#cb9-32"></a>bvar_irf <span class="ot">&lt;-</span> <span class="fu">irf</span>(bvar_est,</span>
<span id="cb9-33"><a href="#cb9-33"></a>                <span class="at">impulse =</span> <span class="st">"interest_rate"</span>,</span>
<span id="cb9-34"><a href="#cb9-34"></a>                <span class="at">response =</span> <span class="st">"inflation"</span>,</span>
<span id="cb9-35"><a href="#cb9-35"></a>                <span class="at">n.ahead =</span> <span class="dv">20</span>,</span>
<span id="cb9-36"><a href="#cb9-36"></a>                <span class="at">type =</span> <span class="st">"feir"</span>,  <span class="co"># forecast error IRF</span></span>
<span id="cb9-37"><a href="#cb9-37"></a>                <span class="at">ci =</span> <span class="fl">0.95</span>)</span>
<span id="cb9-38"><a href="#cb9-38"></a><span class="fu">plot</span>(bvar_irf)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="manual-implementation" class="level2">
<h2 class="anchored" data-anchor-id="manual-implementation">Manual Implementation</h2>
<p>For full control and understanding:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>bvar_gibbs <span class="ot">&lt;-</span> <span class="cf">function</span>(Y, p, <span class="at">n_draw =</span> <span class="dv">10000</span>, <span class="at">n_burn =</span> <span class="dv">2000</span>,</span>
<span id="cb10-2"><a href="#cb10-2"></a>                        <span class="at">lambda1 =</span> <span class="fl">0.2</span>, <span class="at">lambda2 =</span> <span class="fl">0.5</span>, <span class="at">lambda3 =</span> <span class="dv">100</span>) {</span>
<span id="cb10-3"><a href="#cb10-3"></a>  T_full <span class="ot">&lt;-</span> <span class="fu">nrow</span>(Y)</span>
<span id="cb10-4"><a href="#cb10-4"></a>  K <span class="ot">&lt;-</span> <span class="fu">ncol</span>(Y)</span>
<span id="cb10-5"><a href="#cb10-5"></a>  M <span class="ot">&lt;-</span> K <span class="sc">*</span> p <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="co"># Build data matrices</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>  y <span class="ot">&lt;-</span> Y[(p <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>T_full, ]</span>
<span id="cb10-9"><a href="#cb10-9"></a>  T_eff <span class="ot">&lt;-</span> <span class="fu">nrow</span>(y)</span>
<span id="cb10-10"><a href="#cb10-10"></a>  X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>)</span>
<span id="cb10-11"><a href="#cb10-11"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p) {</span>
<span id="cb10-12"><a href="#cb10-12"></a>    X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(X, Y[(p <span class="sc">+</span> <span class="dv">1</span> <span class="sc">-</span> j)<span class="sc">:</span>(T_full <span class="sc">-</span> j), ])</span>
<span id="cb10-13"><a href="#cb10-13"></a>  }</span>
<span id="cb10-14"><a href="#cb10-14"></a></span>
<span id="cb10-15"><a href="#cb10-15"></a>  <span class="co"># Minnesota prior mean</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>  B0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, M, K)</span>
<span id="cb10-17"><a href="#cb10-17"></a>  B0[<span class="dv">2</span><span class="sc">:</span>(K <span class="sc">+</span> <span class="dv">1</span>), ] <span class="ot">&lt;-</span> <span class="fu">diag</span>(K)  <span class="co"># first lag = identity</span></span>
<span id="cb10-18"><a href="#cb10-18"></a></span>
<span id="cb10-19"><a href="#cb10-19"></a>  <span class="co"># Scaling from AR residuals</span></span>
<span id="cb10-20"><a href="#cb10-20"></a>  sigma_i <span class="ot">&lt;-</span> <span class="fu">numeric</span>(K)</span>
<span id="cb10-21"><a href="#cb10-21"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K) {</span>
<span id="cb10-22"><a href="#cb10-22"></a>    ar_fit <span class="ot">&lt;-</span> <span class="fu">ar</span>(Y[, i], <span class="at">order.max =</span> p, <span class="at">method =</span> <span class="st">"ols"</span>)</span>
<span id="cb10-23"><a href="#cb10-23"></a>    sigma_i[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(ar_fit<span class="sc">$</span>var.pred)</span>
<span id="cb10-24"><a href="#cb10-24"></a>  }</span>
<span id="cb10-25"><a href="#cb10-25"></a></span>
<span id="cb10-26"><a href="#cb10-26"></a>  <span class="co"># Prior variance (Minnesota structure)</span></span>
<span id="cb10-27"><a href="#cb10-27"></a>  V0_diag <span class="ot">&lt;-</span> <span class="fu">numeric</span>(M <span class="sc">*</span> K)</span>
<span id="cb10-28"><a href="#cb10-28"></a>  <span class="cf">for</span> (eq <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K) {</span>
<span id="cb10-29"><a href="#cb10-29"></a>    idx <span class="ot">&lt;-</span> (eq <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> M <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb10-30"><a href="#cb10-30"></a>    V0_diag[idx] <span class="ot">&lt;-</span> (lambda1 <span class="sc">*</span> lambda3)<span class="sc">^</span><span class="dv">2</span>  <span class="co"># constant</span></span>
<span id="cb10-31"><a href="#cb10-31"></a></span>
<span id="cb10-32"><a href="#cb10-32"></a>    <span class="cf">for</span> (lag <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p) {</span>
<span id="cb10-33"><a href="#cb10-33"></a>      <span class="cf">for</span> (var <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K) {</span>
<span id="cb10-34"><a href="#cb10-34"></a>        idx <span class="ot">&lt;-</span> (eq <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> M <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> (lag <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> K <span class="sc">+</span> var</span>
<span id="cb10-35"><a href="#cb10-35"></a>        <span class="cf">if</span> (var <span class="sc">==</span> eq) {</span>
<span id="cb10-36"><a href="#cb10-36"></a>          V0_diag[idx] <span class="ot">&lt;-</span> (lambda1 <span class="sc">/</span> lag)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb10-37"><a href="#cb10-37"></a>        } <span class="cf">else</span> {</span>
<span id="cb10-38"><a href="#cb10-38"></a>          V0_diag[idx] <span class="ot">&lt;-</span> (lambda1 <span class="sc">*</span> lambda2 <span class="sc">*</span> sigma_i[eq] <span class="sc">/</span> (lag <span class="sc">*</span> sigma_i[var]))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb10-39"><a href="#cb10-39"></a>        }</span>
<span id="cb10-40"><a href="#cb10-40"></a>      }</span>
<span id="cb10-41"><a href="#cb10-41"></a>    }</span>
<span id="cb10-42"><a href="#cb10-42"></a>  }</span>
<span id="cb10-43"><a href="#cb10-43"></a>  V0_inv <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span> <span class="sc">/</span> V0_diag)</span>
<span id="cb10-44"><a href="#cb10-44"></a></span>
<span id="cb10-45"><a href="#cb10-45"></a>  <span class="co"># Inverse Wishart prior</span></span>
<span id="cb10-46"><a href="#cb10-46"></a>  v0 <span class="ot">&lt;-</span> K <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb10-47"><a href="#cb10-47"></a>  S0 <span class="ot">&lt;-</span> <span class="fu">diag</span>(sigma_i<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb10-48"><a href="#cb10-48"></a></span>
<span id="cb10-49"><a href="#cb10-49"></a>  <span class="co"># Storage and initialization</span></span>
<span id="cb10-50"><a href="#cb10-50"></a>  B_draws <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(M, K, n_draw))</span>
<span id="cb10-51"><a href="#cb10-51"></a>  Sigma_draws <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(K, K, n_draw))</span>
<span id="cb10-52"><a href="#cb10-52"></a>  B_curr <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">crossprod</span>(X)) <span class="sc">%*%</span> <span class="fu">crossprod</span>(X, y)</span>
<span id="cb10-53"><a href="#cb10-53"></a>  Sigma_curr <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(y <span class="sc">-</span> X <span class="sc">%*%</span> B_curr) <span class="sc">/</span> T_eff</span>
<span id="cb10-54"><a href="#cb10-54"></a></span>
<span id="cb10-55"><a href="#cb10-55"></a>  <span class="co"># Gibbs sampler</span></span>
<span id="cb10-56"><a href="#cb10-56"></a>  <span class="cf">for</span> (g <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n_draw <span class="sc">+</span> n_burn)) {</span>
<span id="cb10-57"><a href="#cb10-57"></a>    <span class="co"># Block 1: B | Sigma</span></span>
<span id="cb10-58"><a href="#cb10-58"></a>    Sigma_inv <span class="ot">&lt;-</span> <span class="fu">solve</span>(Sigma_curr)</span>
<span id="cb10-59"><a href="#cb10-59"></a>    V_post_inv <span class="ot">&lt;-</span> V0_inv <span class="sc">+</span> <span class="fu">kronecker</span>(Sigma_inv, <span class="fu">crossprod</span>(X))</span>
<span id="cb10-60"><a href="#cb10-60"></a>    V_post <span class="ot">&lt;-</span> <span class="fu">solve</span>(V_post_inv)</span>
<span id="cb10-61"><a href="#cb10-61"></a>    b_post <span class="ot">&lt;-</span> V_post <span class="sc">%*%</span> (V0_inv <span class="sc">%*%</span> <span class="fu">as.vector</span>(B0) <span class="sc">+</span></span>
<span id="cb10-62"><a href="#cb10-62"></a>                           <span class="fu">kronecker</span>(Sigma_inv, <span class="fu">t</span>(X)) <span class="sc">%*%</span> <span class="fu">as.vector</span>(y))</span>
<span id="cb10-63"><a href="#cb10-63"></a>    B_curr <span class="ot">&lt;-</span> <span class="fu">matrix</span>(mvtnorm<span class="sc">::</span><span class="fu">rmvnorm</span>(<span class="dv">1</span>, b_post, V_post), M, K)</span>
<span id="cb10-64"><a href="#cb10-64"></a></span>
<span id="cb10-65"><a href="#cb10-65"></a>    <span class="co"># Block 2: Sigma | B</span></span>
<span id="cb10-66"><a href="#cb10-66"></a>    U <span class="ot">&lt;-</span> y <span class="sc">-</span> X <span class="sc">%*%</span> B_curr</span>
<span id="cb10-67"><a href="#cb10-67"></a>    S_post <span class="ot">&lt;-</span> S0 <span class="sc">+</span> <span class="fu">crossprod</span>(U)</span>
<span id="cb10-68"><a href="#cb10-68"></a>    v_post <span class="ot">&lt;-</span> v0 <span class="sc">+</span> T_eff</span>
<span id="cb10-69"><a href="#cb10-69"></a>    Sigma_curr <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">rWishart</span>(<span class="dv">1</span>, v_post, <span class="fu">solve</span>(S_post))[,,<span class="dv">1</span>])</span>
<span id="cb10-70"><a href="#cb10-70"></a></span>
<span id="cb10-71"><a href="#cb10-71"></a>    <span class="cf">if</span> (g <span class="sc">&gt;</span> n_burn) {</span>
<span id="cb10-72"><a href="#cb10-72"></a>      B_draws[,,g <span class="sc">-</span> n_burn] <span class="ot">&lt;-</span> B_curr</span>
<span id="cb10-73"><a href="#cb10-73"></a>      Sigma_draws[,,g <span class="sc">-</span> n_burn] <span class="ot">&lt;-</span> Sigma_curr</span>
<span id="cb10-74"><a href="#cb10-74"></a>    }</span>
<span id="cb10-75"><a href="#cb10-75"></a>  }</span>
<span id="cb10-76"><a href="#cb10-76"></a></span>
<span id="cb10-77"><a href="#cb10-77"></a>  <span class="fu">list</span>(<span class="at">B =</span> B_draws, <span class="at">Sigma =</span> Sigma_draws, <span class="at">K =</span> K, <span class="at">p =</span> p)</span>
<span id="cb10-78"><a href="#cb10-78"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="implementation-in-python" class="level1 unnumbered">
<h1 class="unnumbered">Implementation in Python</h1>
<p>For those who prefer Python, here are equivalent implementations.</p>
<section id="using-numpyscipy-manual" class="level2">
<h2 class="anchored" data-anchor-id="using-numpyscipy-manual">Using NumPy/SciPy (Manual)</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="im">from</span> scipy.linalg <span class="im">import</span> cholesky, solve</span>
<span id="cb11-4"><a href="#cb11-4"></a></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="kw">def</span> bvar_gibbs(Y, p, n_draw<span class="op">=</span><span class="dv">10000</span>, n_burn<span class="op">=</span><span class="dv">2000</span>,</span>
<span id="cb11-6"><a href="#cb11-6"></a>               lambda1<span class="op">=</span><span class="fl">0.2</span>, lambda2<span class="op">=</span><span class="fl">0.5</span>, lambda3<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb11-7"><a href="#cb11-7"></a>    <span class="co">"""</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co">    Bayesian VAR with Minnesota prior via Gibbs sampling.</span></span>
<span id="cb11-9"><a href="#cb11-9"></a></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">    Parameters</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">    ----------</span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co">    Y : ndarray (T, K)</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">        Data matrix</span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="co">    p : int</span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="co">        Lag order</span></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="co">    n_draw : int</span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="co">        Number of posterior draws</span></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="co">    n_burn : int</span></span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="co">        Burn-in period</span></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="co">    lambda1, lambda2, lambda3 : float</span></span>
<span id="cb11-21"><a href="#cb11-21"></a><span class="co">        Minnesota prior hyperparameters</span></span>
<span id="cb11-22"><a href="#cb11-22"></a></span>
<span id="cb11-23"><a href="#cb11-23"></a><span class="co">    Returns</span></span>
<span id="cb11-24"><a href="#cb11-24"></a><span class="co">    -------</span></span>
<span id="cb11-25"><a href="#cb11-25"></a><span class="co">    dict with posterior draws of B and Sigma</span></span>
<span id="cb11-26"><a href="#cb11-26"></a><span class="co">    """</span></span>
<span id="cb11-27"><a href="#cb11-27"></a>    T_full, K <span class="op">=</span> Y.shape</span>
<span id="cb11-28"><a href="#cb11-28"></a>    M <span class="op">=</span> K <span class="op">*</span> p <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb11-29"><a href="#cb11-29"></a></span>
<span id="cb11-30"><a href="#cb11-30"></a>    <span class="co"># Build data matrices</span></span>
<span id="cb11-31"><a href="#cb11-31"></a>    y <span class="op">=</span> Y[p:]</span>
<span id="cb11-32"><a href="#cb11-32"></a>    T_eff <span class="op">=</span> <span class="bu">len</span>(y)</span>
<span id="cb11-33"><a href="#cb11-33"></a></span>
<span id="cb11-34"><a href="#cb11-34"></a>    X <span class="op">=</span> np.ones((T_eff, <span class="dv">1</span>))</span>
<span id="cb11-35"><a href="#cb11-35"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, p <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb11-36"><a href="#cb11-36"></a>        X <span class="op">=</span> np.hstack([X, Y[p<span class="op">-</span>j:T_full<span class="op">-</span>j]])</span>
<span id="cb11-37"><a href="#cb11-37"></a></span>
<span id="cb11-38"><a href="#cb11-38"></a>    <span class="co"># Minnesota prior mean (random walk on first lag)</span></span>
<span id="cb11-39"><a href="#cb11-39"></a>    B0 <span class="op">=</span> np.zeros((M, K))</span>
<span id="cb11-40"><a href="#cb11-40"></a>    B0[<span class="dv">1</span>:K<span class="op">+</span><span class="dv">1</span>, :] <span class="op">=</span> np.eye(K)</span>
<span id="cb11-41"><a href="#cb11-41"></a></span>
<span id="cb11-42"><a href="#cb11-42"></a>    <span class="co"># AR residual scaling</span></span>
<span id="cb11-43"><a href="#cb11-43"></a>    sigma_i <span class="op">=</span> np.zeros(K)</span>
<span id="cb11-44"><a href="#cb11-44"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(K):</span>
<span id="cb11-45"><a href="#cb11-45"></a>        ar_resid <span class="op">=</span> Y[p:, i] <span class="op">-</span> Y[p<span class="op">-</span><span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>, i] <span class="op">*</span> <span class="fl">0.9</span>  <span class="co"># approximate</span></span>
<span id="cb11-46"><a href="#cb11-46"></a>        sigma_i[i] <span class="op">=</span> np.std(ar_resid)</span>
<span id="cb11-47"><a href="#cb11-47"></a></span>
<span id="cb11-48"><a href="#cb11-48"></a>    <span class="co"># Prior variance (Minnesota structure)</span></span>
<span id="cb11-49"><a href="#cb11-49"></a>    V0_diag <span class="op">=</span> np.zeros(M <span class="op">*</span> K)</span>
<span id="cb11-50"><a href="#cb11-50"></a>    <span class="cf">for</span> eq <span class="kw">in</span> <span class="bu">range</span>(K):</span>
<span id="cb11-51"><a href="#cb11-51"></a>        idx <span class="op">=</span> eq <span class="op">*</span> M</span>
<span id="cb11-52"><a href="#cb11-52"></a>        V0_diag[idx] <span class="op">=</span> (lambda1 <span class="op">*</span> lambda3)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb11-53"><a href="#cb11-53"></a></span>
<span id="cb11-54"><a href="#cb11-54"></a>        <span class="cf">for</span> lag <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, p <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb11-55"><a href="#cb11-55"></a>            <span class="cf">for</span> var <span class="kw">in</span> <span class="bu">range</span>(K):</span>
<span id="cb11-56"><a href="#cb11-56"></a>                idx <span class="op">=</span> eq <span class="op">*</span> M <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> (lag <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> K <span class="op">+</span> var</span>
<span id="cb11-57"><a href="#cb11-57"></a>                <span class="cf">if</span> var <span class="op">==</span> eq:</span>
<span id="cb11-58"><a href="#cb11-58"></a>                    V0_diag[idx] <span class="op">=</span> (lambda1 <span class="op">/</span> lag)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb11-59"><a href="#cb11-59"></a>                <span class="cf">else</span>:</span>
<span id="cb11-60"><a href="#cb11-60"></a>                    V0_diag[idx] <span class="op">=</span> (lambda1 <span class="op">*</span> lambda2 <span class="op">*</span> sigma_i[eq] <span class="op">/</span></span>
<span id="cb11-61"><a href="#cb11-61"></a>                                    (lag <span class="op">*</span> sigma_i[var]))<span class="op">**</span><span class="dv">2</span></span>
<span id="cb11-62"><a href="#cb11-62"></a></span>
<span id="cb11-63"><a href="#cb11-63"></a>    V0_inv <span class="op">=</span> np.diag(<span class="dv">1</span> <span class="op">/</span> V0_diag)</span>
<span id="cb11-64"><a href="#cb11-64"></a></span>
<span id="cb11-65"><a href="#cb11-65"></a>    <span class="co"># Inverse Wishart prior</span></span>
<span id="cb11-66"><a href="#cb11-66"></a>    v0 <span class="op">=</span> K <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb11-67"><a href="#cb11-67"></a>    S0 <span class="op">=</span> np.diag(sigma_i<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb11-68"><a href="#cb11-68"></a></span>
<span id="cb11-69"><a href="#cb11-69"></a>    <span class="co"># Initialize</span></span>
<span id="cb11-70"><a href="#cb11-70"></a>    B_curr <span class="op">=</span> np.linalg.lstsq(X, y, rcond<span class="op">=</span><span class="va">None</span>)[<span class="dv">0</span>]</span>
<span id="cb11-71"><a href="#cb11-71"></a>    U <span class="op">=</span> y <span class="op">-</span> X <span class="op">@</span> B_curr</span>
<span id="cb11-72"><a href="#cb11-72"></a>    Sigma_curr <span class="op">=</span> U.T <span class="op">@</span> U <span class="op">/</span> T_eff</span>
<span id="cb11-73"><a href="#cb11-73"></a></span>
<span id="cb11-74"><a href="#cb11-74"></a>    <span class="co"># Storage</span></span>
<span id="cb11-75"><a href="#cb11-75"></a>    B_draws <span class="op">=</span> np.zeros((M, K, n_draw))</span>
<span id="cb11-76"><a href="#cb11-76"></a>    Sigma_draws <span class="op">=</span> np.zeros((K, K, n_draw))</span>
<span id="cb11-77"><a href="#cb11-77"></a></span>
<span id="cb11-78"><a href="#cb11-78"></a>    <span class="cf">for</span> g <span class="kw">in</span> <span class="bu">range</span>(n_draw <span class="op">+</span> n_burn):</span>
<span id="cb11-79"><a href="#cb11-79"></a>        <span class="co"># Block 1: Draw B | Sigma</span></span>
<span id="cb11-80"><a href="#cb11-80"></a>        Sigma_inv <span class="op">=</span> np.linalg.inv(Sigma_curr)</span>
<span id="cb11-81"><a href="#cb11-81"></a>        V_post_inv <span class="op">=</span> V0_inv <span class="op">+</span> np.kron(Sigma_inv, X.T <span class="op">@</span> X)</span>
<span id="cb11-82"><a href="#cb11-82"></a>        V_post <span class="op">=</span> np.linalg.inv(V_post_inv)</span>
<span id="cb11-83"><a href="#cb11-83"></a></span>
<span id="cb11-84"><a href="#cb11-84"></a>        b0_vec <span class="op">=</span> B0.flatten(<span class="st">'F'</span>)</span>
<span id="cb11-85"><a href="#cb11-85"></a>        xy_vec <span class="op">=</span> (X.T <span class="op">@</span> y <span class="op">@</span> Sigma_inv).flatten(<span class="st">'F'</span>)</span>
<span id="cb11-86"><a href="#cb11-86"></a>        b_post <span class="op">=</span> V_post <span class="op">@</span> (V0_inv <span class="op">@</span> b0_vec <span class="op">+</span> xy_vec)</span>
<span id="cb11-87"><a href="#cb11-87"></a></span>
<span id="cb11-88"><a href="#cb11-88"></a>        B_curr <span class="op">=</span> np.random.multivariate_normal(b_post, V_post).reshape((M, K), order<span class="op">=</span><span class="st">'F'</span>)</span>
<span id="cb11-89"><a href="#cb11-89"></a></span>
<span id="cb11-90"><a href="#cb11-90"></a>        <span class="co"># Block 2: Draw Sigma | B</span></span>
<span id="cb11-91"><a href="#cb11-91"></a>        U <span class="op">=</span> y <span class="op">-</span> X <span class="op">@</span> B_curr</span>
<span id="cb11-92"><a href="#cb11-92"></a>        S_post <span class="op">=</span> S0 <span class="op">+</span> U.T <span class="op">@</span> U</span>
<span id="cb11-93"><a href="#cb11-93"></a>        v_post <span class="op">=</span> v0 <span class="op">+</span> T_eff</span>
<span id="cb11-94"><a href="#cb11-94"></a></span>
<span id="cb11-95"><a href="#cb11-95"></a>        <span class="co"># Inverse Wishart draw</span></span>
<span id="cb11-96"><a href="#cb11-96"></a>        Sigma_curr <span class="op">=</span> stats.invwishart.rvs(df<span class="op">=</span>v_post, scale<span class="op">=</span>S_post)</span>
<span id="cb11-97"><a href="#cb11-97"></a></span>
<span id="cb11-98"><a href="#cb11-98"></a>        <span class="cf">if</span> g <span class="op">&gt;=</span> n_burn:</span>
<span id="cb11-99"><a href="#cb11-99"></a>            B_draws[:, :, g <span class="op">-</span> n_burn] <span class="op">=</span> B_curr</span>
<span id="cb11-100"><a href="#cb11-100"></a>            Sigma_draws[:, :, g <span class="op">-</span> n_burn] <span class="op">=</span> Sigma_curr</span>
<span id="cb11-101"><a href="#cb11-101"></a></span>
<span id="cb11-102"><a href="#cb11-102"></a>    <span class="cf">return</span> {<span class="st">'B'</span>: B_draws, <span class="st">'Sigma'</span>: Sigma_draws, <span class="st">'K'</span>: K, <span class="st">'p'</span>: p}</span>
<span id="cb11-103"><a href="#cb11-103"></a></span>
<span id="cb11-104"><a href="#cb11-104"></a></span>
<span id="cb11-105"><a href="#cb11-105"></a><span class="kw">def</span> compute_irfs(bvar_result, shock_idx, H<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb11-106"><a href="#cb11-106"></a>    <span class="co">"""</span></span>
<span id="cb11-107"><a href="#cb11-107"></a><span class="co">    Compute IRFs from BVAR posterior draws.</span></span>
<span id="cb11-108"><a href="#cb11-108"></a><span class="co">    """</span></span>
<span id="cb11-109"><a href="#cb11-109"></a>    B_draws <span class="op">=</span> bvar_result[<span class="st">'B'</span>]</span>
<span id="cb11-110"><a href="#cb11-110"></a>    Sigma_draws <span class="op">=</span> bvar_result[<span class="st">'Sigma'</span>]</span>
<span id="cb11-111"><a href="#cb11-111"></a>    K <span class="op">=</span> bvar_result[<span class="st">'K'</span>]</span>
<span id="cb11-112"><a href="#cb11-112"></a>    p <span class="op">=</span> bvar_result[<span class="st">'p'</span>]</span>
<span id="cb11-113"><a href="#cb11-113"></a>    n_draw <span class="op">=</span> B_draws.shape[<span class="dv">2</span>]</span>
<span id="cb11-114"><a href="#cb11-114"></a></span>
<span id="cb11-115"><a href="#cb11-115"></a>    IRF_draws <span class="op">=</span> np.zeros((K, H <span class="op">+</span> <span class="dv">1</span>, n_draw))</span>
<span id="cb11-116"><a href="#cb11-116"></a></span>
<span id="cb11-117"><a href="#cb11-117"></a>    <span class="cf">for</span> g <span class="kw">in</span> <span class="bu">range</span>(n_draw):</span>
<span id="cb11-118"><a href="#cb11-118"></a>        <span class="co"># Extract A matrices</span></span>
<span id="cb11-119"><a href="#cb11-119"></a>        A <span class="op">=</span> [B_draws[<span class="dv">1</span> <span class="op">+</span> j<span class="op">*</span>K:<span class="dv">1</span> <span class="op">+</span> (j<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>K, :, g].T <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(p)]</span>
<span id="cb11-120"><a href="#cb11-120"></a></span>
<span id="cb11-121"><a href="#cb11-121"></a>        <span class="co"># Cholesky impact</span></span>
<span id="cb11-122"><a href="#cb11-122"></a>        P <span class="op">=</span> cholesky(Sigma_draws[:, :, g], lower<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-123"><a href="#cb11-123"></a></span>
<span id="cb11-124"><a href="#cb11-124"></a>        <span class="co"># Compute IRFs</span></span>
<span id="cb11-125"><a href="#cb11-125"></a>        Phi <span class="op">=</span> np.eye(K)</span>
<span id="cb11-126"><a href="#cb11-126"></a>        IRF_draws[:, <span class="dv">0</span>, g] <span class="op">=</span> P[:, shock_idx]</span>
<span id="cb11-127"><a href="#cb11-127"></a></span>
<span id="cb11-128"><a href="#cb11-128"></a>        <span class="cf">for</span> h <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, H <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb11-129"><a href="#cb11-129"></a>            Phi <span class="op">=</span> Phi <span class="op">@</span> A[<span class="dv">0</span>] <span class="cf">if</span> p <span class="op">&gt;=</span> <span class="dv">1</span> <span class="cf">else</span> np.zeros((K, K))</span>
<span id="cb11-130"><a href="#cb11-130"></a>            IRF_draws[:, h, g] <span class="op">=</span> Phi <span class="op">@</span> P[:, shock_idx]</span>
<span id="cb11-131"><a href="#cb11-131"></a></span>
<span id="cb11-132"><a href="#cb11-132"></a>    <span class="cf">return</span> {</span>
<span id="cb11-133"><a href="#cb11-133"></a>        <span class="st">'median'</span>: np.median(IRF_draws, axis<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb11-134"><a href="#cb11-134"></a>        <span class="st">'lower'</span>: np.percentile(IRF_draws, <span class="dv">16</span>, axis<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb11-135"><a href="#cb11-135"></a>        <span class="st">'upper'</span>: np.percentile(IRF_draws, <span class="dv">84</span>, axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb11-136"><a href="#cb11-136"></a>    }</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="using-pymc-probabilistic-programming" class="level2">
<h2 class="anchored" data-anchor-id="using-pymc-probabilistic-programming">Using PyMC (Probabilistic Programming)</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="im">import</span> pymc <span class="im">as</span> pm</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="im">import</span> arviz <span class="im">as</span> az</span>
<span id="cb12-4"><a href="#cb12-4"></a></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="kw">def</span> bvar_pymc(Y, p, n_draw<span class="op">=</span><span class="dv">2000</span>, n_tune<span class="op">=</span><span class="dv">1000</span>):</span>
<span id="cb12-6"><a href="#cb12-6"></a>    <span class="co">"""</span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">    Bayesian VAR using PyMC.</span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="co">    """</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>    T_full, K <span class="op">=</span> Y.shape</span>
<span id="cb12-10"><a href="#cb12-10"></a></span>
<span id="cb12-11"><a href="#cb12-11"></a>    <span class="co"># Build data matrices</span></span>
<span id="cb12-12"><a href="#cb12-12"></a>    y <span class="op">=</span> Y[p:]</span>
<span id="cb12-13"><a href="#cb12-13"></a>    T_eff <span class="op">=</span> <span class="bu">len</span>(y)</span>
<span id="cb12-14"><a href="#cb12-14"></a></span>
<span id="cb12-15"><a href="#cb12-15"></a>    X <span class="op">=</span> np.ones((T_eff, <span class="dv">1</span>))</span>
<span id="cb12-16"><a href="#cb12-16"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, p <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb12-17"><a href="#cb12-17"></a>        X <span class="op">=</span> np.hstack([X, Y[p<span class="op">-</span>j:T_full<span class="op">-</span>j]])</span>
<span id="cb12-18"><a href="#cb12-18"></a>    M <span class="op">=</span> X.shape[<span class="dv">1</span>]</span>
<span id="cb12-19"><a href="#cb12-19"></a></span>
<span id="cb12-20"><a href="#cb12-20"></a>    <span class="cf">with</span> pm.Model() <span class="im">as</span> bvar_model:</span>
<span id="cb12-21"><a href="#cb12-21"></a>        <span class="co"># Priors</span></span>
<span id="cb12-22"><a href="#cb12-22"></a>        <span class="co"># Coefficients: Normal with Minnesota-style shrinkage</span></span>
<span id="cb12-23"><a href="#cb12-23"></a>        B <span class="op">=</span> pm.Normal(<span class="st">'B'</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="fl">0.5</span>, shape<span class="op">=</span>(M, K))</span>
<span id="cb12-24"><a href="#cb12-24"></a></span>
<span id="cb12-25"><a href="#cb12-25"></a>        <span class="co"># Covariance: LKJ prior on correlation + half-normal on scales</span></span>
<span id="cb12-26"><a href="#cb12-26"></a>        chol, corr, stds <span class="op">=</span> pm.LKJCholeskyCov(</span>
<span id="cb12-27"><a href="#cb12-27"></a>            <span class="st">'chol'</span>, n<span class="op">=</span>K, eta<span class="op">=</span><span class="dv">2</span>, sd_dist<span class="op">=</span>pm.HalfNormal.dist(sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-28"><a href="#cb12-28"></a>        )</span>
<span id="cb12-29"><a href="#cb12-29"></a>        Sigma <span class="op">=</span> pm.Deterministic(<span class="st">'Sigma'</span>, chol <span class="op">@</span> chol.T)</span>
<span id="cb12-30"><a href="#cb12-30"></a></span>
<span id="cb12-31"><a href="#cb12-31"></a>        <span class="co"># Likelihood</span></span>
<span id="cb12-32"><a href="#cb12-32"></a>        mu <span class="op">=</span> pm.math.dot(X, B)</span>
<span id="cb12-33"><a href="#cb12-33"></a>        y_obs <span class="op">=</span> pm.MvNormal(<span class="st">'y'</span>, mu<span class="op">=</span>mu, chol<span class="op">=</span>chol, observed<span class="op">=</span>y)</span>
<span id="cb12-34"><a href="#cb12-34"></a></span>
<span id="cb12-35"><a href="#cb12-35"></a>        <span class="co"># Sample</span></span>
<span id="cb12-36"><a href="#cb12-36"></a>        trace <span class="op">=</span> pm.sample(n_draw, tune<span class="op">=</span>n_tune, cores<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb12-37"><a href="#cb12-37"></a>                          return_inferencedata<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-38"><a href="#cb12-38"></a></span>
<span id="cb12-39"><a href="#cb12-39"></a>    <span class="cf">return</span> trace</span>
<span id="cb12-40"><a href="#cb12-40"></a></span>
<span id="cb12-41"><a href="#cb12-41"></a><span class="co"># Usage:</span></span>
<span id="cb12-42"><a href="#cb12-42"></a><span class="co"># trace = bvar_pymc(Y, p=4)</span></span>
<span id="cb12-43"><a href="#cb12-43"></a><span class="co"># az.plot_trace(trace, var_names=['B'])</span></span>
<span id="cb12-44"><a href="#cb12-44"></a><span class="co"># az.summary(trace, var_names=['B', 'Sigma'])</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="summary" class="level1 unnumbered">
<h1 class="unnumbered">Summary</h1>
<p>Key takeaways:</p>
<ol type="1">
<li><p><strong>Why Bayesian VAR</strong>: Shrinkage prevents overfitting when parameters outnumber observations</p></li>
<li><p><strong>Minnesota Prior</strong>: Encodes beliefs that macro variables are persistent, own lags dominate, recent lags matter more</p></li>
<li><p><strong>GLP Optimization</strong>: Data-driven hyperparameter selection via marginal likelihood maximization</p></li>
<li><p><strong>Gibbs Sampling</strong>: Iteratively draw <span class="math inline">\(B|\Sigma\)</span> and <span class="math inline">\(\Sigma|B\)</span> from conditional posteriors</p></li>
<li><p><strong>Structural Identification</strong>: Cholesky (recursive) or sign restrictions, applied to each posterior draw</p></li>
<li><p><strong>Reporting</strong>: Present posterior median IRFs with 68% and 95% credible bands</p></li>
<li><p><strong>Software</strong>:</p>
<ul>
<li>R: <code>BVAR</code> (GLP optimization), <code>bvartools</code> (flexible), <code>bvarsv</code> (TVP-VAR)</li>
<li>Python: Manual with NumPy/SciPy, or PyMC for probabilistic programming</li>
</ul></li>
</ol>
<hr>
<section id="key-references" class="level2">
<h2 class="anchored" data-anchor-id="key-references">Key References</h2>
<p><strong>Foundational</strong>:</p>
<ul>
<li>Litterman (1986). “Forecasting with Bayesian VARs.” <em>JBES</em></li>
<li>Doan, Litterman &amp; Sims (1984). “Forecasting and Conditional Projection.”</li>
<li>Sims &amp; Zha (1998). “Bayesian Methods for Dynamic Multivariate Models.” <em>IER</em></li>
</ul>
<p><strong>Modern Methods</strong>:</p>
<ul>
<li>Giannone, Lenza &amp; Primiceri (2015). “Prior Selection for VARs.” <em>REStat</em></li>
<li>Banbura, Giannone &amp; Reichlin (2010). “Large Bayesian VARs.” <em>JAE</em></li>
<li>Carriero, Clark &amp; Marcellino (2019). “Large BVARs with Stochastic Volatility.” <em>JoE</em></li>
</ul>
<p><strong>Textbooks</strong>:</p>
<ul>
<li>Koop (2003). <em>Bayesian Econometrics</em></li>
<li>Blake &amp; Mumtaz (2012). <em>Applied Bayesian Econometrics for Central Bankers</em></li>
</ul>
<p><strong>R Packages</strong>:</p>
<ul>
<li><code>BVAR</code>: Kuschnig &amp; Vashold — Minnesota prior with GLP</li>
<li><code>bvartools</code>: Mohr — Flexible BVAR toolkit</li>
<li><code>bvarsv</code>: Krueger — TVP-VAR with stochastic volatility</li>
</ul>
<hr>
<p><em>Next: <a href="../chapters/09_bayesian_panel.html">Module 9: Bayesian Panel Methods</a></em></p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/07_bayesian_foundations.html" class="pagination-link" aria-label="Bayesian Foundations">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Bayesian Foundations</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/09_bayesian_panel.html" class="pagination-link" aria-label="Bayesian Panel Methods">
        <span class="nav-page-text"><span class="chapter-title">Bayesian Panel Methods</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">---</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="an">title:</span><span class="co"> "Bayesian Vector Autoregressions"</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="an">subtitle:</span><span class="co"> "Shrinkage, Minnesota Priors, and Posterior Inference"</span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co">---</span></span>
<span id="cb13-5"><a href="#cb13-5"></a></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="in">```{r}</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co">#| label: setup</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co">#| include: false</span></span>
<span id="cb13-11"><a href="#cb13-11"></a></span>
<span id="cb13-12"><a href="#cb13-12"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb13-13"><a href="#cb13-13"></a>  <span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-14"><a href="#cb13-14"></a>  <span class="at">fig.width =</span> <span class="dv">10</span>, <span class="at">fig.height =</span> <span class="dv">6</span>, <span class="at">fig.align =</span> <span class="st">"center"</span></span>
<span id="cb13-15"><a href="#cb13-15"></a>)</span>
<span id="cb13-16"><a href="#cb13-16"></a></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb13-20"><a href="#cb13-20"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb13-21"><a href="#cb13-21"></a></span>
<span id="cb13-22"><a href="#cb13-22"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>))</span>
<span id="cb13-23"><a href="#cb13-23"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb13-24"><a href="#cb13-24"></a><span class="in">```</span></span>
<span id="cb13-25"><a href="#cb13-25"></a></span>
<span id="cb13-26"><a href="#cb13-26"></a><span class="fu"># Why Bayesian VARs? {.unnumbered}</span></span>
<span id="cb13-27"><a href="#cb13-27"></a></span>
<span id="cb13-28"><a href="#cb13-28"></a>Vector Autoregressions are powerful tools for macroeconomic analysis, but they suffer from a fundamental problem: **too many parameters, too little data**.</span>
<span id="cb13-29"><a href="#cb13-29"></a></span>
<span id="cb13-30"><a href="#cb13-30"></a><span class="fu">## The Curse of Dimensionality</span></span>
<span id="cb13-31"><a href="#cb13-31"></a></span>
<span id="cb13-32"><a href="#cb13-32"></a>A VAR(p) with K variables has:</span>
<span id="cb13-33"><a href="#cb13-33"></a>$$</span>
<span id="cb13-34"><a href="#cb13-34"></a>\text{Parameters} = K^2 p + K = K(Kp + 1)</span>
<span id="cb13-35"><a href="#cb13-35"></a>$$</span>
<span id="cb13-36"><a href="#cb13-36"></a></span>
<span id="cb13-37"><a href="#cb13-37"></a><span class="pp">|</span> Variables (K) <span class="pp">|</span> Lags (p) <span class="pp">|</span> Parameters <span class="pp">|</span> Typical Macro Sample (T=200) <span class="pp">|</span></span>
<span id="cb13-38"><a href="#cb13-38"></a><span class="pp">|---------------|----------|------------|------------------------------|</span></span>
<span id="cb13-39"><a href="#cb13-39"></a><span class="pp">|</span> 3 <span class="pp">|</span> 4 <span class="pp">|</span> 39 <span class="pp">|</span> OK <span class="pp">|</span></span>
<span id="cb13-40"><a href="#cb13-40"></a><span class="pp">|</span> 5 <span class="pp">|</span> 4 <span class="pp">|</span> 105 <span class="pp">|</span> Marginal <span class="pp">|</span></span>
<span id="cb13-41"><a href="#cb13-41"></a><span class="pp">|</span> 7 <span class="pp">|</span> 4 <span class="pp">|</span> 203 <span class="pp">|</span> Problematic <span class="pp">|</span></span>
<span id="cb13-42"><a href="#cb13-42"></a><span class="pp">|</span> 10 <span class="pp">|</span> 4 <span class="pp">|</span> 410 <span class="pp">|</span> Unreliable <span class="pp">|</span></span>
<span id="cb13-43"><a href="#cb13-43"></a></span>
<span id="cb13-44"><a href="#cb13-44"></a>With quarterly data since 1960, you have ~250 observations. A 7-variable VAR(4) estimates 203 parameters—almost one parameter per observation!</span>
<span id="cb13-45"><a href="#cb13-45"></a></span>
<span id="cb13-48"><a href="#cb13-48"></a><span class="in">```{r}</span></span>
<span id="cb13-49"><a href="#cb13-49"></a><span class="co">#| label: param-explosion</span></span>
<span id="cb13-50"><a href="#cb13-50"></a><span class="co">#| fig-cap: "The curse of dimensionality in VARs"</span></span>
<span id="cb13-51"><a href="#cb13-51"></a></span>
<span id="cb13-52"><a href="#cb13-52"></a>param_count <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">K =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">p =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-53"><a href="#cb13-53"></a>  <span class="fu">mutate</span>(<span class="at">params =</span> K <span class="sc">*</span> (K <span class="sc">*</span> p <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb13-54"><a href="#cb13-54"></a></span>
<span id="cb13-55"><a href="#cb13-55"></a><span class="fu">ggplot</span>(param_count, <span class="fu">aes</span>(<span class="at">x =</span> K, <span class="at">y =</span> params, <span class="at">color =</span> <span class="fu">factor</span>(p))) <span class="sc">+</span></span>
<span id="cb13-56"><a href="#cb13-56"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-57"><a href="#cb13-57"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb13-58"><a href="#cb13-58"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb13-59"><a href="#cb13-59"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">11</span>, <span class="at">y =</span> <span class="dv">110</span>, <span class="at">label =</span> <span class="st">"T = 100"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb13-60"><a href="#cb13-60"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">11</span>, <span class="at">y =</span> <span class="dv">210</span>, <span class="at">label =</span> <span class="st">"T = 200"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb13-61"><a href="#cb13-61"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb13-62"><a href="#cb13-62"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"VAR Parameters Explode with System Size"</span>,</span>
<span id="cb13-63"><a href="#cb13-63"></a>       <span class="at">subtitle =</span> <span class="st">"Dashed lines show typical macro sample sizes"</span>,</span>
<span id="cb13-64"><a href="#cb13-64"></a>       <span class="at">x =</span> <span class="st">"Number of Variables (K)"</span>, <span class="at">y =</span> <span class="st">"Number of Parameters"</span>,</span>
<span id="cb13-65"><a href="#cb13-65"></a>       <span class="at">color =</span> <span class="st">"Lags (p)"</span>)</span>
<span id="cb13-66"><a href="#cb13-66"></a><span class="in">```</span></span>
<span id="cb13-67"><a href="#cb13-67"></a></span>
<span id="cb13-68"><a href="#cb13-68"></a><span class="fu">## The OLS Problem</span></span>
<span id="cb13-69"><a href="#cb13-69"></a></span>
<span id="cb13-70"><a href="#cb13-70"></a>With many parameters and few observations:</span>
<span id="cb13-71"><a href="#cb13-71"></a><span class="ss">- </span>**Overfitting**: In-sample fit is excellent, out-of-sample forecasts are poor</span>
<span id="cb13-72"><a href="#cb13-72"></a><span class="ss">- </span>**Imprecision**: Huge standard errors, wide confidence intervals</span>
<span id="cb13-73"><a href="#cb13-73"></a><span class="ss">- </span>**Instability**: Small changes in data lead to large changes in estimates</span>
<span id="cb13-74"><a href="#cb13-74"></a></span>
<span id="cb13-75"><a href="#cb13-75"></a><span class="fu">## The Bayesian Solution: Shrinkage</span></span>
<span id="cb13-76"><a href="#cb13-76"></a></span>
<span id="cb13-77"><a href="#cb13-77"></a>**Key insight**: We have prior beliefs about macroeconomic dynamics. Use them!</span>
<span id="cb13-78"><a href="#cb13-78"></a></span>
<span id="cb13-79"><a href="#cb13-79"></a>Reasonable priors for macro VARs:</span>
<span id="cb13-80"><a href="#cb13-80"></a><span class="ss">1. </span>Variables are **persistent** (close to random walks)</span>
<span id="cb13-81"><a href="#cb13-81"></a><span class="ss">2. </span>**Own lags** matter more than other variables' lags</span>
<span id="cb13-82"><a href="#cb13-82"></a><span class="ss">3. </span>**Recent lags** matter more than distant lags</span>
<span id="cb13-83"><a href="#cb13-83"></a><span class="ss">4. </span>**Cross-variable effects** are typically small</span>
<span id="cb13-84"><a href="#cb13-84"></a></span>
<span id="cb13-85"><a href="#cb13-85"></a>Bayesian estimation **shrinks** estimates toward these beliefs, reducing variance at the cost of some bias. With many parameters, this variance-bias tradeoff strongly favors shrinkage.</span>
<span id="cb13-86"><a href="#cb13-86"></a></span>
<span id="cb13-89"><a href="#cb13-89"></a><span class="in">```{r}</span></span>
<span id="cb13-90"><a href="#cb13-90"></a><span class="co">#| label: shrinkage-intuition</span></span>
<span id="cb13-91"><a href="#cb13-91"></a><span class="co">#| fig-cap: "Shrinkage reduces variance at the cost of small bias"</span></span>
<span id="cb13-92"><a href="#cb13-92"></a></span>
<span id="cb13-93"><a href="#cb13-93"></a><span class="co"># Demonstrate shrinkage benefit</span></span>
<span id="cb13-94"><a href="#cb13-94"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb13-95"><a href="#cb13-95"></a>n_sim <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb13-96"><a href="#cb13-96"></a>true_beta <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb13-97"><a href="#cb13-97"></a>n_obs <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb13-98"><a href="#cb13-98"></a></span>
<span id="cb13-99"><a href="#cb13-99"></a><span class="co"># OLS estimates (high variance)</span></span>
<span id="cb13-100"><a href="#cb13-100"></a>ols_estimates <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_sim, {</span>
<span id="cb13-101"><a href="#cb13-101"></a>  x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_obs)</span>
<span id="cb13-102"><a href="#cb13-102"></a>  y <span class="ot">&lt;-</span> true_beta <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n_obs, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb13-103"><a href="#cb13-103"></a>  <span class="fu">coef</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb13-104"><a href="#cb13-104"></a>})</span>
<span id="cb13-105"><a href="#cb13-105"></a></span>
<span id="cb13-106"><a href="#cb13-106"></a><span class="co"># Bayesian estimates with shrinkage prior toward 0</span></span>
<span id="cb13-107"><a href="#cb13-107"></a><span class="co"># Prior: beta ~ N(0, 0.5^2)</span></span>
<span id="cb13-108"><a href="#cb13-108"></a>prior_var <span class="ot">&lt;-</span> <span class="fl">0.5</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb13-109"><a href="#cb13-109"></a>bayes_estimates <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_sim, {</span>
<span id="cb13-110"><a href="#cb13-110"></a>  x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_obs)</span>
<span id="cb13-111"><a href="#cb13-111"></a>  y <span class="ot">&lt;-</span> true_beta <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n_obs, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb13-112"><a href="#cb13-112"></a></span>
<span id="cb13-113"><a href="#cb13-113"></a>  <span class="co"># Posterior with known sigma = 2</span></span>
<span id="cb13-114"><a href="#cb13-114"></a>  sigma2 <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb13-115"><a href="#cb13-115"></a>  post_var <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span><span class="sc">/</span>prior_var <span class="sc">+</span> <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>sigma2)</span>
<span id="cb13-116"><a href="#cb13-116"></a>  post_mean <span class="ot">&lt;-</span> post_var <span class="sc">*</span> (<span class="fu">sum</span>(x<span class="sc">*</span>y)<span class="sc">/</span>sigma2)</span>
<span id="cb13-117"><a href="#cb13-117"></a>  post_mean</span>
<span id="cb13-118"><a href="#cb13-118"></a>})</span>
<span id="cb13-119"><a href="#cb13-119"></a></span>
<span id="cb13-120"><a href="#cb13-120"></a>estimates_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb13-121"><a href="#cb13-121"></a>  <span class="at">estimate =</span> <span class="fu">c</span>(ols_estimates, bayes_estimates),</span>
<span id="cb13-122"><a href="#cb13-122"></a>  <span class="at">method =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"OLS (no shrinkage)"</span>, <span class="st">"Bayesian (shrinkage)"</span>), <span class="at">each =</span> n_sim)</span>
<span id="cb13-123"><a href="#cb13-123"></a>)</span>
<span id="cb13-124"><a href="#cb13-124"></a></span>
<span id="cb13-125"><a href="#cb13-125"></a><span class="fu">ggplot</span>(estimates_df, <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">fill =</span> method)) <span class="sc">+</span></span>
<span id="cb13-126"><a href="#cb13-126"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb13-127"><a href="#cb13-127"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> true_beta, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-128"><a href="#cb13-128"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> true_beta <span class="sc">+</span> <span class="fl">0.1</span>, <span class="at">y =</span> <span class="fl">1.5</span>,</span>
<span id="cb13-129"><a href="#cb13-129"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"True β = "</span>, true_beta), <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb13-130"><a href="#cb13-130"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"OLS (no shrinkage)"</span> <span class="ot">=</span> <span class="st">"#e74c3c"</span>,</span>
<span id="cb13-131"><a href="#cb13-131"></a>                                <span class="st">"Bayesian (shrinkage)"</span> <span class="ot">=</span> <span class="st">"#3498db"</span>)) <span class="sc">+</span></span>
<span id="cb13-132"><a href="#cb13-132"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shrinkage Reduces Estimation Variance"</span>,</span>
<span id="cb13-133"><a href="#cb13-133"></a>       <span class="at">subtitle =</span> <span class="st">"Bayesian estimates cluster closer to truth despite small bias"</span>,</span>
<span id="cb13-134"><a href="#cb13-134"></a>       <span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">hat</span>(beta)), <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb13-135"><a href="#cb13-135"></a>       <span class="at">fill =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb13-136"><a href="#cb13-136"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb13-137"><a href="#cb13-137"></a><span class="in">```</span></span>
<span id="cb13-138"><a href="#cb13-138"></a></span>
<span id="cb13-139"><a href="#cb13-139"></a><span class="fu"># The Minnesota Prior {.unnumbered}</span></span>
<span id="cb13-140"><a href="#cb13-140"></a></span>
<span id="cb13-141"><a href="#cb13-141"></a><span class="fu">## Litterman (1986) and Doan-Litterman-Sims (1984)</span></span>
<span id="cb13-142"><a href="#cb13-142"></a></span>
<span id="cb13-143"><a href="#cb13-143"></a>The **Minnesota prior** is the workhorse prior for macroeconomic BVARs. It encodes the belief that macro variables behave approximately like random walks.</span>
<span id="cb13-144"><a href="#cb13-144"></a></span>
<span id="cb13-145"><a href="#cb13-145"></a><span class="fu">### Prior Mean</span></span>
<span id="cb13-146"><a href="#cb13-146"></a></span>
<span id="cb13-147"><a href="#cb13-147"></a>For variables in **levels** (GDP, prices, etc.):</span>
<span id="cb13-148"><a href="#cb13-148"></a></span>
<span id="cb13-149"><a href="#cb13-149"></a>$$</span>
<span id="cb13-150"><a href="#cb13-150"></a>E<span class="co">[</span><span class="ot">A_1</span><span class="co">]</span> = I_K, \quad E<span class="co">[</span><span class="ot">A_j</span><span class="co">]</span> = 0 \text{ for } j &gt; 1</span>
<span id="cb13-151"><a href="#cb13-151"></a>$$</span>
<span id="cb13-152"><a href="#cb13-152"></a></span>
<span id="cb13-153"><a href="#cb13-153"></a>Each variable's first own lag coefficient is centered at 1 (random walk), all other coefficients at 0.</span>
<span id="cb13-154"><a href="#cb13-154"></a></span>
<span id="cb13-155"><a href="#cb13-155"></a>For **stationary** variables (growth rates, spreads):</span>
<span id="cb13-156"><a href="#cb13-156"></a></span>
<span id="cb13-157"><a href="#cb13-157"></a>$$</span>
<span id="cb13-158"><a href="#cb13-158"></a>E<span class="co">[</span><span class="ot">A_j</span><span class="co">]</span> = 0 \text{ for all } j</span>
<span id="cb13-159"><a href="#cb13-159"></a>$$</span>
<span id="cb13-160"><a href="#cb13-160"></a></span>
<span id="cb13-161"><a href="#cb13-161"></a><span class="fu">### Prior Variance (The Shrinkage Structure)</span></span>
<span id="cb13-162"><a href="#cb13-162"></a></span>
<span id="cb13-163"><a href="#cb13-163"></a>The key innovation is the **structured prior variance**:</span>
<span id="cb13-164"><a href="#cb13-164"></a></span>
<span id="cb13-165"><a href="#cb13-165"></a>**Own lag $l$ of variable $i$**:</span>
<span id="cb13-166"><a href="#cb13-166"></a>$$</span>
<span id="cb13-167"><a href="#cb13-167"></a>\text{Var}(a_{ii,l}) = \left(\frac{\lambda_1}{l^d}\right)^2</span>
<span id="cb13-168"><a href="#cb13-168"></a>$$</span>
<span id="cb13-169"><a href="#cb13-169"></a></span>
<span id="cb13-170"><a href="#cb13-170"></a>**Cross lag $l$ of variable $j$ on equation $i$**:</span>
<span id="cb13-171"><a href="#cb13-171"></a>$$</span>
<span id="cb13-172"><a href="#cb13-172"></a>\text{Var}(a_{ij,l}) = \left(\frac{\lambda_1 \cdot \lambda_2 \cdot \sigma_i}{l^d \cdot \sigma_j}\right)^2</span>
<span id="cb13-173"><a href="#cb13-173"></a>$$</span>
<span id="cb13-174"><a href="#cb13-174"></a></span>
<span id="cb13-175"><a href="#cb13-175"></a>**Constant term**:</span>
<span id="cb13-176"><a href="#cb13-176"></a>$$</span>
<span id="cb13-177"><a href="#cb13-177"></a>\text{Var}(c_i) = (\lambda_1 \cdot \lambda_3)^2</span>
<span id="cb13-178"><a href="#cb13-178"></a>$$</span>
<span id="cb13-179"><a href="#cb13-179"></a></span>
<span id="cb13-180"><a href="#cb13-180"></a>where:</span>
<span id="cb13-181"><a href="#cb13-181"></a><span class="ss">- </span>$\sigma_i$ = residual std from univariate AR(p) of variable $i$</span>
<span id="cb13-182"><a href="#cb13-182"></a><span class="ss">- </span>$\lambda_1$ = **overall tightness** (controls shrinkage strength)</span>
<span id="cb13-183"><a href="#cb13-183"></a><span class="ss">- </span>$\lambda_2$ = **cross-variable shrinkage** (typically &lt; 1)</span>
<span id="cb13-184"><a href="#cb13-184"></a><span class="ss">- </span>$\lambda_3$ = **constant tightness** (typically large, ~100)</span>
<span id="cb13-185"><a href="#cb13-185"></a><span class="ss">- </span>$d$ = **lag decay** (typically 1 or 2)</span>
<span id="cb13-186"><a href="#cb13-186"></a></span>
<span id="cb13-187"><a href="#cb13-187"></a><span class="fu">### Hyperparameter Interpretation</span></span>
<span id="cb13-188"><a href="#cb13-188"></a></span>
<span id="cb13-189"><a href="#cb13-189"></a><span class="pp">|</span> Parameter <span class="pp">|</span> Typical Range <span class="pp">|</span> Effect <span class="pp">|</span></span>
<span id="cb13-190"><a href="#cb13-190"></a><span class="pp">|-----------|---------------|--------|</span></span>
<span id="cb13-191"><a href="#cb13-191"></a><span class="pp">|</span> $\lambda_1$ <span class="pp">|</span> 0.1 - 0.5 <span class="pp">|</span> Smaller → more shrinkage toward prior <span class="pp">|</span></span>
<span id="cb13-192"><a href="#cb13-192"></a><span class="pp">|</span> $\lambda_2$ <span class="pp">|</span> 0.3 - 0.5 <span class="pp">|</span> Smaller → own lags dominate cross effects <span class="pp">|</span></span>
<span id="cb13-193"><a href="#cb13-193"></a><span class="pp">|</span> $\lambda_3$ <span class="pp">|</span> 100 <span class="pp">|</span> Large → loose prior on constant <span class="pp">|</span></span>
<span id="cb13-194"><a href="#cb13-194"></a><span class="pp">|</span> $d$ <span class="pp">|</span> 1 or 2 <span class="pp">|</span> Larger → faster decay for distant lags <span class="pp">|</span></span>
<span id="cb13-195"><a href="#cb13-195"></a></span>
<span id="cb13-198"><a href="#cb13-198"></a><span class="in">```{r}</span></span>
<span id="cb13-199"><a href="#cb13-199"></a><span class="co">#| label: minnesota-variance</span></span>
<span id="cb13-200"><a href="#cb13-200"></a><span class="co">#| fig-cap: "Minnesota prior variance structure"</span></span>
<span id="cb13-201"><a href="#cb13-201"></a></span>
<span id="cb13-202"><a href="#cb13-202"></a><span class="co"># Illustrate Minnesota prior variance structure</span></span>
<span id="cb13-203"><a href="#cb13-203"></a>K <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb13-204"><a href="#cb13-204"></a>p <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb13-205"><a href="#cb13-205"></a>lambda1 <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb13-206"><a href="#cb13-206"></a>lambda2 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb13-207"><a href="#cb13-207"></a>d <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-208"><a href="#cb13-208"></a></span>
<span id="cb13-209"><a href="#cb13-209"></a><span class="co"># Prior variance for different coefficient types</span></span>
<span id="cb13-210"><a href="#cb13-210"></a>lags <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>p</span>
<span id="cb13-211"><a href="#cb13-211"></a>own_var <span class="ot">&lt;-</span> (lambda1 <span class="sc">/</span> lags<span class="sc">^</span>d)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb13-212"><a href="#cb13-212"></a>cross_var <span class="ot">&lt;-</span> (lambda1 <span class="sc">*</span> lambda2 <span class="sc">/</span> lags<span class="sc">^</span>d)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb13-213"><a href="#cb13-213"></a></span>
<span id="cb13-214"><a href="#cb13-214"></a>var_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb13-215"><a href="#cb13-215"></a>  <span class="at">lag =</span> <span class="fu">rep</span>(lags, <span class="dv">2</span>),</span>
<span id="cb13-216"><a href="#cb13-216"></a>  <span class="at">variance =</span> <span class="fu">c</span>(own_var, cross_var),</span>
<span id="cb13-217"><a href="#cb13-217"></a>  <span class="at">type =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Own lag"</span>, <span class="st">"Cross lag"</span>), <span class="at">each =</span> p)</span>
<span id="cb13-218"><a href="#cb13-218"></a>)</span>
<span id="cb13-219"><a href="#cb13-219"></a></span>
<span id="cb13-220"><a href="#cb13-220"></a><span class="fu">ggplot</span>(var_df, <span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> <span class="fu">sqrt</span>(variance), <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb13-221"><a href="#cb13-221"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb13-222"><a href="#cb13-222"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb13-223"><a href="#cb13-223"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Own lag"</span> <span class="ot">=</span> <span class="st">"#3498db"</span>, <span class="st">"Cross lag"</span> <span class="ot">=</span> <span class="st">"#e74c3c"</span>)) <span class="sc">+</span></span>
<span id="cb13-224"><a href="#cb13-224"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Minnesota Prior: Standard Deviation by Lag"</span>,</span>
<span id="cb13-225"><a href="#cb13-225"></a>       <span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(lambda[<span class="dv">1</span>], <span class="st">" = 0.2, "</span>, lambda[<span class="dv">2</span>], <span class="st">" = 0.5, d = 1"</span>)),</span>
<span id="cb13-226"><a href="#cb13-226"></a>       <span class="at">x =</span> <span class="st">"Lag"</span>, <span class="at">y =</span> <span class="st">"Prior Standard Deviation"</span>,</span>
<span id="cb13-227"><a href="#cb13-227"></a>       <span class="at">color =</span> <span class="st">"Coefficient Type"</span>) <span class="sc">+</span></span>
<span id="cb13-228"><a href="#cb13-228"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb13-229"><a href="#cb13-229"></a><span class="in">```</span></span>
<span id="cb13-230"><a href="#cb13-230"></a></span>
<span id="cb13-231"><a href="#cb13-231"></a><span class="fu">## The Normal-Inverse-Wishart Prior</span></span>
<span id="cb13-232"><a href="#cb13-232"></a></span>
<span id="cb13-233"><a href="#cb13-233"></a>The Minnesota prior is typically implemented as a **Normal-Inverse-Wishart (NIW)** prior:</span>
<span id="cb13-234"><a href="#cb13-234"></a></span>
<span id="cb13-235"><a href="#cb13-235"></a>$$</span>
<span id="cb13-236"><a href="#cb13-236"></a>\begin{aligned}</span>
<span id="cb13-237"><a href="#cb13-237"></a>\text{vec}(B) | \Sigma &amp;\sim N(\text{vec}(B_0), \Sigma \otimes V_0) <span class="sc">\\</span></span>
<span id="cb13-238"><a href="#cb13-238"></a>\Sigma &amp;\sim \text{Inverse-Wishart}(S_0, \nu_0)</span>
<span id="cb13-239"><a href="#cb13-239"></a>\end{aligned}</span>
<span id="cb13-240"><a href="#cb13-240"></a>$$</span>
<span id="cb13-241"><a href="#cb13-241"></a></span>
<span id="cb13-242"><a href="#cb13-242"></a>This is **conjugate**: the posterior has the same form with updated parameters.</span>
<span id="cb13-243"><a href="#cb13-243"></a></span>
<span id="cb13-244"><a href="#cb13-244"></a>**Posterior**:</span>
<span id="cb13-245"><a href="#cb13-245"></a>$$</span>
<span id="cb13-246"><a href="#cb13-246"></a>\begin{aligned}</span>
<span id="cb13-247"><a href="#cb13-247"></a>V_{\text{post}} &amp;= (V_0^{-1} + X'X)^{-1} <span class="sc">\\</span></span>
<span id="cb13-248"><a href="#cb13-248"></a>B_{\text{post}} &amp;= V_{\text{post}}(V_0^{-1} B_0 + X'Y) <span class="sc">\\</span></span>
<span id="cb13-249"><a href="#cb13-249"></a>\nu_{\text{post}} &amp;= \nu_0 + T <span class="sc">\\</span></span>
<span id="cb13-250"><a href="#cb13-250"></a>S_{\text{post}} &amp;= S_0 + (Y - XB_{\text{post}})'(Y - XB_{\text{post}}) + (B_{\text{post}} - B_0)'V_0^{-1}(B_{\text{post}} - B_0)</span>
<span id="cb13-251"><a href="#cb13-251"></a>\end{aligned}</span>
<span id="cb13-252"><a href="#cb13-252"></a>$$</span>
<span id="cb13-253"><a href="#cb13-253"></a></span>
<span id="cb13-254"><a href="#cb13-254"></a><span class="fu"># GLP: Data-Driven Hyperparameters {.unnumbered}</span></span>
<span id="cb13-255"><a href="#cb13-255"></a></span>
<span id="cb13-256"><a href="#cb13-256"></a><span class="fu">## Giannone, Lenza &amp; Primiceri (2015)</span></span>
<span id="cb13-257"><a href="#cb13-257"></a></span>
<span id="cb13-258"><a href="#cb13-258"></a>How do we choose $\lambda_1, \lambda_2$? The traditional approach: researcher judgment or cross-validation.</span>
<span id="cb13-259"><a href="#cb13-259"></a></span>
<span id="cb13-260"><a href="#cb13-260"></a>**GLP innovation**: Choose hyperparameters by **maximizing the marginal likelihood**:</span>
<span id="cb13-261"><a href="#cb13-261"></a></span>
<span id="cb13-262"><a href="#cb13-262"></a>$$</span>
<span id="cb13-263"><a href="#cb13-263"></a>p(Y | \lambda) = \int p(Y | B, \Sigma) \cdot p(B, \Sigma | \lambda) \, dB \, d\Sigma</span>
<span id="cb13-264"><a href="#cb13-264"></a>$$</span>
<span id="cb13-265"><a href="#cb13-265"></a></span>
<span id="cb13-266"><a href="#cb13-266"></a>For the NIW prior, this integral has a **closed-form solution**!</span>
<span id="cb13-267"><a href="#cb13-267"></a></span>
<span id="cb13-268"><a href="#cb13-268"></a><span class="fu">### The Algorithm</span></span>
<span id="cb13-269"><a href="#cb13-269"></a></span>
<span id="cb13-270"><a href="#cb13-270"></a><span class="ss">1. </span>Define a grid over $\lambda = (\lambda_1, \lambda_2, \ldots)$</span>
<span id="cb13-271"><a href="#cb13-271"></a><span class="ss">2. </span>For each $\lambda$, compute $p(Y | \lambda)$ analytically</span>
<span id="cb13-272"><a href="#cb13-272"></a><span class="ss">3. </span>Choose $\lambda^* = \arg\max_\lambda p(Y | \lambda)$</span>
<span id="cb13-273"><a href="#cb13-273"></a><span class="ss">4. </span>Estimate BVAR with optimal hyperparameters</span>
<span id="cb13-274"><a href="#cb13-274"></a></span>
<span id="cb13-275"><a href="#cb13-275"></a><span class="fu">### Why This Matters</span></span>
<span id="cb13-276"><a href="#cb13-276"></a></span>
<span id="cb13-277"><a href="#cb13-277"></a><span class="ss">- </span>**Data-driven**: No arbitrary hyperparameter choices</span>
<span id="cb13-278"><a href="#cb13-278"></a><span class="ss">- </span>**Automatic**: Adapts to different datasets</span>
<span id="cb13-279"><a href="#cb13-279"></a><span class="ss">- </span>**Forecast accuracy**: GLP BVARs consistently outperform OLS VARs</span>
<span id="cb13-280"><a href="#cb13-280"></a></span>
<span id="cb13-283"><a href="#cb13-283"></a><span class="in">```{r}</span></span>
<span id="cb13-284"><a href="#cb13-284"></a><span class="co">#| label: glp-illustration</span></span>
<span id="cb13-285"><a href="#cb13-285"></a><span class="co">#| fig-cap: "GLP marginal likelihood optimization"</span></span>
<span id="cb13-286"><a href="#cb13-286"></a></span>
<span id="cb13-287"><a href="#cb13-287"></a><span class="co"># Illustrate marginal likelihood as function of lambda</span></span>
<span id="cb13-288"><a href="#cb13-288"></a><span class="co"># (Simulated for illustration)</span></span>
<span id="cb13-289"><a href="#cb13-289"></a>lambda_grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">50</span>)</span>
<span id="cb13-290"><a href="#cb13-290"></a></span>
<span id="cb13-291"><a href="#cb13-291"></a><span class="co"># Simulated marginal likelihood (realistic shape)</span></span>
<span id="cb13-292"><a href="#cb13-292"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb13-293"><a href="#cb13-293"></a>ml_values <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">50</span> <span class="sc">-</span> <span class="dv">20</span><span class="sc">*</span>(lambda_grid <span class="sc">-</span> <span class="fl">0.25</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb13-294"><a href="#cb13-294"></a></span>
<span id="cb13-295"><a href="#cb13-295"></a>ml_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">lambda =</span> lambda_grid, <span class="at">log_ml =</span> ml_values)</span>
<span id="cb13-296"><a href="#cb13-296"></a>optimal_lambda <span class="ot">&lt;-</span> lambda_grid[<span class="fu">which.max</span>(ml_values)]</span>
<span id="cb13-297"><a href="#cb13-297"></a></span>
<span id="cb13-298"><a href="#cb13-298"></a><span class="fu">ggplot</span>(ml_df, <span class="fu">aes</span>(<span class="at">x =</span> lambda, <span class="at">y =</span> log_ml)) <span class="sc">+</span></span>
<span id="cb13-299"><a href="#cb13-299"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"#3498db"</span>) <span class="sc">+</span></span>
<span id="cb13-300"><a href="#cb13-300"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> optimal_lambda, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb13-301"><a href="#cb13-301"></a>  <span class="fu">annotate</span>(<span class="st">"point"</span>, <span class="at">x =</span> optimal_lambda, <span class="at">y =</span> <span class="fu">max</span>(ml_values),</span>
<span id="cb13-302"><a href="#cb13-302"></a>           <span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb13-303"><a href="#cb13-303"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> optimal_lambda <span class="sc">+</span> <span class="fl">0.05</span>, <span class="at">y =</span> <span class="fu">max</span>(ml_values) <span class="sc">-</span> <span class="dv">5</span>,</span>
<span id="cb13-304"><a href="#cb13-304"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"λ* = "</span>, <span class="fu">round</span>(optimal_lambda, <span class="dv">2</span>)), <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb13-305"><a href="#cb13-305"></a>           <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb13-306"><a href="#cb13-306"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"GLP: Marginal Likelihood Optimization"</span>,</span>
<span id="cb13-307"><a href="#cb13-307"></a>       <span class="at">subtitle =</span> <span class="st">"Optimal shrinkage is data-determined"</span>,</span>
<span id="cb13-308"><a href="#cb13-308"></a>       <span class="at">x =</span> <span class="fu">expression</span>(lambda[<span class="dv">1</span>] <span class="sc">~</span> <span class="st">"(Overall Tightness)"</span>),</span>
<span id="cb13-309"><a href="#cb13-309"></a>       <span class="at">y =</span> <span class="st">"Log Marginal Likelihood"</span>)</span>
<span id="cb13-310"><a href="#cb13-310"></a><span class="in">```</span></span>
<span id="cb13-311"><a href="#cb13-311"></a></span>
<span id="cb13-312"><a href="#cb13-312"></a><span class="fu">## Additional Priors: Sum-of-Coefficients and No-Cointegration</span></span>
<span id="cb13-313"><a href="#cb13-313"></a></span>
<span id="cb13-314"><a href="#cb13-314"></a>GLP (2015) also optimizes over additional priors that improve forecasting:</span>
<span id="cb13-315"><a href="#cb13-315"></a></span>
<span id="cb13-316"><a href="#cb13-316"></a><span class="fu">### Sum-of-Coefficients (Doan-Litterman-Sims)</span></span>
<span id="cb13-317"><a href="#cb13-317"></a></span>
<span id="cb13-318"><a href="#cb13-318"></a>Belief: If all variables equal their sample means, the forecast should also be the mean.</span>
<span id="cb13-319"><a href="#cb13-319"></a></span>
<span id="cb13-320"><a href="#cb13-320"></a>Implemented by adding dummy observations. Controlled by hyperparameter $\mu$.</span>
<span id="cb13-321"><a href="#cb13-321"></a></span>
<span id="cb13-322"><a href="#cb13-322"></a><span class="fu">### No-Cointegration (Sims-Zha)</span></span>
<span id="cb13-323"><a href="#cb13-323"></a></span>
<span id="cb13-324"><a href="#cb13-324"></a>Belief: Variables have unit roots but are not cointegrated.</span>
<span id="cb13-325"><a href="#cb13-325"></a></span>
<span id="cb13-326"><a href="#cb13-326"></a>Also implemented via dummy observations. Controlled by hyperparameter $\delta$.</span>
<span id="cb13-327"><a href="#cb13-327"></a></span>
<span id="cb13-328"><a href="#cb13-328"></a>**GLP jointly optimizes** $(\lambda_1, \lambda_2, \mu, \delta)$ via marginal likelihood.</span>
<span id="cb13-329"><a href="#cb13-329"></a></span>
<span id="cb13-330"><a href="#cb13-330"></a><span class="fu"># Gibbs Sampling for BVAR {.unnumbered}</span></span>
<span id="cb13-331"><a href="#cb13-331"></a></span>
<span id="cb13-332"><a href="#cb13-332"></a>While the NIW prior allows analytical posteriors, we often use **Gibbs sampling** to:</span>
<span id="cb13-333"><a href="#cb13-333"></a><span class="ss">- </span>Easily compute posterior quantities (IRFs, FEVDs)</span>
<span id="cb13-334"><a href="#cb13-334"></a><span class="ss">- </span>Extend to non-conjugate priors</span>
<span id="cb13-335"><a href="#cb13-335"></a><span class="ss">- </span>Handle structural identification</span>
<span id="cb13-336"><a href="#cb13-336"></a></span>
<span id="cb13-337"><a href="#cb13-337"></a><span class="fu">## The Gibbs Sampler</span></span>
<span id="cb13-338"><a href="#cb13-338"></a></span>
<span id="cb13-339"><a href="#cb13-339"></a>**Block 1**: Draw $B | \Sigma, Y$</span>
<span id="cb13-340"><a href="#cb13-340"></a>$$</span>
<span id="cb13-341"><a href="#cb13-341"></a>\text{vec}(B) | \Sigma, Y \sim N(\text{vec}(B_{\text{post}}), \Sigma \otimes V_{\text{post}})</span>
<span id="cb13-342"><a href="#cb13-342"></a>$$</span>
<span id="cb13-343"><a href="#cb13-343"></a></span>
<span id="cb13-344"><a href="#cb13-344"></a>**Block 2**: Draw $\Sigma | B, Y$</span>
<span id="cb13-345"><a href="#cb13-345"></a>$$</span>
<span id="cb13-346"><a href="#cb13-346"></a>\Sigma | B, Y \sim \text{Inverse-Wishart}(S_{\text{post}}, \nu_{\text{post}})</span>
<span id="cb13-347"><a href="#cb13-347"></a>$$</span>
<span id="cb13-348"><a href="#cb13-348"></a></span>
<span id="cb13-349"><a href="#cb13-349"></a>Iterate for $G$ draws, discarding the first $B_{\text{burn}}$ as burn-in.</span>
<span id="cb13-350"><a href="#cb13-350"></a></span>
<span id="cb13-353"><a href="#cb13-353"></a><span class="in">```{r}</span></span>
<span id="cb13-354"><a href="#cb13-354"></a><span class="co">#| label: gibbs-bvar</span></span>
<span id="cb13-355"><a href="#cb13-355"></a><span class="co">#| fig-cap: "Gibbs sampler trace plots for BVAR coefficient"</span></span>
<span id="cb13-356"><a href="#cb13-356"></a></span>
<span id="cb13-357"><a href="#cb13-357"></a><span class="co"># Simplified BVAR Gibbs sampler demonstration</span></span>
<span id="cb13-358"><a href="#cb13-358"></a><span class="co"># Generate synthetic VAR(1) data</span></span>
<span id="cb13-359"><a href="#cb13-359"></a>T_obs <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb13-360"><a href="#cb13-360"></a>K <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb13-361"><a href="#cb13-361"></a></span>
<span id="cb13-362"><a href="#cb13-362"></a><span class="co"># True parameters</span></span>
<span id="cb13-363"><a href="#cb13-363"></a>A_true <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>, <span class="fl">0.7</span>), K, K)</span>
<span id="cb13-364"><a href="#cb13-364"></a>Sigma_true <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="dv">1</span>), K, K)</span>
<span id="cb13-365"><a href="#cb13-365"></a></span>
<span id="cb13-366"><a href="#cb13-366"></a><span class="co"># Generate data</span></span>
<span id="cb13-367"><a href="#cb13-367"></a>Y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, T_obs, K)</span>
<span id="cb13-368"><a href="#cb13-368"></a>Y[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(K)</span>
<span id="cb13-369"><a href="#cb13-369"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>T_obs) {</span>
<span id="cb13-370"><a href="#cb13-370"></a>  Y[t, ] <span class="ot">&lt;-</span> Y[t<span class="dv">-1</span>, ] <span class="sc">%*%</span> <span class="fu">t</span>(A_true) <span class="sc">+</span> <span class="fu">rmvnorm</span>(<span class="dv">1</span>, <span class="at">sigma =</span> Sigma_true)</span>
<span id="cb13-371"><a href="#cb13-371"></a>}</span>
<span id="cb13-372"><a href="#cb13-372"></a></span>
<span id="cb13-373"><a href="#cb13-373"></a><span class="co"># Build matrices</span></span>
<span id="cb13-374"><a href="#cb13-374"></a>y <span class="ot">&lt;-</span> Y[<span class="dv">2</span><span class="sc">:</span>T_obs, ]</span>
<span id="cb13-375"><a href="#cb13-375"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, Y[<span class="dv">1</span><span class="sc">:</span>(T_obs<span class="dv">-1</span>), ])</span>
<span id="cb13-376"><a href="#cb13-376"></a>T_eff <span class="ot">&lt;-</span> <span class="fu">nrow</span>(y)</span>
<span id="cb13-377"><a href="#cb13-377"></a>M <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb13-378"><a href="#cb13-378"></a></span>
<span id="cb13-379"><a href="#cb13-379"></a><span class="co"># Minnesota-style prior</span></span>
<span id="cb13-380"><a href="#cb13-380"></a>B0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, M, K)</span>
<span id="cb13-381"><a href="#cb13-381"></a>B0[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, ] <span class="ot">&lt;-</span> <span class="fu">diag</span>(K) <span class="sc">*</span> <span class="fl">0.9</span>  <span class="co"># Prior: close to random walk</span></span>
<span id="cb13-382"><a href="#cb13-382"></a></span>
<span id="cb13-383"><a href="#cb13-383"></a><span class="co"># Prior precision (diagonal, tight) - must be (M*K) x (M*K) for vec(B)</span></span>
<span id="cb13-384"><a href="#cb13-384"></a>lambda1 <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb13-385"><a href="#cb13-385"></a><span class="co"># Build prior variance for each coefficient in vec(B)</span></span>
<span id="cb13-386"><a href="#cb13-386"></a><span class="co"># Structure: [const_eq1, y1_eq1, y2_eq1, const_eq2, y1_eq2, y2_eq2]</span></span>
<span id="cb13-387"><a href="#cb13-387"></a>v0_diag <span class="ot">&lt;-</span> <span class="fu">numeric</span>(M <span class="sc">*</span> K)</span>
<span id="cb13-388"><a href="#cb13-388"></a><span class="cf">for</span> (eq <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K) {</span>
<span id="cb13-389"><a href="#cb13-389"></a>  idx_const <span class="ot">&lt;-</span> (eq <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> M <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-390"><a href="#cb13-390"></a>  v0_diag[idx_const] <span class="ot">&lt;-</span> <span class="dv">100</span>  <span class="co"># Loose prior on constant</span></span>
<span id="cb13-391"><a href="#cb13-391"></a>  <span class="cf">for</span> (var <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K) {</span>
<span id="cb13-392"><a href="#cb13-392"></a>    idx_var <span class="ot">&lt;-</span> (eq <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> M <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> var</span>
<span id="cb13-393"><a href="#cb13-393"></a>    v0_diag[idx_var] <span class="ot">&lt;-</span> lambda1<span class="sc">^</span><span class="dv">2</span>  <span class="co"># Tight prior on AR coefficients</span></span>
<span id="cb13-394"><a href="#cb13-394"></a>  }</span>
<span id="cb13-395"><a href="#cb13-395"></a>}</span>
<span id="cb13-396"><a href="#cb13-396"></a>V0_inv <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span> <span class="sc">/</span> v0_diag)</span>
<span id="cb13-397"><a href="#cb13-397"></a></span>
<span id="cb13-398"><a href="#cb13-398"></a><span class="co"># Prior for Sigma</span></span>
<span id="cb13-399"><a href="#cb13-399"></a>nu0 <span class="ot">&lt;-</span> K <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb13-400"><a href="#cb13-400"></a>S0 <span class="ot">&lt;-</span> <span class="fu">diag</span>(K)</span>
<span id="cb13-401"><a href="#cb13-401"></a></span>
<span id="cb13-402"><a href="#cb13-402"></a><span class="co"># Gibbs sampler</span></span>
<span id="cb13-403"><a href="#cb13-403"></a>n_draw <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb13-404"><a href="#cb13-404"></a>n_burn <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb13-405"><a href="#cb13-405"></a>B_draws <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(M, K, n_draw))</span>
<span id="cb13-406"><a href="#cb13-406"></a>Sigma_draws <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(K, K, n_draw))</span>
<span id="cb13-407"><a href="#cb13-407"></a></span>
<span id="cb13-408"><a href="#cb13-408"></a><span class="co"># Initialize</span></span>
<span id="cb13-409"><a href="#cb13-409"></a>B_curr <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">crossprod</span>(X)) <span class="sc">%*%</span> <span class="fu">crossprod</span>(X, y)</span>
<span id="cb13-410"><a href="#cb13-410"></a>Sigma_curr <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(y <span class="sc">-</span> X <span class="sc">%*%</span> B_curr) <span class="sc">/</span> T_eff</span>
<span id="cb13-411"><a href="#cb13-411"></a></span>
<span id="cb13-412"><a href="#cb13-412"></a><span class="cf">for</span> (g <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n_draw <span class="sc">+</span> n_burn)) {</span>
<span id="cb13-413"><a href="#cb13-413"></a>  <span class="co"># Draw B | Sigma using vectorized form</span></span>
<span id="cb13-414"><a href="#cb13-414"></a>  <span class="co"># vec(B) | Sigma ~ N(b_post, V_post) where V_post = (V0_inv + Sigma^{-1} ⊗ X'X)^{-1}</span></span>
<span id="cb13-415"><a href="#cb13-415"></a>  Sigma_inv <span class="ot">&lt;-</span> <span class="fu">solve</span>(Sigma_curr)</span>
<span id="cb13-416"><a href="#cb13-416"></a>  V_post_inv <span class="ot">&lt;-</span> V0_inv <span class="sc">+</span> <span class="fu">kronecker</span>(Sigma_inv, <span class="fu">crossprod</span>(X))</span>
<span id="cb13-417"><a href="#cb13-417"></a>  V_post <span class="ot">&lt;-</span> <span class="fu">solve</span>(V_post_inv)</span>
<span id="cb13-418"><a href="#cb13-418"></a>  b_post <span class="ot">&lt;-</span> V_post <span class="sc">%*%</span> (V0_inv <span class="sc">%*%</span> <span class="fu">as.vector</span>(B0) <span class="sc">+</span></span>
<span id="cb13-419"><a href="#cb13-419"></a>                         <span class="fu">kronecker</span>(Sigma_inv, <span class="fu">t</span>(X)) <span class="sc">%*%</span> <span class="fu">as.vector</span>(y))</span>
<span id="cb13-420"><a href="#cb13-420"></a>  B_curr <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rmvnorm</span>(<span class="dv">1</span>, b_post, V_post), M, K)</span>
<span id="cb13-421"><a href="#cb13-421"></a></span>
<span id="cb13-422"><a href="#cb13-422"></a>  <span class="co"># Draw Sigma | B</span></span>
<span id="cb13-423"><a href="#cb13-423"></a>  U <span class="ot">&lt;-</span> y <span class="sc">-</span> X <span class="sc">%*%</span> B_curr</span>
<span id="cb13-424"><a href="#cb13-424"></a>  S_post <span class="ot">&lt;-</span> S0 <span class="sc">+</span> <span class="fu">crossprod</span>(U)</span>
<span id="cb13-425"><a href="#cb13-425"></a>  Sigma_curr <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">rWishart</span>(<span class="dv">1</span>, nu0 <span class="sc">+</span> T_eff, <span class="fu">solve</span>(S_post))[,,<span class="dv">1</span>])</span>
<span id="cb13-426"><a href="#cb13-426"></a></span>
<span id="cb13-427"><a href="#cb13-427"></a>  <span class="co"># Store</span></span>
<span id="cb13-428"><a href="#cb13-428"></a>  <span class="cf">if</span> (g <span class="sc">&gt;</span> n_burn) {</span>
<span id="cb13-429"><a href="#cb13-429"></a>    B_draws[,,g <span class="sc">-</span> n_burn] <span class="ot">&lt;-</span> B_curr</span>
<span id="cb13-430"><a href="#cb13-430"></a>    Sigma_draws[,,g <span class="sc">-</span> n_burn] <span class="ot">&lt;-</span> Sigma_curr</span>
<span id="cb13-431"><a href="#cb13-431"></a>  }</span>
<span id="cb13-432"><a href="#cb13-432"></a>}</span>
<span id="cb13-433"><a href="#cb13-433"></a></span>
<span id="cb13-434"><a href="#cb13-434"></a><span class="co"># Trace plot for A[1,1]</span></span>
<span id="cb13-435"><a href="#cb13-435"></a>trace_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb13-436"><a href="#cb13-436"></a>  <span class="at">iteration =</span> <span class="dv">1</span><span class="sc">:</span>n_draw,</span>
<span id="cb13-437"><a href="#cb13-437"></a>  <span class="at">value =</span> B_draws[<span class="dv">2</span>, <span class="dv">1</span>, ]  <span class="co"># A[1,1] coefficient</span></span>
<span id="cb13-438"><a href="#cb13-438"></a>)</span>
<span id="cb13-439"><a href="#cb13-439"></a></span>
<span id="cb13-440"><a href="#cb13-440"></a><span class="fu">ggplot</span>(trace_df, <span class="fu">aes</span>(<span class="at">x =</span> iteration, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb13-441"><a href="#cb13-441"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"#3498db"</span>) <span class="sc">+</span></span>
<span id="cb13-442"><a href="#cb13-442"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> A_true[<span class="dv">1</span>,<span class="dv">1</span>], <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb13-443"><a href="#cb13-443"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(trace_df<span class="sc">$</span>value), <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">color =</span> <span class="st">"#2ecc71"</span>) <span class="sc">+</span></span>
<span id="cb13-444"><a href="#cb13-444"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> n_draw <span class="sc">*</span> <span class="fl">0.8</span>, <span class="at">y =</span> A_true[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">+</span> <span class="fl">0.05</span>,</span>
<span id="cb13-445"><a href="#cb13-445"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"True = "</span>, A_true[<span class="dv">1</span>,<span class="dv">1</span>]), <span class="at">color =</span> <span class="st">"#e74c3c"</span>) <span class="sc">+</span></span>
<span id="cb13-446"><a href="#cb13-446"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gibbs Sampler: Trace Plot for VAR Coefficient"</span>,</span>
<span id="cb13-447"><a href="#cb13-447"></a>       <span class="at">subtitle =</span> <span class="st">"Green = posterior mean, Red = true value"</span>,</span>
<span id="cb13-448"><a href="#cb13-448"></a>       <span class="at">x =</span> <span class="st">"Iteration (post burn-in)"</span>, <span class="at">y =</span> <span class="fu">expression</span>(A[<span class="dv">11</span>]))</span>
<span id="cb13-449"><a href="#cb13-449"></a><span class="in">```</span></span>
<span id="cb13-450"><a href="#cb13-450"></a></span>
<span id="cb13-451"><a href="#cb13-451"></a><span class="fu"># Structural Identification in BVAR {.unnumbered}</span></span>
<span id="cb13-452"><a href="#cb13-452"></a></span>
<span id="cb13-453"><a href="#cb13-453"></a>Bayesian VARs estimate **reduced-form** parameters $(B, \Sigma)$. For structural analysis, we need to identify structural shocks.</span>
<span id="cb13-454"><a href="#cb13-454"></a></span>
<span id="cb13-455"><a href="#cb13-455"></a><span class="fu">## Cholesky Identification</span></span>
<span id="cb13-456"><a href="#cb13-456"></a></span>
<span id="cb13-457"><a href="#cb13-457"></a>The simplest approach: impose a recursive structure.</span>
<span id="cb13-458"><a href="#cb13-458"></a></span>
<span id="cb13-459"><a href="#cb13-459"></a>$$</span>
<span id="cb13-460"><a href="#cb13-460"></a>\Sigma = PP', \quad P = \text{chol}(\Sigma, \text{lower})</span>
<span id="cb13-461"><a href="#cb13-461"></a>$$</span>
<span id="cb13-462"><a href="#cb13-462"></a></span>
<span id="cb13-463"><a href="#cb13-463"></a>For each posterior draw $\Sigma^{(g)}$, compute $P^{(g)} = \text{chol}(\Sigma^{(g)})$.</span>
<span id="cb13-464"><a href="#cb13-464"></a></span>
<span id="cb13-465"><a href="#cb13-465"></a>The ordering matters: variable ordered first is not affected contemporaneously by others.</span>
<span id="cb13-466"><a href="#cb13-466"></a></span>
<span id="cb13-467"><a href="#cb13-467"></a><span class="fu">## Sign Restrictions in BVAR</span></span>
<span id="cb13-468"><a href="#cb13-468"></a></span>
<span id="cb13-469"><a href="#cb13-469"></a>Bayesian framework naturally handles set-identification:</span>
<span id="cb13-470"><a href="#cb13-470"></a></span>
<span id="cb13-471"><a href="#cb13-471"></a><span class="ss">1. </span>For each posterior draw $(B^{(g)}, \Sigma^{(g)})$:</span>
<span id="cb13-472"><a href="#cb13-472"></a>   a. Compute $P^{(g)} = \text{chol}(\Sigma^{(g)})$</span>
<span id="cb13-473"><a href="#cb13-473"></a>   b. Draw orthogonal rotation $Q$ uniformly</span>
<span id="cb13-474"><a href="#cb13-474"></a>   c. Candidate impact: $\tilde{P}^{(g)} = P^{(g)} Q$</span>
<span id="cb13-475"><a href="#cb13-475"></a>   d. Check sign restrictions on IRFs</span>
<span id="cb13-476"><a href="#cb13-476"></a>   e. If satisfied: keep. Otherwise: redraw $Q$</span>
<span id="cb13-477"><a href="#cb13-477"></a><span class="ss">2. </span>Report distribution across accepted draws</span>
<span id="cb13-478"><a href="#cb13-478"></a></span>
<span id="cb13-481"><a href="#cb13-481"></a><span class="in">```{r}</span></span>
<span id="cb13-482"><a href="#cb13-482"></a><span class="co">#| label: sign-restrictions</span></span>
<span id="cb13-483"><a href="#cb13-483"></a></span>
<span id="cb13-484"><a href="#cb13-484"></a><span class="co"># Sign restriction: monetary tightening</span></span>
<span id="cb13-485"><a href="#cb13-485"></a><span class="co"># - Raises interest rate (positive)</span></span>
<span id="cb13-486"><a href="#cb13-486"></a><span class="co"># - Lowers output (negative)</span></span>
<span id="cb13-487"><a href="#cb13-487"></a><span class="co"># - Lowers inflation (negative)</span></span>
<span id="cb13-488"><a href="#cb13-488"></a></span>
<span id="cb13-489"><a href="#cb13-489"></a>restrictions <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb13-490"><a href="#cb13-490"></a>  <span class="at">Variable =</span> <span class="fu">c</span>(<span class="st">"Interest Rate"</span>, <span class="st">"Output"</span>, <span class="st">"Inflation"</span>),</span>
<span id="cb13-491"><a href="#cb13-491"></a>  <span class="at">Sign =</span> <span class="fu">c</span>(<span class="st">"+"</span>, <span class="st">"-"</span>, <span class="st">"-"</span>),</span>
<span id="cb13-492"><a href="#cb13-492"></a>  <span class="at">Interpretation =</span> <span class="fu">c</span>(<span class="st">"Policy instrument"</span>, <span class="st">"Demand falls"</span>, <span class="st">"Prices fall"</span>)</span>
<span id="cb13-493"><a href="#cb13-493"></a>)</span>
<span id="cb13-494"><a href="#cb13-494"></a></span>
<span id="cb13-495"><a href="#cb13-495"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(restrictions,</span>
<span id="cb13-496"><a href="#cb13-496"></a>             <span class="at">caption =</span> <span class="st">"Example Sign Restrictions for Monetary Policy Shock"</span>)</span>
<span id="cb13-497"><a href="#cb13-497"></a><span class="in">```</span></span>
<span id="cb13-498"><a href="#cb13-498"></a></span>
<span id="cb13-499"><a href="#cb13-499"></a><span class="fu"># IRFs and FEVDs from Posterior {.unnumbered}</span></span>
<span id="cb13-500"><a href="#cb13-500"></a></span>
<span id="cb13-501"><a href="#cb13-501"></a><span class="fu">## Computing Posterior IRFs</span></span>
<span id="cb13-502"><a href="#cb13-502"></a></span>
<span id="cb13-503"><a href="#cb13-503"></a>For each posterior draw $(B^{(g)}, \Sigma^{(g)})$:</span>
<span id="cb13-504"><a href="#cb13-504"></a></span>
<span id="cb13-505"><a href="#cb13-505"></a><span class="ss">1. </span>Extract coefficient matrices $A_1^{(g)}, \ldots, A_p^{(g)}$ from $B^{(g)}$</span>
<span id="cb13-506"><a href="#cb13-506"></a><span class="ss">2. </span>Compute structural impact $P^{(g)}$ (Cholesky or sign-restricted)</span>
<span id="cb13-507"><a href="#cb13-507"></a><span class="ss">3. </span>Compute IRF at each horizon using MA representation:</span>
<span id="cb13-508"><a href="#cb13-508"></a>   $$</span>
<span id="cb13-509"><a href="#cb13-509"></a>   \Phi_h = \sum_{j=1}^{\min(h,p)} \Phi_{h-j} A_j, \quad \Phi_0 = I</span>
<span id="cb13-510"><a href="#cb13-510"></a>   $$</span>
<span id="cb13-511"><a href="#cb13-511"></a><span class="ss">4. </span>Structural IRF: $\text{IRF}_h = \Phi_h P$</span>
<span id="cb13-512"><a href="#cb13-512"></a></span>
<span id="cb13-513"><a href="#cb13-513"></a>Report **posterior median** and **credible bands** (68%, 95%).</span>
<span id="cb13-514"><a href="#cb13-514"></a></span>
<span id="cb13-517"><a href="#cb13-517"></a><span class="in">```{r}</span></span>
<span id="cb13-518"><a href="#cb13-518"></a><span class="co">#| label: posterior-irfs</span></span>
<span id="cb13-519"><a href="#cb13-519"></a><span class="co">#| fig-cap: "Impulse responses with posterior credible bands"</span></span>
<span id="cb13-520"><a href="#cb13-520"></a></span>
<span id="cb13-521"><a href="#cb13-521"></a><span class="co"># Compute IRFs from Gibbs draws</span></span>
<span id="cb13-522"><a href="#cb13-522"></a>H <span class="ot">&lt;-</span> <span class="dv">20</span>  <span class="co"># horizons</span></span>
<span id="cb13-523"><a href="#cb13-523"></a>K <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb13-524"><a href="#cb13-524"></a>n_draws_use <span class="ot">&lt;-</span> <span class="dv">500</span>  <span class="co"># use subset for speed</span></span>
<span id="cb13-525"><a href="#cb13-525"></a></span>
<span id="cb13-526"><a href="#cb13-526"></a>IRF_draws <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(K, K, H<span class="sc">+</span><span class="dv">1</span>, n_draws_use))</span>
<span id="cb13-527"><a href="#cb13-527"></a></span>
<span id="cb13-528"><a href="#cb13-528"></a><span class="cf">for</span> (g <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_draws_use) {</span>
<span id="cb13-529"><a href="#cb13-529"></a>  <span class="co"># Extract A matrix (coefficients on lagged Y)</span></span>
<span id="cb13-530"><a href="#cb13-530"></a>  A1 <span class="ot">&lt;-</span> <span class="fu">t</span>(B_draws[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, , g])</span>
<span id="cb13-531"><a href="#cb13-531"></a></span>
<span id="cb13-532"><a href="#cb13-532"></a>  <span class="co"># Cholesky impact</span></span>
<span id="cb13-533"><a href="#cb13-533"></a>  P <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">chol</span>(Sigma_draws[,,g]))</span>
<span id="cb13-534"><a href="#cb13-534"></a></span>
<span id="cb13-535"><a href="#cb13-535"></a>  <span class="co"># Compute IRFs</span></span>
<span id="cb13-536"><a href="#cb13-536"></a>  Phi <span class="ot">&lt;-</span> <span class="fu">diag</span>(K)</span>
<span id="cb13-537"><a href="#cb13-537"></a>  IRF_draws[,,<span class="dv">1</span>,g] <span class="ot">&lt;-</span> P</span>
<span id="cb13-538"><a href="#cb13-538"></a></span>
<span id="cb13-539"><a href="#cb13-539"></a>  <span class="cf">for</span> (h <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>H) {</span>
<span id="cb13-540"><a href="#cb13-540"></a>    Phi <span class="ot">&lt;-</span> Phi <span class="sc">%*%</span> A1</span>
<span id="cb13-541"><a href="#cb13-541"></a>    IRF_draws[,,h<span class="sc">+</span><span class="dv">1</span>,g] <span class="ot">&lt;-</span> Phi <span class="sc">%*%</span> P</span>
<span id="cb13-542"><a href="#cb13-542"></a>  }</span>
<span id="cb13-543"><a href="#cb13-543"></a>}</span>
<span id="cb13-544"><a href="#cb13-544"></a></span>
<span id="cb13-545"><a href="#cb13-545"></a><span class="co"># Extract IRF of variable 1 to shock 1</span></span>
<span id="cb13-546"><a href="#cb13-546"></a>irf_11 <span class="ot">&lt;-</span> IRF_draws[<span class="dv">1</span>, <span class="dv">1</span>, , ]</span>
<span id="cb13-547"><a href="#cb13-547"></a></span>
<span id="cb13-548"><a href="#cb13-548"></a><span class="co"># Posterior summaries</span></span>
<span id="cb13-549"><a href="#cb13-549"></a>irf_median <span class="ot">&lt;-</span> <span class="fu">apply</span>(irf_11, <span class="dv">1</span>, median)</span>
<span id="cb13-550"><a href="#cb13-550"></a>irf_lower <span class="ot">&lt;-</span> <span class="fu">apply</span>(irf_11, <span class="dv">1</span>, quantile, <span class="fl">0.16</span>)</span>
<span id="cb13-551"><a href="#cb13-551"></a>irf_upper <span class="ot">&lt;-</span> <span class="fu">apply</span>(irf_11, <span class="dv">1</span>, quantile, <span class="fl">0.84</span>)</span>
<span id="cb13-552"><a href="#cb13-552"></a>irf_lower95 <span class="ot">&lt;-</span> <span class="fu">apply</span>(irf_11, <span class="dv">1</span>, quantile, <span class="fl">0.025</span>)</span>
<span id="cb13-553"><a href="#cb13-553"></a>irf_upper95 <span class="ot">&lt;-</span> <span class="fu">apply</span>(irf_11, <span class="dv">1</span>, quantile, <span class="fl">0.975</span>)</span>
<span id="cb13-554"><a href="#cb13-554"></a></span>
<span id="cb13-555"><a href="#cb13-555"></a>irf_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb13-556"><a href="#cb13-556"></a>  <span class="at">horizon =</span> <span class="dv">0</span><span class="sc">:</span>H,</span>
<span id="cb13-557"><a href="#cb13-557"></a>  <span class="at">median =</span> irf_median,</span>
<span id="cb13-558"><a href="#cb13-558"></a>  <span class="at">lower68 =</span> irf_lower,</span>
<span id="cb13-559"><a href="#cb13-559"></a>  <span class="at">upper68 =</span> irf_upper,</span>
<span id="cb13-560"><a href="#cb13-560"></a>  <span class="at">lower95 =</span> irf_lower95,</span>
<span id="cb13-561"><a href="#cb13-561"></a>  <span class="at">upper95 =</span> irf_upper95</span>
<span id="cb13-562"><a href="#cb13-562"></a>)</span>
<span id="cb13-563"><a href="#cb13-563"></a></span>
<span id="cb13-564"><a href="#cb13-564"></a><span class="fu">ggplot</span>(irf_df, <span class="fu">aes</span>(<span class="at">x =</span> horizon)) <span class="sc">+</span></span>
<span id="cb13-565"><a href="#cb13-565"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower95, <span class="at">ymax =</span> upper95), <span class="at">fill =</span> <span class="st">"#3498db"</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb13-566"><a href="#cb13-566"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower68, <span class="at">ymax =</span> upper68), <span class="at">fill =</span> <span class="st">"#3498db"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb13-567"><a href="#cb13-567"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> median), <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"#2c3e50"</span>) <span class="sc">+</span></span>
<span id="cb13-568"><a href="#cb13-568"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb13-569"><a href="#cb13-569"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Bayesian VAR: Impulse Response Function"</span>,</span>
<span id="cb13-570"><a href="#cb13-570"></a>       <span class="at">subtitle =</span> <span class="st">"Posterior median with 68% and 95% credible bands"</span>,</span>
<span id="cb13-571"><a href="#cb13-571"></a>       <span class="at">x =</span> <span class="st">"Horizon"</span>, <span class="at">y =</span> <span class="st">"Response of Y1 to Shock 1"</span>)</span>
<span id="cb13-572"><a href="#cb13-572"></a><span class="in">```</span></span>
<span id="cb13-573"><a href="#cb13-573"></a></span>
<span id="cb13-574"><a href="#cb13-574"></a><span class="fu">## Forecast Error Variance Decomposition</span></span>
<span id="cb13-575"><a href="#cb13-575"></a></span>
<span id="cb13-576"><a href="#cb13-576"></a>FEVD at horizon $h$:</span>
<span id="cb13-577"><a href="#cb13-577"></a>$$</span>
<span id="cb13-578"><a href="#cb13-578"></a>\text{FEVD}_{i,j}(h) = \frac{\sum_{s=0}^{h} (\text{IRF}_{i,j,s})^2}{\sum_{s=0}^{h} \sum_{k=1}^{K} (\text{IRF}_{i,k,s})^2}</span>
<span id="cb13-579"><a href="#cb13-579"></a>$$</span>
<span id="cb13-580"><a href="#cb13-580"></a></span>
<span id="cb13-581"><a href="#cb13-581"></a>Compute for each posterior draw, report median and bands.</span>
<span id="cb13-582"><a href="#cb13-582"></a></span>
<span id="cb13-583"><a href="#cb13-583"></a><span class="fu"># Implementation in R {.unnumbered}</span></span>
<span id="cb13-584"><a href="#cb13-584"></a></span>
<span id="cb13-585"><a href="#cb13-585"></a><span class="fu">## Using the `BVAR` Package</span></span>
<span id="cb13-586"><a href="#cb13-586"></a></span>
<span id="cb13-587"><a href="#cb13-587"></a>The <span class="in">`BVAR`</span> package implements Minnesota priors with GLP-style optimization.</span>
<span id="cb13-588"><a href="#cb13-588"></a></span>
<span id="cb13-589"><a href="#cb13-589"></a><span class="in">```r</span></span>
<span id="cb13-590"><a href="#cb13-590"></a><span class="fu">library</span>(BVAR)</span>
<span id="cb13-591"><a href="#cb13-591"></a></span>
<span id="cb13-592"><a href="#cb13-592"></a><span class="co"># Prepare data (T × K matrix)</span></span>
<span id="cb13-593"><a href="#cb13-593"></a>data_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(macro_data[, <span class="fu">c</span>(<span class="st">"gdp_growth"</span>, <span class="st">"inflation"</span>, <span class="st">"interest_rate"</span>)])</span>
<span id="cb13-594"><a href="#cb13-594"></a></span>
<span id="cb13-595"><a href="#cb13-595"></a><span class="co"># Minnesota prior with GLP optimization</span></span>
<span id="cb13-596"><a href="#cb13-596"></a>mn_prior <span class="ot">&lt;-</span> <span class="fu">bv_minnesota</span>(</span>
<span id="cb13-597"><a href="#cb13-597"></a>  <span class="at">lambda =</span> <span class="fu">bv_lambda</span>(<span class="at">mode =</span> <span class="fl">0.2</span>, <span class="at">sd =</span> <span class="fl">0.4</span>, <span class="at">min =</span> <span class="fl">0.0001</span>, <span class="at">max =</span> <span class="dv">5</span>),</span>
<span id="cb13-598"><a href="#cb13-598"></a>  <span class="at">alpha =</span> <span class="fu">bv_alpha</span>(<span class="at">mode =</span> <span class="dv">2</span>),   <span class="co"># lag decay</span></span>
<span id="cb13-599"><a href="#cb13-599"></a>  <span class="at">var =</span> <span class="fl">1e07</span>                     <span class="co"># constant variance</span></span>
<span id="cb13-600"><a href="#cb13-600"></a>)</span>
<span id="cb13-601"><a href="#cb13-601"></a></span>
<span id="cb13-602"><a href="#cb13-602"></a><span class="co"># Estimate BVAR</span></span>
<span id="cb13-603"><a href="#cb13-603"></a>bvar_model <span class="ot">&lt;-</span> <span class="fu">bvar</span>(</span>
<span id="cb13-604"><a href="#cb13-604"></a>  <span class="at">data =</span> data_mat,</span>
<span id="cb13-605"><a href="#cb13-605"></a>  <span class="at">lags =</span> <span class="dv">4</span>,</span>
<span id="cb13-606"><a href="#cb13-606"></a>  <span class="at">n_draw =</span> <span class="dv">20000</span>,</span>
<span id="cb13-607"><a href="#cb13-607"></a>  <span class="at">n_burn =</span> <span class="dv">5000</span>,</span>
<span id="cb13-608"><a href="#cb13-608"></a>  <span class="at">priors =</span> mn_prior,</span>
<span id="cb13-609"><a href="#cb13-609"></a>  <span class="at">mh =</span> <span class="fu">bv_mh</span>(<span class="at">scale_hess =</span> <span class="fl">0.01</span>, <span class="at">adjust_acc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-610"><a href="#cb13-610"></a>)</span>
<span id="cb13-611"><a href="#cb13-611"></a></span>
<span id="cb13-612"><a href="#cb13-612"></a><span class="co"># Diagnostics</span></span>
<span id="cb13-613"><a href="#cb13-613"></a><span class="fu">summary</span>(bvar_model)</span>
<span id="cb13-614"><a href="#cb13-614"></a><span class="fu">plot</span>(bvar_model)  <span class="co"># trace plots</span></span>
<span id="cb13-615"><a href="#cb13-615"></a></span>
<span id="cb13-616"><a href="#cb13-616"></a><span class="co"># IRFs (Cholesky identification)</span></span>
<span id="cb13-617"><a href="#cb13-617"></a>irf_results <span class="ot">&lt;-</span> <span class="fu">irf</span>(bvar_model, <span class="at">horizon =</span> <span class="dv">20</span>, <span class="at">identification =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-618"><a href="#cb13-618"></a><span class="fu">plot</span>(irf_results)</span>
<span id="cb13-619"><a href="#cb13-619"></a></span>
<span id="cb13-620"><a href="#cb13-620"></a><span class="co"># FEVD</span></span>
<span id="cb13-621"><a href="#cb13-621"></a>fevd_results <span class="ot">&lt;-</span> <span class="fu">fevd</span>(bvar_model, <span class="at">horizon =</span> <span class="dv">20</span>)</span>
<span id="cb13-622"><a href="#cb13-622"></a><span class="fu">plot</span>(fevd_results)</span>
<span id="cb13-623"><a href="#cb13-623"></a></span>
<span id="cb13-624"><a href="#cb13-624"></a><span class="co"># Forecasting</span></span>
<span id="cb13-625"><a href="#cb13-625"></a>forecasts <span class="ot">&lt;-</span> <span class="fu">predict</span>(bvar_model, <span class="at">horizon =</span> <span class="dv">8</span>)</span>
<span id="cb13-626"><a href="#cb13-626"></a><span class="fu">plot</span>(forecasts)</span>
<span id="cb13-627"><a href="#cb13-627"></a><span class="in">```</span></span>
<span id="cb13-628"><a href="#cb13-628"></a></span>
<span id="cb13-629"><a href="#cb13-629"></a><span class="fu">## Using the `bvartools` Package</span></span>
<span id="cb13-630"><a href="#cb13-630"></a></span>
<span id="cb13-631"><a href="#cb13-631"></a>More flexible, allows custom prior specification.</span>
<span id="cb13-632"><a href="#cb13-632"></a></span>
<span id="cb13-633"><a href="#cb13-633"></a><span class="in">```r</span></span>
<span id="cb13-634"><a href="#cb13-634"></a><span class="fu">library</span>(bvartools)</span>
<span id="cb13-635"><a href="#cb13-635"></a></span>
<span id="cb13-636"><a href="#cb13-636"></a><span class="co"># Generate VAR data matrices</span></span>
<span id="cb13-637"><a href="#cb13-637"></a>bvar_data <span class="ot">&lt;-</span> <span class="fu">gen_var</span>(data_ts, <span class="at">p =</span> <span class="dv">4</span>, <span class="at">deterministic =</span> <span class="st">"const"</span>)</span>
<span id="cb13-638"><a href="#cb13-638"></a>y <span class="ot">&lt;-</span> <span class="fu">t</span>(bvar_data<span class="sc">$</span>data<span class="sc">$</span>Y)</span>
<span id="cb13-639"><a href="#cb13-639"></a>x <span class="ot">&lt;-</span> <span class="fu">t</span>(bvar_data<span class="sc">$</span>data<span class="sc">$</span>Z)</span>
<span id="cb13-640"><a href="#cb13-640"></a></span>
<span id="cb13-641"><a href="#cb13-641"></a><span class="co"># Set up Minnesota prior manually</span></span>
<span id="cb13-642"><a href="#cb13-642"></a>K <span class="ot">&lt;-</span> <span class="fu">ncol</span>(data_mat)</span>
<span id="cb13-643"><a href="#cb13-643"></a>M <span class="ot">&lt;-</span> K <span class="sc">*</span> <span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-644"><a href="#cb13-644"></a></span>
<span id="cb13-645"><a href="#cb13-645"></a><span class="co"># Prior mean: random walk on first lag</span></span>
<span id="cb13-646"><a href="#cb13-646"></a>a_mu_prior <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, M, K)</span>
<span id="cb13-647"><a href="#cb13-647"></a>a_mu_prior[<span class="dv">2</span><span class="sc">:</span>(K<span class="sc">+</span><span class="dv">1</span>), ] <span class="ot">&lt;-</span> <span class="fu">diag</span>(K)</span>
<span id="cb13-648"><a href="#cb13-648"></a></span>
<span id="cb13-649"><a href="#cb13-649"></a><span class="co"># Prior precision (Minnesota structure)</span></span>
<span id="cb13-650"><a href="#cb13-650"></a>a_v_i_prior <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>, M <span class="sc">*</span> K) <span class="sc">*</span> <span class="fl">0.01</span></span>
<span id="cb13-651"><a href="#cb13-651"></a></span>
<span id="cb13-652"><a href="#cb13-652"></a><span class="co"># Prior for Sigma</span></span>
<span id="cb13-653"><a href="#cb13-653"></a>u_sigma_df_prior <span class="ot">&lt;-</span> K <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb13-654"><a href="#cb13-654"></a>u_sigma_scale_prior <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>, K)</span>
<span id="cb13-655"><a href="#cb13-655"></a></span>
<span id="cb13-656"><a href="#cb13-656"></a><span class="co"># Estimate</span></span>
<span id="cb13-657"><a href="#cb13-657"></a>bvar_est <span class="ot">&lt;-</span> <span class="fu">bvar</span>(</span>
<span id="cb13-658"><a href="#cb13-658"></a>  <span class="at">y =</span> y, <span class="at">x =</span> x,</span>
<span id="cb13-659"><a href="#cb13-659"></a>  <span class="at">A =</span> <span class="fu">list</span>(<span class="at">mu =</span> a_mu_prior, <span class="at">V_i =</span> a_v_i_prior),</span>
<span id="cb13-660"><a href="#cb13-660"></a>  <span class="at">Sigma =</span> <span class="fu">list</span>(<span class="at">df =</span> u_sigma_df_prior, <span class="at">scale =</span> u_sigma_scale_prior),</span>
<span id="cb13-661"><a href="#cb13-661"></a>  <span class="at">iterations =</span> <span class="dv">20000</span>, <span class="at">burnin =</span> <span class="dv">5000</span></span>
<span id="cb13-662"><a href="#cb13-662"></a>)</span>
<span id="cb13-663"><a href="#cb13-663"></a></span>
<span id="cb13-664"><a href="#cb13-664"></a><span class="co"># IRFs</span></span>
<span id="cb13-665"><a href="#cb13-665"></a>bvar_irf <span class="ot">&lt;-</span> <span class="fu">irf</span>(bvar_est,</span>
<span id="cb13-666"><a href="#cb13-666"></a>                <span class="at">impulse =</span> <span class="st">"interest_rate"</span>,</span>
<span id="cb13-667"><a href="#cb13-667"></a>                <span class="at">response =</span> <span class="st">"inflation"</span>,</span>
<span id="cb13-668"><a href="#cb13-668"></a>                <span class="at">n.ahead =</span> <span class="dv">20</span>,</span>
<span id="cb13-669"><a href="#cb13-669"></a>                <span class="at">type =</span> <span class="st">"feir"</span>,  <span class="co"># forecast error IRF</span></span>
<span id="cb13-670"><a href="#cb13-670"></a>                <span class="at">ci =</span> <span class="fl">0.95</span>)</span>
<span id="cb13-671"><a href="#cb13-671"></a><span class="fu">plot</span>(bvar_irf)</span>
<span id="cb13-672"><a href="#cb13-672"></a><span class="in">```</span></span>
<span id="cb13-673"><a href="#cb13-673"></a></span>
<span id="cb13-674"><a href="#cb13-674"></a><span class="fu">## Manual Implementation</span></span>
<span id="cb13-675"><a href="#cb13-675"></a></span>
<span id="cb13-676"><a href="#cb13-676"></a>For full control and understanding:</span>
<span id="cb13-677"><a href="#cb13-677"></a></span>
<span id="cb13-678"><a href="#cb13-678"></a><span class="in">```r</span></span>
<span id="cb13-679"><a href="#cb13-679"></a>bvar_gibbs <span class="ot">&lt;-</span> <span class="cf">function</span>(Y, p, <span class="at">n_draw =</span> <span class="dv">10000</span>, <span class="at">n_burn =</span> <span class="dv">2000</span>,</span>
<span id="cb13-680"><a href="#cb13-680"></a>                        <span class="at">lambda1 =</span> <span class="fl">0.2</span>, <span class="at">lambda2 =</span> <span class="fl">0.5</span>, <span class="at">lambda3 =</span> <span class="dv">100</span>) {</span>
<span id="cb13-681"><a href="#cb13-681"></a>  T_full <span class="ot">&lt;-</span> <span class="fu">nrow</span>(Y)</span>
<span id="cb13-682"><a href="#cb13-682"></a>  K <span class="ot">&lt;-</span> <span class="fu">ncol</span>(Y)</span>
<span id="cb13-683"><a href="#cb13-683"></a>  M <span class="ot">&lt;-</span> K <span class="sc">*</span> p <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-684"><a href="#cb13-684"></a></span>
<span id="cb13-685"><a href="#cb13-685"></a>  <span class="co"># Build data matrices</span></span>
<span id="cb13-686"><a href="#cb13-686"></a>  y <span class="ot">&lt;-</span> Y[(p <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>T_full, ]</span>
<span id="cb13-687"><a href="#cb13-687"></a>  T_eff <span class="ot">&lt;-</span> <span class="fu">nrow</span>(y)</span>
<span id="cb13-688"><a href="#cb13-688"></a>  X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>)</span>
<span id="cb13-689"><a href="#cb13-689"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p) {</span>
<span id="cb13-690"><a href="#cb13-690"></a>    X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(X, Y[(p <span class="sc">+</span> <span class="dv">1</span> <span class="sc">-</span> j)<span class="sc">:</span>(T_full <span class="sc">-</span> j), ])</span>
<span id="cb13-691"><a href="#cb13-691"></a>  }</span>
<span id="cb13-692"><a href="#cb13-692"></a></span>
<span id="cb13-693"><a href="#cb13-693"></a>  <span class="co"># Minnesota prior mean</span></span>
<span id="cb13-694"><a href="#cb13-694"></a>  B0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, M, K)</span>
<span id="cb13-695"><a href="#cb13-695"></a>  B0[<span class="dv">2</span><span class="sc">:</span>(K <span class="sc">+</span> <span class="dv">1</span>), ] <span class="ot">&lt;-</span> <span class="fu">diag</span>(K)  <span class="co"># first lag = identity</span></span>
<span id="cb13-696"><a href="#cb13-696"></a></span>
<span id="cb13-697"><a href="#cb13-697"></a>  <span class="co"># Scaling from AR residuals</span></span>
<span id="cb13-698"><a href="#cb13-698"></a>  sigma_i <span class="ot">&lt;-</span> <span class="fu">numeric</span>(K)</span>
<span id="cb13-699"><a href="#cb13-699"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K) {</span>
<span id="cb13-700"><a href="#cb13-700"></a>    ar_fit <span class="ot">&lt;-</span> <span class="fu">ar</span>(Y[, i], <span class="at">order.max =</span> p, <span class="at">method =</span> <span class="st">"ols"</span>)</span>
<span id="cb13-701"><a href="#cb13-701"></a>    sigma_i[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(ar_fit<span class="sc">$</span>var.pred)</span>
<span id="cb13-702"><a href="#cb13-702"></a>  }</span>
<span id="cb13-703"><a href="#cb13-703"></a></span>
<span id="cb13-704"><a href="#cb13-704"></a>  <span class="co"># Prior variance (Minnesota structure)</span></span>
<span id="cb13-705"><a href="#cb13-705"></a>  V0_diag <span class="ot">&lt;-</span> <span class="fu">numeric</span>(M <span class="sc">*</span> K)</span>
<span id="cb13-706"><a href="#cb13-706"></a>  <span class="cf">for</span> (eq <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K) {</span>
<span id="cb13-707"><a href="#cb13-707"></a>    idx <span class="ot">&lt;-</span> (eq <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> M <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-708"><a href="#cb13-708"></a>    V0_diag[idx] <span class="ot">&lt;-</span> (lambda1 <span class="sc">*</span> lambda3)<span class="sc">^</span><span class="dv">2</span>  <span class="co"># constant</span></span>
<span id="cb13-709"><a href="#cb13-709"></a></span>
<span id="cb13-710"><a href="#cb13-710"></a>    <span class="cf">for</span> (lag <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p) {</span>
<span id="cb13-711"><a href="#cb13-711"></a>      <span class="cf">for</span> (var <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K) {</span>
<span id="cb13-712"><a href="#cb13-712"></a>        idx <span class="ot">&lt;-</span> (eq <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> M <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> (lag <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> K <span class="sc">+</span> var</span>
<span id="cb13-713"><a href="#cb13-713"></a>        <span class="cf">if</span> (var <span class="sc">==</span> eq) {</span>
<span id="cb13-714"><a href="#cb13-714"></a>          V0_diag[idx] <span class="ot">&lt;-</span> (lambda1 <span class="sc">/</span> lag)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb13-715"><a href="#cb13-715"></a>        } <span class="cf">else</span> {</span>
<span id="cb13-716"><a href="#cb13-716"></a>          V0_diag[idx] <span class="ot">&lt;-</span> (lambda1 <span class="sc">*</span> lambda2 <span class="sc">*</span> sigma_i[eq] <span class="sc">/</span> (lag <span class="sc">*</span> sigma_i[var]))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb13-717"><a href="#cb13-717"></a>        }</span>
<span id="cb13-718"><a href="#cb13-718"></a>      }</span>
<span id="cb13-719"><a href="#cb13-719"></a>    }</span>
<span id="cb13-720"><a href="#cb13-720"></a>  }</span>
<span id="cb13-721"><a href="#cb13-721"></a>  V0_inv <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span> <span class="sc">/</span> V0_diag)</span>
<span id="cb13-722"><a href="#cb13-722"></a></span>
<span id="cb13-723"><a href="#cb13-723"></a>  <span class="co"># Inverse Wishart prior</span></span>
<span id="cb13-724"><a href="#cb13-724"></a>  v0 <span class="ot">&lt;-</span> K <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb13-725"><a href="#cb13-725"></a>  S0 <span class="ot">&lt;-</span> <span class="fu">diag</span>(sigma_i<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb13-726"><a href="#cb13-726"></a></span>
<span id="cb13-727"><a href="#cb13-727"></a>  <span class="co"># Storage and initialization</span></span>
<span id="cb13-728"><a href="#cb13-728"></a>  B_draws <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(M, K, n_draw))</span>
<span id="cb13-729"><a href="#cb13-729"></a>  Sigma_draws <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(K, K, n_draw))</span>
<span id="cb13-730"><a href="#cb13-730"></a>  B_curr <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">crossprod</span>(X)) <span class="sc">%*%</span> <span class="fu">crossprod</span>(X, y)</span>
<span id="cb13-731"><a href="#cb13-731"></a>  Sigma_curr <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(y <span class="sc">-</span> X <span class="sc">%*%</span> B_curr) <span class="sc">/</span> T_eff</span>
<span id="cb13-732"><a href="#cb13-732"></a></span>
<span id="cb13-733"><a href="#cb13-733"></a>  <span class="co"># Gibbs sampler</span></span>
<span id="cb13-734"><a href="#cb13-734"></a>  <span class="cf">for</span> (g <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n_draw <span class="sc">+</span> n_burn)) {</span>
<span id="cb13-735"><a href="#cb13-735"></a>    <span class="co"># Block 1: B | Sigma</span></span>
<span id="cb13-736"><a href="#cb13-736"></a>    Sigma_inv <span class="ot">&lt;-</span> <span class="fu">solve</span>(Sigma_curr)</span>
<span id="cb13-737"><a href="#cb13-737"></a>    V_post_inv <span class="ot">&lt;-</span> V0_inv <span class="sc">+</span> <span class="fu">kronecker</span>(Sigma_inv, <span class="fu">crossprod</span>(X))</span>
<span id="cb13-738"><a href="#cb13-738"></a>    V_post <span class="ot">&lt;-</span> <span class="fu">solve</span>(V_post_inv)</span>
<span id="cb13-739"><a href="#cb13-739"></a>    b_post <span class="ot">&lt;-</span> V_post <span class="sc">%*%</span> (V0_inv <span class="sc">%*%</span> <span class="fu">as.vector</span>(B0) <span class="sc">+</span></span>
<span id="cb13-740"><a href="#cb13-740"></a>                           <span class="fu">kronecker</span>(Sigma_inv, <span class="fu">t</span>(X)) <span class="sc">%*%</span> <span class="fu">as.vector</span>(y))</span>
<span id="cb13-741"><a href="#cb13-741"></a>    B_curr <span class="ot">&lt;-</span> <span class="fu">matrix</span>(mvtnorm<span class="sc">::</span><span class="fu">rmvnorm</span>(<span class="dv">1</span>, b_post, V_post), M, K)</span>
<span id="cb13-742"><a href="#cb13-742"></a></span>
<span id="cb13-743"><a href="#cb13-743"></a>    <span class="co"># Block 2: Sigma | B</span></span>
<span id="cb13-744"><a href="#cb13-744"></a>    U <span class="ot">&lt;-</span> y <span class="sc">-</span> X <span class="sc">%*%</span> B_curr</span>
<span id="cb13-745"><a href="#cb13-745"></a>    S_post <span class="ot">&lt;-</span> S0 <span class="sc">+</span> <span class="fu">crossprod</span>(U)</span>
<span id="cb13-746"><a href="#cb13-746"></a>    v_post <span class="ot">&lt;-</span> v0 <span class="sc">+</span> T_eff</span>
<span id="cb13-747"><a href="#cb13-747"></a>    Sigma_curr <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">rWishart</span>(<span class="dv">1</span>, v_post, <span class="fu">solve</span>(S_post))[,,<span class="dv">1</span>])</span>
<span id="cb13-748"><a href="#cb13-748"></a></span>
<span id="cb13-749"><a href="#cb13-749"></a>    <span class="cf">if</span> (g <span class="sc">&gt;</span> n_burn) {</span>
<span id="cb13-750"><a href="#cb13-750"></a>      B_draws[,,g <span class="sc">-</span> n_burn] <span class="ot">&lt;-</span> B_curr</span>
<span id="cb13-751"><a href="#cb13-751"></a>      Sigma_draws[,,g <span class="sc">-</span> n_burn] <span class="ot">&lt;-</span> Sigma_curr</span>
<span id="cb13-752"><a href="#cb13-752"></a>    }</span>
<span id="cb13-753"><a href="#cb13-753"></a>  }</span>
<span id="cb13-754"><a href="#cb13-754"></a></span>
<span id="cb13-755"><a href="#cb13-755"></a>  <span class="fu">list</span>(<span class="at">B =</span> B_draws, <span class="at">Sigma =</span> Sigma_draws, <span class="at">K =</span> K, <span class="at">p =</span> p)</span>
<span id="cb13-756"><a href="#cb13-756"></a>}</span>
<span id="cb13-757"><a href="#cb13-757"></a><span class="in">```</span></span>
<span id="cb13-758"><a href="#cb13-758"></a></span>
<span id="cb13-759"><a href="#cb13-759"></a><span class="fu"># Implementation in Python {.unnumbered}</span></span>
<span id="cb13-760"><a href="#cb13-760"></a></span>
<span id="cb13-761"><a href="#cb13-761"></a>For those who prefer Python, here are equivalent implementations.</span>
<span id="cb13-762"><a href="#cb13-762"></a></span>
<span id="cb13-763"><a href="#cb13-763"></a><span class="fu">## Using NumPy/SciPy (Manual)</span></span>
<span id="cb13-764"><a href="#cb13-764"></a></span>
<span id="cb13-765"><a href="#cb13-765"></a><span class="in">```python</span></span>
<span id="cb13-766"><a href="#cb13-766"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb13-767"><a href="#cb13-767"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb13-768"><a href="#cb13-768"></a><span class="im">from</span> scipy.linalg <span class="im">import</span> cholesky, solve</span>
<span id="cb13-769"><a href="#cb13-769"></a></span>
<span id="cb13-770"><a href="#cb13-770"></a><span class="kw">def</span> bvar_gibbs(Y, p, n_draw<span class="op">=</span><span class="dv">10000</span>, n_burn<span class="op">=</span><span class="dv">2000</span>,</span>
<span id="cb13-771"><a href="#cb13-771"></a>               lambda1<span class="op">=</span><span class="fl">0.2</span>, lambda2<span class="op">=</span><span class="fl">0.5</span>, lambda3<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb13-772"><a href="#cb13-772"></a>    <span class="co">"""</span></span>
<span id="cb13-773"><a href="#cb13-773"></a><span class="co">    Bayesian VAR with Minnesota prior via Gibbs sampling.</span></span>
<span id="cb13-774"><a href="#cb13-774"></a></span>
<span id="cb13-775"><a href="#cb13-775"></a><span class="co">    Parameters</span></span>
<span id="cb13-776"><a href="#cb13-776"></a><span class="co">    ----------</span></span>
<span id="cb13-777"><a href="#cb13-777"></a><span class="co">    Y : ndarray (T, K)</span></span>
<span id="cb13-778"><a href="#cb13-778"></a><span class="co">        Data matrix</span></span>
<span id="cb13-779"><a href="#cb13-779"></a><span class="co">    p : int</span></span>
<span id="cb13-780"><a href="#cb13-780"></a><span class="co">        Lag order</span></span>
<span id="cb13-781"><a href="#cb13-781"></a><span class="co">    n_draw : int</span></span>
<span id="cb13-782"><a href="#cb13-782"></a><span class="co">        Number of posterior draws</span></span>
<span id="cb13-783"><a href="#cb13-783"></a><span class="co">    n_burn : int</span></span>
<span id="cb13-784"><a href="#cb13-784"></a><span class="co">        Burn-in period</span></span>
<span id="cb13-785"><a href="#cb13-785"></a><span class="co">    lambda1, lambda2, lambda3 : float</span></span>
<span id="cb13-786"><a href="#cb13-786"></a><span class="co">        Minnesota prior hyperparameters</span></span>
<span id="cb13-787"><a href="#cb13-787"></a></span>
<span id="cb13-788"><a href="#cb13-788"></a><span class="co">    Returns</span></span>
<span id="cb13-789"><a href="#cb13-789"></a><span class="co">    -------</span></span>
<span id="cb13-790"><a href="#cb13-790"></a><span class="co">    dict with posterior draws of B and Sigma</span></span>
<span id="cb13-791"><a href="#cb13-791"></a><span class="co">    """</span></span>
<span id="cb13-792"><a href="#cb13-792"></a>    T_full, K <span class="op">=</span> Y.shape</span>
<span id="cb13-793"><a href="#cb13-793"></a>    M <span class="op">=</span> K <span class="op">*</span> p <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb13-794"><a href="#cb13-794"></a></span>
<span id="cb13-795"><a href="#cb13-795"></a>    <span class="co"># Build data matrices</span></span>
<span id="cb13-796"><a href="#cb13-796"></a>    y <span class="op">=</span> Y[p:]</span>
<span id="cb13-797"><a href="#cb13-797"></a>    T_eff <span class="op">=</span> <span class="bu">len</span>(y)</span>
<span id="cb13-798"><a href="#cb13-798"></a></span>
<span id="cb13-799"><a href="#cb13-799"></a>    X <span class="op">=</span> np.ones((T_eff, <span class="dv">1</span>))</span>
<span id="cb13-800"><a href="#cb13-800"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, p <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb13-801"><a href="#cb13-801"></a>        X <span class="op">=</span> np.hstack([X, Y[p<span class="op">-</span>j:T_full<span class="op">-</span>j]])</span>
<span id="cb13-802"><a href="#cb13-802"></a></span>
<span id="cb13-803"><a href="#cb13-803"></a>    <span class="co"># Minnesota prior mean (random walk on first lag)</span></span>
<span id="cb13-804"><a href="#cb13-804"></a>    B0 <span class="op">=</span> np.zeros((M, K))</span>
<span id="cb13-805"><a href="#cb13-805"></a>    B0[<span class="dv">1</span>:K<span class="op">+</span><span class="dv">1</span>, :] <span class="op">=</span> np.eye(K)</span>
<span id="cb13-806"><a href="#cb13-806"></a></span>
<span id="cb13-807"><a href="#cb13-807"></a>    <span class="co"># AR residual scaling</span></span>
<span id="cb13-808"><a href="#cb13-808"></a>    sigma_i <span class="op">=</span> np.zeros(K)</span>
<span id="cb13-809"><a href="#cb13-809"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(K):</span>
<span id="cb13-810"><a href="#cb13-810"></a>        ar_resid <span class="op">=</span> Y[p:, i] <span class="op">-</span> Y[p<span class="op">-</span><span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>, i] <span class="op">*</span> <span class="fl">0.9</span>  <span class="co"># approximate</span></span>
<span id="cb13-811"><a href="#cb13-811"></a>        sigma_i[i] <span class="op">=</span> np.std(ar_resid)</span>
<span id="cb13-812"><a href="#cb13-812"></a></span>
<span id="cb13-813"><a href="#cb13-813"></a>    <span class="co"># Prior variance (Minnesota structure)</span></span>
<span id="cb13-814"><a href="#cb13-814"></a>    V0_diag <span class="op">=</span> np.zeros(M <span class="op">*</span> K)</span>
<span id="cb13-815"><a href="#cb13-815"></a>    <span class="cf">for</span> eq <span class="kw">in</span> <span class="bu">range</span>(K):</span>
<span id="cb13-816"><a href="#cb13-816"></a>        idx <span class="op">=</span> eq <span class="op">*</span> M</span>
<span id="cb13-817"><a href="#cb13-817"></a>        V0_diag[idx] <span class="op">=</span> (lambda1 <span class="op">*</span> lambda3)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb13-818"><a href="#cb13-818"></a></span>
<span id="cb13-819"><a href="#cb13-819"></a>        <span class="cf">for</span> lag <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, p <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb13-820"><a href="#cb13-820"></a>            <span class="cf">for</span> var <span class="kw">in</span> <span class="bu">range</span>(K):</span>
<span id="cb13-821"><a href="#cb13-821"></a>                idx <span class="op">=</span> eq <span class="op">*</span> M <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> (lag <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> K <span class="op">+</span> var</span>
<span id="cb13-822"><a href="#cb13-822"></a>                <span class="cf">if</span> var <span class="op">==</span> eq:</span>
<span id="cb13-823"><a href="#cb13-823"></a>                    V0_diag[idx] <span class="op">=</span> (lambda1 <span class="op">/</span> lag)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb13-824"><a href="#cb13-824"></a>                <span class="cf">else</span>:</span>
<span id="cb13-825"><a href="#cb13-825"></a>                    V0_diag[idx] <span class="op">=</span> (lambda1 <span class="op">*</span> lambda2 <span class="op">*</span> sigma_i[eq] <span class="op">/</span></span>
<span id="cb13-826"><a href="#cb13-826"></a>                                    (lag <span class="op">*</span> sigma_i[var]))<span class="op">**</span><span class="dv">2</span></span>
<span id="cb13-827"><a href="#cb13-827"></a></span>
<span id="cb13-828"><a href="#cb13-828"></a>    V0_inv <span class="op">=</span> np.diag(<span class="dv">1</span> <span class="op">/</span> V0_diag)</span>
<span id="cb13-829"><a href="#cb13-829"></a></span>
<span id="cb13-830"><a href="#cb13-830"></a>    <span class="co"># Inverse Wishart prior</span></span>
<span id="cb13-831"><a href="#cb13-831"></a>    v0 <span class="op">=</span> K <span class="op">+</span> <span class="dv">2</span></span>
<span id="cb13-832"><a href="#cb13-832"></a>    S0 <span class="op">=</span> np.diag(sigma_i<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb13-833"><a href="#cb13-833"></a></span>
<span id="cb13-834"><a href="#cb13-834"></a>    <span class="co"># Initialize</span></span>
<span id="cb13-835"><a href="#cb13-835"></a>    B_curr <span class="op">=</span> np.linalg.lstsq(X, y, rcond<span class="op">=</span><span class="va">None</span>)[<span class="dv">0</span>]</span>
<span id="cb13-836"><a href="#cb13-836"></a>    U <span class="op">=</span> y <span class="op">-</span> X <span class="op">@</span> B_curr</span>
<span id="cb13-837"><a href="#cb13-837"></a>    Sigma_curr <span class="op">=</span> U.T <span class="op">@</span> U <span class="op">/</span> T_eff</span>
<span id="cb13-838"><a href="#cb13-838"></a></span>
<span id="cb13-839"><a href="#cb13-839"></a>    <span class="co"># Storage</span></span>
<span id="cb13-840"><a href="#cb13-840"></a>    B_draws <span class="op">=</span> np.zeros((M, K, n_draw))</span>
<span id="cb13-841"><a href="#cb13-841"></a>    Sigma_draws <span class="op">=</span> np.zeros((K, K, n_draw))</span>
<span id="cb13-842"><a href="#cb13-842"></a></span>
<span id="cb13-843"><a href="#cb13-843"></a>    <span class="cf">for</span> g <span class="kw">in</span> <span class="bu">range</span>(n_draw <span class="op">+</span> n_burn):</span>
<span id="cb13-844"><a href="#cb13-844"></a>        <span class="co"># Block 1: Draw B | Sigma</span></span>
<span id="cb13-845"><a href="#cb13-845"></a>        Sigma_inv <span class="op">=</span> np.linalg.inv(Sigma_curr)</span>
<span id="cb13-846"><a href="#cb13-846"></a>        V_post_inv <span class="op">=</span> V0_inv <span class="op">+</span> np.kron(Sigma_inv, X.T <span class="op">@</span> X)</span>
<span id="cb13-847"><a href="#cb13-847"></a>        V_post <span class="op">=</span> np.linalg.inv(V_post_inv)</span>
<span id="cb13-848"><a href="#cb13-848"></a></span>
<span id="cb13-849"><a href="#cb13-849"></a>        b0_vec <span class="op">=</span> B0.flatten(<span class="st">'F'</span>)</span>
<span id="cb13-850"><a href="#cb13-850"></a>        xy_vec <span class="op">=</span> (X.T <span class="op">@</span> y <span class="op">@</span> Sigma_inv).flatten(<span class="st">'F'</span>)</span>
<span id="cb13-851"><a href="#cb13-851"></a>        b_post <span class="op">=</span> V_post <span class="op">@</span> (V0_inv <span class="op">@</span> b0_vec <span class="op">+</span> xy_vec)</span>
<span id="cb13-852"><a href="#cb13-852"></a></span>
<span id="cb13-853"><a href="#cb13-853"></a>        B_curr <span class="op">=</span> np.random.multivariate_normal(b_post, V_post).reshape((M, K), order<span class="op">=</span><span class="st">'F'</span>)</span>
<span id="cb13-854"><a href="#cb13-854"></a></span>
<span id="cb13-855"><a href="#cb13-855"></a>        <span class="co"># Block 2: Draw Sigma | B</span></span>
<span id="cb13-856"><a href="#cb13-856"></a>        U <span class="op">=</span> y <span class="op">-</span> X <span class="op">@</span> B_curr</span>
<span id="cb13-857"><a href="#cb13-857"></a>        S_post <span class="op">=</span> S0 <span class="op">+</span> U.T <span class="op">@</span> U</span>
<span id="cb13-858"><a href="#cb13-858"></a>        v_post <span class="op">=</span> v0 <span class="op">+</span> T_eff</span>
<span id="cb13-859"><a href="#cb13-859"></a></span>
<span id="cb13-860"><a href="#cb13-860"></a>        <span class="co"># Inverse Wishart draw</span></span>
<span id="cb13-861"><a href="#cb13-861"></a>        Sigma_curr <span class="op">=</span> stats.invwishart.rvs(df<span class="op">=</span>v_post, scale<span class="op">=</span>S_post)</span>
<span id="cb13-862"><a href="#cb13-862"></a></span>
<span id="cb13-863"><a href="#cb13-863"></a>        <span class="cf">if</span> g <span class="op">&gt;=</span> n_burn:</span>
<span id="cb13-864"><a href="#cb13-864"></a>            B_draws[:, :, g <span class="op">-</span> n_burn] <span class="op">=</span> B_curr</span>
<span id="cb13-865"><a href="#cb13-865"></a>            Sigma_draws[:, :, g <span class="op">-</span> n_burn] <span class="op">=</span> Sigma_curr</span>
<span id="cb13-866"><a href="#cb13-866"></a></span>
<span id="cb13-867"><a href="#cb13-867"></a>    <span class="cf">return</span> {<span class="st">'B'</span>: B_draws, <span class="st">'Sigma'</span>: Sigma_draws, <span class="st">'K'</span>: K, <span class="st">'p'</span>: p}</span>
<span id="cb13-868"><a href="#cb13-868"></a></span>
<span id="cb13-869"><a href="#cb13-869"></a></span>
<span id="cb13-870"><a href="#cb13-870"></a><span class="kw">def</span> compute_irfs(bvar_result, shock_idx, H<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb13-871"><a href="#cb13-871"></a>    <span class="co">"""</span></span>
<span id="cb13-872"><a href="#cb13-872"></a><span class="co">    Compute IRFs from BVAR posterior draws.</span></span>
<span id="cb13-873"><a href="#cb13-873"></a><span class="co">    """</span></span>
<span id="cb13-874"><a href="#cb13-874"></a>    B_draws <span class="op">=</span> bvar_result[<span class="st">'B'</span>]</span>
<span id="cb13-875"><a href="#cb13-875"></a>    Sigma_draws <span class="op">=</span> bvar_result[<span class="st">'Sigma'</span>]</span>
<span id="cb13-876"><a href="#cb13-876"></a>    K <span class="op">=</span> bvar_result[<span class="st">'K'</span>]</span>
<span id="cb13-877"><a href="#cb13-877"></a>    p <span class="op">=</span> bvar_result[<span class="st">'p'</span>]</span>
<span id="cb13-878"><a href="#cb13-878"></a>    n_draw <span class="op">=</span> B_draws.shape[<span class="dv">2</span>]</span>
<span id="cb13-879"><a href="#cb13-879"></a></span>
<span id="cb13-880"><a href="#cb13-880"></a>    IRF_draws <span class="op">=</span> np.zeros((K, H <span class="op">+</span> <span class="dv">1</span>, n_draw))</span>
<span id="cb13-881"><a href="#cb13-881"></a></span>
<span id="cb13-882"><a href="#cb13-882"></a>    <span class="cf">for</span> g <span class="kw">in</span> <span class="bu">range</span>(n_draw):</span>
<span id="cb13-883"><a href="#cb13-883"></a>        <span class="co"># Extract A matrices</span></span>
<span id="cb13-884"><a href="#cb13-884"></a>        A <span class="op">=</span> [B_draws[<span class="dv">1</span> <span class="op">+</span> j<span class="op">*</span>K:<span class="dv">1</span> <span class="op">+</span> (j<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>K, :, g].T <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(p)]</span>
<span id="cb13-885"><a href="#cb13-885"></a></span>
<span id="cb13-886"><a href="#cb13-886"></a>        <span class="co"># Cholesky impact</span></span>
<span id="cb13-887"><a href="#cb13-887"></a>        P <span class="op">=</span> cholesky(Sigma_draws[:, :, g], lower<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-888"><a href="#cb13-888"></a></span>
<span id="cb13-889"><a href="#cb13-889"></a>        <span class="co"># Compute IRFs</span></span>
<span id="cb13-890"><a href="#cb13-890"></a>        Phi <span class="op">=</span> np.eye(K)</span>
<span id="cb13-891"><a href="#cb13-891"></a>        IRF_draws[:, <span class="dv">0</span>, g] <span class="op">=</span> P[:, shock_idx]</span>
<span id="cb13-892"><a href="#cb13-892"></a></span>
<span id="cb13-893"><a href="#cb13-893"></a>        <span class="cf">for</span> h <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, H <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb13-894"><a href="#cb13-894"></a>            Phi <span class="op">=</span> Phi <span class="op">@</span> A[<span class="dv">0</span>] <span class="cf">if</span> p <span class="op">&gt;=</span> <span class="dv">1</span> <span class="cf">else</span> np.zeros((K, K))</span>
<span id="cb13-895"><a href="#cb13-895"></a>            IRF_draws[:, h, g] <span class="op">=</span> Phi <span class="op">@</span> P[:, shock_idx]</span>
<span id="cb13-896"><a href="#cb13-896"></a></span>
<span id="cb13-897"><a href="#cb13-897"></a>    <span class="cf">return</span> {</span>
<span id="cb13-898"><a href="#cb13-898"></a>        <span class="st">'median'</span>: np.median(IRF_draws, axis<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb13-899"><a href="#cb13-899"></a>        <span class="st">'lower'</span>: np.percentile(IRF_draws, <span class="dv">16</span>, axis<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb13-900"><a href="#cb13-900"></a>        <span class="st">'upper'</span>: np.percentile(IRF_draws, <span class="dv">84</span>, axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb13-901"><a href="#cb13-901"></a>    }</span>
<span id="cb13-902"><a href="#cb13-902"></a><span class="in">```</span></span>
<span id="cb13-903"><a href="#cb13-903"></a></span>
<span id="cb13-904"><a href="#cb13-904"></a><span class="fu">## Using PyMC (Probabilistic Programming)</span></span>
<span id="cb13-905"><a href="#cb13-905"></a></span>
<span id="cb13-906"><a href="#cb13-906"></a><span class="in">```python</span></span>
<span id="cb13-907"><a href="#cb13-907"></a><span class="im">import</span> pymc <span class="im">as</span> pm</span>
<span id="cb13-908"><a href="#cb13-908"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb13-909"><a href="#cb13-909"></a><span class="im">import</span> arviz <span class="im">as</span> az</span>
<span id="cb13-910"><a href="#cb13-910"></a></span>
<span id="cb13-911"><a href="#cb13-911"></a><span class="kw">def</span> bvar_pymc(Y, p, n_draw<span class="op">=</span><span class="dv">2000</span>, n_tune<span class="op">=</span><span class="dv">1000</span>):</span>
<span id="cb13-912"><a href="#cb13-912"></a>    <span class="co">"""</span></span>
<span id="cb13-913"><a href="#cb13-913"></a><span class="co">    Bayesian VAR using PyMC.</span></span>
<span id="cb13-914"><a href="#cb13-914"></a><span class="co">    """</span></span>
<span id="cb13-915"><a href="#cb13-915"></a>    T_full, K <span class="op">=</span> Y.shape</span>
<span id="cb13-916"><a href="#cb13-916"></a></span>
<span id="cb13-917"><a href="#cb13-917"></a>    <span class="co"># Build data matrices</span></span>
<span id="cb13-918"><a href="#cb13-918"></a>    y <span class="op">=</span> Y[p:]</span>
<span id="cb13-919"><a href="#cb13-919"></a>    T_eff <span class="op">=</span> <span class="bu">len</span>(y)</span>
<span id="cb13-920"><a href="#cb13-920"></a></span>
<span id="cb13-921"><a href="#cb13-921"></a>    X <span class="op">=</span> np.ones((T_eff, <span class="dv">1</span>))</span>
<span id="cb13-922"><a href="#cb13-922"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, p <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb13-923"><a href="#cb13-923"></a>        X <span class="op">=</span> np.hstack([X, Y[p<span class="op">-</span>j:T_full<span class="op">-</span>j]])</span>
<span id="cb13-924"><a href="#cb13-924"></a>    M <span class="op">=</span> X.shape[<span class="dv">1</span>]</span>
<span id="cb13-925"><a href="#cb13-925"></a></span>
<span id="cb13-926"><a href="#cb13-926"></a>    <span class="cf">with</span> pm.Model() <span class="im">as</span> bvar_model:</span>
<span id="cb13-927"><a href="#cb13-927"></a>        <span class="co"># Priors</span></span>
<span id="cb13-928"><a href="#cb13-928"></a>        <span class="co"># Coefficients: Normal with Minnesota-style shrinkage</span></span>
<span id="cb13-929"><a href="#cb13-929"></a>        B <span class="op">=</span> pm.Normal(<span class="st">'B'</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="fl">0.5</span>, shape<span class="op">=</span>(M, K))</span>
<span id="cb13-930"><a href="#cb13-930"></a></span>
<span id="cb13-931"><a href="#cb13-931"></a>        <span class="co"># Covariance: LKJ prior on correlation + half-normal on scales</span></span>
<span id="cb13-932"><a href="#cb13-932"></a>        chol, corr, stds <span class="op">=</span> pm.LKJCholeskyCov(</span>
<span id="cb13-933"><a href="#cb13-933"></a>            <span class="st">'chol'</span>, n<span class="op">=</span>K, eta<span class="op">=</span><span class="dv">2</span>, sd_dist<span class="op">=</span>pm.HalfNormal.dist(sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-934"><a href="#cb13-934"></a>        )</span>
<span id="cb13-935"><a href="#cb13-935"></a>        Sigma <span class="op">=</span> pm.Deterministic(<span class="st">'Sigma'</span>, chol <span class="op">@</span> chol.T)</span>
<span id="cb13-936"><a href="#cb13-936"></a></span>
<span id="cb13-937"><a href="#cb13-937"></a>        <span class="co"># Likelihood</span></span>
<span id="cb13-938"><a href="#cb13-938"></a>        mu <span class="op">=</span> pm.math.dot(X, B)</span>
<span id="cb13-939"><a href="#cb13-939"></a>        y_obs <span class="op">=</span> pm.MvNormal(<span class="st">'y'</span>, mu<span class="op">=</span>mu, chol<span class="op">=</span>chol, observed<span class="op">=</span>y)</span>
<span id="cb13-940"><a href="#cb13-940"></a></span>
<span id="cb13-941"><a href="#cb13-941"></a>        <span class="co"># Sample</span></span>
<span id="cb13-942"><a href="#cb13-942"></a>        trace <span class="op">=</span> pm.sample(n_draw, tune<span class="op">=</span>n_tune, cores<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb13-943"><a href="#cb13-943"></a>                          return_inferencedata<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-944"><a href="#cb13-944"></a></span>
<span id="cb13-945"><a href="#cb13-945"></a>    <span class="cf">return</span> trace</span>
<span id="cb13-946"><a href="#cb13-946"></a></span>
<span id="cb13-947"><a href="#cb13-947"></a><span class="co"># Usage:</span></span>
<span id="cb13-948"><a href="#cb13-948"></a><span class="co"># trace = bvar_pymc(Y, p=4)</span></span>
<span id="cb13-949"><a href="#cb13-949"></a><span class="co"># az.plot_trace(trace, var_names=['B'])</span></span>
<span id="cb13-950"><a href="#cb13-950"></a><span class="co"># az.summary(trace, var_names=['B', 'Sigma'])</span></span>
<span id="cb13-951"><a href="#cb13-951"></a><span class="in">```</span></span>
<span id="cb13-952"><a href="#cb13-952"></a></span>
<span id="cb13-953"><a href="#cb13-953"></a><span class="fu"># Summary {.unnumbered}</span></span>
<span id="cb13-954"><a href="#cb13-954"></a></span>
<span id="cb13-955"><a href="#cb13-955"></a>Key takeaways:</span>
<span id="cb13-956"><a href="#cb13-956"></a></span>
<span id="cb13-957"><a href="#cb13-957"></a><span class="ss">1. </span>**Why Bayesian VAR**: Shrinkage prevents overfitting when parameters outnumber observations</span>
<span id="cb13-958"><a href="#cb13-958"></a></span>
<span id="cb13-959"><a href="#cb13-959"></a><span class="ss">2. </span>**Minnesota Prior**: Encodes beliefs that macro variables are persistent, own lags dominate, recent lags matter more</span>
<span id="cb13-960"><a href="#cb13-960"></a></span>
<span id="cb13-961"><a href="#cb13-961"></a><span class="ss">3. </span>**GLP Optimization**: Data-driven hyperparameter selection via marginal likelihood maximization</span>
<span id="cb13-962"><a href="#cb13-962"></a></span>
<span id="cb13-963"><a href="#cb13-963"></a><span class="ss">4. </span>**Gibbs Sampling**: Iteratively draw $B|\Sigma$ and $\Sigma|B$ from conditional posteriors</span>
<span id="cb13-964"><a href="#cb13-964"></a></span>
<span id="cb13-965"><a href="#cb13-965"></a><span class="ss">5. </span>**Structural Identification**: Cholesky (recursive) or sign restrictions, applied to each posterior draw</span>
<span id="cb13-966"><a href="#cb13-966"></a></span>
<span id="cb13-967"><a href="#cb13-967"></a><span class="ss">6. </span>**Reporting**: Present posterior median IRFs with 68% and 95% credible bands</span>
<span id="cb13-968"><a href="#cb13-968"></a></span>
<span id="cb13-969"><a href="#cb13-969"></a><span class="ss">7. </span>**Software**:</span>
<span id="cb13-970"><a href="#cb13-970"></a><span class="ss">   - </span>R: <span class="in">`BVAR`</span> (GLP optimization), <span class="in">`bvartools`</span> (flexible), <span class="in">`bvarsv`</span> (TVP-VAR)</span>
<span id="cb13-971"><a href="#cb13-971"></a><span class="ss">   - </span>Python: Manual with NumPy/SciPy, or PyMC for probabilistic programming</span>
<span id="cb13-972"><a href="#cb13-972"></a></span>
<span id="cb13-973"><a href="#cb13-973"></a>---</span>
<span id="cb13-974"><a href="#cb13-974"></a></span>
<span id="cb13-975"><a href="#cb13-975"></a><span class="fu">## Key References</span></span>
<span id="cb13-976"><a href="#cb13-976"></a></span>
<span id="cb13-977"><a href="#cb13-977"></a>**Foundational**:</span>
<span id="cb13-978"><a href="#cb13-978"></a></span>
<span id="cb13-979"><a href="#cb13-979"></a><span class="ss">- </span>Litterman (1986). "Forecasting with Bayesian VARs." *JBES*</span>
<span id="cb13-980"><a href="#cb13-980"></a><span class="ss">- </span>Doan, Litterman &amp; Sims (1984). "Forecasting and Conditional Projection."</span>
<span id="cb13-981"><a href="#cb13-981"></a><span class="ss">- </span>Sims &amp; Zha (1998). "Bayesian Methods for Dynamic Multivariate Models." *IER*</span>
<span id="cb13-982"><a href="#cb13-982"></a></span>
<span id="cb13-983"><a href="#cb13-983"></a>**Modern Methods**:</span>
<span id="cb13-984"><a href="#cb13-984"></a></span>
<span id="cb13-985"><a href="#cb13-985"></a><span class="ss">- </span>Giannone, Lenza &amp; Primiceri (2015). "Prior Selection for VARs." *REStat*</span>
<span id="cb13-986"><a href="#cb13-986"></a><span class="ss">- </span>Banbura, Giannone &amp; Reichlin (2010). "Large Bayesian VARs." *JAE*</span>
<span id="cb13-987"><a href="#cb13-987"></a><span class="ss">- </span>Carriero, Clark &amp; Marcellino (2019). "Large BVARs with Stochastic Volatility." *JoE*</span>
<span id="cb13-988"><a href="#cb13-988"></a></span>
<span id="cb13-989"><a href="#cb13-989"></a>**Textbooks**:</span>
<span id="cb13-990"><a href="#cb13-990"></a></span>
<span id="cb13-991"><a href="#cb13-991"></a><span class="ss">- </span>Koop (2003). *Bayesian Econometrics*</span>
<span id="cb13-992"><a href="#cb13-992"></a><span class="ss">- </span>Blake &amp; Mumtaz (2012). *Applied Bayesian Econometrics for Central Bankers*</span>
<span id="cb13-993"><a href="#cb13-993"></a></span>
<span id="cb13-994"><a href="#cb13-994"></a>**R Packages**:</span>
<span id="cb13-995"><a href="#cb13-995"></a></span>
<span id="cb13-996"><a href="#cb13-996"></a><span class="ss">- </span><span class="in">`BVAR`</span>: Kuschnig &amp; Vashold — Minnesota prior with GLP</span>
<span id="cb13-997"><a href="#cb13-997"></a><span class="ss">- </span><span class="in">`bvartools`</span>: Mohr — Flexible BVAR toolkit</span>
<span id="cb13-998"><a href="#cb13-998"></a><span class="ss">- </span><span class="in">`bvarsv`</span>: Krueger — TVP-VAR with stochastic volatility</span>
<span id="cb13-999"><a href="#cb13-999"></a></span>
<span id="cb13-1000"><a href="#cb13-1000"></a>---</span>
<span id="cb13-1001"><a href="#cb13-1001"></a></span>
<span id="cb13-1002"><a href="#cb13-1002"></a>*Next: [Module 9: Bayesian Panel Methods](09_bayesian_panel.qmd)*</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Mastering Empirical Macroeconometrics by Bijoy Ratan Ghosh</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/bijoyratanghosh/empirical-macro-curriculum/edit/main/chapters/08_bayesian_var.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/bijoyratanghosh/empirical-macro-curriculum/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>